{"version":3,"file":"ol-pdf-printer.min.js","sources":["../node_modules/tslib/tslib.es6.js","../node_modules/dom-to-image-improved/src/dom-to-image-improved.js","../node_modules/@babel/runtime/helpers/esm/arrayLikeToArray.js","../node_modules/@babel/runtime/helpers/esm/unsupportedIterableToArray.js","../node_modules/@babel/runtime/helpers/esm/toConsumableArray.js","../node_modules/@babel/runtime/helpers/esm/arrayWithoutHoles.js","../node_modules/@babel/runtime/helpers/esm/iterableToArray.js","../node_modules/@babel/runtime/helpers/esm/nonIterableSpread.js","../node_modules/@babel/runtime/helpers/esm/typeof.js","../node_modules/@babel/runtime/helpers/esm/slicedToArray.js","../node_modules/@babel/runtime/helpers/esm/arrayWithHoles.js","../node_modules/@babel/runtime/helpers/esm/iterableToArrayLimit.js","../node_modules/@babel/runtime/helpers/esm/nonIterableRest.js","../src/myPragma.js","../src/components/Pdf.tsx","../node_modules/modal-vanilla/lib/modal.js","../src/components/SettingsModal.tsx","../src/components/Helpers.ts","../src/components/ProcessingModal.ts","../src/components/i18n/en.ts","../src/components/i18n/es.ts","../src/ol-pdf-printer.ts"],"sourcesContent":["/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport function __createBinding(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n}\r\n\r\nexport function __exportStar(m, exports) {\r\n    for (var p in m) if (p !== \"default\" && !exports.hasOwnProperty(p)) exports[p] = m[p];\r\n}\r\n\r\nexport function __values(o) {\r\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\r\n    if (m) return m.call(o);\r\n    if (o && typeof o.length === \"number\") return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n};\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\r\n    result.default = mod;\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n\r\nexport function __classPrivateFieldGet(receiver, privateMap) {\r\n    if (!privateMap.has(receiver)) {\r\n        throw new TypeError(\"attempted to get private field on non-instance\");\r\n    }\r\n    return privateMap.get(receiver);\r\n}\r\n\r\nexport function __classPrivateFieldSet(receiver, privateMap, value) {\r\n    if (!privateMap.has(receiver)) {\r\n        throw new TypeError(\"attempted to set private field on non-instance\");\r\n    }\r\n    privateMap.set(receiver, value);\r\n    return value;\r\n}\r\n","(function(global) {\n    'use strict';\n\n    var util = newUtil();\n    var inliner = newInliner();\n    var fontFaces = newFontFaces();\n    var images = newImages();\n\n    // Default impl options\n    var defaultOptions = {\n        // Default is to fail on error, no placeholder\n        imagePlaceholder: undefined,\n        // Default cache bust is false, it will use the cache\n        cacheBust: false,\n        // Use (existing) authentication credentials for external URIs (CORS requests)\n        useCredentials: false\n    };\n\n    var domtoimage = {\n        toSvg: toSvg,\n        toPng: toPng,\n        toJpeg: toJpeg,\n        toBlob: toBlob,\n        toPixelData: toPixelData,\n        toCanvas: toCanvas,\n        impl: {\n            fontFaces: fontFaces,\n            images: images,\n            util: util,\n            inliner: inliner,\n            options: {}\n        }\n    };\n\n    if (typeof exports === \"object\" && typeof module === \"object\")\n        module.exports = domtoimage;\n    else\n        global.domtoimage = domtoimage;\n\n    /**\n     * @param {Node} node - The DOM Node object to render\n     * @param {Object} options - Rendering options\n     * @param {Function} options.filter - Should return true if passed node should be included in the output\n     *          (excluding node means excluding it's children as well). Not called on the root node.\n     * @param {String} options.bgcolor - color for the background, any valid CSS color value.\n     * @param {Number} options.width - width to be applied to node before rendering.\n     * @param {Number} options.height - height to be applied to node before rendering.\n     * @param {Object} options.style - an object whose properties to be copied to node's style before rendering.\n     * @param {Number} options.quality - a Number between 0 and 1 indicating image quality (applicable to JPEG only),\n     defaults to 1.0.\n     * @param {Number} options.scale - a Number multiplier to scale up the canvas before rendering to reduce fuzzy images, defaults to 1.0.\n     * @param {String} options.imagePlaceholder - dataURL to use as a placeholder for failed images, default behaviour is to fail fast on images we can't fetch\n     * @param {Boolean} options.cacheBust - set to true to cache bust by appending the time to the request url\n     * @return {Promise} - A promise that is fulfilled with a SVG image data URL\n     * */\n    function toSvg(node, options) {\n        options = options || {};\n        copyOptions(options);\n        return Promise.resolve(node)\n        .then(function(node) {\n            return cloneNode(node, options.filter, true);\n        })\n        .then(embedFonts)\n        .then(inlineImages)\n        .then(applyOptions)\n        .then(function(clone) {\n            return makeSvgDataUri(clone,\n              options.width || util.width(node),\n              options.height || util.height(node)\n            );\n        });\n\n        function applyOptions(clone) {\n            if (options.bgcolor) clone.style.backgroundColor = options.bgcolor;\n            if (options.width) clone.style.width = options.width + 'px';\n            if (options.height) clone.style.height = options.height + 'px';\n\n            if (options.style)\n                Object.keys(options.style).forEach(function(property) {\n                    clone.style[property] = options.style[property];\n                });\n\n            return clone;\n        }\n    }\n\n    /**\n     * @param {Node} node - The DOM Node object to render\n     * @param {Object} options - Rendering options, @see {@link toSvg}\n     * @return {Promise} - A promise that is fulfilled with a Uint8Array containing RGBA pixel data.\n     * */\n    function toPixelData(node, options) {\n        return draw(node, options || {})\n        .then(function(canvas) {\n            return canvas.getContext('2d').getImageData(\n              0,\n              0,\n              util.width(node),\n              util.height(node)\n            ).data;\n        });\n    }\n\n    /**\n     * @param {Node} node - The DOM Node object to render\n     * @param {Object} options - Rendering options, @see {@link toSvg}\n     * @return {Promise} - A promise that is fulfilled with a PNG image data URL\n     * */\n    function toPng(node, options) {\n        return draw(node, options || {})\n        .then(function(canvas) {\n            return canvas.toDataURL();\n        });\n    }\n\n    /**\n     * @param {Node} node - The DOM Node object to render\n     * @param {Object} options - Rendering options, @see {@link toSvg}\n     * @return {Promise} - A promise that is fulfilled with a JPEG image data URL\n     * */\n    function toJpeg(node, options) {\n        options = options || {};\n        return draw(node, options)\n        .then(function(canvas) {\n            return canvas.toDataURL('image/jpeg', options.quality || 1.0);\n        });\n    }\n\n    /**\n     * @param {Node} node - The DOM Node object to render\n     * @param {Object} options - Rendering options, @see {@link toSvg}\n     * @return {Promise} - A promise that is fulfilled with a PNG image blob\n     * */\n    function toBlob(node, options) {\n        return draw(node, options || {})\n        .then(util.canvasToBlob);\n    }\n\n    /**\n     * @param {Node} node - The DOM Node object to render\n     * @param {Object} options - Rendering options, @see {@link toSvg}\n     * @return {Promise} - A promise that is fulfilled with a canvas object\n     * */\n    function toCanvas(node, options) {\n        return draw(node, options || {});\n    }\n\n    function copyOptions(options) {\n        // Copy options to impl options for use in impl\n        if (typeof(options.imagePlaceholder) === 'undefined') {\n            domtoimage.impl.options.imagePlaceholder = defaultOptions.imagePlaceholder;\n        } else {\n            domtoimage.impl.options.imagePlaceholder = options.imagePlaceholder;\n        }\n\n        if (typeof(options.cacheBust) === 'undefined') {\n            domtoimage.impl.options.cacheBust = defaultOptions.cacheBust;\n        } else {\n            domtoimage.impl.options.cacheBust = options.cacheBust;\n        }\n\n        if(typeof(options.useCredentials) === 'undefined') {\n            domtoimage.impl.options.useCredentials = defaultOptions.useCredentials;\n        } else {\n            domtoimage.impl.options.useCredentials = options.useCredentials;\n        }\n    }\n\n    function draw(domNode, options) {\n        return toSvg(domNode, options)\n        .then(util.makeImage)\n        .then(util.delay(100))\n        .then(function(image) {\n            var scale = typeof(options.scale) !== 'number' ? 1 : options.scale;\n            console.log('scale', scale);\n            var canvas = newCanvas(domNode, scale);\n            var ctx = canvas.getContext('2d');\n            if (image) {\n                //console.log('should be scaled', image);\n                ctx.scale(scale, scale);\n                //canvas.height = 620;\n                //ctx.drawImage(image, 150, 600, 1150, 700, 0, 0, 1150, 700);\n                // canvas.height = options.image.height + 50;\n                // //canvas.width = options.image.width - 135;// - options.image.offsetRight\n                // canvas.width = options.image.width - options.image.offsetRight - options.image.offsetLeft + 60;\n                // ctx.drawImage(image, options.image.offsetLeft, options.image.offsetTop - 50, options.image.width, options.image.height + 50, 0, 0, options.image.width, options.image.height);\n\n                if (options.canvas && options.canvas.width) {\n                    canvas.width = options.canvas.width;\n                }\n\n                if (options.canvas && options.canvas.height) {\n                    canvas.height = options.canvas.height;\n                }\n\n                if (options.canvas) {\n                    console.log('canv', options.canvas);\n                    ctx.drawImage(\n                      image,\n                      options.canvas.sx  || 0,\n                      options.canvas.sy || 0,\n                      options.canvas.sw || options.width,\n                      options.canvas.sh || options.height,\n                      options.canvas.dx || 0,\n                      options.canvas.dy || 0,\n                      options.canvas.dw || options.width,\n                      options.canvas.dh || options.height\n                    );\n                } else {\n                    ctx.drawImage(image, 0, 0);\n                }\n\n            }\n            return canvas;\n        });\n\n        function newCanvas(domNode, scale) {\n            var canvas = document.createElement('canvas');\n            canvas.width = (options.width || util.width(domNode)) * scale;\n            canvas.height = (options.height || util.height(domNode)) * scale;\n\n            console.log(canvas.width, canvas.height);\n\n            if (options.bgcolor) {\n                var ctx = canvas.getContext('2d');\n                ctx.fillStyle = options.bgcolor;\n                ctx.fillRect(0, 0, canvas.width, canvas.height);\n            }\n\n            return canvas;\n        }\n    }\n\n    function cloneNode(node, filter, root) {\n        if (!root && filter && !filter(node)) return Promise.resolve();\n\n        return Promise.resolve(node)\n        .then(makeNodeCopy)\n        .then(function(clone) {\n            return cloneChildren(node, clone, filter);\n        })\n        .then(function(clone) {\n            return processClone(node, clone);\n        });\n\n        function makeNodeCopy(node) {\n            if (node instanceof HTMLCanvasElement) return util.makeImage(node.toDataURL());\n            return node.cloneNode(false);\n        }\n\n        function cloneChildren(original, clone, filter) {\n            var children = original.tagName === 'use' ? copyShadowChild(original) : original.childNodes;\n            if (children.length === 0) return Promise.resolve(clone);\n\n            return cloneChildrenInOrder(clone, util.asArray(children), filter)\n            .then(function() {\n                return clone;\n            });\n\n            function cloneChildrenInOrder(parent, children, filter) {\n                var done = Promise.resolve();\n                children.forEach(function(child) {\n                    done = done\n                    .then(function() {\n                        return cloneNode(child, filter);\n                    })\n                    .then(function(childClone) {\n                        if (childClone) parent.appendChild(childClone);\n                    });\n                });\n                return done;\n            }\n        }\n\n        function copyShadowChild(original) {\n            var child = document.getElementById(original.href.baseVal.replace('#', ''));\n            return [child.cloneNode(true)];\n        }\n\n        function processClone(original, clone) {\n            if (!(clone instanceof Element)) return clone;\n\n            return Promise.resolve()\n            .then(cloneStyle)\n            .then(clonePseudoElements)\n            .then(copyUserInput)\n            .then(fixSvg)\n            .then(function() {\n                return clone;\n            });\n\n            function cloneStyle() {\n                copyStyle(window.getComputedStyle(original), clone.style);\n\n                if (util.isChrome() && clone.style.marker && ( clone.tagName === 'line' || clone.tagName === 'path')) {\n                    clone.style.marker = '';\n                }\n\n                function copyStyle(source, target) {\n                    if (source.cssText) {\n                        target.cssText = source.cssText;\n                        target.font = source.font; // here, we re-assign the font prop.\n                    } else copyProperties(source, target);\n\n                    function copyProperties(source, target) {\n                        util.asArray(source).forEach(function(name) {\n                            target.setProperty(\n                              name,\n                              source.getPropertyValue(name),\n                              source.getPropertyPriority(name)\n                            );\n                        });\n                    }\n                }\n            }\n\n            function clonePseudoElements() {\n                [':before', ':after'].forEach(function(element) {\n                    clonePseudoElement(element);\n                });\n\n                function clonePseudoElement(element) {\n                    var style = window.getComputedStyle(original, element);\n                    var content = style.getPropertyValue('content');\n\n                    if (content === '' || content === 'none') return;\n\n                    var className = util.uid();\n                    var currentClass = clone.getAttribute('class');\n                    if (currentClass) {\n                        clone.setAttribute('class', currentClass + ' ' + className);\n                    }\n\n                    var styleElement = document.createElement('style');\n                    styleElement.appendChild(formatPseudoElementStyle(className, element, style));\n                    clone.appendChild(styleElement);\n\n                    function formatPseudoElementStyle(className, element, style) {\n                        var selector = '.' + className + ':' + element;\n                        var cssText = style.cssText ? formatCssText(style) : formatCssProperties(style);\n                        return document.createTextNode(selector + '{' + cssText + '}');\n\n                        function formatCssText(style) {\n                            var content = style.getPropertyValue('content');\n                            return style.cssText + ' content: ' + content + ';';\n                        }\n\n                        function formatCssProperties(style) {\n\n                            return util.asArray(style)\n                            .map(formatProperty)\n                            .join('; ') + ';';\n\n                            function formatProperty(name) {\n                                return name + ': ' +\n                                  style.getPropertyValue(name) +\n                                  (style.getPropertyPriority(name) ? ' !important' : '');\n                            }\n                        }\n                    }\n                }\n            }\n\n            function copyUserInput() {\n                if (original instanceof HTMLTextAreaElement) clone.innerHTML = original.value;\n                if (original instanceof HTMLInputElement) clone.setAttribute(\"value\", original.value);\n            }\n\n            function fixSvg() {\n                if (!(clone instanceof SVGElement)) return;\n                clone.setAttribute('xmlns', 'http://www.w3.org/2000/svg');\n\n                if (!(clone instanceof SVGRectElement)) return;\n                ['width', 'height'].forEach(function(attribute) {\n                    var value = clone.getAttribute(attribute);\n                    if (!value) return;\n\n                    clone.style.setProperty(attribute, value);\n                });\n            }\n        }\n    }\n\n    function embedFonts(node) {\n        return fontFaces.resolveAll()\n        .then(function(cssText) {\n            var styleNode = document.createElement('style');\n            node.appendChild(styleNode);\n            styleNode.appendChild(document.createTextNode(cssText));\n            return node;\n        });\n    }\n\n    function inlineImages(node) {\n        return images.inlineAll(node)\n        .then(function() {\n            return node;\n        });\n    }\n\n    function makeSvgDataUri(node, width, height) {\n        return Promise.resolve(node)\n        .then(function(node) {\n            node.setAttribute('xmlns', 'http://www.w3.org/1999/xhtml');\n            return new XMLSerializer().serializeToString(node);\n        })\n        .then(util.escapeXhtml)\n        .then(function(xhtml) {\n            return '<foreignObject x=\"0\" y=\"0\" width=\"100%\" height=\"100%\">' + xhtml + '</foreignObject>';\n        })\n        .then(function(foreignObject) {\n            return '<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"' + width + '\" height=\"' + height + '\">' +\n              foreignObject + '</svg>';\n        })\n        .then(function(svg) {\n            return 'data:image/svg+xml;charset=utf-8,' + svg;\n        });\n    }\n\n    function newUtil() {\n        return {\n            escape: escape,\n            parseExtension: parseExtension,\n            mimeType: mimeType,\n            dataAsUrl: dataAsUrl,\n            isDataUrl: isDataUrl,\n            canvasToBlob: canvasToBlob,\n            resolveUrl: resolveUrl,\n            getAndEncode: getAndEncode,\n            uid: uid(),\n            delay: delay,\n            asArray: asArray,\n            isChrome: isChrome,\n            escapeXhtml: escapeXhtml,\n            makeImage: makeImage,\n            width: width,\n            height: height\n        };\n\n        function mimes() {\n            /*\n             * Only WOFF and EOT mime types for fonts are 'real'\n             * see http://www.iana.org/assignments/media-types/media-types.xhtml\n             */\n            var WOFF = 'application/font-woff';\n            var JPEG = 'image/jpeg';\n\n            return {\n                'woff': WOFF,\n                'woff2': WOFF,\n                'ttf': 'application/font-truetype',\n                'eot': 'application/vnd.ms-fontobject',\n                'png': 'image/png',\n                'jpg': JPEG,\n                'jpeg': JPEG,\n                'gif': 'image/gif',\n                'tiff': 'image/tiff',\n                'svg': 'image/svg+xml'\n            };\n        }\n\n        function parseExtension(url) {\n            var match = /\\.([^\\.\\/]*?)(\\?|$)/g.exec(url);\n            if (match) return match[1];\n            else return '';\n        }\n\n        function mimeType(url) {\n            var extension = parseExtension(url).toLowerCase();\n            return mimes()[extension] || '';\n        }\n\n        function isDataUrl(url) {\n            return url.search(/^(data:)/) !== -1;\n        }\n\n        function toBlob(canvas) {\n            return new Promise(function(resolve) {\n                var binaryString = window.atob(canvas.toDataURL().split(',')[1]);\n                var length = binaryString.length;\n                var binaryArray = new Uint8Array(length);\n\n                for (var i = 0; i < length; i++)\n                    binaryArray[i] = binaryString.charCodeAt(i);\n\n                resolve(new Blob([binaryArray], {\n                    type: 'image/png'\n                }));\n            });\n        }\n\n        function canvasToBlob(canvas) {\n            if (canvas.toBlob)\n                return new Promise(function(resolve) {\n                    canvas.toBlob(resolve);\n                });\n\n            return toBlob(canvas);\n        }\n\n        function resolveUrl(url, baseUrl) {\n            var doc = document.implementation.createHTMLDocument();\n            var base = doc.createElement('base');\n            doc.head.appendChild(base);\n            var a = doc.createElement('a');\n            doc.body.appendChild(a);\n            base.href = baseUrl;\n            a.href = url;\n            return a.href;\n        }\n\n        function uid() {\n            var index = 0;\n\n            return function() {\n                return 'u' + fourRandomChars() + index++;\n\n                function fourRandomChars() {\n                    /* see http://stackoverflow.com/a/6248722/2519373 */\n                    return ('0000' + (Math.random() * Math.pow(36, 4) << 0).toString(36)).slice(-4);\n                }\n            };\n        }\n\n        function makeImage(uri) {\n            if (uri === 'data:,') return Promise.resolve();\n            return new Promise(function(resolve, reject) {\n                var image = new Image();\n                if(domtoimage.impl.options.useCredentials) {\n                    image.crossOrigin = 'use-credentials';\n                }\n                image.onload = function() {\n                    resolve(image);\n                };\n                image.onerror = reject;\n                image.src = uri;\n            });\n        }\n\n        function getAndEncode(url) {\n            var TIMEOUT = 30000;\n            if (domtoimage.impl.options.cacheBust) {\n                // Cache bypass so we dont have CORS issues with cached images\n                // Source: https://developer.mozilla.org/en/docs/Web/API/XMLHttpRequest/Using_XMLHttpRequest#Bypassing_the_cache\n                url += ((/\\?/).test(url) ? \"&\" : \"?\") + (new Date()).getTime();\n            }\n\n            return new Promise(function(resolve) {\n                var request = new XMLHttpRequest();\n\n                request.onreadystatechange = done;\n                request.ontimeout = timeout;\n                request.responseType = 'blob';\n                request.timeout = TIMEOUT;\n                if(domtoimage.impl.options.useCredentials) {\n                    request.withCredentials = true;\n                }\n                request.open('GET', url, true);\n                request.send();\n\n                var placeholder;\n                if (domtoimage.impl.options.imagePlaceholder) {\n                    var split = domtoimage.impl.options.imagePlaceholder.split(/,/);\n                    if (split && split[1]) {\n                        placeholder = split[1];\n                    }\n                }\n\n                function done() {\n                    if (request.readyState !== 4) return;\n\n                    if (request.status !== 200) {\n                        if (placeholder) {\n                            resolve(placeholder);\n                        } else {\n                            fail('cannot fetch resource: ' + url + ', status: ' + request.status);\n                        }\n\n                        return;\n                    }\n\n                    var encoder = new FileReader();\n                    encoder.onloadend = function() {\n                        var content = encoder.result.split(/,/)[1];\n                        resolve(content);\n                    };\n                    encoder.readAsDataURL(request.response);\n                }\n\n                function timeout() {\n                    if (placeholder) {\n                        resolve(placeholder);\n                    } else {\n                        fail('timeout of ' + TIMEOUT + 'ms occured while fetching resource: ' + url);\n                    }\n                }\n\n                function fail(message) {\n                    console.error(message);\n                    resolve('');\n                }\n            });\n        }\n\n        function dataAsUrl(content, type) {\n            return 'data:' + type + ';base64,' + content;\n        }\n\n        function escape(string) {\n            return string.replace(/([.*+?^${}()|\\[\\]\\/\\\\])/g, '\\\\$1');\n        }\n\n        function isChrome() {\n            return /chrome/i.test( navigator.userAgent );\n        }\n\n        function delay(ms) {\n            return function(arg) {\n                return new Promise(function(resolve) {\n                    setTimeout(function() {\n                        resolve(arg);\n                    }, ms);\n                });\n            };\n        }\n\n        function asArray(arrayLike) {\n            var array = [];\n            var length = arrayLike.length;\n            for (var i = 0; i < length; i++) array.push(arrayLike[i]);\n            return array;\n        }\n\n        function escapeXhtml(string) {\n            return string.replace(/#/g, '%23').replace(/\\n/g, '%0A');\n        }\n\n        function width(node) {\n            var leftBorder = px(node, 'border-left-width');\n            var rightBorder = px(node, 'border-right-width');\n            return node.scrollWidth + leftBorder + rightBorder;\n        }\n\n        function height(node) {\n            var topBorder = px(node, 'border-top-width');\n            var bottomBorder = px(node, 'border-bottom-width');\n            return node.scrollHeight + topBorder + bottomBorder;\n        }\n\n        function px(node, styleProperty) {\n            var value = window.getComputedStyle(node).getPropertyValue(styleProperty);\n            return parseFloat(value.replace('px', ''));\n        }\n    }\n\n    function newInliner() {\n        var URL_REGEX = /url\\(['\"]?([^'\"]+?)['\"]?\\)/g;\n\n        return {\n            inlineAll: inlineAll,\n            shouldProcess: shouldProcess,\n            impl: {\n                readUrls: readUrls,\n                inline: inline\n            }\n        };\n\n        function shouldProcess(string) {\n            return string.search(URL_REGEX) !== -1;\n        }\n\n        function readUrls(string) {\n            var result = [];\n            var match;\n            while ((match = URL_REGEX.exec(string)) !== null) {\n                result.push(match[1]);\n            }\n            return result.filter(function(url) {\n                return !util.isDataUrl(url);\n            });\n        }\n\n        function inline(string, url, baseUrl, get) {\n            return Promise.resolve(url)\n            .then(function(url) {\n                return baseUrl ? util.resolveUrl(url, baseUrl) : url;\n            })\n            .then(get || util.getAndEncode)\n            .then(function(data) {\n                return util.dataAsUrl(data, util.mimeType(url));\n            })\n            .then(function(dataUrl) {\n                return string.replace(urlAsRegex(url), '$1' + dataUrl + '$3');\n            });\n\n            function urlAsRegex(url) {\n                return new RegExp('(url\\\\([\\'\"]?)(' + util.escape(url) + ')([\\'\"]?\\\\))', 'g');\n            }\n        }\n\n        function inlineAll(string, baseUrl, get) {\n            if (nothingToInline()) return Promise.resolve(string);\n\n            return Promise.resolve(string)\n            .then(readUrls)\n            .then(function(urls) {\n                var done = Promise.resolve(string);\n                urls.forEach(function(url) {\n                    done = done.then(function(string) {\n                        return inline(string, url, baseUrl, get);\n                    });\n                });\n                return done;\n            });\n\n            function nothingToInline() {\n                return !shouldProcess(string);\n            }\n        }\n    }\n\n    function newFontFaces() {\n        return {\n            resolveAll: resolveAll,\n            impl: {\n                readAll: readAll\n            }\n        };\n\n        function resolveAll() {\n            return readAll(document)\n            .then(function(webFonts) {\n                return Promise.all(\n                  webFonts.map(function(webFont) {\n                      return webFont.resolve();\n                  })\n                );\n            })\n            .then(function(cssStrings) {\n                return cssStrings.join('\\n');\n            });\n        }\n\n        function readAll() {\n            return Promise.resolve(util.asArray(document.styleSheets))\n            .then(getCssRules)\n            .then(selectWebFontRules)\n            .then(function(rules) {\n                return rules.map(newWebFont);\n            });\n\n            function selectWebFontRules(cssRules) {\n                return cssRules\n                .filter(function(rule) {\n                    return rule.type === CSSRule.FONT_FACE_RULE;\n                })\n                .filter(function(rule) {\n                    return inliner.shouldProcess(rule.style.getPropertyValue('src'));\n                });\n            }\n\n            function getCssRules(styleSheets) {\n                var cssRules = [];\n                styleSheets.forEach(function(sheet) {\n                    if (sheet.hasOwnProperty(\"cssRules\")) {\n                        try {\n                            util.asArray(sheet.cssRules || []).forEach(cssRules.push.bind(cssRules));\n                        } catch (e) {\n                            console.log('Error while reading CSS rules from ' + sheet.href, e.toString());\n                        }\n                    }\n                });\n                return cssRules;\n            }\n\n            function newWebFont(webFontRule) {\n                return {\n                    resolve: function resolve() {\n                        var baseUrl = (webFontRule.parentStyleSheet || {}).href;\n                        return inliner.inlineAll(webFontRule.cssText, baseUrl);\n                    },\n                    src: function() {\n                        return webFontRule.style.getPropertyValue('src');\n                    }\n                };\n            }\n        }\n    }\n\n    function newImages() {\n        return {\n            inlineAll: inlineAll,\n            impl: {\n                newImage: newImage\n            }\n        };\n\n        function newImage(element) {\n            return {\n                inline: inline\n            };\n\n            function inline(get) {\n                if (util.isDataUrl(element.src)) return Promise.resolve();\n\n                return Promise.resolve(element.src)\n                .then(get || util.getAndEncode)\n                .then(function(data) {\n                    return util.dataAsUrl(data, util.mimeType(element.src));\n                })\n                .then(function(dataUrl) {\n                    return new Promise(function(resolve, reject) {\n                        element.onload = resolve;\n                        // for any image with invalid src(such as <img src />), just ignore it\n                        element.onerror = resolve;\n                        element.src = dataUrl;\n                    });\n                });\n            }\n        }\n\n        function inlineAll(node) {\n            if (!(node instanceof Element)) return Promise.resolve(node);\n\n            return inlineBackground(node)\n            .then(function() {\n                if (node instanceof HTMLImageElement)\n                    return newImage(node).inline();\n                else\n                    return Promise.all(\n                      util.asArray(node.childNodes).map(function(child) {\n                          return inlineAll(child);\n                      })\n                    );\n            });\n\n            function inlineBackground(node) {\n                var background = node.style.getPropertyValue('background');\n\n                if (!background) return Promise.resolve(node);\n\n                return inliner.inlineAll(background)\n                .then(function(inlined) {\n                    node.style.setProperty(\n                      'background',\n                      inlined,\n                      node.style.getPropertyPriority('background')\n                    );\n                })\n                .then(function() {\n                    return node;\n                });\n            }\n        }\n    }\n})(this);\n","export default function _arrayLikeToArray(arr, len) {\n  if (len == null || len > arr.length) len = arr.length;\n  for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i];\n  return arr2;\n}","import arrayLikeToArray from \"./arrayLikeToArray.js\";\nexport default function _unsupportedIterableToArray(o, minLen) {\n  if (!o) return;\n  if (typeof o === \"string\") return arrayLikeToArray(o, minLen);\n  var n = Object.prototype.toString.call(o).slice(8, -1);\n  if (n === \"Object\" && o.constructor) n = o.constructor.name;\n  if (n === \"Map\" || n === \"Set\") return Array.from(o);\n  if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return arrayLikeToArray(o, minLen);\n}","import arrayWithoutHoles from \"./arrayWithoutHoles.js\";\nimport iterableToArray from \"./iterableToArray.js\";\nimport unsupportedIterableToArray from \"./unsupportedIterableToArray.js\";\nimport nonIterableSpread from \"./nonIterableSpread.js\";\nexport default function _toConsumableArray(arr) {\n  return arrayWithoutHoles(arr) || iterableToArray(arr) || unsupportedIterableToArray(arr) || nonIterableSpread();\n}","import arrayLikeToArray from \"./arrayLikeToArray.js\";\nexport default function _arrayWithoutHoles(arr) {\n  if (Array.isArray(arr)) return arrayLikeToArray(arr);\n}","export default function _iterableToArray(iter) {\n  if (typeof Symbol !== \"undefined\" && iter[Symbol.iterator] != null || iter[\"@@iterator\"] != null) return Array.from(iter);\n}","export default function _nonIterableSpread() {\n  throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}","export default function _typeof(obj) {\n  \"@babel/helpers - typeof\";\n\n  return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (obj) {\n    return typeof obj;\n  } : function (obj) {\n    return obj && \"function\" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n  }, _typeof(obj);\n}","import arrayWithHoles from \"./arrayWithHoles.js\";\nimport iterableToArrayLimit from \"./iterableToArrayLimit.js\";\nimport unsupportedIterableToArray from \"./unsupportedIterableToArray.js\";\nimport nonIterableRest from \"./nonIterableRest.js\";\nexport default function _slicedToArray(arr, i) {\n  return arrayWithHoles(arr) || iterableToArrayLimit(arr, i) || unsupportedIterableToArray(arr, i) || nonIterableRest();\n}","export default function _arrayWithHoles(arr) {\n  if (Array.isArray(arr)) return arr;\n}","export default function _iterableToArrayLimit(arr, i) {\n  var _i = null == arr ? null : \"undefined\" != typeof Symbol && arr[Symbol.iterator] || arr[\"@@iterator\"];\n  if (null != _i) {\n    var _s,\n      _e,\n      _x,\n      _r,\n      _arr = [],\n      _n = !0,\n      _d = !1;\n    try {\n      if (_x = (_i = _i.call(arr)).next, 0 === i) {\n        if (Object(_i) !== _i) return;\n        _n = !1;\n      } else for (; !(_n = (_s = _x.call(_i)).done) && (_arr.push(_s.value), _arr.length !== i); _n = !0);\n    } catch (err) {\n      _d = !0, _e = err;\n    } finally {\n      try {\n        if (!_n && null != _i[\"return\"] && (_r = _i[\"return\"](), Object(_r) !== _r)) return;\n      } finally {\n        if (_d) throw _e;\n      }\n    }\n    return _arr;\n  }\n}","export default function _nonIterableRest() {\n  throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}","export default function createElement(tagName, attrs = {}, ...children) {\r\n    if (tagName === 'null' || tagName === null) return children;\r\n    if (typeof tagName === 'function') return tagName(attrs, children);\r\n\r\n    const elem = document.createElement(tagName);\r\n\r\n    Object.entries(attrs || {}).forEach(([name, value]) => {\r\n        if (typeof value !== undefined && value !== null) {\r\n            if (\r\n                name.startsWith('on') &&\r\n                name.toLowerCase() in window &&\r\n                typeof value === 'function'\r\n            )\r\n                elem.addEventListener(name.toLowerCase().substr(2), value);\r\n            else {\r\n                if (name === 'className')\r\n                    elem.setAttribute('class', value.toString());\r\n                else if (name === 'htmlFor')\r\n                    elem.setAttribute('for', value.toString());\r\n                else elem.setAttribute(name, value.toString());\r\n            }\r\n        }\r\n    });\r\n\r\n    for (const child of children) {\r\n        if (!child) continue;\r\n        if (Array.isArray(child)) elem.append(...child);\r\n        else {\r\n            if (child.nodeType === undefined) elem.innerHTML += child;\r\n            else elem.appendChild(child);\r\n        }\r\n    }\r\n    return elem;\r\n}\r\n","import View from 'ol/View';\r\nimport { getPointResolution } from 'ol/proj';\r\n\r\nimport { jsPDF, TextOptionsLight } from 'jspdf';\r\nimport { getDocument, GlobalWorkerOptions, version } from 'pdfjs-dist';\r\n\r\nimport { I18n, Options, IPrintOptions, IWatermark } from '../ol-pdf-printer';\r\n\r\nimport myPragma from '../myPragma';\r\n\r\n/**\r\n * @private\r\n */\r\nexport default class Pdf {\r\n    protected _pdf: IPdf;\r\n    protected _view: View;\r\n    protected _scaleDenominator: number;\r\n    protected _form: IPrintOptions;\r\n    protected _style: Options['style'];\r\n    protected _i18n: I18n;\r\n\r\n    protected _config: Options;\r\n\r\n    constructor(params: IPdfOptions) {\r\n        const { view, form, i18n, config, height, width, scaleResolution } =\r\n            params;\r\n\r\n        this._view = view;\r\n        this._form = form;\r\n        this._i18n = i18n;\r\n        this._config = config;\r\n\r\n        this._pdf = this.create(\r\n            this._form.orientation,\r\n            this._form.format,\r\n            height,\r\n            width\r\n        );\r\n\r\n        this._scaleDenominator = this._calculateScaleDenominator(\r\n            this._form.resolution,\r\n            scaleResolution\r\n        );\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param orientation\r\n     * @param format\r\n     * @param width\r\n     * @param height\r\n     * @returns\r\n     * @protected\r\n     */\r\n    create(\r\n        orientation: IPrintOptions['orientation'],\r\n        format: IPrintOptions['format'],\r\n        height: number,\r\n        width: number\r\n    ): IPdf {\r\n        // UMD support\r\n        const _jsPDF =\r\n            (window as IWindow & typeof globalThis).jspdf?.jsPDF || jsPDF;\r\n\r\n        return {\r\n            doc: new _jsPDF({ orientation, format }),\r\n            height: height,\r\n            width: width\r\n        };\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param dataUrl\r\n     * @protected\r\n     */\r\n    addMapImage(dataUrl: string): void {\r\n        this._pdf.doc.addImage(\r\n            dataUrl,\r\n            'JPEG',\r\n            this._config.style.paperMargin, // Add margins\r\n            this._config.style.paperMargin,\r\n            this._pdf.width - this._config.style.paperMargin * 2,\r\n            this._pdf.height - this._config.style.paperMargin * 2\r\n        );\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @protected\r\n     */\r\n    addMapHelpers = async (): Promise<void> => {\r\n        const { mapElements, extraInfo, style, watermark } = this._config;\r\n\r\n        this._style = style;\r\n\r\n        if (watermark) {\r\n            await this._addWatermark(watermark);\r\n        }\r\n\r\n        if (mapElements) {\r\n            if (mapElements.compass && this._form.compass) {\r\n                await this._addCompass(mapElements.compass);\r\n            }\r\n\r\n            if (mapElements.description && this._form.description) {\r\n                this._addDescription();\r\n            }\r\n\r\n            if (mapElements.scalebar && this._form.scalebar) {\r\n                this._addScaleBar();\r\n            }\r\n\r\n            if (mapElements.attributions && this._form.attributions) {\r\n                this._addAttributions();\r\n            }\r\n        }\r\n\r\n        if (extraInfo) {\r\n            // Bottom info\r\n            if (extraInfo.url) {\r\n                this._addUrl();\r\n            }\r\n\r\n            if (extraInfo.date) {\r\n                this._addDate();\r\n            }\r\n\r\n            if (extraInfo.specs) {\r\n                this._addSpecs();\r\n            }\r\n        }\r\n    };\r\n\r\n    /**\r\n     * @protected\r\n     */\r\n    savePdf(): Promise<void> {\r\n        const downloadURI = (uri: string, name: string): void => {\r\n            const link = <a download={name} href={uri}></a>;\r\n            document.body.appendChild(link);\r\n            link.click();\r\n            document.body.removeChild(link);\r\n        };\r\n\r\n        return new Promise((resolve, reject) => {\r\n            if (this._form.typeExport === 'pdf') {\r\n                this._pdf.doc.save(this._config.filename + '.pdf');\r\n                resolve();\r\n            } else {\r\n                const pdf = this._pdf.doc.output('dataurlstring');\r\n\r\n                // UMD support\r\n                const versionPdfJS =\r\n                    (window as IWindow & typeof globalThis)?.pdfjsLib\r\n                        ?.version || version;\r\n\r\n                GlobalWorkerOptions.workerSrc = `https://cdnjs.cloudflare.com/ajax/libs/pdf.js/${versionPdfJS}/pdf.worker.js`;\r\n\r\n                getDocument(pdf).promise.then(\r\n                    (pdf) => {\r\n                        pdf.getPage(1).then((page) => {\r\n                            const scale = 2;\r\n\r\n                            const viewport = page.getViewport({ scale });\r\n\r\n                            // Prepare canvas\r\n                            const canvas = <canvas />;\r\n                            canvas.style.display = 'none';\r\n                            document.body.appendChild(canvas);\r\n                            const context = canvas.getContext('2d');\r\n                            canvas.height = viewport.height;\r\n                            canvas.width = viewport.width;\r\n\r\n                            // Render PDF page into canvas context\r\n                            const task = page.render({\r\n                                canvasContext: context,\r\n                                viewport: viewport\r\n                            });\r\n                            task.promise.then(() => {\r\n                                downloadURI(\r\n                                    canvas.toDataURL(\r\n                                        `image/${this._form.typeExport}`\r\n                                    ),\r\n                                    this._config.filename +\r\n                                        `.${this._form.typeExport}`\r\n                                );\r\n                                canvas.remove();\r\n                                resolve();\r\n                            });\r\n                        });\r\n                    },\r\n                    (error: Error) => {\r\n                        reject(error);\r\n                        console.log(error);\r\n                    }\r\n                );\r\n            }\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Convert an SVGElement to an PNG string\r\n     * @param svg\r\n     * @returns\r\n     */\r\n    _processSvgImage = (svg: SVGElement): Promise<string> => {\r\n        // https://stackoverflow.com/questions/3975499/convert-svg-to-image-jpeg-png-etc-in-the-browser#answer-58142441\r\n        return new Promise((resolve, reject) => {\r\n            const svgToPng = (svg: SVGElement, callback) => {\r\n                const url = getSvgUrl(svg);\r\n                svgUrlToPng(url, (imgData: string) => {\r\n                    callback(imgData);\r\n                    URL.revokeObjectURL(url);\r\n                });\r\n            };\r\n\r\n            const getSvgUrl = (svg: SVGElement) => {\r\n                return URL.createObjectURL(\r\n                    new Blob([svg.outerHTML], { type: 'image/svg+xml' })\r\n                );\r\n            };\r\n\r\n            const svgUrlToPng = (svgUrl: string, callback) => {\r\n                const svgImage = document.createElement('img');\r\n                document.body.appendChild(svgImage);\r\n\r\n                svgImage.onerror = (err) => {\r\n                    console.error(err);\r\n                    return reject(this._i18n.errorImage);\r\n                };\r\n\r\n                svgImage.onload = () => {\r\n                    try {\r\n                        const canvas = document.createElement('canvas');\r\n                        canvas.width = svgImage.clientWidth;\r\n                        canvas.height = svgImage.clientHeight;\r\n                        const canvasCtx = canvas.getContext('2d');\r\n                        canvasCtx.drawImage(svgImage, 0, 0);\r\n                        const imgData = canvas.toDataURL('image/png');\r\n                        callback(imgData);\r\n                        document.body.removeChild(svgImage);\r\n                    } catch (err) {\r\n                        return reject(err);\r\n                    }\r\n                };\r\n                svgImage.src = svgUrl;\r\n            };\r\n\r\n            svgToPng(svg, (imgData: string) => {\r\n                resolve(imgData);\r\n            });\r\n        });\r\n    };\r\n\r\n    /**\r\n     * Adapted from http://hg.intevation.de/gemma/file/tip/client/src/components/Pdftool.vue#l252\r\n     * @protected\r\n     */\r\n    _calculateScaleDenominator(\r\n        resolution: number,\r\n        scaleResolution: number\r\n    ): number {\r\n        const pixelsPerMapMillimeter = resolution / 25.4;\r\n        return Math.round(\r\n            1000 *\r\n                pixelsPerMapMillimeter *\r\n                this._getMeterPerPixel(scaleResolution)\r\n        );\r\n    }\r\n\r\n    /**\r\n     * @protected\r\n     */\r\n    _getMeterPerPixel(scaleResolution: number): number {\r\n        const proj = this._view.getProjection();\r\n        return (\r\n            getPointResolution(proj, scaleResolution, this._view.getCenter()) *\r\n            proj.getMetersPerUnit()\r\n        );\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param position\r\n     * @param offset\r\n     * @param size\r\n     * @returns\r\n     * @protected\r\n     */\r\n    _calculateOffsetByPosition = (\r\n        position: string,\r\n        offset: { x: number; y: number },\r\n        size = 0\r\n    ): { x: number; y: number } => {\r\n        let x: number, y: number;\r\n\r\n        switch (position) {\r\n            case 'topleft':\r\n                x = offset.x + this._style.paperMargin;\r\n                y = offset.y + this._style.paperMargin + size;\r\n                break;\r\n\r\n            case 'topright':\r\n                x = this._pdf.width - offset.x - this._style.paperMargin;\r\n                y = offset.y + this._style.paperMargin + size;\r\n                break;\r\n\r\n            case 'bottomright':\r\n                x = this._pdf.width - offset.x - this._style.paperMargin;\r\n                y =\r\n                    this._pdf.height -\r\n                    offset.y -\r\n                    this._style.paperMargin -\r\n                    size;\r\n                break;\r\n\r\n            case 'bottomleft':\r\n                y =\r\n                    this._pdf.height -\r\n                    offset.y -\r\n                    this._style.paperMargin -\r\n                    size;\r\n                x = offset.x + this._style.paperMargin;\r\n                break;\r\n        }\r\n\r\n        return { x, y };\r\n    };\r\n\r\n    /**\r\n     *\r\n     * @param x\r\n     * @param y\r\n     * @param width\r\n     * @param height\r\n     * @param bkcolor\r\n     * @param brcolor\r\n     * @protected\r\n     */\r\n    _addRoundedBox = (\r\n        x: number,\r\n        y: number,\r\n        width: number,\r\n        height: number,\r\n        bkcolor: string,\r\n        brcolor: string\r\n    ): void => {\r\n        const rounding = 1;\r\n\r\n        this._pdf.doc.setDrawColor(brcolor);\r\n        this._pdf.doc.setFillColor(bkcolor);\r\n\r\n        this._pdf.doc.roundedRect(\r\n            x,\r\n            y,\r\n            width,\r\n            height,\r\n            rounding,\r\n            rounding,\r\n            'FD'\r\n        );\r\n    };\r\n\r\n    /**\r\n     *\r\n     * @param x\r\n     * @param y\r\n     * @param width\r\n     * @param fontSize\r\n     * @param color\r\n     * @param align\r\n     * @param str\r\n     * @protected\r\n     */\r\n    _addText = (\r\n        x: number,\r\n        y: number,\r\n        width: number,\r\n        fontSize: number,\r\n        color: string,\r\n        align: TextOptionsLight['align'] = 'left',\r\n        str: string\r\n    ): void => {\r\n        this._pdf.doc.setTextColor(color);\r\n        this._pdf.doc.setFontSize(fontSize);\r\n\r\n        this._pdf.doc.text(str, x, y, {\r\n            align: align\r\n        });\r\n    };\r\n\r\n    /**\r\n     *\r\n     * @param position\r\n     * @param offset\r\n     * @param width\r\n     * @param fontSize\r\n     * @param color\r\n     * @param align\r\n     * @param str\r\n     * @protected\r\n     */\r\n    _addTextByOffset = (\r\n        position: string,\r\n        offset: { x: number; y: number },\r\n        width: number,\r\n        fontSize: number,\r\n        color: string,\r\n        align: TextOptionsLight['align'],\r\n        str: string\r\n    ): void => {\r\n        const { x, y } = this._calculateOffsetByPosition(position, offset);\r\n        const fixX = align === 'center' ? x - width / 2 : x;\r\n        this._addText(fixX, y, width, fontSize, color, align, str);\r\n    };\r\n\r\n    /**\r\n     * @protected\r\n     */\r\n    _addDescription = (): void => {\r\n        const str = this._form.description.trim();\r\n        const position = 'topleft';\r\n        const offset = { x: 2, y: 2 };\r\n        const fontSize = 8;\r\n        const maxWidth = 50;\r\n\r\n        const paddingBack = 4;\r\n\r\n        const { x, y } = this._calculateOffsetByPosition(position, offset);\r\n\r\n        this._pdf.doc.setTextColor(this._style.txcolor);\r\n        this._pdf.doc.setFontSize(fontSize);\r\n\r\n        const { w, h } = this._pdf.doc.getTextDimensions(str, {\r\n            maxWidth: maxWidth\r\n        });\r\n\r\n        this._addRoundedBox(\r\n            x,\r\n            y,\r\n            w + paddingBack * 2,\r\n            h + paddingBack,\r\n            this._style.bkcolor,\r\n            this._style.brcolor\r\n        );\r\n\r\n        this._pdf.doc.text(str, x + paddingBack, y + paddingBack, {\r\n            align: 'left',\r\n            maxWidth: maxWidth\r\n        });\r\n    };\r\n\r\n    /**\r\n     * This functions is a mess\r\n     * @returns\r\n     * @protected\r\n     */\r\n    _addWatermark = async (watermark: IWatermark): Promise<void> => {\r\n        const position = 'topright';\r\n        const offset = { x: 0, y: 0 };\r\n        const fontSize = 14;\r\n        const imageSize = 12;\r\n        const fontSizeSubtitle = fontSize / 1.8;\r\n        let back = false;\r\n\r\n        const { x, y } = this._calculateOffsetByPosition(position, offset);\r\n\r\n        const paddingBack = 2;\r\n\r\n        let acumulativeWidth = watermark.logo ? imageSize + 0.5 : 0;\r\n\r\n        if (watermark.title) {\r\n            this._pdf.doc.setTextColor(watermark.titleColor);\r\n            this._pdf.doc.setFontSize(fontSize);\r\n            this._pdf.doc.setFont('helvetica', 'bold');\r\n\r\n            // This function works bad\r\n            let { w } = this._pdf.doc.getTextDimensions(watermark.title);\r\n\r\n            if (watermark.subtitle) {\r\n                this._pdf.doc.setFontSize(fontSizeSubtitle);\r\n                const wSub = this._pdf.doc.getTextDimensions(\r\n                    watermark.subtitle\r\n                ).w;\r\n                w = wSub - 4 > w ? wSub : w + 4; // weird fix needed\r\n                this._pdf.doc.setFontSize(fontSize);\r\n            } else {\r\n                w += 4;\r\n            }\r\n\r\n            // Adaptable width, fixed height\r\n            const height = 16;\r\n            const widthBack = w + paddingBack;\r\n\r\n            this._addRoundedBox(\r\n                x - widthBack + 4 - acumulativeWidth,\r\n                y - 4,\r\n                widthBack + acumulativeWidth,\r\n                height,\r\n                '#ffffff',\r\n                '#ffffff'\r\n            );\r\n            back = true;\r\n\r\n            this._pdf.doc.text(\r\n                watermark.title,\r\n                x,\r\n                y + paddingBack + 3 + (!watermark.subtitle ? 2 : 0),\r\n                {\r\n                    align: 'right'\r\n                }\r\n            );\r\n\r\n            acumulativeWidth += w;\r\n        }\r\n\r\n        if (watermark.subtitle) {\r\n            this._pdf.doc.setTextColor(watermark.subtitleColor);\r\n            this._pdf.doc.setFontSize(fontSizeSubtitle);\r\n            this._pdf.doc.setFont('helvetica', 'normal');\r\n\r\n            if (!back) {\r\n                const { w } = this._pdf.doc.getTextDimensions(\r\n                    watermark.subtitle\r\n                );\r\n                const widthBack = paddingBack * 2 + w;\r\n                this._addRoundedBox(\r\n                    x - widthBack + 3 - acumulativeWidth,\r\n                    y - 4,\r\n                    widthBack + acumulativeWidth,\r\n                    16,\r\n                    '#ffffff',\r\n                    '#ffffff'\r\n                );\r\n                acumulativeWidth += widthBack;\r\n                back = true;\r\n            }\r\n\r\n            const marginTop = watermark.title ? fontSize / 2 : 4;\r\n\r\n            this._pdf.doc.text(\r\n                watermark.subtitle,\r\n                x,\r\n                y + paddingBack + marginTop,\r\n                {\r\n                    align: 'right'\r\n                }\r\n            );\r\n        }\r\n\r\n        if (!watermark.logo) return;\r\n\r\n        const addImage = (image: HTMLImageElement): void => {\r\n            this._pdf.doc.addImage(\r\n                image,\r\n                'PNG',\r\n                x - acumulativeWidth + paddingBack * 2 - 1,\r\n                y - 1,\r\n                imageSize,\r\n                imageSize\r\n            );\r\n        };\r\n\r\n        if (!back) {\r\n            const widthBack = acumulativeWidth + paddingBack;\r\n            this._addRoundedBox(\r\n                x - widthBack + 4,\r\n                y - 4,\r\n                widthBack,\r\n                16,\r\n                '#ffffff',\r\n                '#ffffff'\r\n            );\r\n        }\r\n\r\n        if (watermark.logo instanceof Image) {\r\n            addImage(watermark.logo);\r\n            return;\r\n        } else {\r\n            let imgData: string;\r\n\r\n            if (typeof watermark.logo === 'string') {\r\n                imgData = watermark.logo;\r\n            } else if (watermark.logo instanceof SVGElement) {\r\n                imgData = await this._processSvgImage(watermark.logo);\r\n            } else {\r\n                throw this._i18n.errorImage;\r\n            }\r\n\r\n            return new Promise((resolve, reject) => {\r\n                const image = new Image(imageSize, imageSize);\r\n                image.onload = () => {\r\n                    try {\r\n                        addImage(image);\r\n                        resolve();\r\n                    } catch (err) {\r\n                        return reject(err);\r\n                    }\r\n                };\r\n                image.onerror = () => {\r\n                    return reject(this._i18n.errorImage);\r\n                };\r\n                image.src = imgData;\r\n            });\r\n        }\r\n    };\r\n\r\n    /**\r\n     * @protected\r\n     */\r\n    _addDate = (): void => {\r\n        const position = 'bottomright';\r\n        const width = 250;\r\n        const offset = {\r\n            x: 0,\r\n            y: -5\r\n        };\r\n        const fontSize = 7;\r\n        const txcolor = '#000000';\r\n        const align = 'right';\r\n\r\n        this._pdf.doc.setFont('helvetica', 'normal');\r\n        const str = new Date(Date.now()).toLocaleDateString(\r\n            this._config.dateFormat\r\n        );\r\n        this._addTextByOffset(\r\n            position,\r\n            offset,\r\n            width,\r\n            fontSize,\r\n            txcolor,\r\n            align,\r\n            str\r\n        );\r\n    };\r\n\r\n    /**\r\n     * @protected\r\n     */\r\n    _addUrl = (): void => {\r\n        const position = 'bottomleft';\r\n        const width = 250;\r\n        const offset = {\r\n            x: 0,\r\n            y: -6.5\r\n        };\r\n        const fontSize = 6;\r\n        const txcolor = '#000000';\r\n        const align = 'left';\r\n\r\n        this._pdf.doc.setFont('helvetica', 'italic');\r\n        const str = window.location.href;\r\n        this._addTextByOffset(\r\n            position,\r\n            offset,\r\n            width,\r\n            fontSize,\r\n            txcolor,\r\n            align,\r\n            str\r\n        );\r\n    };\r\n    /**\r\n     * @protected\r\n     */\r\n    _addSpecs = (): void => {\r\n        const position = 'bottomleft';\r\n        const offset = {\r\n            x: 0,\r\n            y: -3.5\r\n        };\r\n        const fontSize = 6;\r\n        const txcolor = '#000000';\r\n        const align = 'left';\r\n\r\n        this._pdf.doc.setFont('helvetica', 'bold');\r\n        this._pdf.doc.setFontSize(fontSize);\r\n\r\n        const scale = `${\r\n            this._i18n.scale\r\n        } 1:${this._scaleDenominator.toLocaleString('de')}`;\r\n        const paper = `${this._i18n.paper} ${this._form.format.toUpperCase()}`;\r\n        const dpi = `${this._form.resolution} DPI`;\r\n\r\n        const specs = [scale, dpi, paper];\r\n        const str = specs.join(' - ');\r\n\r\n        const { w } = this._pdf.doc.getTextDimensions(str);\r\n\r\n        this._addTextByOffset(\r\n            position,\r\n            offset,\r\n            w,\r\n            fontSize,\r\n            txcolor,\r\n            align,\r\n            str\r\n        );\r\n    };\r\n\r\n    /**\r\n     * The attributions are obtained from the Control in the DOM.\r\n     * @protected\r\n     */\r\n    _addAttributions = (): void => {\r\n        const attributionsUl = document.querySelector('.ol-attribution ul');\r\n\r\n        if (!attributionsUl) return;\r\n\r\n        const ATTRI_SEPATATOR = ' · ';\r\n\r\n        const position = 'bottomright';\r\n        const offset = { x: 1, y: 1 };\r\n        const fontSize = 7;\r\n\r\n        this._pdf.doc.setFont('helvetica', 'normal');\r\n        this._pdf.doc.setFontSize(fontSize);\r\n        const { x, y } = this._calculateOffsetByPosition(position, offset);\r\n\r\n        let xPos = x;\r\n\r\n        const { w, h } = this._pdf.doc.getTextDimensions(\r\n            attributionsUl.textContent\r\n        );\r\n\r\n        const paddingBack = 4;\r\n\r\n        const whiteSpaceWidth =\r\n            this._pdf.doc.getTextDimensions(ATTRI_SEPATATOR).w;\r\n\r\n        const attributions = document.querySelectorAll('.ol-attribution li');\r\n\r\n        const sumWhiteSpaceWidth = whiteSpaceWidth * (attributions.length - 1);\r\n\r\n        this._addRoundedBox(\r\n            x - w - sumWhiteSpaceWidth - 2,\r\n            y - h,\r\n            w + paddingBack + sumWhiteSpaceWidth + 2,\r\n            h + paddingBack,\r\n            '#ffffff',\r\n            '#ffffff'\r\n        );\r\n\r\n        Array.from(attributions)\r\n            .reverse()\r\n            .forEach((attribution, index) => {\r\n                Array.from(attribution.childNodes)\r\n                    .reverse()\r\n                    .forEach((node) => {\r\n                        const content = node.textContent;\r\n\r\n                        if ('href' in node) {\r\n                            this._pdf.doc.setTextColor('#0077cc');\r\n                            this._pdf.doc.textWithLink(content, xPos, y, {\r\n                                align: 'right',\r\n                                url: (node as HTMLAnchorElement).href\r\n                            });\r\n                        } else {\r\n                            this._pdf.doc.setTextColor('#666666');\r\n                            this._pdf.doc.text(content, xPos, y, {\r\n                                align: 'right'\r\n                            });\r\n                        }\r\n\r\n                        const { w } = this._pdf.doc.getTextDimensions(content);\r\n                        xPos -= w;\r\n                    });\r\n\r\n                // Excldue last element\r\n                if (index !== attributions.length - 1) {\r\n                    // To add separation between diferents attributtions\r\n                    this._pdf.doc.text(ATTRI_SEPATATOR, xPos, y, {\r\n                        align: 'right'\r\n                    });\r\n\r\n                    xPos -= whiteSpaceWidth;\r\n                }\r\n            });\r\n    };\r\n\r\n    /**\r\n     * Adapted from http://hg.intevation.de/gemma/file/tip/client/src/components/Pdftool.vue#l252\r\n     * @protected\r\n     */\r\n    _addScaleBar = (): void => {\r\n        const offset = { x: 2, y: 2 };\r\n\r\n        const maxWidth = 90; // in mm\r\n\r\n        // from https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Math/log10#Polyfill\r\n        const log10 =\r\n            Math.log10 || // more precise, but unsupported by IE\r\n            function (x) {\r\n                return Math.log(x) * Math.LOG10E;\r\n            };\r\n\r\n        let maxLength = maxWidth * this._scaleDenominator;\r\n\r\n        let unit: string;\r\n        let unitConversionFactor: number;\r\n\r\n        if (this._config.units === 'metric') {\r\n            unit = 'mm';\r\n\r\n            const millimetre = 1;\r\n            const metre = 1000;\r\n            const kilometre = metre * 1000;\r\n\r\n            unitConversionFactor = millimetre;\r\n\r\n            if (maxLength >= kilometre * 10) {\r\n                unit = 'km';\r\n                unitConversionFactor = 1e6;\r\n            } else if (maxLength >= metre * 10) {\r\n                unit = 'm';\r\n                unitConversionFactor = metre;\r\n            }\r\n        } else if (this._config.units === 'imperial') {\r\n            const inch = 25.4; // Millimetre to inch\r\n            const mile = inch * 63360;\r\n            const yard = inch * 36;\r\n\r\n            unit = 'in';\r\n            unitConversionFactor = inch;\r\n\r\n            if (maxLength >= mile * 10) {\r\n                unit = 'mi';\r\n                unitConversionFactor = mile;\r\n            } else if (maxLength >= yard * 10) {\r\n                unit = 'yd';\r\n                unitConversionFactor = yard;\r\n            }\r\n        }\r\n\r\n        maxLength /= unitConversionFactor;\r\n\r\n        const unroundedLength = maxLength;\r\n        const numberOfDigits = Math.floor(log10(unroundedLength));\r\n        const factor = Math.pow(10, numberOfDigits);\r\n        const mapped = unroundedLength / factor;\r\n\r\n        let length = Math.floor(maxLength); // just to have an upper limit\r\n\r\n        // manually only use numbers that are very nice to devide by 4\r\n        // note that this is taken into account for rounding later\r\n        if (mapped > 8) {\r\n            length = 8 * factor;\r\n        } else if (mapped > 4) {\r\n            length = 4 * factor;\r\n        } else if (mapped > 2) {\r\n            length = 2 * factor;\r\n        } else {\r\n            length = factor;\r\n        }\r\n\r\n        let size = (length * unitConversionFactor) / this._scaleDenominator / 4;\r\n\r\n        const percentageMargin = this._style.paperMargin\r\n            ? ((this._style.paperMargin * 2) / this._pdf.width) * 100\r\n            : null;\r\n\r\n        // Reduce length acording to margins\r\n        size = percentageMargin\r\n            ? (size / 100) * (100 - percentageMargin)\r\n            : size;\r\n\r\n        const fullSize = size * 4;\r\n\r\n        // x/y defaults to offset for topleft corner (normal x/y coordinates)\r\n        const x = offset.x + this._style.paperMargin;\r\n        let y = offset.y + this._style.paperMargin;\r\n\r\n        y = this._pdf.height - offset.y - 10 - this._style.paperMargin;\r\n\r\n        // to give the outer white box 4mm padding\r\n        const scaleBarX = x + 4;\r\n        const scaleBarY = y + 5; // 5 because above the scalebar will be the numbers\r\n\r\n        // draw outer box\r\n        this._addRoundedBox(\r\n            x,\r\n            y,\r\n            fullSize + 8,\r\n            10,\r\n            this._style.bkcolor,\r\n            this._style.brcolor\r\n        );\r\n\r\n        // draw first part of scalebar\r\n        this._pdf.doc.setDrawColor(this._style.brcolor);\r\n        this._pdf.doc.setFillColor(0, 0, 0);\r\n        this._pdf.doc.rect(scaleBarX, scaleBarY, size, 1, 'FD');\r\n\r\n        // draw second part of scalebar\r\n        this._pdf.doc.setDrawColor(this._style.brcolor);\r\n        this._pdf.doc.setFillColor(255, 255, 255);\r\n        this._pdf.doc.rect(scaleBarX + size, scaleBarY, size, 1, 'FD');\r\n\r\n        // draw third part of scalebar\r\n        this._pdf.doc.setDrawColor(this._style.brcolor);\r\n        this._pdf.doc.setFillColor(0, 0, 0);\r\n        this._pdf.doc.rect(scaleBarX + size * 2, scaleBarY, size * 2, 1, 'FD');\r\n\r\n        // draw numeric labels above scalebar\r\n        this._pdf.doc.setTextColor(this._style.txcolor);\r\n        this._pdf.doc.setFontSize(6);\r\n        this._pdf.doc.text('0', scaleBarX, scaleBarY - 1);\r\n        // /4 and could give 2.5. We still round, because of floating point arith\r\n        this._pdf.doc.text(\r\n            String(Math.round((length * 10) / 4) / 10),\r\n            scaleBarX + size - 1,\r\n            scaleBarY - 1\r\n        );\r\n        this._pdf.doc.text(\r\n            String(Math.round(length / 2)),\r\n            scaleBarX + size * 2 - 2,\r\n            scaleBarY - 1\r\n        );\r\n        this._pdf.doc.text(\r\n            Math.round(length).toString() + ' ' + unit,\r\n            scaleBarX + size * 4 - 4,\r\n            scaleBarY - 1\r\n        );\r\n    };\r\n\r\n    /**\r\n     *\r\n     * @param imgSrc\r\n     * @returns\r\n     * @protected\r\n     */\r\n    _addCompass = async (\r\n        imgSrc: HTMLImageElement | string | SVGElement\r\n    ): Promise<void> => {\r\n        const position = 'bottomright';\r\n        const offset = { x: 2, y: 6 };\r\n        const size = 6;\r\n        const rotationRadians = this._view.getRotation();\r\n        const imageSize = 100;\r\n\r\n        const { x, y } = this._calculateOffsetByPosition(\r\n            position,\r\n            offset,\r\n            size\r\n        );\r\n\r\n        const addRotation = (image: CanvasImageSource) => {\r\n            const canvas = document.createElement('canvas');\r\n\r\n            // Must be bigger than the image to prevent clipping\r\n            canvas.height = 120;\r\n            canvas.width = 120;\r\n            const context = canvas.getContext('2d');\r\n\r\n            context.translate(canvas.width * 0.5, canvas.height * 0.5);\r\n            context.rotate(rotationRadians);\r\n            context.translate(-canvas.width * 0.5, -canvas.height * 0.5);\r\n            context.drawImage(\r\n                image,\r\n                (canvas.height - imageSize) / 2,\r\n                (canvas.width - imageSize) / 2,\r\n                imageSize,\r\n                imageSize\r\n            );\r\n\r\n            // Add back circle\r\n            const xCircle = x - size;\r\n            const yCircle = y;\r\n            this._pdf.doc.setDrawColor(this._style.brcolor);\r\n            this._pdf.doc.setFillColor(this._style.bkcolor);\r\n            this._pdf.doc.circle(xCircle, yCircle, size, 'FD');\r\n\r\n            return canvas;\r\n        };\r\n\r\n        const addImage = (image: CanvasImageSource): void => {\r\n            const rotatedCanvas = addRotation(image);\r\n\r\n            const sizeImage = size * 1.5;\r\n            const xImage = x - sizeImage - size / 4.3;\r\n            const yImage = y - sizeImage / 2;\r\n\r\n            this._pdf.doc.addImage(\r\n                rotatedCanvas,\r\n                'PNG',\r\n                xImage,\r\n                yImage,\r\n                sizeImage,\r\n                sizeImage\r\n            );\r\n        };\r\n\r\n        let image: HTMLImageElement;\r\n\r\n        if (imgSrc instanceof Image) {\r\n            addImage(image);\r\n            return;\r\n        } else {\r\n            let imgData: string;\r\n\r\n            if (typeof imgSrc === 'string') {\r\n                imgData = imgSrc;\r\n            } else if (imgSrc instanceof SVGElement) {\r\n                imgData = await this._processSvgImage(imgSrc);\r\n            } else {\r\n                throw this._i18n.errorImage;\r\n            }\r\n\r\n            return new Promise((resolve, reject) => {\r\n                const image = new Image(imageSize, imageSize);\r\n\r\n                image.onload = () => {\r\n                    addImage(image);\r\n                    resolve();\r\n                };\r\n\r\n                image.onerror = () => {\r\n                    reject(this._i18n.errorImage);\r\n                };\r\n\r\n                image.src = imgData;\r\n            });\r\n        }\r\n    };\r\n}\r\n\r\n/**\r\n * **_[interface]_**\r\n * @protected\r\n */\r\ninterface IWindow extends Window {\r\n    jspdf: any;\r\n    pdfjsLib: any;\r\n}\r\n\r\n/**\r\n * **_[interface]_**\r\n * @protected\r\n */\r\nexport interface IPdf {\r\n    doc: jsPDF;\r\n    width: number;\r\n    height: number;\r\n}\r\n\r\ninterface IPdfOptions {\r\n    view: View;\r\n    form: IPrintOptions;\r\n    i18n: I18n;\r\n    config: Options;\r\n    height: number;\r\n    width: number;\r\n    scaleResolution: number;\r\n}\r\n","/**\n * Vanilla JS Modal compatible with Bootstrap\n * modal-vanilla 0.12.0 <https://github.com/KaneCohen/modal-vanilla>\n * Copyright 2020 Kane Cohen <https://github.com/KaneCohen>\n * Available under BSD-3-Clause license\n */\nimport EventEmitter from 'events';\n\nlet _factory = null;\n\nconst _defaults = Object.freeze({\n  el: null,               // Existing DOM element that will be 'Modal-ized'.\n  animate: true,          // Show Modal using animation.\n  animateClass: 'fade',   //\n  animateInClass: 'show', //\n  appendTo: 'body',       // DOM element to which constructed Modal will be appended.\n  backdrop: true,         // Boolean or 'static', Show Modal backdrop blocking content.\n  keyboard: true,         // Close modal on esc key.\n  title: false,           // Content of the title in the constructed dialog.\n  header: true,           // Show header content.\n  content: false,         // Either string or an HTML element.\n  footer: true,           // Footer content. By default will use buttons.\n  buttons: null,          //\n  headerClose: true,      // Show close button in the header.\n  construct: false,       // Creates new HTML with a given content.\n  transition: 300,        //\n  backdropTransition: 150 //\n});\n\nconst _buttons = deepFreeze({\n  dialog: [\n    {text: 'Cancel',\n      value: false,\n      attr: {\n        'class': 'btn btn-default',\n        'data-dismiss': 'modal'\n      }\n    },\n    {text: 'OK',\n      value: true,\n      attr: {\n        'class': 'btn btn-primary',\n        'data-dismiss': 'modal'\n      }\n    }\n  ],\n  alert: [\n    {text: 'OK',\n      attr: {\n        'class': 'btn btn-primary',\n        'data-dismiss': 'modal'\n      }\n    }\n  ],\n  confirm: [\n    {text: 'Cancel',\n      value: false,\n      attr: {\n        'class': 'btn btn-default',\n        'data-dismiss': 'modal'\n      }\n    },\n    {text: 'OK',\n      value: true,\n      attr: {\n        'class': 'btn btn-primary',\n        'data-dismiss': 'modal'\n      }\n    }\n  ]\n});\n\nconst _templates = {\n  container: '<div class=\"modal\"></div>',\n  dialog: '<div class=\"modal-dialog\"></div>',\n  content: '<div class=\"modal-content\"></div>',\n  header: '<div class=\"modal-header\"></div>',\n  headerClose: '<button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Close\"><span aria-hidden=\"true\">×</span></button>',\n  body: '<div class=\"modal-body\"></div>',\n  footer: '<div class=\"modal-footer\"></div>',\n  backdrop: '<div class=\"modal-backdrop\"></div>'\n};\n\nfunction deepFreeze(obj) {\n  for (let k in obj) {\n    if (Array.isArray(obj[k])) {\n      obj[k].forEach(v => {\n        deepFreeze(v);\n      });\n    } else if (obj[k] !== null && typeof obj[k] === 'object') {\n      Object.freeze(obj[k]);\n    }\n  }\n  return Object.freeze(obj);\n}\n\nfunction guid() {\n  return (((1 + Math.random()) * 0x10000) | 0).toString(16) +\n    (((1 + Math.random()) * 0x10000) | 0).toString(16);\n}\n\nfunction data(el, prop, value) {\n let prefix = 'data';\n let elData = el[prefix] || {};\n if (typeof value === 'undefined') {\n   if (el[prefix] && el[prefix][prop]) {\n     return el[prefix][prop];\n   } else {\n     var dataAttr = el.getAttribute(`${prefix}-${prop}`);\n     if (typeof dataAttr !== 'undefined') {\n       return dataAttr;\n     }\n     return null;\n   }\n } else {\n   elData[prop] = value;\n   el[prefix] = elData;\n   return el;\n }\n}\n\nfunction build(html, all) {\n  if (html.nodeName) return html;\n  html = html.replace(/(\\t|\\n$)/g, '');\n\n  if (!_factory) {\n    _factory = document.createElement('div');\n  }\n\n  _factory.innerHTML = '';\n  _factory.innerHTML = html;\n  if (all === true) {\n    return _factory.childNodes;\n  } else {\n    return _factory.childNodes[0];\n  }\n}\n\nfunction calcScrollbarWidth() {\n  let inner;\n  let width;\n  let outerWidth;\n  let outer = document.createElement('div');\n  Object.assign(outer.style, {\n    visibility: 'hidden',\n    width: '100px'\n  });\n  document.body.appendChild(outer);\n\n  outerWidth = outer.offsetWidth;\n  outer.style.overflow = 'scroll';\n\n  inner = document.createElement('div');\n  inner.style.width = '100%';\n  outer.appendChild(inner);\n\n  width = outerWidth - inner.offsetWidth;\n  document.body.removeChild(outer);\n\n  return width;\n}\n\nfunction getPath(node) {\n  let nodes = [node];\n  while (node.parentNode) {\n    node = node.parentNode;\n    nodes.push(node);\n  }\n  return nodes;\n}\n\nclass Modal extends EventEmitter {\n  static set templates(templates) {\n    this._baseTemplates = templates;\n  }\n\n  static get templates() {\n    return Object.assign({}, _templates, Modal._baseTemplates || {});\n  }\n\n  static set buttons(buttons) {\n    this._baseButtons = buttons;\n  }\n\n  static get buttons() {\n    return Object.assign({}, _buttons, Modal._baseButtons || {});\n  }\n\n  static set options(options) {\n    this._baseOptions = options;\n  }\n\n  static get options() {\n    return Object.assign({}, _defaults, Modal._baseOptions || {});\n  }\n\n  static get version() {\n    return '0.12.0';\n  }\n\n  static alert(message, _options = {}) {\n    let options = Object.assign({},\n      _defaults,\n      {\n        title:  message,\n        content: false,\n        construct: true,\n        headerClose: false,\n        buttons: Modal.buttons.alert\n      },\n      _options\n    );\n\n    return new Modal(options);\n  }\n\n  static confirm(question, _options = {}) {\n    let options = Object.assign({},\n      _defaults,\n      {\n        title:  question,\n        content: false,\n        construct: true,\n        headerClose: false,\n        buttons: Modal.buttons.confirm\n      },\n      _options\n    );\n\n    return new Modal(options);\n  }\n\n  constructor(options = {}) {\n    super();\n\n    this.id = guid();\n    this.el = null;\n    this._html = {};\n    this._events = {};\n    this._visible = false;\n    this._pointerInContent = false;\n    this._options = Object.assign({}, Modal.options, options);\n    this._templates = Object.assign({}, Modal.templates, options.templates || {});\n    this._html.appendTo = document.querySelector(this._options.appendTo);\n    this._scrollbarWidth = calcScrollbarWidth();\n\n    if (this._options.buttons === null) {\n      this._options.buttons = Modal.buttons.dialog;\n    }\n\n    if (this._options.el) {\n      let el = this._options.el;\n      if (typeof this._options.el == 'string') {\n        el = document.querySelector(this._options.el);\n        if (! el) {\n          throw new Error(`Selector: DOM Element ${this._options.el} not found.`);\n        }\n      }\n      data(el, 'modal', this);\n      this.el = el;\n    } else {\n      this._options.construct = true;\n    }\n\n    if (this._options.construct) {\n      this._render();\n    } else {\n      this._mapDom();\n    }\n  }\n\n  _render() {\n    let html = this._html;\n    let o = this._options;\n    let t = this._templates;\n    let animate = o.animate ? o.animateClass : false;\n\n    html.container = build(t.container);\n    html.dialog = build(t.dialog);\n    html.content = build(t.content);\n    html.header = build(t.header);\n    html.headerClose = build(t.headerClose);\n    html.body = build(t.body);\n    html.footer = build(t.footer);\n    if (animate) html.container.classList.add(animate);\n\n    this._setHeader();\n    this._setContent();\n    this._setFooter();\n\n    this.el = html.container;\n\n    html.dialog.appendChild(html.content);\n    html.container.appendChild(html.dialog);\n\n    return this;\n  }\n\n  _mapDom() {\n    let html = this._html;\n    let o = this._options;\n\n    if (this.el.classList.contains(o.animateClass)) {\n      o.animate = true;\n    }\n\n    html.container = this.el;\n    html.dialog = this.el.querySelector('.modal-dialog');\n    html.content = this.el.querySelector('.modal-content');\n    html.header = this.el.querySelector('.modal-header');\n    html.headerClose = this.el.querySelector('.modal-header .close');\n    html.body = this.el.querySelector('.modal-body');\n    html.footer = this.el.querySelector('.modal-footer');\n\n    this._setHeader();\n    this._setContent();\n    this._setFooter();\n\n    return this;\n  }\n\n  _setHeader() {\n    let html = this._html;\n    let o = this._options;\n\n    if (o.header && html.header) {\n      if (o.title.nodeName) {\n        html.header.innerHTML = o.title.outerHTML;\n      } else if (typeof o.title === 'string') {\n        html.header.innerHTML = `<h4 class=\"modal-title\">${o.title}</h4>`;\n      }\n      // Add header close button only to constructed modals.\n      if (this.el === null && html.headerClose && o.headerClose) {\n        html.header.appendChild(html.headerClose);\n      }\n      if (o.construct) {\n        html.content.appendChild(html.header);\n      }\n    }\n  }\n\n  _setContent() {\n    let html = this._html;\n    let o = this._options;\n\n    if (o.content && html.body) {\n      if (typeof o.content === 'string') {\n        html.body.innerHTML = o.content;\n      } else {\n        html.body.innerHTML = o.content.outerHTML;\n      }\n      if (o.construct) {\n        html.content.appendChild(html.body);\n      }\n    }\n  }\n\n  _setFooter() {\n    let html = this._html;\n    let o = this._options;\n\n    if (o.footer && html.footer) {\n      if (o.footer.nodeName) {\n        html.footer.ineerHTML = o.footer.outerHTML;\n      } else if (typeof o.footer === 'string') {\n        html.footer.innerHTML = o.footer;\n      } else if (! html.footer.children.length) {\n        o.buttons.forEach((button) => {\n          let el = document.createElement('button');\n          data(el, 'button', button);\n          el.innerHTML = button.text;\n          el.setAttribute('type', 'button');\n          for (let j in button.attr) {\n            el.setAttribute(j, button.attr[j]);\n          }\n          html.footer.appendChild(el);\n        });\n      }\n      if (o.construct) {\n        html.content.appendChild(html.footer);\n      }\n    }\n\n  }\n\n  _setEvents() {\n    let o = this._options;\n    let html = this._html;\n\n    this._events.keydownHandler = this._handleKeydownEvent.bind(this);\n    document.body.addEventListener('keydown',\n      this._events.keydownHandler\n    );\n\n    this._events.mousedownHandler = this._handleMousedownEvent.bind(this);\n    html.container.addEventListener('mousedown',\n      this._events.mousedownHandler\n    );\n\n    this._events.clickHandler = this._handleClickEvent.bind(this);\n    html.container.addEventListener('click',\n      this._events.clickHandler\n    );\n\n    this._events.resizeHandler = this._handleResizeEvent.bind(this);\n    window.addEventListener('resize',\n      this._events.resizeHandler\n    );\n  }\n\n  _handleMousedownEvent(e) {\n    this._pointerInContent = false;\n    let path = getPath(e.target);\n    path.every(node => {\n      if (node.classList && node.classList.contains('modal-content')) {\n        this._pointerInContent = true;\n        return false;\n      }\n      return true;\n    });\n  }\n\n  _handleClickEvent(e) {\n    let path = getPath(e.target);\n    path.every(node => {\n      if (node.tagName === 'HTML') {\n        return false;\n      }\n      if (this._options.backdrop !== true && node.classList.contains('modal')) {\n        return false;\n      }\n      if (node.classList.contains('modal-content')) {\n        return false;\n      }\n      if (node.getAttribute('data-dismiss') === 'modal') {\n        this.emit('dismiss', this, e, data(e.target, 'button'));\n        this.hide();\n        return false;\n      }\n\n      if (!this._pointerInContent && node.classList.contains('modal')) {\n        this.emit('dismiss', this, e, null);\n        this.hide();\n        return false;\n      }\n      return true;\n    });\n\n    this._pointerInContent = false;\n  }\n\n  _handleKeydownEvent(e) {\n    if (e.which === 27 && this._options.keyboard) {\n      this.emit('dismiss', this, e, null);\n      this.hide();\n    }\n  }\n\n  _handleResizeEvent(e) {\n    this._resize();\n  }\n\n  show() {\n    let o = this._options;\n    let html = this._html;\n    this.emit('show', this);\n\n    this._checkScrollbar();\n    this._setScrollbar();\n    document.body.classList.add('modal-open');\n\n    if (o.construct) {\n      html.appendTo.appendChild(html.container);\n    }\n\n    html.container.style.display = 'block';\n    html.container.scrollTop = 0;\n\n    if (o.backdrop !== false) {\n      this.once('showBackdrop', () => {\n        this._setEvents();\n\n        if (o.animate) html.container.offsetWidth; // Force reflow\n\n        html.container.classList.add(o.animateInClass);\n\n        setTimeout(() => {\n          this._visible = true;\n          this.emit('shown', this);\n        }, o.transition);\n      });\n      this._backdrop();\n    } else {\n      this._setEvents();\n\n      if (o.animate) html.container.offsetWidth; // Force reflow\n\n      html.container.classList.add(o.animateInClass);\n\n      setTimeout(() => {\n        this._visible = true;\n        this.emit('shown', this);\n      }, o.transition);\n    }\n    this._resize();\n\n    return this;\n  }\n\n  toggle() {\n    if (this._visible) {\n      this.hide();\n    } else {\n      this.show();\n    }\n  }\n\n  _resize() {\n    var modalIsOverflowing =\n      this._html.container.scrollHeight > document.documentElement.clientHeight;\n\n    this._html.container.style.paddingLeft =\n      ! this.bodyIsOverflowing && modalIsOverflowing ? this._scrollbarWidth + 'px' : '';\n\n    this._html.container.style.paddingRight =\n      this.bodyIsOverflowing && ! modalIsOverflowing ? this._scrollbarWidth + 'px' : '';\n  }\n\n  _backdrop() {\n    let html = this._html;\n    let t = this._templates;\n    let o = this._options;\n    let animate = o.animate ? o.animateClass : false;\n\n    html.backdrop = build(t.backdrop);\n    if (animate) html.backdrop.classList.add(animate);\n    html.appendTo.appendChild(html.backdrop);\n\n    if (animate) html.backdrop.offsetWidth;\n\n    html.backdrop.classList.add(o.animateInClass);\n\n    setTimeout(() => {\n      this.emit('showBackdrop', this);\n    }, this._options.backdropTransition);\n  }\n\n  hide() {\n    let html = this._html;\n    let o = this._options;\n    let contCList = html.container.classList;\n    this.emit('hide', this);\n\n    contCList.remove(o.animateInClass);\n\n    if (o.backdrop) {\n      let backCList = html.backdrop.classList;\n      backCList.remove(o.animateInClass);\n    }\n\n    this._removeEvents();\n\n    setTimeout(() => {\n      document.body.classList.remove('modal-open');\n      document.body.style.paddingRight = this.originalBodyPad;\n    }, o.backdropTransition);\n\n    setTimeout(() => {\n      if (o.backdrop) {\n        html.backdrop.parentNode.removeChild(html.backdrop);\n      }\n      html.container.style.display = 'none';\n\n      if (o.construct) {\n        html.container.parentNode.removeChild(html.container);\n      }\n\n      this._visible = false;\n      this.emit('hidden', this);\n    }, o.transition);\n\n    return this;\n  }\n\n  _removeEvents() {\n    if (this._events.keydownHandler) {\n      document.body.removeEventListener('keydown',\n        this._events.keydownHandler\n      );\n    }\n\n    this._html.container.removeEventListener('mousedown',\n      this._events.mousedownHandler\n    );\n\n    this._html.container.removeEventListener('click',\n      this._events.clickHandler\n    );\n\n    window.removeEventListener('resize',\n      this._events.resizeHandler\n    );\n  }\n\n  _checkScrollbar() {\n    this.bodyIsOverflowing = document.body.clientWidth < window.innerWidth;\n  }\n\n  _setScrollbar() {\n    this.originalBodyPad = document.body.style.paddingRight || '';\n    if (this.bodyIsOverflowing) {\n      let basePadding = parseInt(this.originalBodyPad || 0, 10);\n      document.body.style.paddingRight = basePadding + this._scrollbarWidth + 'px';\n    }\n  }\n}\n\nexport default Modal;\n","import Modal from 'modal-vanilla';\r\nimport Map from 'ol/Map';\r\n\r\nimport { I18n, IValues, Options } from '../ol-pdf-printer';\r\nimport { getMapScale } from './Helpers';\r\nimport myPragma from '../myPragma';\r\n/**\r\n * @private\r\n */\r\nexport default class SettingsModal {\r\n    _modal: Modal;\r\n\r\n    constructor(\r\n        map: Map,\r\n        options: Options,\r\n        i18n: I18n,\r\n        printMap: (values: IValues, showLoading: boolean, delay: number) => void\r\n    ) {\r\n        this._modal = new Modal({\r\n            headerClose: true,\r\n            header: true,\r\n            animate: true,\r\n            title: i18n.printPdf,\r\n            content: this.Content(i18n, options),\r\n            footer: this.Footer(i18n, options),\r\n            ...options.modal\r\n        });\r\n\r\n        this._modal.on('dismiss', (modal: Modal, event: Event): void => {\r\n            const print = (event.target as HTMLElement).dataset.print;\r\n            if (!print) return;\r\n\r\n            const form = document.getElementById('printMap') as HTMLFormElement;\r\n\r\n            const formData = new FormData(form);\r\n\r\n            const values = {\r\n                format: formData.get('printFormat'),\r\n                orientation: formData.get('printOrientation'),\r\n                resolution: formData.get('printResolution'),\r\n                scale: formData.get('printScale'),\r\n                description: formData.get('printDescription'),\r\n                compass: formData.get('printCompass'),\r\n                attributions: formData.get('printAttributions'),\r\n                scalebar: formData.get('printScalebar'),\r\n                typeExport: this._modal.el.querySelector(\r\n                    'select[name=\"printTypeExport\"]'\r\n                ).value\r\n            };\r\n\r\n            printMap(\r\n                values,\r\n                /* showLoading */ true,\r\n                /* delay */ options.modal.transition\r\n            );\r\n        });\r\n\r\n        this._modal.on('shown', (): void => {\r\n            const actualScaleVal = getMapScale(map);\r\n            const actualScale = this._modal.el.querySelector('.actualScale');\r\n            (actualScale as HTMLInputElement).value = String(\r\n                actualScaleVal / 1000\r\n            );\r\n            actualScale.innerHTML = `${\r\n                i18n.current\r\n            } (1:${actualScaleVal.toLocaleString('de')})`;\r\n        });\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param i18n\r\n     * @param options\r\n     * @returns\r\n     * @protected\r\n     */\r\n    Content(i18n: I18n, options: Options): HTMLElement {\r\n        const { scales, dpi, mapElements, paperSizes } = options;\r\n\r\n        return (\r\n            <form id=\"printMap\">\r\n                <div>\r\n                    <div className=\"printFieldHalf\">\r\n                        <label htmlFor=\"printFormat\">{i18n.paperSize}</label>\r\n                        <select name=\"printFormat\" id=\"printFormat\">\r\n                            {paperSizes.map((paper) => (\r\n                                <option\r\n                                    value={paper.value}\r\n                                    {...(paper.selected\r\n                                        ? { selected: 'selected' }\r\n                                        : {})}\r\n                                >\r\n                                    {paper.value}\r\n                                </option>\r\n                            ))}\r\n                        </select>\r\n                    </div>\r\n                    <div className=\"printFieldHalf\">\r\n                        <label htmlFor=\"printOrientation\">\r\n                            {i18n.orientation}\r\n                        </label>\r\n                        <select name=\"printOrientation\" id=\"printOrientation\">\r\n                            <option value=\"landscape\" selected>\r\n                                {i18n.landscape}\r\n                            </option>\r\n                            <option value=\"portrait\">{i18n.portrait}</option>\r\n                        </select>\r\n                    </div>\r\n                </div>\r\n                <div>\r\n                    <div className=\"printFieldHalf\">\r\n                        <label htmlFor=\"printResolution\">\r\n                            {i18n.resolution}\r\n                        </label>\r\n                        <select name=\"printResolution\" id=\"printResolution\">\r\n                            {dpi.map((d) => (\r\n                                <option\r\n                                    value={d.value}\r\n                                    {...(d.selected\r\n                                        ? { selected: 'selected' }\r\n                                        : {})}\r\n                                >\r\n                                    {d.value} dpi\r\n                                </option>\r\n                            ))}\r\n                        </select>\r\n                    </div>\r\n                    <div className=\"printFieldHalf\">\r\n                        <label htmlFor=\"printScale\">{i18n.scale}</label>\r\n                        <select name=\"printScale\" id=\"printScale\">\r\n                            <option\r\n                                className=\"actualScale\"\r\n                                value=\"\"\r\n                                selected\r\n                            ></option>\r\n                            {scales.map((scale) => (\r\n                                <option value={scale}>\r\n                                    1:{(scale * 1000).toLocaleString('de')}\r\n                                </option>\r\n                            ))}\r\n                        </select>\r\n                    </div>\r\n                </div>\r\n                {mapElements && (\r\n                    <div>\r\n                        {mapElements.description && (\r\n                            <div>\r\n                                <label htmlFor=\"printDescription\">\r\n                                    {i18n.addNote}\r\n                                </label>\r\n                                <textarea\r\n                                    id=\"printDescription\"\r\n                                    name=\"printDescription\"\r\n                                    rows=\"4\"\r\n                                ></textarea>\r\n                            </div>\r\n                        )}\r\n                        <div>{i18n.mapElements}</div>\r\n                        <div className=\"printElements\">\r\n                            {mapElements.compass && (\r\n                                <label htmlFor=\"printCompass\">\r\n                                    <input\r\n                                        type=\"checkbox\"\r\n                                        id=\"printCompass\"\r\n                                        name=\"printCompass\"\r\n                                        checked\r\n                                    />\r\n                                    {i18n.compass}\r\n                                </label>\r\n                            )}\r\n                            {mapElements.scalebar && (\r\n                                <label htmlFor=\"printScalebar\">\r\n                                    <input\r\n                                        type=\"checkbox\"\r\n                                        id=\"printScalebar\"\r\n                                        name=\"printScalebar\"\r\n                                        checked\r\n                                    />\r\n                                    {i18n.scale}\r\n                                </label>\r\n                            )}\r\n                            {mapElements.attributions && (\r\n                                <label htmlFor=\"printAttributions\">\r\n                                    <input\r\n                                        type=\"checkbox\"\r\n                                        id=\"printAttributions\"\r\n                                        name=\"printAttributions\"\r\n                                        checked\r\n                                    />\r\n                                    {i18n.layersAttributions}\r\n                                </label>\r\n                            )}\r\n                        </div>\r\n                    </div>\r\n                )}\r\n            </form>\r\n        );\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param i18n\r\n     * @returns\r\n     * @protected\r\n     */\r\n    Footer(i18n: I18n, options: Options): string {\r\n        const { mimeTypeExports } = options;\r\n\r\n        return (\r\n            <div>\r\n                <button\r\n                    type=\"button\"\r\n                    className=\"btn-sm btn btn-secondary\"\r\n                    data-dismiss=\"modal\"\r\n                >\r\n                    {i18n.cancel}\r\n                </button>\r\n                <div class=\"typeExportContainer\">\r\n                    <button\r\n                        type=\"button\"\r\n                        className=\"btn-sm btn btn-primary\"\r\n                        data-print=\"true\"\r\n                        data-dismiss=\"modal\"\r\n                    >\r\n                        {i18n.print}\r\n                    </button>\r\n                    <select\r\n                        className=\"typeExport\"\r\n                        name=\"printTypeExport\"\r\n                        id=\"printTypeExport\"\r\n                    >\r\n                        {mimeTypeExports.map((type) => (\r\n                            <option\r\n                                value={type.value}\r\n                                {...(type.selected\r\n                                    ? { selected: 'selected' }\r\n                                    : {})}\r\n                            >\r\n                                {type.value}\r\n                            </option>\r\n                        ))}\r\n                    </select>\r\n                </div>\r\n            </div>\r\n        ).outerHTML;\r\n    }\r\n\r\n    hide(): void {\r\n        this._modal.hide();\r\n    }\r\n\r\n    show(): void {\r\n        if (!this._modal._visible) this._modal.show();\r\n    }\r\n}\r\n","import Map from 'ol/Map';\r\nimport { METERS_PER_UNIT } from 'ol/proj/Units';\r\n\r\n/**\r\n *\r\n * @param map\r\n * @param opt_round\r\n * @returns\r\n * @protected\r\n */\r\nexport const getMapScale = (map: Map, opt_round = true): number => {\r\n    const dpi = 25.4 / 0.28;\r\n\r\n    const view = map.getView();\r\n    const unit = view.getProjection().getUnits();\r\n    const res = view.getResolution();\r\n    const inchesPerMetre = 39.37;\r\n\r\n    let scale = res * METERS_PER_UNIT[unit] * inchesPerMetre * dpi;\r\n\r\n    if (opt_round) {\r\n        scale = Math.round(scale);\r\n    }\r\n\r\n    return scale;\r\n};\r\n","import Modal from 'modal-vanilla';\r\nimport { I18n, Options } from '../ol-pdf-printer';\r\n\r\n/**\r\n * @private\r\n */\r\nexport default class ProcessingModal {\r\n    protected _modal: Modal;\r\n    protected _footer: string;\r\n    protected _i18n: I18n;\r\n\r\n    /**\r\n     *\r\n     * @param i18n\r\n     * @param options\r\n     * @param onEndPrint\r\n     * @protected\r\n     */\r\n    constructor(i18n: I18n, options: Options, onEndPrint: () => void) {\r\n        this._i18n = i18n;\r\n\r\n        this._modal = new Modal({\r\n            headerClose: false,\r\n            title: this._i18n.printing,\r\n            backdrop: 'static', // To prevent close on clicking backdrop\r\n            content: ' ',\r\n            footer: `\r\n            <button\r\n                type=\"button\"\r\n                class=\"btn-sm btn btn-secondary\"\r\n                data-dismiss=\"modal\"\r\n            >\r\n                ${this._i18n.cancel}\r\n            </button>\r\n            `,\r\n            ...options.modal\r\n        });\r\n\r\n        this._modal.on('dismiss', () => {\r\n            onEndPrint();\r\n        });\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param string\r\n     * @protected\r\n     */\r\n    _setContentModal(string: string): void {\r\n        this._modal._html.body.innerHTML = string;\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param string\r\n     * @protected\r\n     */\r\n    _setFooterModal(string: string): void {\r\n        this._modal._html.footer.innerHTML = string;\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param string\r\n     * @param footer\r\n     * @protected\r\n     */\r\n    show(string: string): void {\r\n        this._setContentModal(string);\r\n        if (!this._modal._visible) this._modal.show();\r\n    }\r\n\r\n    /**\r\n     * @protected\r\n     */\r\n    hide(): void {\r\n        this._modal.hide();\r\n    }\r\n}\r\n","import { I18n } from '../../ol-pdf-printer';\r\n\r\nexport const en: I18n = {\r\n    printPdf: 'Print PDF',\r\n    pleaseWait: 'Please wait...',\r\n    almostThere: 'Almost there...',\r\n    error: 'An error occurred while printing',\r\n    errorImage: 'An error ocurred while loading an image',\r\n    printing: 'Exporting',\r\n    cancel: 'Cancel',\r\n    close: 'Close',\r\n    print: 'Export',\r\n    mapElements: 'Map elements',\r\n    compass: 'Compass',\r\n    scale: 'Scale',\r\n    layersAttributions: 'Layer attributions',\r\n    addNote: 'Add note (optional)',\r\n    resolution: 'Resolution',\r\n    orientation: 'Orientation',\r\n    paperSize: 'Paper size',\r\n    landscape: 'Landscape',\r\n    portrait: 'Portrait',\r\n    current: 'Current',\r\n    paper: 'Paper'\r\n};\r\n","import { I18n } from '../../ol-pdf-printer';\r\n\r\nexport const es: I18n = {\r\n    printPdf: 'Exportar PDF',\r\n    pleaseWait: 'Por favor espere...',\r\n    almostThere: 'Ya casi...',\r\n    error: 'Error al generar pdf',\r\n    errorImage: 'Ocurrió un error al tratar de cargar una imagen',\r\n    printing: 'Exportando',\r\n    cancel: 'Cancelar',\r\n    close: 'Cerrar',\r\n    print: 'Exportar',\r\n    mapElements: 'Elementos en el mapa',\r\n    compass: 'Brújula',\r\n    scale: 'Escala',\r\n    layersAttributions: 'Atribuciones de capas',\r\n    addNote: 'Agregar nota (opcional)',\r\n    resolution: 'Resolución',\r\n    orientation: 'Orientación',\r\n    paperSize: 'Tamaño de página',\r\n    landscape: 'Paisaje',\r\n    portrait: 'Retrato',\r\n    current: 'Actual',\r\n    paper: 'Hoja'\r\n};\r\n","import Map from 'ol/Map';\r\nimport View from 'ol/View';\r\nimport Control, { Options as ControlOptions } from 'ol/control/Control';\r\nimport TileWMS from 'ol/source/TileWMS';\r\nimport Tile from 'ol/layer/Tile';\r\nimport { getPointResolution } from 'ol/proj';\r\nimport { EventsKey } from 'ol/events';\r\nimport { unByKey } from 'ol/Observable';\r\n\r\nimport domtoimage from 'dom-to-image-improved';\r\n\r\nimport { Locale } from 'locale-enum';\r\n\r\nimport Pdf from './components/Pdf';\r\nimport SettingsModal from './components/SettingsModal';\r\nimport ProcessingModal from './components/ProcessingModal';\r\nimport * as i18n from './components/i18n/index.js';\r\n\r\nimport compassIcon from './assets/images/compass.svg';\r\nimport pdfIcon from './assets/images/pdf.svg';\r\n\r\nimport './assets/css/ol-pdf-printer.css';\r\n\r\n/**\r\n * @protected\r\n */\r\nconst DEFAULT_LANGUAGE = 'en';\r\n\r\n/**\r\n * @protected\r\n */\r\nconst CLASS_PRINT_MODE = 'printMode';\r\n\r\n/**\r\n * @protected\r\n */\r\nfunction deepObjectAssign(target, ...sources) {\r\n    sources.forEach((source) => {\r\n        Object.keys(source).forEach((key) => {\r\n            const s_val = source[key];\r\n            const t_val = target[key];\r\n            target[key] =\r\n                t_val &&\r\n                s_val &&\r\n                typeof t_val === 'object' &&\r\n                typeof s_val === 'object' &&\r\n                !Array.isArray(t_val) // Don't merge arrays\r\n                    ? deepObjectAssign(t_val, s_val)\r\n                    : s_val;\r\n        });\r\n    });\r\n    return target;\r\n}\r\n\r\nexport default class PdfPrinter extends Control {\r\n    protected _i18n: I18n;\r\n\r\n    protected _map: Map;\r\n    protected _view: View;\r\n    protected _mapTarget: HTMLElement;\r\n\r\n    protected _pdf: Pdf;\r\n\r\n    protected _processingModal: ProcessingModal;\r\n    protected _settingsModal: SettingsModal;\r\n\r\n    protected _initialized: boolean;\r\n\r\n    protected _timeoutProcessing: ReturnType<typeof setTimeout>;\r\n\r\n    protected _initialViewResolution: number;\r\n\r\n    protected _options: Options;\r\n\r\n    protected _renderCompleteKey: EventsKey | EventsKey[];\r\n\r\n    protected _isCanceled: boolean;\r\n\r\n    constructor(opt_options?: Options) {\r\n        const controlElement = document.createElement('button');\r\n\r\n        super({\r\n            target: opt_options.target,\r\n            element: controlElement\r\n        });\r\n\r\n        // Check if the selected language exists\r\n        this._i18n =\r\n            opt_options.language && opt_options.language in i18n\r\n                ? i18n[opt_options.language]\r\n                : i18n[DEFAULT_LANGUAGE];\r\n\r\n        if (opt_options.i18n) {\r\n            // Merge custom translations\r\n            this._i18n = {\r\n                ...this._i18n,\r\n                ...opt_options.i18n\r\n            };\r\n        }\r\n\r\n        // Default options\r\n        this._options = {\r\n            language: DEFAULT_LANGUAGE,\r\n            filename: 'Ol Pdf Printer',\r\n            style: {\r\n                paperMargin: 10,\r\n                brcolor: '#000000',\r\n                bkcolor: '#273f50',\r\n                txcolor: '#ffffff'\r\n            },\r\n            extraInfo: {\r\n                date: true,\r\n                url: true,\r\n                specs: true\r\n            },\r\n            mapElements: {\r\n                description: true,\r\n                attributions: true,\r\n                scalebar: true,\r\n                compass: compassIcon() as SVGElement\r\n            },\r\n            watermark: {\r\n                title: 'Ol Pdf Printer',\r\n                titleColor: '#d65959',\r\n                subtitle: 'https://github.com/GastonZalba/ol-pdf-printer',\r\n                subtitleColor: '#444444',\r\n                logo: false\r\n            },\r\n            paperSizes: [\r\n                // { size: [1189, 841], value: 'A0' },\r\n                // { size: [841, 594], value: 'A1' },\r\n                { size: [594, 420], value: 'A2' },\r\n                { size: [420, 297], value: 'A3' },\r\n                { size: [297, 210], value: 'A4', selected: true },\r\n                { size: [210, 148], value: 'A5' }\r\n            ],\r\n            dpi: [\r\n                { value: 72 },\r\n                { value: 96 },\r\n                { value: 150, selected: true },\r\n                { value: 200 },\r\n                { value: 300 }\r\n            ],\r\n            scales: [10000, 5000, 1000, 500, 250, 100, 50, 25, 10],\r\n            mimeTypeExports: [\r\n                { value: 'pdf', selected: true },\r\n                { value: 'png' },\r\n                { value: 'jpeg' },\r\n                { value: 'webp' }\r\n            ],\r\n            units: 'metric',\r\n            dateFormat: undefined,\r\n            ctrlBtnClass: '',\r\n            modal: {\r\n                animateClass: 'fade',\r\n                animateInClass: 'show',\r\n                transition: 150,\r\n                backdropTransition: 100,\r\n                templates: {\r\n                    dialog: '<div class=\"modal-dialog modal-dialog-centered\"></div>',\r\n                    headerClose: `<button type=\"button\" class=\"btn-close\" data-dismiss=\"modal\" aria-label=\"${this._i18n.close}\"><span aria-hidden=\"true\">×</span></button>`\r\n                }\r\n            }\r\n        };\r\n\r\n        // Merge options\r\n        this._options = deepObjectAssign(this._options, opt_options);\r\n\r\n        controlElement.className = `ol-print-btn-menu ${this._options.ctrlBtnClass}`;\r\n        controlElement.title = this._i18n.printPdf;\r\n        controlElement.onclick = () => this.showPrintSettingsModal();\r\n        controlElement.append(pdfIcon());\r\n    }\r\n\r\n    /**\r\n     * @protected\r\n     */\r\n    _init(): void {\r\n        this._map = this.getMap();\r\n        this._view = this._map.getView();\r\n        this._mapTarget = this._map.getTargetElement();\r\n        this._settingsModal = new SettingsModal(\r\n            this._map,\r\n            this._options,\r\n            this._i18n,\r\n            this._printMap.bind(this)\r\n        );\r\n\r\n        this._processingModal = new ProcessingModal(\r\n            this._i18n,\r\n            this._options,\r\n            this._onEndPrint.bind(this)\r\n        );\r\n\r\n        this._initialized = true;\r\n    }\r\n\r\n    /**\r\n     * @protected\r\n     */\r\n    _setMapSizForPrint(\r\n        width: number,\r\n        height: number,\r\n        resolution: number\r\n    ): number[] {\r\n        const pixelsPerMapMillimeter = resolution / 25.4;\r\n        return [\r\n            Math.round(width * pixelsPerMapMillimeter),\r\n            Math.round(height * pixelsPerMapMillimeter)\r\n        ];\r\n    }\r\n\r\n    /**\r\n     * Restore inital view, remove classes, disable loading\r\n     * @protected\r\n     */\r\n    _onEndPrint(): void {\r\n        this._mapTarget.style.width = '';\r\n        this._mapTarget.style.height = '';\r\n        this._map.updateSize();\r\n        this._view.setResolution(this._initialViewResolution);\r\n        this._mapTarget.classList.remove(CLASS_PRINT_MODE);\r\n\r\n        this._view.setConstrainResolution(true);\r\n\r\n        clearTimeout(this._timeoutProcessing);\r\n\r\n        this._cancel();\r\n    }\r\n    /**\r\n     * @protected\r\n     */\r\n    _prepareLoading(): void {\r\n        this._processingModal.show(this._i18n.pleaseWait);\r\n\r\n        this._timeoutProcessing = setTimeout(() => {\r\n            this._processingModal.show(this._i18n.almostThere);\r\n        }, 4000);\r\n    }\r\n\r\n    /**\r\n     * @protected\r\n     */\r\n    _disableLoading(): void {\r\n        this._processingModal.hide();\r\n    }\r\n\r\n    /**\r\n     * This could be used to increment the DPI before printing\r\n     * @protected\r\n     */\r\n    _setFormatOptions(string = ''): void {\r\n        const layers = this._map.getLayers();\r\n        layers.forEach((layer) => {\r\n            if (layer instanceof Tile) {\r\n                const source = layer.getSource();\r\n                // Set WMS DPI\r\n                if (source instanceof TileWMS) {\r\n                    source.updateParams({\r\n                        FORMAT_OPTIONS: string\r\n                    });\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param form\r\n     * @param showLoading\r\n     * @param delay Delay to prevent glitching with modals animation\r\n     * @protected\r\n     */\r\n    _printMap(form: IPrintOptions, showLoading = true, delay = 0): void {\r\n        if (showLoading) {\r\n            this._mapTarget.classList.add(CLASS_PRINT_MODE);\r\n        }\r\n\r\n        setTimeout(() => {\r\n            if (showLoading) {\r\n                this._prepareLoading();\r\n            }\r\n\r\n            this._isCanceled = false;\r\n\r\n            // To allow intermediate zoom levels\r\n            this._view.setConstrainResolution(false);\r\n\r\n            // this._prepareLayers(form);\r\n\r\n            let dim = this._options.paperSizes.find(\r\n                (e) => e.value === form.format\r\n            ).size;\r\n            dim =\r\n                form.orientation === 'landscape'\r\n                    ? dim\r\n                    : (dim.reverse() as [number, number]);\r\n\r\n            const widthPaper = dim[0];\r\n            const heightPaper = dim[1];\r\n\r\n            const mapSizeForPrint = this._setMapSizForPrint(\r\n                widthPaper,\r\n                heightPaper,\r\n                form.resolution\r\n            );\r\n            const [width, height] = mapSizeForPrint;\r\n\r\n            // Save current resolution to restore it later\r\n            this._initialViewResolution = this._view.getResolution();\r\n\r\n            const pixelsPerMapMillimeter = form.resolution / 25.4;\r\n\r\n            const scaleResolution =\r\n                form.scale /\r\n                getPointResolution(\r\n                    this._view.getProjection(),\r\n                    pixelsPerMapMillimeter,\r\n                    this._view.getCenter()\r\n                );\r\n\r\n            this._renderCompleteKey = this._map.once('rendercomplete', () => {\r\n                domtoimage\r\n                    .toJpeg(\r\n                        this._mapTarget.querySelector(\r\n                            '.ol-unselectable.ol-layers'\r\n                        ),\r\n                        {\r\n                            width,\r\n                            height\r\n                        }\r\n                    )\r\n                    .then(async (dataUrl) => {\r\n                        if (this._isCanceled) return;\r\n\r\n                        this._pdf = new Pdf({\r\n                            view: this._view,\r\n                            i18n: this._i18n,\r\n                            config: this._options,\r\n                            form: form,\r\n                            height: heightPaper,\r\n                            width: widthPaper,\r\n                            scaleResolution\r\n                        });\r\n\r\n                        this._pdf.addMapImage(dataUrl);\r\n                        await this._pdf.addMapHelpers();\r\n\r\n                        if (this._isCanceled) return;\r\n\r\n                        await this._pdf.savePdf();\r\n\r\n                        // Reset original map size\r\n                        this._onEndPrint();\r\n\r\n                        if (showLoading) this._disableLoading();\r\n                    })\r\n                    .catch((err: Error) => {\r\n                        const message =\r\n                            typeof err === 'string' ? err : this._i18n.error;\r\n                        console.error(err);\r\n                        this._onEndPrint();\r\n                        this._processingModal.show(message);\r\n                    });\r\n            });\r\n\r\n            // Set print size\r\n            this._mapTarget.style.width = width + 'px';\r\n            this._mapTarget.style.height = height + 'px';\r\n            this._map.updateSize();\r\n            this._map.getView().setResolution(scaleResolution);\r\n        }, delay);\r\n    }\r\n\r\n    /**\r\n     * @protected\r\n     */\r\n    _cancel(): void {\r\n        if (this._renderCompleteKey) {\r\n            unByKey(this._renderCompleteKey);\r\n        }\r\n\r\n        this._isCanceled = true;\r\n    }\r\n    /**\r\n     * Show the Settings Modal\r\n     * @public\r\n     */\r\n    showPrintSettingsModal(): void {\r\n        if (!this._initialized) this._init();\r\n        this._settingsModal.show();\r\n    }\r\n\r\n    /**\r\n     * Hide the Settings Modal\r\n     * @public\r\n     */\r\n    hidePrintSettingsModal(): void {\r\n        this._settingsModal.hide();\r\n    }\r\n\r\n    /**\r\n     * Create PDF programatically without displaying the Settings Modal\r\n     * @param options\r\n     * @public\r\n     */\r\n    createPdf(options: IPrintOptions, showLoading: boolean): void {\r\n        options = {\r\n            format: (\r\n                this._options.paperSizes.find((p) => p.selected) ||\r\n                this._options.paperSizes[0]\r\n            ).value,\r\n            resolution: (\r\n                this._options.dpi.find((p) => p.selected) ||\r\n                this._options.dpi[0]\r\n            ).value,\r\n            orientation: 'landscape',\r\n            compass: true,\r\n            attributions: true,\r\n            scale: true,\r\n            ...options\r\n        };\r\n        this._printMap(options, showLoading);\r\n    }\r\n}\r\n\r\n/**\r\n * **_[interface]_**\r\n */\r\nexport interface IPrintOptions {\r\n    /**\r\n     *\r\n     */\r\n    format?: IPaperSize['value'];\r\n    /**\r\n     *\r\n     */\r\n    orientation?: 'landscape' | 'portrait';\r\n    /**\r\n     *\r\n     */\r\n    resolution?: IDpi['value'];\r\n    /**\r\n     *\r\n     */\r\n    scale: IScale;\r\n    /**\r\n     *\r\n     */\r\n    description?: string;\r\n    /**\r\n     *\r\n     */\r\n    compass?: boolean;\r\n    /**\r\n     *\r\n     */\r\n    attributions?: boolean;\r\n    /**\r\n     *\r\n     */\r\n    scalebar?: boolean;\r\n    /**\r\n     *\r\n     */\r\n    typeExport?: IMimeTypeExport['value'];\r\n}\r\n\r\n/**\r\n * **_[interface]_** - Custom translations specified when creating an instance\r\n */\r\nexport interface IValues {\r\n    format: FormDataEntryValue;\r\n    orientation: FormDataEntryValue;\r\n    resolution: FormDataEntryValue;\r\n    scale: FormDataEntryValue;\r\n    description: FormDataEntryValue;\r\n    compass: FormDataEntryValue;\r\n    attributions: FormDataEntryValue;\r\n    scalebar: FormDataEntryValue;\r\n    typeExport: FormDataEntryValue;\r\n}\r\n\r\n/**\r\n * **_[interface]_** - Custom translations specified when creating an instance\r\n */\r\nexport interface I18n {\r\n    printPdf: string;\r\n    pleaseWait: string;\r\n    almostThere: string;\r\n    error: string;\r\n    errorImage: string;\r\n    printing: string;\r\n    cancel: string;\r\n    close: string;\r\n    print: string;\r\n    mapElements: string;\r\n    compass: string;\r\n    scale: string;\r\n    layersAttributions: string;\r\n    addNote: string;\r\n    resolution: string;\r\n    orientation: string;\r\n    paperSize: string;\r\n    landscape: string;\r\n    portrait: string;\r\n    current: string;\r\n    paper: string;\r\n}\r\n\r\n/**\r\n * **_[interface]_**\r\n */\r\ninterface IPaperSize {\r\n    /**\r\n     *\r\n     */\r\n    size: [number, number];\r\n    /**\r\n     *\r\n     */\r\n    value: string;\r\n    /**\r\n     *\r\n     */\r\n    selected?: boolean;\r\n}\r\n\r\n/**\r\n * **_[type]_**\r\n */\r\ntype IScale = number;\r\n\r\n/**\r\n * **_[interface]_**\r\n */\r\ninterface IDpi {\r\n    /**\r\n     *\r\n     */\r\n    value: number;\r\n    /**\r\n     *\r\n     */\r\n    selected?: boolean;\r\n}\r\n\r\n/**\r\n * **_[interface]_**\r\n */\r\ninterface IStyle {\r\n    /**\r\n     *\r\n     */\r\n    paperMargin?: number;\r\n    /**\r\n     *\r\n     */\r\n    brcolor?: string;\r\n    /**\r\n     *\r\n     */\r\n    bkcolor?: string;\r\n    /**\r\n     *\r\n     */\r\n    txcolor?: string;\r\n}\r\n\r\n/**\r\n * **_[interface]_**\r\n */\r\ninterface IMimeTypeExport {\r\n    value: 'pdf' | 'png' | 'jpeg' | 'webp';\r\n    selected?: boolean;\r\n}\r\n\r\n/**\r\n * **_[interface]_**\r\n */\r\ninterface IModal {\r\n    /**\r\n     *\r\n     */\r\n    animateClass?: string;\r\n    /**\r\n     *\r\n     */\r\n    animateInClass?: string;\r\n    /**\r\n     *\r\n     */\r\n    transition?: number;\r\n    /**\r\n     *\r\n     */\r\n    backdropTransition?: number;\r\n    /**\r\n     *\r\n     */\r\n    templates?: {\r\n        dialog?: string | HTMLElement;\r\n        headerClose?: string | HTMLElement;\r\n    };\r\n}\r\n\r\n/**\r\n * **_[interface]_**\r\n */\r\nexport interface IWatermark {\r\n    /**\r\n     *\r\n     */\r\n    title?: string;\r\n    /**\r\n     *\r\n     */\r\n    titleColor?: string;\r\n    /**\r\n     *\r\n     */\r\n    subtitle?: string;\r\n    /**\r\n     *\r\n     */\r\n    subtitleColor?: string;\r\n    /**\r\n     *\r\n     */\r\n    logo?: false | string | HTMLImageElement | SVGElement;\r\n}\r\n\r\n/**\r\n * **_[interface]_** - Print information at the bottom of the PDF\r\n */\r\ninterface IExtraInfo {\r\n    /**\r\n     * Print Date\r\n     */\r\n    date?: boolean;\r\n    /**\r\n     * Current site url\r\n     */\r\n    url?: boolean;\r\n    /**\r\n     * DPI, Format and Scale information\r\n     */\r\n    specs?: boolean;\r\n}\r\n\r\n/**\r\n * **_[interface]_** - MapElements\r\n * @public\r\n */\r\nexport interface IMapElements {\r\n    /**\r\n     * Print description\r\n     */\r\n    description?: boolean;\r\n    /**\r\n     * Layers attributions\r\n     */\r\n    attributions?: boolean;\r\n    /**\r\n     * Scalebar\r\n     */\r\n    scalebar?: boolean;\r\n    /**\r\n     * Compass image. North must be pointing to the top\r\n     */\r\n    compass?: false | string | HTMLImageElement | SVGElement;\r\n}\r\n\r\n/**\r\n * **_[interface]_** - Options specified when creating an instance\r\n */\r\nexport interface Options extends ControlOptions {\r\n    /**\r\n     * Export filename\r\n     */\r\n    filename?: string;\r\n\r\n    /**\r\n     * Map unit mode\r\n     */\r\n    units?: 'metric' | 'imperial';\r\n\r\n    /**\r\n     * Some basic PDF style configuration\r\n     */\r\n    style?: IStyle;\r\n\r\n    /**\r\n     * Information to be inserted at the bottom of the PDF\r\n     * False to disable\r\n     */\r\n    extraInfo?: false | IExtraInfo;\r\n\r\n    /**\r\n     * Elements to be showed on the PDF and in the Settings Modal.\r\n     * False to disable\r\n     */\r\n    mapElements?: false | IMapElements;\r\n\r\n    /**\r\n     * Watermark to be inserted in the PDF.\r\n     * False to disable\r\n     */\r\n    watermark?: false | IWatermark;\r\n\r\n    /**\r\n     * Paper sizes options to be shown in the settings modal\r\n     */\r\n    paperSizes?: IPaperSize[];\r\n\r\n    /**\r\n     * DPI resolutions options to be shown in the settings modal\r\n     */\r\n    dpi?: IDpi[];\r\n\r\n    /**\r\n     * Map scales options to be shown in the settings modal\r\n     */\r\n    scales?: IScale[];\r\n\r\n    /**\r\n     * Export format\r\n     */\r\n    mimeTypeExports?: IMimeTypeExport[];\r\n\r\n    /**\r\n     * Locale time zone. Default varies according to browser locale\r\n     * https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date/toLocaleDateString#using_locales\r\n     */\r\n    dateFormat?: Locale;\r\n\r\n    /**\r\n     * ClassName to add to the Btn Control\r\n     */\r\n    ctrlBtnClass?: string;\r\n\r\n    /**\r\n     * Modal configuration\r\n     */\r\n    modal?: IModal;\r\n\r\n    /**\r\n     * Language support\r\n     */\r\n    language?: 'es' | 'en';\r\n\r\n    /**\r\n     * Add custom translations\r\n     */\r\n    i18n?: I18n;\r\n}\r\n"],"names":["__awaiter","thisArg","_arguments","P","generator","Promise","resolve","reject","fulfilled","value","step","next","e","rejected","result","done","then","apply","global","util","escape","string","replace","parseExtension","mimeType","url","extension","toLowerCase","WOFF","JPEG","woff","woff2","ttf","eot","png","jpg","jpeg","gif","tiff","svg","dataAsUrl","content","type","isDataUrl","search","canvasToBlob","canvas","toBlob","binaryString","window","atob","toDataURL","split","length","binaryArray","Uint8Array","i","charCodeAt","Blob","resolveUrl","baseUrl","doc","document","implementation","createHTMLDocument","base","createElement","head","appendChild","a","body","href","getAndEncode","TIMEOUT","domtoimage","impl","options","cacheBust","test","Date","getTime","placeholder","request","XMLHttpRequest","onreadystatechange","ontimeout","timeout","responseType","useCredentials","withCredentials","open","send","imagePlaceholder","readyState","status","encoder","FileReader","onloadend","readAsDataURL","response","fail","message","console","error","uid","index","fourRandomChars","Math","random","pow","toString","slice","delay","ms","arg","setTimeout","asArray","arrayLike","array","push","isChrome","navigator","userAgent","escapeXhtml","makeImage","uri","image","Image","crossOrigin","onload","onerror","src","width","node","leftBorder","px","rightBorder","scrollWidth","height","topBorder","bottomBorder","scrollHeight","match","exec","styleProperty","getComputedStyle","getPropertyValue","parseFloat","newUtil","inliner","URL_REGEX","inlineAll","get","nothingToInline","readUrls","urls","forEach","inline","shouldProcess","filter","data","dataUrl","RegExp","urlAsRegex","newInliner","fontFaces","resolveAll","readAll","webFonts","all","map","webFont","cssStrings","join","styleSheets","cssRules","sheet","hasOwnProperty","bind","log","rule","CSSRule","FONT_FACE_RULE","style","rules","newWebFont","webFontRule","parentStyleSheet","cssText","newFontFaces","images","Element","inlineBackground","HTMLImageElement","newImage","childNodes","child","background","inlined","setProperty","getPropertyPriority","element","newImages","defaultOptions","undefined","toSvg","toPng","draw","toJpeg","quality","toPixelData","getContext","getImageData","toCanvas","copyOptions","cloneNode","embedFonts","inlineImages","clone","bgcolor","backgroundColor","Object","keys","property","setAttribute","XMLSerializer","serializeToString","xhtml","foreignObject","makeSvgDataUri","domNode","scale","ctx","fillStyle","fillRect","newCanvas","drawImage","sx","sy","sw","sh","dx","dy","dw","dh","root","HTMLCanvasElement","original","children","tagName","getElementById","baseVal","copyShadowChild","cloneChildrenInOrder","parent","childClone","cloneChildren","cloneStyle","clonePseudoElements","copyUserInput","fixSvg","copyStyle","source","target","copyProperties","name","font","marker","clonePseudoElement","className","currentClass","getAttribute","styleElement","formatPseudoElementStyle","selector","formatCssText","formatCssProperties","createTextNode","formatProperty","HTMLTextAreaElement","innerHTML","HTMLInputElement","SVGElement","SVGRectElement","attribute","processClone","styleNode","module","exports","_arrayLikeToArray","arr","len","arr2","Array","_unsupportedIterableToArray","o","minLen","arrayLikeToArray","n","prototype","call","constructor","from","_toConsumableArray","isArray","arrayWithoutHoles","iter","Symbol","iterator","iterableToArray","unsupportedIterableToArray","TypeError","nonIterableSpread","_typeof","obj","_slicedToArray","arrayWithHoles","_i","_s","_e","_x","_r","_arr","_n","_d","err","iterableToArrayLimit","nonIterableRest","attrs","arguments","_len","_key","elem","entries","_ref","_ref2","startsWith","addEventListener","substr","_children","append","nodeType","Pdf","params","this","addMapHelpers","mapElements","extraInfo","watermark","_config","_style","_addWatermark","compass","_form","_addCompass","description","_addDescription","scalebar","_addScaleBar","attributions","_addAttributions","_addUrl","date","_addDate","specs","_addSpecs","_processSvgImage","getSvgUrl","URL","createObjectURL","outerHTML","svgUrlToPng","svgUrl","callback","svgImage","_i18n","errorImage","clientWidth","clientHeight","imgData","removeChild","revokeObjectURL","svgToPng","_calculateOffsetByPosition","position","offset","size","x","y","paperMargin","_pdf","_addRoundedBox","bkcolor","brcolor","setDrawColor","setFillColor","roundedRect","_addText","fontSize","color","align","str","setTextColor","setFontSize","text","_addTextByOffset","fixX","trim","txcolor","w","h","getTextDimensions","maxWidth","paddingBack","fontSizeSubtitle","back","acumulativeWidth","logo","imageSize","title","titleColor","setFont","subtitle","wSub","widthBack","subtitleColor","marginTop","addImage","now","toLocaleDateString","dateFormat","location","_scaleDenominator","toLocaleString","paper","format","toUpperCase","resolution","attributionsUl","querySelector","xPos","textContent","whiteSpaceWidth","querySelectorAll","sumWhiteSpaceWidth","reverse","attribution","textWithLink","log10","LOG10E","unit","unitConversionFactor","maxLength","units","metre","inch","mile","yard","unroundedLength","numberOfDigits","floor","factor","mapped","percentageMargin","fullSize","scaleBarX","scaleBarY","rect","String","round","imgSrc","rotationRadians","_view","getRotation","addRotation","context","translate","rotate","xCircle","yCircle","circle","rotatedCanvas","xImage","yImage","sizeImage","view","form","i18n","config","scaleResolution","create","orientation","_calculateScaleDenominator","_a","jspdf","jsPDF","addMapImage","savePdf","typeExport","save","filename","pdf","output","versionPdfJS","pdfjsLib","version","GlobalWorkerOptions","workerSrc","getDocument","promise","getPage","page","viewport","getViewport","myPragma","display","render","canvasContext","link","download","click","downloadURI","remove","pixelsPerMapMillimeter","_getMeterPerPixel","proj","getProjection","getPointResolution","getCenter","getMetersPerUnit","_factory","_defaults","freeze","el","animate","animateClass","animateInClass","appendTo","backdrop","keyboard","header","footer","buttons","headerClose","construct","transition","backdropTransition","_buttons","deepFreeze","k","v","dialog","attr","class","alert","confirm","_templates","container","prop","prefix","elData","dataAttr","build","html","nodeName","getPath","nodes","parentNode","Modal","EventEmitter","templates","_baseTemplates","assign","_baseButtons","_baseOptions","static","_options","question","super","id","_html","_events","_visible","_pointerInContent","_scrollbarWidth","inner","outerWidth","outer","visibility","offsetWidth","overflow","calcScrollbarWidth","Error","_render","_mapDom","t","classList","add","_setHeader","_setContent","_setFooter","contains","ineerHTML","button","j","_setEvents","keydownHandler","_handleKeydownEvent","mousedownHandler","_handleMousedownEvent","clickHandler","_handleClickEvent","resizeHandler","_handleResizeEvent","every","emit","hide","which","_resize","show","_checkScrollbar","_setScrollbar","scrollTop","once","_backdrop","toggle","modalIsOverflowing","documentElement","paddingLeft","bodyIsOverflowing","paddingRight","contCList","_removeEvents","originalBodyPad","removeEventListener","innerWidth","basePadding","parseInt","SettingsModal","printMap","_modal","printPdf","Content","Footer","modal","on","event","dataset","print","formData","FormData","values","actualScaleVal","opt_round","getView","getUnits","getResolution","METERS_PER_UNIT","getMapScale","actualScale","current","scales","dpi","paperSizes","htmlFor","paperSize","selected","landscape","portrait","d","addNote","rows","checked","layersAttributions","mimeTypeExports","cancel","ProcessingModal","onEndPrint","printing","_setContentModal","_setFooterModal","pleaseWait","almostThere","close","CLASS_PRINT_MODE","deepObjectAssign","sources","key","s_val","t_val","Control","opt_options","controlElement","language","ctrlBtnClass","onclick","showPrintSettingsModal","_init","_map","getMap","_mapTarget","getTargetElement","_settingsModal","_printMap","_processingModal","_onEndPrint","_initialized","_setMapSizForPrint","updateSize","setResolution","_initialViewResolution","setConstrainResolution","clearTimeout","_timeoutProcessing","_cancel","_prepareLoading","_disableLoading","_setFormatOptions","getLayers","layer","Tile","getSource","TileWMS","updateParams","FORMAT_OPTIONS","showLoading","_isCanceled","dim","find","widthPaper","heightPaper","mapSizeForPrint","_renderCompleteKey","catch","unByKey","hidePrintSettingsModal","createPdf","p"],"mappings":"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","x_google_ignoreList":[0,1,2,3,4,5,6,7,8,9,10,11,12,15]}