{"version":3,"file":"ol-pdf-printer.min.js","sources":["../node_modules/dom-to-image-more/dist/dom-to-image-more.min.js","../src/components/Helpers.ts","../src/components/MapElements/Legends.tsx","../src/myPragma.ts","../src/components/Pdf.tsx","../node_modules/modal-vanilla/lib/modal.js","../src/classnames.ts","../src/components/ReframeROI.tsx","../src/components/SettingsModal.tsx","../src/components/ProcessingModal.ts","../src/ol-pdf-printer.ts","../src/components/i18n/en.ts","../src/components/i18n/es.ts","../src/defaults.ts","../src/index-umd.ts"],"sourcesContent":["/*! dom-to-image-more 03-10-2023 */\n!function(s){\"use strict\";const f=function(){let e=0;return{escape:function(e){return e.replace(/([.*+?^${}()|[]\\/\\\\])/g,\"\\\\$1\")},isDataUrl:function(e){return-1!==e.search(/^(data:)/)},canvasToBlob:function(t){if(t.toBlob)return new Promise(function(e){t.toBlob(e)});return function(r){return new Promise(function(e){var t=l(r.toDataURL().split(\",\")[1]),n=t.length,o=new Uint8Array(n);for(let e=0;e<n;e++)o[e]=t.charCodeAt(e);e(new Blob([o],{type:\"image/png\"}))})}(t)},resolveUrl:function(e,t){var n=document.implementation.createHTMLDocument(),o=n.createElement(\"base\"),r=(n.head.appendChild(o),n.createElement(\"a\"));return n.body.appendChild(r),o.href=t,r.href=e,r.href},getAndEncode:function(l){let e=c.impl.urlCache.find(function(e){return e.url===l});e||(e={url:l,promise:null},c.impl.urlCache.push(e));null===e.promise&&(c.impl.options.cacheBust&&(l+=(/\\?/.test(l)?\"&\":\"?\")+(new Date).getTime()),e.promise=new Promise(function(t){const e=c.impl.options.httpTimeout,n=new XMLHttpRequest;if(n.onreadystatechange=function(){if(4===n.readyState)if(300<=n.status)r?t(r):i(`cannot fetch resource: ${l}, status: `+n.status);else{const e=new FileReader;e.onloadend=function(){t(e.result)},e.readAsDataURL(n.response)}},n.ontimeout=function(){r?t(r):i(`timeout of ${e}ms occured while fetching resource: `+l)},n.responseType=\"blob\",n.timeout=e,c.impl.options.useCredentials&&(n.withCredentials=!0),c.impl.options.corsImg&&0===l.indexOf(\"http\")&&-1===l.indexOf(window.location.origin)){var o=\"POST\"===(c.impl.options.corsImg.method||\"GET\").toUpperCase()?\"POST\":\"GET\";n.open(o,(c.impl.options.corsImg.url||\"\").replace(\"#{cors}\",l),!0);let t=!1;const s=c.impl.options.corsImg.headers||{},u=(Object.keys(s).forEach(function(e){-1!==s[e].indexOf(\"application/json\")&&(t=!0),n.setRequestHeader(e,s[e])}),function(e){try{return JSON.parse(JSON.stringify(e))}catch(e){i(\"corsImg.data is missing or invalid\")}}(c.impl.options.corsImg.data||\"\"));Object.keys(u).forEach(function(e){\"string\"==typeof u[e]&&(u[e]=u[e].replace(\"#{cors}\",l))}),n.send(t?JSON.stringify(u):u)}else n.open(\"GET\",l,!0),n.send();let r;function i(e){console.error(e),t(\"\")}c.impl.options.imagePlaceholder&&(o=c.impl.options.imagePlaceholder.split(/,/))&&o[1]&&(r=o[1])}));return e.promise},uid:function(){return\"u\"+(\"0000\"+(Math.random()*Math.pow(36,4)<<0).toString(36)).slice(-4)+e++},delay:function(n){return function(t){return new Promise(function(e){setTimeout(function(){e(t)},n)})}},asArray:function(t){var n=[],o=t.length;for(let e=0;e<o;e++)n.push(t[e]);return n},escapeXhtml:function(e){return e.replace(/%/g,\"%25\").replace(/#/g,\"%23\").replace(/\\n/g,\"%0A\")},makeImage:function(o){return\"data:,\"!==o?new Promise(function(e,t){const n=new Image;c.impl.options.useCredentials&&(n.crossOrigin=\"use-credentials\"),n.onload=function(){window&&window.requestAnimationFrame?window.requestAnimationFrame(function(){e(n)}):e(n)},n.onerror=t,n.src=o}):Promise.resolve()},width:function(e){var t=i(e,\"width\");if(!isNaN(t))return t;var t=i(e,\"border-left-width\"),n=i(e,\"border-right-width\");return e.scrollWidth+t+n},height:function(e){var t=i(e,\"height\");if(!isNaN(t))return t;var t=i(e,\"border-top-width\"),n=i(e,\"border-bottom-width\");return e.scrollHeight+t+n},getWindow:t,isElement:r,isElementHostForOpenShadowRoot:function(e){return r(e)&&null!==e.shadowRoot},isShadowRoot:n,isInShadowRoot:o,isHTMLElement:function(e){return e instanceof t(e).HTMLElement},isHTMLCanvasElement:function(e){return e instanceof t(e).HTMLCanvasElement},isHTMLInputElement:function(e){return e instanceof t(e).HTMLInputElement},isHTMLImageElement:function(e){return e instanceof t(e).HTMLImageElement},isHTMLLinkElement:function(e){return e instanceof t(e).HTMLLinkElement},isHTMLScriptElement:function(e){return e instanceof t(e).HTMLScriptElement},isHTMLStyleElement:function(e){return e instanceof t(e).HTMLStyleElement},isHTMLTextAreaElement:function(e){return e instanceof t(e).HTMLTextAreaElement},isShadowSlotElement:function(e){return o(e)&&e instanceof t(e).HTMLSlotElement},isSVGElement:function(e){return e instanceof t(e).SVGElement},isSVGRectElement:function(e){return e instanceof t(e).SVGRectElement},isDimensionMissing:function(e){return isNaN(e)||e<=0}};function t(e){e=e?e.ownerDocument:void 0;return(e?e.defaultView:void 0)||s||window}function n(e){return e instanceof t(e).ShadowRoot}function o(e){return null!==e&&Object.prototype.hasOwnProperty.call(e,\"getRootNode\")&&n(e.getRootNode())}function r(e){return e instanceof t(e).Element}function i(t,n){if(t.nodeType===a){let e=m(t).getPropertyValue(n);if(\"px\"===e.slice(-2))return e=e.slice(0,-2),parseFloat(e)}return NaN}}(),r=function(){const o=/url\\(['\"]?([^'\"]+?)['\"]?\\)/g;return{inlineAll:function(t,o,r){if(!e(t))return Promise.resolve(t);return Promise.resolve(t).then(n).then(function(e){let n=Promise.resolve(t);return e.forEach(function(t){n=n.then(function(e){return i(e,t,o,r)})}),n})},shouldProcess:e,impl:{readUrls:n,inline:i}};function e(e){return-1!==e.search(o)}function n(e){for(var t,n=[];null!==(t=o.exec(e));)n.push(t[1]);return n.filter(function(e){return!f.isDataUrl(e)})}function i(n,o,t,e){return Promise.resolve(o).then(function(e){return t?f.resolveUrl(e,t):e}).then(e||f.getAndEncode).then(function(e){return n.replace((t=o,new RegExp(`(url\\\\(['\"]?)(${f.escape(t)})(['\"]?\\\\))`,\"g\")),`$1${e}$3`);var t})}}(),e={resolveAll:function(){return t().then(function(e){return Promise.all(e.map(function(e){return e.resolve()}))}).then(function(e){return e.join(\"\\n\")})},impl:{readAll:t}};function t(){return Promise.resolve(f.asArray(document.styleSheets)).then(function(e){const n=[];return e.forEach(function(t){if(Object.prototype.hasOwnProperty.call(Object.getPrototypeOf(t),\"cssRules\"))try{f.asArray(t.cssRules||[]).forEach(n.push.bind(n))}catch(e){console.error(\"domtoimage: Error while reading CSS rules from \"+t.href,e.toString())}}),n}).then(function(e){return e.filter(function(e){return e.type===CSSRule.FONT_FACE_RULE}).filter(function(e){return r.shouldProcess(e.style.getPropertyValue(\"src\"))})}).then(function(e){return e.map(t)});function t(t){return{resolve:function(){var e=(t.parentStyleSheet||{}).href;return r.inlineAll(t.cssText,e)},src:function(){return t.style.getPropertyValue(\"src\")}}}}const n={inlineAll:function t(e){if(!f.isElement(e))return Promise.resolve(e);return n(e).then(function(){return f.isHTMLImageElement(e)?o(e).inline():Promise.all(f.asArray(e.childNodes).map(function(e){return t(e)}))});function n(o){const e=[\"background\",\"background-image\"],t=e.map(function(t){const e=o.style.getPropertyValue(t),n=o.style.getPropertyPriority(t);return e?r.inlineAll(e).then(function(e){o.style.setProperty(t,e,n)}):Promise.resolve()});return Promise.all(t).then(function(){return o})}},impl:{newImage:o}};function o(n){return{inline:function(e){if(f.isDataUrl(n.src))return Promise.resolve();return Promise.resolve(n.src).then(e||f.getAndEncode).then(function(t){return new Promise(function(e){n.onload=e,n.onerror=e,n.src=t})})}}}const u={copyDefaultStyles:!0,imagePlaceholder:void 0,cacheBust:!1,useCredentials:!1,httpTimeout:3e4,styleCaching:\"strict\",corsImg:void 0},c={toSvg:d,toPng:function(e,t){return i(e,t).then(function(e){return e.toDataURL()})},toJpeg:function(e,t){return i(e,t).then(function(e){return e.toDataURL(\"image/jpeg\",(t?t.quality:void 0)||1)})},toBlob:function(e,t){return i(e,t).then(f.canvasToBlob)},toPixelData:function(t,e){return i(t,e).then(function(e){return e.getContext(\"2d\").getImageData(0,0,f.width(t),f.height(t)).data})},toCanvas:i,impl:{fontFaces:e,images:n,util:f,inliner:r,urlCache:[],options:{}}},a=(\"object\"==typeof exports&&\"object\"==typeof module?module.exports=c:s.domtoimage=c,(\"undefined\"!=typeof Node?Node.ELEMENT_NODE:void 0)||1),m=(void 0!==s?s.getComputedStyle:void 0)||(\"undefined\"!=typeof window?window.getComputedStyle:void 0)||globalThis.getComputedStyle,l=(void 0!==s?s.atob:void 0)||(\"undefined\"!=typeof window?window.atob:void 0)||globalThis.atob;function d(e,r){const t=c.impl.util.getWindow(e);var n=r=r||{};void 0===n.copyDefaultStyles?c.impl.options.copyDefaultStyles=u.copyDefaultStyles:c.impl.options.copyDefaultStyles=n.copyDefaultStyles,void 0===n.imagePlaceholder?c.impl.options.imagePlaceholder=u.imagePlaceholder:c.impl.options.imagePlaceholder=n.imagePlaceholder,void 0===n.cacheBust?c.impl.options.cacheBust=u.cacheBust:c.impl.options.cacheBust=n.cacheBust,void 0===n.corsImg?c.impl.options.corsImg=u.corsImg:c.impl.options.corsImg=n.corsImg,void 0===n.useCredentials?c.impl.options.useCredentials=u.useCredentials:c.impl.options.useCredentials=n.useCredentials,void 0===n.httpTimeout?c.impl.options.httpTimeout=u.httpTimeout:c.impl.options.httpTimeout=n.httpTimeout,void 0===n.styleCaching?c.impl.options.styleCaching=u.styleCaching:c.impl.options.styleCaching=n.styleCaching;let i=[];return Promise.resolve(e).then(function(e){if(e.nodeType===a)return e;var t=e,n=e.parentNode,o=document.createElement(\"span\");return n.replaceChild(o,t),o.append(e),i.push({parent:n,child:t,wrapper:o}),o}).then(function(e){return function u(t,a,r,l){const e=a.filter;if(t===h||f.isHTMLScriptElement(t)||f.isHTMLStyleElement(t)||f.isHTMLLinkElement(t)||null!==r&&e&&!e(t))return Promise.resolve();return Promise.resolve(t).then(n).then(function(e){return i(e,o(t))}).then(function(e){return s(e,t)});function n(e){return f.isHTMLCanvasElement(e)?f.makeImage(e.toDataURL()):e.cloneNode(!1)}function o(e){return f.isElementHostForOpenShadowRoot(e)?e.shadowRoot:e}function i(t,e){const n=i(e);let o=Promise.resolve();if(0!==n.length){const s=m(r(e));f.asArray(n).forEach(function(e){o=o.then(function(){return u(e,a,s,l).then(function(e){e&&t.appendChild(e)})})})}return o.then(function(){return t});function r(e){return f.isShadowRoot(e)?e.host:e}function i(e){return f.isShadowSlotElement(e)?e.assignedNodes():e.childNodes}}function s(l,c){return!f.isElement(l)||f.isShadowSlotElement(c)?Promise.resolve(l):Promise.resolve().then(e).then(t).then(n).then(o).then(function(){return l});function e(){function o(e,t){t.font=e.font,t.fontFamily=e.fontFamily,t.fontFeatureSettings=e.fontFeatureSettings,t.fontKerning=e.fontKerning,t.fontSize=e.fontSize,t.fontStretch=e.fontStretch,t.fontStyle=e.fontStyle,t.fontVariant=e.fontVariant,t.fontVariantCaps=e.fontVariantCaps,t.fontVariantEastAsian=e.fontVariantEastAsian,t.fontVariantLigatures=e.fontVariantLigatures,t.fontVariantNumeric=e.fontVariantNumeric,t.fontVariationSettings=e.fontVariationSettings,t.fontWeight=e.fontWeight}function e(e,t){const n=m(e);n.cssText?(t.style.cssText=n.cssText,o(n,t.style)):(y(a,e,n,r,t),null===r&&([\"inset-block\",\"inset-block-start\",\"inset-block-end\"].forEach(e=>t.style.removeProperty(e)),[\"left\",\"right\",\"top\",\"bottom\"].forEach(e=>{t.style.getPropertyValue(e)&&t.style.setProperty(e,\"0px\")})))}e(c,l)}function t(){const u=f.uid();function t(r){const i=m(c,r),s=i.getPropertyValue(\"content\");if(\"\"!==s&&\"none\"!==s){const t=l.getAttribute(\"class\")||\"\",n=(l.setAttribute(\"class\",t+\" \"+u),document.createElement(\"style\"));function e(){const e=`.${u}:`+r,t=(i.cssText?n:o)();return document.createTextNode(e+`{${t}}`);function n(){return`${i.cssText} content: ${s};`}function o(){const e=f.asArray(i).map(t).join(\"; \");return e+\";\";function t(e){const t=i.getPropertyValue(e),n=i.getPropertyPriority(e)?\" !important\":\"\";return e+\": \"+t+n}}}n.appendChild(e()),l.appendChild(n)}}[\":before\",\":after\"].forEach(function(e){t(e)})}function n(){f.isHTMLTextAreaElement(c)&&(l.innerHTML=c.value),f.isHTMLInputElement(c)&&l.setAttribute(\"value\",c.value)}function o(){f.isSVGElement(l)&&(l.setAttribute(\"xmlns\",\"http://www.w3.org/2000/svg\"),f.isSVGRectElement(l))&&[\"width\",\"height\"].forEach(function(e){const t=l.getAttribute(e);t&&l.style.setProperty(e,t)})}}}(e,r,null,t)}).then(p).then(g).then(function(t){r.bgcolor&&(t.style.backgroundColor=r.bgcolor);r.width&&(t.style.width=r.width+\"px\");r.height&&(t.style.height=r.height+\"px\");r.style&&Object.keys(r.style).forEach(function(e){t.style[e]=r.style[e]});let e=null;\"function\"==typeof r.onclone&&(e=r.onclone(t));return Promise.resolve(e).then(function(){return t})}).then(function(e){let n=r.width||f.width(e),o=r.height||f.height(e);return Promise.resolve(e).then(function(e){return e.setAttribute(\"xmlns\",\"http://www.w3.org/1999/xhtml\"),(new XMLSerializer).serializeToString(e)}).then(f.escapeXhtml).then(function(e){var t=(f.isDimensionMissing(n)?' width=\"100%\"':` width=\"${n}\"`)+(f.isDimensionMissing(o)?' height=\"100%\"':` height=\"${o}\"`);return`<svg xmlns=\"http://www.w3.org/2000/svg\"${(f.isDimensionMissing(n)?\"\":` width=\"${n}\"`)+(f.isDimensionMissing(o)?\"\":` height=\"${o}\"`)}><foreignObject${t}>${e}</foreignObject></svg>`}).then(function(e){return\"data:image/svg+xml;charset=utf-8,\"+e})}).then(function(e){for(;0<i.length;){var t=i.pop();t.parent.replaceChild(t.child,t.wrapper)}return e}).then(function(e){return c.impl.urlCache=[],function(){h&&(document.body.removeChild(h),h=null);w&&clearTimeout(w);w=setTimeout(()=>{w=null,E={}},2e4)}(),e})}function i(r,i){return d(r,i=i||{}).then(f.makeImage).then(function(e){var t=\"number\"!=typeof i.scale?1:i.scale,n=function(e,t){let n=i.width||f.width(e),o=i.height||f.height(e);f.isDimensionMissing(n)&&(n=f.isDimensionMissing(o)?300:2*o);f.isDimensionMissing(o)&&(o=n/2);e=document.createElement(\"canvas\");e.width=n*t,e.height=o*t,i.bgcolor&&((t=e.getContext(\"2d\")).fillStyle=i.bgcolor,t.fillRect(0,0,e.width,e.height));return e}(r,t),o=n.getContext(\"2d\");return o.msImageSmoothingEnabled=!1,o.imageSmoothingEnabled=!1,e&&(o.scale(t,t),o.drawImage(e,0,0)),n})}let h=null;function p(n){return e.resolveAll().then(function(e){var t;return\"\"!==e&&(t=document.createElement(\"style\"),n.appendChild(t),t.appendChild(document.createTextNode(e))),n})}function g(e){return n.inlineAll(e).then(function(){return e})}function y(e,t,i,s,n){const u=c.impl.options.copyDefaultStyles?function(t,e){var e=function(e){var t=[];do{if(e.nodeType===a){var n=e.tagName;if(t.push(n),v.includes(n))break}}while(e=e.parentNode,e);return t}(e),n=function(e){return(\"relaxed\"!==t.styleCaching?e:e.filter((e,t,n)=>0===t||t===n.length-1)).join(\">\")}(e);if(E[n])return E[n];var o=function(){if(h)return h.contentWindow;var e=document.characterSet||\"UTF-8\",t=document.doctype,t=t?(`<!DOCTYPE ${n(t.name)} ${n(t.publicId)} `+n(t.systemId)).trim()+\">\":\"\";return(h=document.createElement(\"iframe\")).id=\"domtoimage-sandbox-\"+f.uid(),h.style.visibility=\"hidden\",h.style.position=\"fixed\",document.body.appendChild(h),function(e,t,n,o){try{return e.contentWindow.document.write(t+`<html><head><meta charset='${n}'><title>${o}</title></head><body></body></html>`),e.contentWindow}catch(e){}var r=document.createElement(\"meta\");r.setAttribute(\"charset\",n);try{var i=document.implementation.createHTMLDocument(o),s=(i.head.appendChild(r),t+i.documentElement.outerHTML);return e.setAttribute(\"srcdoc\",s),e.contentWindow}catch(e){}return e.contentDocument.head.appendChild(r),e.contentDocument.title=o,e.contentWindow}(h,t,e,\"domtoimage-sandbox\");function n(e){var t;return e?((t=document.createElement(\"div\")).innerText=e,t.innerHTML):\"\"}}(),e=function(e,t){let n=e.body;do{var o=t.pop(),o=e.createElement(o);n.appendChild(o),n=o}while(0<t.length);return n.textContent=\"â€‹\",n}(o.document,e),o=function(e,t){const n={},o=e.getComputedStyle(t);return f.asArray(o).forEach(function(e){n[e]=\"width\"===e||\"height\"===e?\"auto\":o.getPropertyValue(e)}),n}(o,e);return function(e){do{var t=e.parentElement;null!==t&&t.removeChild(e),e=t}while(e&&\"BODY\"!==e.tagName)}(e),E[n]=o}(e,t):{},l=n.style;f.asArray(i).forEach(function(e){var t,n=i.getPropertyValue(e),o=u[e],r=s?s.getPropertyValue(e):void 0;(n!==o||s&&n!==r)&&(o=i.getPropertyPriority(e),r=l,n=n,o=o,t=0<=[\"background-clip\"].indexOf(e=e),o?(r.setProperty(e,n,o),t&&r.setProperty(\"-webkit-\"+e,n,o)):(r.setProperty(e,n),t&&r.setProperty(\"-webkit-\"+e,n)))})}let w=null,E={};const v=[\"ADDRESS\",\"ARTICLE\",\"ASIDE\",\"BLOCKQUOTE\",\"DETAILS\",\"DIALOG\",\"DD\",\"DIV\",\"DL\",\"DT\",\"FIELDSET\",\"FIGCAPTION\",\"FIGURE\",\"FOOTER\",\"FORM\",\"H1\",\"H2\",\"H3\",\"H4\",\"H5\",\"H6\",\"HEADER\",\"HGROUP\",\"HR\",\"LI\",\"MAIN\",\"NAV\",\"OL\",\"P\",\"PRE\",\"SECTION\",\"SVG\",\"TABLE\",\"UL\",\"math\",\"svg\",\"BODY\",\"HEAD\",\"HTML\"]}(this);\n//# sourceMappingURL=dom-to-image-more.min.js.map","import Map from 'ol/Map.js';\r\nimport { METERS_PER_UNIT } from 'ol/proj/Units.js';\r\nimport ImageWMS from 'ol/source/ImageWMS.js';\r\nimport TileLayer from 'ol/layer/Tile.js';\r\nimport ImageLayer from 'ol/layer/Image.js';\r\nimport BaseLayer from 'ol/layer/Base.js';\r\nimport TileWMS from 'ol/source/TileWMS.js';\r\n\r\n/**\r\n *\r\n * @param map\r\n * @param opt_round\r\n * @returns\r\n * @protected\r\n */\r\nexport const getMapScale = (map: Map, opt_round = true): number => {\r\n    const dpi = 25.4 / 0.28;\r\n\r\n    const view = map.getView();\r\n    const unit = view.getProjection().getUnits();\r\n    const res = view.getResolution();\r\n    const inchesPerMetre = 39.37;\r\n\r\n    let scale = res * METERS_PER_UNIT[unit] * inchesPerMetre * dpi;\r\n\r\n    if (opt_round) {\r\n        scale = Math.round(scale);\r\n    }\r\n\r\n    return scale;\r\n};\r\n\r\n/**\r\n *\r\n * @param layer\r\n * @returns\r\n */\r\nexport const isWmsLayer = (layer: BaseLayer): boolean => {\r\n    return (\r\n        (layer instanceof ImageLayer || layer instanceof TileLayer) &&\r\n        (layer.getSource() instanceof TileWMS ||\r\n            layer.getSource() instanceof ImageWMS)\r\n    );\r\n};\r\n","import View from 'ol/View.js';\r\nimport Map from 'ol/Map.js';\r\nimport BaseLayer from 'ol/layer/Base.js';\r\nimport TileWMS from 'ol/source/TileWMS.js';\r\nimport ImageWMS from 'ol/source/ImageWMS.js';\r\nimport TileLayer from 'ol/layer/Tile.js';\r\nimport ImageLayer from 'ol/layer/Image.js';\r\nimport { appendParams } from 'ol/uri.js';\r\nimport { Projection } from 'ol/proj.js';\r\n\r\nimport { isWmsLayer } from '../Helpers';\r\n\r\nexport const legendsDefaultConfig = {\r\n    legendOptions: {\r\n        fontAntiAliasing: 'true',\r\n        fontColor: '0x333333',\r\n        bgColor: '0xffffff',\r\n        forceLabels: 'on',\r\n        forceTitles: 'on'\r\n    },\r\n    requestParams: {},\r\n    order: true\r\n};\r\n\r\nexport interface LegendsOptions {\r\n    /**\r\n     * To control legend appearance\r\n     * https://docs.geoserver.org/latest/en/user/services/wms/get_legend_graphic/index.html#controlling-legend-appearance-with-legend-options\r\n     */\r\n    legendOptions?: { [key: string]: string | number };\r\n\r\n    /**\r\n     * Extra params to add/overwrite the default `GetLegendGraphic` request\r\n     * https://docs.geoserver.org/latest/en/user/services/wms/get_legend_graphic/index.html#getlegendgraphic\r\n     */\r\n    requestParams?: { [key: string]: string };\r\n\r\n    /**\r\n     * Order control legends by layer zindex\r\n     * Default is `true`\r\n     */\r\n    order?: boolean;\r\n}\r\n\r\nexport default class Legends {\r\n    private _map: Map;\r\n    private _view: View;\r\n\r\n    private _legendOptions: { [key: string]: string | number } = {};\r\n    private _requestParams: { [key: string]: string } = {};\r\n\r\n    private _order: boolean;\r\n\r\n    constructor(options: LegendsOptions | true, map: Map) {\r\n        this._map = map;\r\n        this._view = map.getView();\r\n\r\n        this._legendOptions = legendsDefaultConfig.legendOptions;\r\n        this._requestParams = legendsDefaultConfig.requestParams;\r\n        this._order = legendsDefaultConfig.order;\r\n\r\n        if (typeof options === 'object') {\r\n            const { legendOptions, requestParams, order } = options;\r\n            this._legendOptions = {\r\n                ...this._legendOptions,\r\n                ...(legendOptions || {})\r\n            };\r\n            this._requestParams = {\r\n                ...this._requestParams,\r\n                ...(requestParams || {})\r\n            };\r\n            this._order = typeof order !== 'undefined' ? order : this._order;\r\n        }\r\n    }\r\n\r\n    public async getImages(\r\n        dpi: number,\r\n        txcolor: string,\r\n        bkcolor: string\r\n    ): Promise<HTMLImageElement[]> {\r\n        const images: HTMLImageElement[] = [];\r\n        const wmsLayers = this.getWmsLegendLayers();\r\n        this._legendOptions = {\r\n            ...this._legendOptions,\r\n            dpi,\r\n            fontColor: '0x' + txcolor.replace('#', ''),\r\n            bgColor: '0x' + bkcolor.replace('#', '')\r\n        };\r\n\r\n        for (const wmsLayer of wmsLayers) {\r\n            const image = await this._getLegends(wmsLayer);\r\n            if (image) {\r\n                images.push(image);\r\n            }\r\n        }\r\n\r\n        if (this._order && images.length) {\r\n            return this._orderImagesByIndex(images);\r\n        }\r\n\r\n        return images;\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @returns\r\n     */\r\n    public getWmsLegendLayers(): Array<\r\n        TileLayer<TileWMS> | ImageLayer<ImageWMS>\r\n    > {\r\n        return this._map\r\n            .getLayers()\r\n            .getArray()\r\n            .filter(\r\n                (layer) => isWmsLayer(layer) && layer.getVisible()\r\n            ) as Array<TileLayer<TileWMS> | ImageLayer<ImageWMS>>;\r\n    }\r\n\r\n    public getMapProjection(): Projection {\r\n        return this._view.getProjection();\r\n    }\r\n\r\n    public getViewExtent(): number[] {\r\n        return this._view.calculateExtent(this._map.getSize());\r\n    }\r\n\r\n    protected async _getLegends(layer: BaseLayer): Promise<HTMLImageElement> {\r\n        return new Promise((resolve) => {\r\n            const srcs = this._getSrcFromParams(layer);\r\n\r\n            if (!srcs) {\r\n                return resolve(null);\r\n            }\r\n\r\n            srcs.forEach((src) => {\r\n                const img = new Image();\r\n                // to enable reorder\r\n                img.dataset.index = String(layer.getZIndex());\r\n\r\n                img.onerror = () => {\r\n                    resolve(null);\r\n                };\r\n                img.onload = () => {\r\n                    // discard empty images\r\n                    if (img.naturalHeight <= 1) {\r\n                        resolve(null);\r\n                    } else {\r\n                        resolve(img);\r\n                    }\r\n                };\r\n                img.src = src;\r\n            });\r\n        });\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param layer\r\n     * @param inline\r\n     * @returns\r\n     */\r\n    protected _getSrcFromParams(layer): string[] {\r\n        const sourceParams = layer.getSource().getParams();\r\n\r\n        const proj = this.getMapProjection().getCode();\r\n\r\n        const legend_options = {\r\n            fontColor: '0x000000',\r\n            fontAntiAliasing: true,\r\n            bgColor: '0xffffff',\r\n            forceLabels: 'on',\r\n            forceTitles: 'on',\r\n            fontSize: 8,\r\n            ...this._legendOptions\r\n        };\r\n\r\n        const params = {\r\n            SERVICE: 'WMS',\r\n            VERSION: '1.1.0',\r\n            REQUEST: 'GetLegendGraphic',\r\n            FORMAT: 'image/png',\r\n            LEGEND_OPTIONS: Object.entries(legend_options)\r\n                .map((a) => `${a[0]}:${a[1]}`)\r\n                .join(';'),\r\n            STYLE: sourceParams.STYLES,\r\n            CQL_FILTER: sourceParams.CQL_FILTER,\r\n            SLD_BODY: sourceParams.SLD_BODY,\r\n            SLD: sourceParams.SLD,\r\n            ENV: sourceParams.ENV,\r\n            SRS: proj,\r\n            SRCWIDTH: this._map.getSize()[0],\r\n            SRCHEIGHT: this._map.getSize()[1],\r\n            SCALE: this._getScale(),\r\n            ...this._requestParams\r\n            // bug showing empty spaces betweeen labels\r\n            //TRANSPARENT: true\r\n        };\r\n\r\n        const layersName = sourceParams.LAYERS;\r\n        const layerNames = !Array.isArray(layersName)\r\n            ? layersName.split(',')\r\n            : layersName;\r\n\r\n        return [\r\n            this._getLegendUrl(layer.getSource() as TileWMS | ImageWMS, {\r\n                ...params,\r\n                LAYER: layerNames[0]\r\n            })\r\n        ];\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param source\r\n     * @param params\r\n     * @returns\r\n     */\r\n    protected _getLegendUrl(source: TileWMS | ImageWMS, params) {\r\n        const url =\r\n            'getUrls' in source\r\n                ? source.getUrls()[0]\r\n                : 'getUrl' in source\r\n                ? source.getUrl()\r\n                : undefined;\r\n\r\n        if (!url) return undefined;\r\n\r\n        return appendParams(url, params);\r\n    }\r\n\r\n    /**\r\n     *\r\n     */\r\n    protected _orderImagesByIndex(\r\n        images: HTMLImageElement[]\r\n    ): HTMLImageElement[] {\r\n        const t = Array.from(images).sort((x, y) => {\r\n            const xIndex = Number(x.dataset.index);\r\n            const yIndex = Number(y.dataset.index);\r\n            if (xIndex > yIndex) return -1;\r\n            if (xIndex < yIndex) return 1;\r\n            return 0;\r\n        });\r\n\r\n        return t.reverse();\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @returns\r\n     */\r\n    protected _getScale() {\r\n        const resolution = this._view.getResolution();\r\n        const mpu = this.getMapProjection()\r\n            ? this.getMapProjection().getMetersPerUnit()\r\n            : 1;\r\n        const pixelSize = 0.00028;\r\n        return (resolution * mpu) / pixelSize;\r\n    }\r\n}\r\n","export default function createElement(tagName, attrs = {}, ...children) {\r\n    if (typeof tagName === 'function') return tagName(attrs, children);\r\n\r\n    const elem =\r\n        tagName === null\r\n            ? new DocumentFragment()\r\n            : document.createElement(tagName);\r\n\r\n    Object.entries(attrs || {}).forEach(([name, value]) => {\r\n        if (\r\n            typeof value !== 'undefined' &&\r\n            value !== null &&\r\n            value !== undefined\r\n        ) {\r\n            if (name.startsWith('on') && name.toLowerCase() in window)\r\n                elem.addEventListener(name.toLowerCase().substr(2), value);\r\n            else {\r\n                if (name === 'className')\r\n                    elem.setAttribute('class', value.toString());\r\n                else if (name === 'htmlFor')\r\n                    elem.setAttribute('for', value.toString());\r\n                else elem.setAttribute(name, value.toString());\r\n            }\r\n        }\r\n    });\r\n\r\n    for (const child of children) {\r\n        if (!child) continue;\r\n        if (Array.isArray(child)) elem.append(...child);\r\n        else {\r\n            if (child.nodeType === undefined) elem.innerHTML += child;\r\n            else elem.appendChild(child);\r\n        }\r\n    }\r\n    return elem;\r\n}\r\n","import Map from 'ol/Map';\r\nimport View from 'ol/View.js';\r\nimport { getPointResolution } from 'ol/proj.js';\r\nimport { AttributionLike } from 'ol/source/Source';\r\n\r\nimport { jsPDF, TextOptionsLight } from 'jspdf';\r\nimport { getDocument, GlobalWorkerOptions, version } from 'pdfjs-dist';\r\n\r\nimport {\r\n    I18n,\r\n    Options,\r\n    IPrintOptions,\r\n    IWatermark,\r\n    IExtraInfo\r\n} from '../ol-pdf-printer';\r\nimport Legends from './MapElements/Legends';\r\n\r\nimport myPragma from '../myPragma';\r\n\r\n/**\r\n * @private\r\n */\r\nexport default class Pdf {\r\n    protected _pdf: IPdf;\r\n    protected _view: View;\r\n    protected _map: Map;\r\n    protected _scaleDenominator: number;\r\n    protected _legends: Legends;\r\n    protected _form: IPrintOptions;\r\n    protected _style: Options['style'];\r\n    protected _i18n: I18n;\r\n    protected _printingMargins: IMargins;\r\n    protected _accumulativeOffsetBottomLeft = 0;\r\n\r\n    protected _config: Options;\r\n\r\n    constructor(params: IPdfOptions) {\r\n        const { map, form, i18n, config, height, width, scaleResolution } =\r\n            params;\r\n\r\n        this._map = map;\r\n        this._view = map.getView();\r\n        this._form = form;\r\n        this._i18n = i18n;\r\n        this._config = config;\r\n\r\n        this._style = config.style;\r\n\r\n        if (this._form.safeMargins) {\r\n            this._printingMargins =\r\n                typeof config.style.paperMargin === 'number'\r\n                    ? {\r\n                          top: config.style.paperMargin,\r\n                          left: config.style.paperMargin,\r\n                          right: config.style.paperMargin,\r\n                          bottom: config.style.paperMargin\r\n                      }\r\n                    : config.style.paperMargin;\r\n        } else {\r\n            this._printingMargins = {\r\n                top: 0,\r\n                left: 0,\r\n                right: 0,\r\n                bottom: 0\r\n            };\r\n        }\r\n\r\n        this._pdf = this.create(\r\n            this._form.orientation,\r\n            this._form.format,\r\n            height,\r\n            width\r\n        );\r\n\r\n        this._scaleDenominator = this._calculateScaleDenominator(\r\n            this._form.resolution,\r\n            scaleResolution\r\n        );\r\n\r\n        if (config.mapElements && config.mapElements.legends) {\r\n            this._legends = new Legends(config.mapElements.legends, map);\r\n        }\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param orientation\r\n     * @param format\r\n     * @param width\r\n     * @param height\r\n     * @returns\r\n     * @protected\r\n     */\r\n    create(\r\n        orientation: IPrintOptions['orientation'],\r\n        format: IPrintOptions['format'],\r\n        height: number,\r\n        width: number\r\n    ): IPdf {\r\n        // UMD support\r\n        const _jsPDF =\r\n            (window as IWindow & typeof globalThis).jspdf?.jsPDF || jsPDF;\r\n\r\n        return {\r\n            doc: new _jsPDF({ orientation, format }),\r\n            height: height,\r\n            width: width\r\n        };\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param dataUrl\r\n     * @protected\r\n     */\r\n    addMapImage(dataUrl: string): void {\r\n        this._pdf.doc.addImage(\r\n            dataUrl,\r\n            'JPEG',\r\n            this._printingMargins.left, // Add margins\r\n            this._printingMargins.top,\r\n            this._pdf.width -\r\n                (this._printingMargins.left + this._printingMargins.right),\r\n            this._pdf.height -\r\n                (this._printingMargins.top + this._printingMargins.bottom)\r\n        );\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @protected\r\n     */\r\n    addMapHelpers = async (): Promise<void> => {\r\n        const { mapElements, extraInfo, description, watermark } = this._config;\r\n\r\n        if (watermark) {\r\n            await this._addWatermark(watermark);\r\n        }\r\n\r\n        if (description && this._form.description) {\r\n            this._addDescription();\r\n        }\r\n\r\n        if (extraInfo) {\r\n            this._addExtraInfo(extraInfo);\r\n        }\r\n\r\n        if (mapElements) {\r\n            if (mapElements.compass && this._form.compass) {\r\n                await this._addCompass(mapElements.compass);\r\n            }\r\n\r\n            if (mapElements.scalebar && this._form.scalebar) {\r\n                this._addScaleBar();\r\n            }\r\n\r\n            if (mapElements.attributions && this._form.attributions) {\r\n                this._addAttributions();\r\n            }\r\n\r\n            if (mapElements.legends && this._form.legends) {\r\n                await this._addLegends();\r\n            }\r\n        }\r\n\r\n        if (this._form.safeMargins) this._fllWhite();\r\n    };\r\n\r\n    /**\r\n     * @protected\r\n     */\r\n    savePdf(): Promise<void> {\r\n        const downloadURI = (uri: string, name: string): void => {\r\n            const link = <a download={name} href={uri}></a>;\r\n            document.body.appendChild(link);\r\n            link.click();\r\n            document.body.removeChild(link);\r\n        };\r\n\r\n        return new Promise((resolve, reject) => {\r\n            if (this._form.typeExport === 'pdf') {\r\n                this._pdf.doc.save(this._config.filename + '.pdf');\r\n                resolve();\r\n            } else {\r\n                const pdf = this._pdf.doc.output('dataurlstring');\r\n\r\n                // UMD support\r\n                const versionPdfJS =\r\n                    (window as IWindow & typeof globalThis)?.pdfjsLib\r\n                        ?.version || version;\r\n\r\n                GlobalWorkerOptions.workerSrc = `https://cdnjs.cloudflare.com/ajax/libs/pdf.js/${versionPdfJS}/pdf.worker.js`;\r\n\r\n                getDocument(pdf).promise.then(\r\n                    (pdf) => {\r\n                        pdf.getPage(1).then((page) => {\r\n                            // transform DPI correctly\r\n                            const scale = (this._form.resolution / 100) * 1.39;\r\n\r\n                            const viewport = page.getViewport({ scale });\r\n\r\n                            // Prepare canvas\r\n                            const canvas = <canvas />;\r\n                            canvas.style.display = 'none';\r\n                            document.body.appendChild(canvas);\r\n                            const context = canvas.getContext('2d');\r\n                            canvas.height = viewport.height;\r\n                            canvas.width = viewport.width;\r\n\r\n                            // Render PDF page into canvas context\r\n                            const task = page.render({\r\n                                canvasContext: context,\r\n                                viewport: viewport\r\n                            });\r\n                            task.promise.then(() => {\r\n                                downloadURI(\r\n                                    canvas.toDataURL(\r\n                                        `image/${this._form.typeExport}`\r\n                                    ),\r\n                                    this._config.filename +\r\n                                        `.${this._form.typeExport}`\r\n                                );\r\n                                canvas.remove();\r\n                                resolve();\r\n                            });\r\n                        });\r\n                    },\r\n                    (error: Error) => {\r\n                        reject(error);\r\n                        console.log(error);\r\n                    }\r\n                );\r\n            }\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Add white rectangles to hide elements outside the map\r\n     */\r\n    protected _fllWhite(): void {\r\n        this._pdf.doc.setFillColor('#ffffff');\r\n        this._pdf.doc.rect(\r\n            0,\r\n            0,\r\n            this._printingMargins.left,\r\n            this._pdf.height,\r\n            'F'\r\n        );\r\n        this._pdf.doc.rect(\r\n            this._pdf.width - this._printingMargins.right,\r\n            0,\r\n            this._printingMargins.right,\r\n            this._pdf.height,\r\n            'F'\r\n        );\r\n        this._pdf.doc.rect(\r\n            0,\r\n            0,\r\n            this._pdf.width,\r\n            this._printingMargins.top,\r\n            'F'\r\n        );\r\n        this._pdf.doc.rect(\r\n            0,\r\n            this._pdf.height - this._printingMargins.bottom,\r\n            this._pdf.width,\r\n            this._printingMargins.bottom,\r\n            'F'\r\n        );\r\n    }\r\n\r\n    /**\r\n     * Convert an SVGElement to an PNG string\r\n     * @param svg\r\n     * @returns\r\n     */\r\n    _processSvgImage = (svg: SVGElement): Promise<string> => {\r\n        // https://stackoverflow.com/questions/3975499/convert-svg-to-image-jpeg-png-etc-in-the-browser#answer-58142441\r\n        return new Promise((resolve, reject) => {\r\n            const svgToPng = (svg: SVGElement, callback) => {\r\n                const url = getSvgUrl(svg);\r\n                svgUrlToPng(url, (imgData: string) => {\r\n                    callback(imgData);\r\n                    URL.revokeObjectURL(url);\r\n                });\r\n            };\r\n\r\n            const getSvgUrl = (svg: SVGElement) => {\r\n                const data = new XMLSerializer().serializeToString(svg);\r\n                return URL.createObjectURL(\r\n                    new Blob([data], { type: 'image/svg+xml' })\r\n                );\r\n            };\r\n\r\n            const svgUrlToPng = (svgUrl: string, callback) => {\r\n                const svgImage = document.createElement('img');\r\n                document.body.appendChild(svgImage);\r\n\r\n                svgImage.onerror = (err) => {\r\n                    console.error(err);\r\n                    return reject(this._i18n.errorImage);\r\n                };\r\n\r\n                svgImage.onload = () => {\r\n                    try {\r\n                        const canvas = document.createElement('canvas');\r\n                        canvas.width = svgImage.clientWidth;\r\n                        canvas.height = svgImage.clientHeight;\r\n                        const canvasCtx = canvas.getContext('2d');\r\n                        canvasCtx.drawImage(svgImage, 0, 0);\r\n                        const imgData = canvas\r\n                            .toDataURL('image/png')\r\n                            .replace('image/png', 'octet/stream');\r\n                        callback(imgData);\r\n                        document.body.removeChild(svgImage);\r\n                    } catch (err) {\r\n                        return reject(err);\r\n                    }\r\n                };\r\n                svgImage.src = svgUrl;\r\n            };\r\n\r\n            svgToPng(svg, (imgData: string) => {\r\n                resolve(imgData);\r\n            });\r\n        });\r\n    };\r\n\r\n    /**\r\n     * Adapted from http://hg.intevation.de/gemma/file/tip/client/src/components/Pdftool.vue#l252\r\n     * @protected\r\n     */\r\n    _calculateScaleDenominator(\r\n        resolution: number,\r\n        scaleResolution: number\r\n    ): number {\r\n        const pixelsPerMapMillimeter = resolution / 25.4;\r\n        return Math.round(\r\n            1000 *\r\n                pixelsPerMapMillimeter *\r\n                this._getMeterPerPixel(scaleResolution)\r\n        );\r\n    }\r\n\r\n    /**\r\n     * @protected\r\n     */\r\n    _getMeterPerPixel(scaleResolution: number): number {\r\n        const proj = this._view.getProjection();\r\n        return (\r\n            getPointResolution(proj, scaleResolution, this._view.getCenter()) *\r\n            proj.getMetersPerUnit()\r\n        );\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param position\r\n     * @param offset\r\n     * @param size\r\n     * @returns\r\n     * @protected\r\n     */\r\n    _calculateOffsetByPosition = (\r\n        position: string,\r\n        offset: { x: number; y: number },\r\n        size = 0\r\n    ): { x: number; y: number } => {\r\n        let x: number, y: number;\r\n\r\n        switch (position) {\r\n            case 'topleft':\r\n                x = offset.x + this._printingMargins.left;\r\n                y = offset.y + this._printingMargins.top + size;\r\n                break;\r\n\r\n            case 'topright':\r\n                x = this._pdf.width - offset.x - this._printingMargins.left;\r\n                y = offset.y + this._printingMargins.top + size;\r\n                break;\r\n\r\n            case 'bottomright':\r\n                x = this._pdf.width - offset.x - this._printingMargins.left;\r\n                y =\r\n                    this._pdf.height -\r\n                    offset.y -\r\n                    this._printingMargins.bottom -\r\n                    size;\r\n                break;\r\n\r\n            case 'bottomleft':\r\n                y =\r\n                    this._pdf.height -\r\n                    offset.y -\r\n                    this._printingMargins.bottom -\r\n                    size;\r\n                x = offset.x + this._printingMargins.left;\r\n                break;\r\n        }\r\n\r\n        return { x, y };\r\n    };\r\n\r\n    /**\r\n     *\r\n     * @param x\r\n     * @param y\r\n     * @param width\r\n     * @param height\r\n     * @param bkcolor\r\n     * @param brcolor\r\n     * @protected\r\n     */\r\n    _addRoundedBox = (\r\n        x: number,\r\n        y: number,\r\n        width: number,\r\n        height: number,\r\n        bkcolor: string,\r\n        brcolor: string\r\n    ): void => {\r\n        const rounding = 1;\r\n\r\n        this._pdf.doc.setDrawColor(brcolor);\r\n        this._pdf.doc.setFillColor(bkcolor);\r\n\r\n        this._pdf.doc.roundedRect(\r\n            x,\r\n            y,\r\n            width,\r\n            height,\r\n            rounding,\r\n            rounding,\r\n            'FD'\r\n        );\r\n    };\r\n\r\n    /**\r\n     *\r\n     * @param x\r\n     * @param y\r\n     * @param width\r\n     * @param fontSize\r\n     * @param color\r\n     * @param align\r\n     * @param str\r\n     * @protected\r\n     */\r\n    _addText = (\r\n        x: number,\r\n        y: number,\r\n        fontSize: number,\r\n        color: string,\r\n        align: TextOptionsLight['align'] = 'left',\r\n        str: string\r\n    ): void => {\r\n        this._pdf.doc.setTextColor(color);\r\n        this._pdf.doc.setFontSize(fontSize);\r\n\r\n        this._pdf.doc.text(str, x, y, {\r\n            align\r\n        });\r\n    };\r\n\r\n    /**\r\n     *\r\n     * @param position\r\n     * @param offset\r\n     * @param width\r\n     * @param fontSize\r\n     * @param color\r\n     * @param align\r\n     * @param str\r\n     * @protected\r\n     */\r\n    _addTextByOffset = (\r\n        position: string,\r\n        offset: { x: number; y: number },\r\n        width: number,\r\n        fontSize: number,\r\n        color: string,\r\n        align: TextOptionsLight['align'],\r\n        str: string\r\n    ): void => {\r\n        const { x, y } = this._calculateOffsetByPosition(position, offset);\r\n        const fixX = align === 'center' ? x - width / 2 : x;\r\n        this._addText(fixX, y, fontSize, color, align, str);\r\n    };\r\n\r\n    /**\r\n     * @protected\r\n     */\r\n    _addDescription = (): void => {\r\n        const str = this._form.description.trim();\r\n        const position = 'topleft';\r\n        const offset = {\r\n            x: -0.7,\r\n            y:\r\n                this._config.extraInfo &&\r\n                ((this._config.extraInfo.date && this._form.date) ||\r\n                    (this._config.extraInfo.specs && this._form.specs))\r\n                    ? 10\r\n                    : 2\r\n        };\r\n        const fontSize = 8;\r\n        const maxWidth = 50;\r\n\r\n        const paddingBack = 2;\r\n\r\n        const { x, y } = this._calculateOffsetByPosition(position, offset);\r\n\r\n        this._pdf.doc.setTextColor(this._style.description.txcolor);\r\n        this._pdf.doc.setFontSize(fontSize);\r\n\r\n        const { w, h } = this._pdf.doc.getTextDimensions(str, {\r\n            maxWidth,\r\n            fontSize\r\n        });\r\n\r\n        this._addRoundedBox(\r\n            x,\r\n            y,\r\n            w + paddingBack * 2,\r\n            h + paddingBack * 2,\r\n            this._style.description.bkcolor,\r\n            this._style.description.brcolor\r\n        );\r\n\r\n        this._pdf.doc.text(str, x + paddingBack, y + paddingBack * 2, {\r\n            align: 'left',\r\n            maxWidth\r\n        });\r\n    };\r\n\r\n    /**\r\n     * This function is a mess\r\n     * @returns\r\n     * @protected\r\n     */\r\n    _addWatermark = async (watermark: IWatermark): Promise<void> => {\r\n        const getImageElement = async (\r\n            image: string | SVGElement\r\n        ): Promise<HTMLImageElement> => {\r\n            let imgData: string;\r\n\r\n            if (typeof image === 'string') {\r\n                imgData = image;\r\n            } else if (image instanceof SVGElement) {\r\n                imgData = await this._processSvgImage(image);\r\n            } else {\r\n                throw this._i18n.errorImage;\r\n            }\r\n\r\n            return new Promise((resolve, reject) => {\r\n                const image = new Image();\r\n                image.onload = () => {\r\n                    try {\r\n                        resolve(image);\r\n                    } catch (err) {\r\n                        return reject(err);\r\n                    }\r\n                };\r\n                image.onerror = () => {\r\n                    return reject(this._i18n.errorImage);\r\n                };\r\n                image.src = imgData;\r\n            });\r\n        };\r\n\r\n        let logoImage: HTMLImageElement;\r\n\r\n        const position = 'topright';\r\n        const offset = { x: 2, y: 2 };\r\n        const fontSize = 14;\r\n\r\n        const logoSizeHeight = 12;\r\n        let logoSizeWidth: number;\r\n\r\n        const fontSizeSubtitle = fontSize / 1.8;\r\n\r\n        let back = false;\r\n\r\n        const { x, y } = this._calculateOffsetByPosition(position, offset);\r\n\r\n        const paddingBack = 2;\r\n\r\n        let marginRight = 0;\r\n\r\n        let backBoxHeight = paddingBack * 2;\r\n\r\n        let titleYPosition = y + paddingBack + 1.5;\r\n\r\n        let subtitleYPosition = y + paddingBack;\r\n\r\n        let logoSpace = 0;\r\n\r\n        if (watermark.logo) {\r\n            if (watermark.logo instanceof Image) {\r\n                logoImage = watermark.logo;\r\n            } else {\r\n                logoImage = await getImageElement(watermark.logo);\r\n            }\r\n\r\n            const aspectRatio = logoImage.width / logoImage.height;\r\n\r\n            logoSizeWidth = logoSizeHeight * aspectRatio;\r\n\r\n            // space between text and logo\r\n            logoSpace = 3;\r\n\r\n            marginRight = logoSizeWidth + logoSpace;\r\n\r\n            backBoxHeight += 14;\r\n\r\n            if (watermark.title) {\r\n                titleYPosition += 4;\r\n                subtitleYPosition += 2;\r\n            }\r\n\r\n            if (watermark.subtitle) {\r\n                subtitleYPosition += 5;\r\n                titleYPosition -= 2.5;\r\n            }\r\n        } else {\r\n            if (watermark.title) {\r\n                backBoxHeight += 5;\r\n                subtitleYPosition += 5;\r\n            }\r\n\r\n            if (watermark.subtitle) {\r\n                backBoxHeight += 3;\r\n            }\r\n\r\n            if (watermark.title && watermark.subtitle) {\r\n                backBoxHeight += 1;\r\n            }\r\n        }\r\n\r\n        if (watermark.title) {\r\n            this._pdf.doc.setTextColor(this._style.watermark.txcolortitle);\r\n            this._pdf.doc.setFontSize(fontSize);\r\n            this._pdf.doc.setFont('helvetica', 'bold');\r\n\r\n            let { w } = this._pdf.doc.getTextDimensions(watermark.title);\r\n\r\n            if (watermark.subtitle) {\r\n                this._pdf.doc.setFontSize(fontSizeSubtitle);\r\n                this._pdf.doc.setFont('helvetica', 'normal');\r\n                const wSub = this._pdf.doc.getTextDimensions(\r\n                    watermark.subtitle\r\n                ).w;\r\n                w = wSub > w ? wSub : w;\r\n                this._pdf.doc.setFontSize(fontSize);\r\n            }\r\n\r\n            // Adaptable width, fixed height\r\n            const widthBack = w + paddingBack * 2;\r\n\r\n            this._addRoundedBox(\r\n                x - widthBack + 2 - marginRight,\r\n                y - 4,\r\n                widthBack + paddingBack + marginRight + logoSpace,\r\n                backBoxHeight,\r\n                this._style.watermark.bkcolor,\r\n                this._style.watermark.brcolor\r\n            );\r\n            back = true;\r\n            this._pdf.doc.setFont('helvetica', 'bold');\r\n            this._pdf.doc.text(\r\n                watermark.title,\r\n                x - marginRight,\r\n                titleYPosition,\r\n                {\r\n                    align: 'right'\r\n                }\r\n            );\r\n        }\r\n\r\n        if (watermark.subtitle) {\r\n            this._pdf.doc.setTextColor(this._style.watermark.txcolorsubtitle);\r\n            this._pdf.doc.setFontSize(fontSizeSubtitle);\r\n            this._pdf.doc.setFont('helvetica', 'normal');\r\n\r\n            // only subtitle, no title\r\n            if (!back) {\r\n                const { w } = this._pdf.doc.getTextDimensions(\r\n                    watermark.subtitle\r\n                );\r\n                const widthBack = paddingBack * 2 + w;\r\n                this._addRoundedBox(\r\n                    x - widthBack + 2 - marginRight,\r\n                    y - 4,\r\n                    widthBack + paddingBack + marginRight,\r\n                    backBoxHeight,\r\n                    this._style.watermark.bkcolor,\r\n                    this._style.watermark.brcolor\r\n                );\r\n                back = true;\r\n            }\r\n\r\n            this._pdf.doc.text(\r\n                watermark.subtitle,\r\n                x - marginRight,\r\n                subtitleYPosition,\r\n                {\r\n                    align: 'right'\r\n                }\r\n            );\r\n        }\r\n\r\n        if (!watermark.logo) return;\r\n\r\n        if (!back) {\r\n            const widthBack = marginRight + paddingBack;\r\n            this._addRoundedBox(\r\n                x,\r\n                y - 4,\r\n                widthBack,\r\n                16,\r\n                this._style.watermark.bkcolor,\r\n                this._style.watermark.brcolor\r\n            );\r\n        }\r\n\r\n        this._pdf.doc.addImage(\r\n            logoImage,\r\n            'PNG',\r\n            x - logoSizeWidth,\r\n            y,\r\n            logoSizeWidth,\r\n            logoSizeHeight\r\n        );\r\n    };\r\n\r\n    /**\r\n     * Info displayed at the bottom of the map\r\n     * @protected\r\n     */\r\n    protected _addExtraInfo = (extraInfo: IExtraInfo): void => {\r\n        if (extraInfo.url && this._form.url) {\r\n            this._addUrl();\r\n        }\r\n\r\n        if (\r\n            (extraInfo.specs && this._form.specs) ||\r\n            (extraInfo.date && this._form.date)\r\n        ) {\r\n            this._addSpecsAndDate();\r\n        }\r\n    };\r\n\r\n    /**\r\n     * @protected\r\n     */\r\n    protected _addSpecsAndDate = (): void => {\r\n        const position = 'topleft';\r\n        const offset = {\r\n            x: 1,\r\n            y: 2.5\r\n        };\r\n        const fontSize = 6;\r\n        const txcolor = this._style.specs.txcolor;\r\n        const align = 'left';\r\n\r\n        const { x, y } = this._calculateOffsetByPosition(position, offset);\r\n\r\n        this._pdf.doc.setFont('helvetica', 'bold');\r\n        this._pdf.doc.setFontSize(fontSize);\r\n\r\n        let str = '';\r\n\r\n        if (\r\n            this._form.specs &&\r\n            this._config.extraInfo &&\r\n            this._config.extraInfo.specs\r\n        ) {\r\n            const scale = `${\r\n                this._i18n.scale\r\n            } 1:${this._scaleDenominator.toLocaleString('de')}`;\r\n            const paper = `${\r\n                this._i18n.paper\r\n            } ${this._form.format.toUpperCase()}`;\r\n            const dpi = `${this._form.resolution} DPI`;\r\n            const specs = [scale, dpi, paper];\r\n            str = specs.join(' - ');\r\n        }\r\n\r\n        if (\r\n            this._form.date &&\r\n            this._config.extraInfo &&\r\n            this._config.extraInfo.date\r\n        ) {\r\n            const date = this._getDate();\r\n\r\n            if (str) {\r\n                str += ` (${date})`;\r\n            } else {\r\n                str = date;\r\n            }\r\n        }\r\n\r\n        const { w, h } = this._pdf.doc.getTextDimensions(str, { fontSize });\r\n\r\n        const paddingBack = 2;\r\n\r\n        this._addRoundedBox(\r\n            x - paddingBack * 2,\r\n            y - h - paddingBack * 2,\r\n            w + paddingBack * 3,\r\n            h + paddingBack * 3,\r\n            this._style.specs.bkcolor,\r\n            this._style.specs.brcolor\r\n        );\r\n\r\n        this._addTextByOffset(\r\n            position,\r\n            offset,\r\n            w,\r\n            fontSize,\r\n            txcolor,\r\n            align,\r\n            str\r\n        );\r\n    };\r\n\r\n    /**\r\n     * @protected\r\n     */\r\n    protected _addUrl = (): void => {\r\n        const position = 'bottomleft';\r\n        const width = 250;\r\n        const offset = {\r\n            x: 1,\r\n            y: 1\r\n        };\r\n\r\n        const fontSize = 6;\r\n        const txcolor = this._style.url.txcolor;\r\n        const align = 'left';\r\n\r\n        this._pdf.doc.setFont('helvetica', 'italic');\r\n        const str = window.location.href;\r\n\r\n        const { x, y } = this._calculateOffsetByPosition(position, offset);\r\n\r\n        const { w, h } = this._pdf.doc.getTextDimensions(str, {\r\n            fontSize\r\n        });\r\n\r\n        const paddingBack = 2;\r\n\r\n        this._addRoundedBox(\r\n            x - paddingBack * 2,\r\n            y - h - 1,\r\n            w + paddingBack * 3,\r\n            h + paddingBack * 3,\r\n            this._style.url.bkcolor,\r\n            this._style.url.brcolor\r\n        );\r\n\r\n        this._addTextByOffset(\r\n            position,\r\n            offset,\r\n            width,\r\n            fontSize,\r\n            txcolor,\r\n            align,\r\n            str\r\n        );\r\n\r\n        this._accumulativeOffsetBottomLeft = offset.y + h + 1;\r\n    };\r\n\r\n    /**\r\n     * @protected\r\n     */\r\n    protected _getDate = (): string => {\r\n        return String(\r\n            new Date(Date.now()).toLocaleDateString(this._config.dateFormat)\r\n        );\r\n    };\r\n\r\n    /**\r\n     * The attributions are obtained from the Control in the DOM.\r\n     * @protected\r\n     */\r\n    protected _addAttributions = (): void => {\r\n        const createNode = (content: string): HTMLElement => {\r\n            return <span>{content}</span>;\r\n        };\r\n\r\n        const attributions: string[] = this._map\r\n            .getLayers()\r\n            .getArray()\r\n            .flatMap((l) => {\r\n                if ('getSource' in l && typeof l.getSource === 'function') {\r\n                    const attr = l\r\n                        .getSource()\r\n                        .getAttributions() as AttributionLike;\r\n                    if (attr) {\r\n                        if (typeof attr === 'function') {\r\n                            try {\r\n                                return attr(null);\r\n                            } catch (err) {\r\n                                console.error(err);\r\n                            }\r\n                        }\r\n                        return attr as string | string[];\r\n                    }\r\n                }\r\n                return [];\r\n            });\r\n\r\n        if (!attributions.length) return;\r\n\r\n        // remove duplicates and create nodes\r\n        const attributionsList = [...new Set(attributions)].map((a) => {\r\n            return createNode(a);\r\n        });\r\n\r\n        const ATTRI_SEPATATOR = ' Â· ';\r\n\r\n        const position = 'bottomright';\r\n        const offset = { x: 1, y: 1 };\r\n        const fontSize = 7;\r\n\r\n        this._pdf.doc.setFont('helvetica', 'normal');\r\n        this._pdf.doc.setFontSize(fontSize);\r\n        const { x, y } = this._calculateOffsetByPosition(position, offset);\r\n\r\n        let xPos = x;\r\n\r\n        const attributionsText = attributionsList\r\n            .map((a) => a.textContent)\r\n            .join(ATTRI_SEPATATOR);\r\n\r\n        const { w, h } = this._pdf.doc.getTextDimensions(attributionsText, {\r\n            fontSize\r\n        });\r\n\r\n        const paddingBack = 4;\r\n\r\n        const whiteSpaceWidth = this._pdf.doc.getTextDimensions(\r\n            ATTRI_SEPATATOR,\r\n            { fontSize }\r\n        ).w;\r\n\r\n        this._addRoundedBox(\r\n            x - w - 2,\r\n            y - h,\r\n            w + paddingBack + 2,\r\n            h + paddingBack,\r\n            this._style.attributions.bkcolor,\r\n            this._style.attributions.brcolor\r\n        );\r\n\r\n        Array.from(attributionsList)\r\n            .reverse()\r\n            .forEach((attribution, index) => {\r\n                Array.from(attribution.childNodes)\r\n                    .reverse()\r\n                    .forEach((node) => {\r\n                        const content = node.textContent;\r\n\r\n                        if ('href' in node) {\r\n                            this._pdf.doc.setTextColor(\r\n                                this._style.attributions.txcolorlink\r\n                            );\r\n                            this._pdf.doc.textWithLink(content, xPos, y, {\r\n                                align: 'right',\r\n                                url: (node as HTMLAnchorElement).href\r\n                            });\r\n                        } else {\r\n                            this._pdf.doc.setTextColor(\r\n                                this._style.attributions.txcolor\r\n                            );\r\n                            this._pdf.doc.text(content, xPos, y, {\r\n                                align: 'right'\r\n                            });\r\n                        }\r\n\r\n                        const { w } = this._pdf.doc.getTextDimensions(content);\r\n                        xPos -= w;\r\n                    });\r\n\r\n                // Excldue last element\r\n                if (index !== attributionsList.length - 1) {\r\n                    // To add separation between diferents attributtions\r\n                    this._pdf.doc.text(ATTRI_SEPATATOR, xPos, y, {\r\n                        align: 'right'\r\n                    });\r\n\r\n                    xPos -= whiteSpaceWidth;\r\n                }\r\n            });\r\n    };\r\n\r\n    /**\r\n     * Adapted from http://hg.intevation.de/gemma/file/tip/client/src/components/Pdftool.vue#l252\r\n     * @protected\r\n     */\r\n    protected _addScaleBar = (): void => {\r\n        const offset = {\r\n            x: -0.7,\r\n            y:\r\n                this._config.extraInfo &&\r\n                ((this._form.url && this._config.extraInfo.url) ||\r\n                    (this._form.specs && this._config.extraInfo.specs))\r\n                    ? this._accumulativeOffsetBottomLeft + 2\r\n                    : 2\r\n        };\r\n\r\n        const maxWidth = 90; // in mm\r\n\r\n        // from https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Math/log10#Polyfill\r\n        const log10 =\r\n            Math.log10 || // more precise, but unsupported by IE\r\n            function (x) {\r\n                return Math.log(x) * Math.LOG10E;\r\n            };\r\n\r\n        let maxLength = maxWidth * this._scaleDenominator;\r\n\r\n        let unit: string;\r\n        let unitConversionFactor: number;\r\n\r\n        if (this._config.units === 'metric') {\r\n            unit = 'mm';\r\n\r\n            const millimetre = 1;\r\n            const metre = 1000;\r\n            const kilometre = metre * 1000;\r\n\r\n            unitConversionFactor = millimetre;\r\n\r\n            if (maxLength >= kilometre * 10) {\r\n                unit = 'km';\r\n                unitConversionFactor = 1e6;\r\n            } else if (maxLength >= metre * 10) {\r\n                unit = 'm';\r\n                unitConversionFactor = metre;\r\n            }\r\n        } else if (this._config.units === 'imperial') {\r\n            const inch = 25.4; // Millimetre to inch\r\n            const mile = inch * 63360;\r\n            const yard = inch * 36;\r\n\r\n            unit = 'in';\r\n            unitConversionFactor = inch;\r\n\r\n            if (maxLength >= mile * 10) {\r\n                unit = 'mi';\r\n                unitConversionFactor = mile;\r\n            } else if (maxLength >= yard * 10) {\r\n                unit = 'yd';\r\n                unitConversionFactor = yard;\r\n            }\r\n        }\r\n\r\n        maxLength /= unitConversionFactor;\r\n\r\n        const unroundedLength = maxLength;\r\n        const numberOfDigits = Math.floor(log10(unroundedLength));\r\n        const factor = Math.pow(10, numberOfDigits);\r\n        const mapped = unroundedLength / factor;\r\n\r\n        let length = Math.floor(maxLength); // just to have an upper limit\r\n\r\n        // manually only use numbers that are very nice to devide by 4\r\n        // note that this is taken into account for rounding later\r\n        if (mapped > 8) {\r\n            length = 8 * factor;\r\n        } else if (mapped > 4) {\r\n            length = 4 * factor;\r\n        } else if (mapped > 2) {\r\n            length = 2 * factor;\r\n        } else {\r\n            length = factor;\r\n        }\r\n\r\n        let size = (length * unitConversionFactor) / this._scaleDenominator / 4;\r\n\r\n        const percentageMargin = this._style.paperMargin\r\n            ? ((this._printingMargins.left + this._printingMargins.right) /\r\n                  this._pdf.width) *\r\n              100\r\n            : null;\r\n\r\n        // Reduce length acording to margins\r\n        size = percentageMargin\r\n            ? (size / 100) * (100 - percentageMargin)\r\n            : size;\r\n\r\n        const fullSize = size * 4;\r\n\r\n        // x/y defaults to offset for topleft corner (normal x/y coordinates)\r\n        const x = offset.x + this._printingMargins.left;\r\n        let y = offset.y + this._printingMargins.top;\r\n\r\n        y = this._pdf.height - offset.y - 10 - this._printingMargins.bottom;\r\n\r\n        // to give the outer white box 4mm padding\r\n        const scaleBarX = x + 4;\r\n        const scaleBarY = y + 5; // 5 because above the scalebar will be the numbers\r\n\r\n        const width = fullSize + 8;\r\n        const height = 10;\r\n\r\n        // draw outer box\r\n        this._addRoundedBox(\r\n            x,\r\n            y,\r\n            width,\r\n            10,\r\n            this._style.scalebar.bkcolor,\r\n            this._style.scalebar.brcolor\r\n        );\r\n\r\n        // draw first part of scalebar\r\n        this._pdf.doc.setDrawColor(this._style.scalebar.txcolor);\r\n        this._pdf.doc.setFillColor(this._style.scalebar.txcolor);\r\n        this._pdf.doc.rect(scaleBarX, scaleBarY, size, 1, 'FD');\r\n\r\n        // draw second part of scalebar\r\n        this._pdf.doc.setDrawColor(this._style.scalebar.txcolor);\r\n        this._pdf.doc.setFillColor(this._style.scalebar.bkcolor);\r\n        this._pdf.doc.rect(scaleBarX + size, scaleBarY, size, 1, 'FD');\r\n\r\n        // draw third part of scalebar\r\n        this._pdf.doc.setDrawColor(this._style.scalebar.txcolor);\r\n        this._pdf.doc.setFillColor(this._style.scalebar.txcolor);\r\n        this._pdf.doc.rect(scaleBarX + size * 2, scaleBarY, size * 2, 1, 'FD');\r\n\r\n        // draw numeric labels above scalebar\r\n        this._pdf.doc.setTextColor(this._style.scalebar.txcolor);\r\n        this._pdf.doc.setFontSize(6);\r\n        this._pdf.doc.text('0', scaleBarX, scaleBarY - 1);\r\n        // /4 and could give 2.5. We still round, because of floating point arith\r\n        this._pdf.doc.text(\r\n            String(Math.round((length * 10) / 4) / 10),\r\n            scaleBarX + size - 1,\r\n            scaleBarY - 1\r\n        );\r\n        this._pdf.doc.text(\r\n            String(Math.round(length / 2)),\r\n            scaleBarX + size * 2 - 2,\r\n            scaleBarY - 1\r\n        );\r\n        this._pdf.doc.text(\r\n            Math.round(length).toString() + ' ' + unit,\r\n            scaleBarX + size * 4 - 4,\r\n            scaleBarY - 1\r\n        );\r\n\r\n        this._accumulativeOffsetBottomLeft = offset.y + height;\r\n    };\r\n\r\n    /**\r\n     *\r\n     * @param imgSrc\r\n     * @returns\r\n     * @protected\r\n     */\r\n    protected _addCompass = async (\r\n        imgSrc: HTMLImageElement | string | SVGElement\r\n    ): Promise<void> => {\r\n        const position = 'bottomright';\r\n        const offset = { x: 2, y: 6 };\r\n        const size = 6;\r\n        const rotationRadians = this._view.getRotation();\r\n        const imageSize = 100;\r\n\r\n        const { x, y } = this._calculateOffsetByPosition(\r\n            position,\r\n            offset,\r\n            size\r\n        );\r\n\r\n        const addRotation = (image: CanvasImageSource) => {\r\n            const canvas = document.createElement('canvas');\r\n\r\n            // Must be bigger than the image to prevent clipping\r\n            canvas.height = 120;\r\n            canvas.width = 120;\r\n            const context = canvas.getContext('2d');\r\n\r\n            context.translate(canvas.width * 0.5, canvas.height * 0.5);\r\n            context.rotate(rotationRadians);\r\n            context.translate(-canvas.width * 0.5, -canvas.height * 0.5);\r\n            context.drawImage(\r\n                image,\r\n                (canvas.height - imageSize) / 2,\r\n                (canvas.width - imageSize) / 2,\r\n                imageSize,\r\n                imageSize\r\n            );\r\n\r\n            // Add back circle\r\n            const xCircle = x - size;\r\n            const yCircle = y;\r\n            this._pdf.doc.setDrawColor(this._style.compass.brcolor);\r\n            this._pdf.doc.setFillColor(this._style.compass.bkcolor);\r\n            this._pdf.doc.circle(xCircle, yCircle, size, 'FD');\r\n\r\n            return canvas;\r\n        };\r\n\r\n        const addImage = (image: CanvasImageSource): void => {\r\n            const rotatedCanvas = addRotation(image);\r\n\r\n            const sizeImage = size * 1.5;\r\n            const xImage = x - sizeImage - size / 4.3;\r\n            const yImage = y - sizeImage / 2;\r\n\r\n            this._pdf.doc.addImage(\r\n                rotatedCanvas,\r\n                'PNG',\r\n                xImage,\r\n                yImage,\r\n                sizeImage,\r\n                sizeImage\r\n            );\r\n        };\r\n\r\n        let image: HTMLImageElement;\r\n\r\n        if (imgSrc instanceof Image) {\r\n            addImage(image);\r\n            return;\r\n        } else {\r\n            let imgData: string;\r\n\r\n            if (typeof imgSrc === 'string') {\r\n                imgData = imgSrc;\r\n            } else if (imgSrc instanceof SVGElement) {\r\n                imgData = await this._processSvgImage(imgSrc);\r\n            } else {\r\n                throw this._i18n.errorImage;\r\n            }\r\n\r\n            return new Promise((resolve, reject) => {\r\n                const image = new Image(imageSize, imageSize);\r\n\r\n                image.onload = () => {\r\n                    addImage(image);\r\n                    resolve();\r\n                };\r\n\r\n                image.onerror = () => {\r\n                    reject(this._i18n.errorImage);\r\n                };\r\n\r\n                image.src = imgData;\r\n            });\r\n        }\r\n    };\r\n\r\n    protected async _addLegends() {\r\n        const position = 'bottomleft';\r\n\r\n        const offset = {\r\n            x: 1,\r\n            y: this._accumulativeOffsetBottomLeft + 3\r\n        };\r\n\r\n        const { x, y } = this._calculateOffsetByPosition(position, offset);\r\n\r\n        let yPos = y;\r\n\r\n        const images: HTMLImageElement[] = await this._legends.getImages(\r\n            this._form.resolution * 1.5,\r\n            this._style.legends.txcolor,\r\n            this._style.legends.bkcolor\r\n        );\r\n\r\n        if (!images.length) {\r\n            return;\r\n        }\r\n\r\n        const ratioSize = 1 / (this._form.resolution / 15);\r\n\r\n        const largestWidth =\r\n            Math.max(...images.map((i) => i.naturalWidth)) * ratioSize;\r\n        const accumulativeHeight = images.reduce(\r\n            (acc, curr) => acc + curr.naturalHeight * ratioSize,\r\n            0\r\n        );\r\n\r\n        const paddingBack = 1;\r\n\r\n        this._addRoundedBox(\r\n            x - paddingBack * 3,\r\n            y - accumulativeHeight - paddingBack,\r\n            largestWidth + paddingBack * 2 * 3,\r\n            accumulativeHeight + paddingBack * 2,\r\n            this._style.legends.bkcolor,\r\n            this._style.legends.brcolor\r\n        );\r\n\r\n        images.forEach((img) => {\r\n            const { naturalWidth, naturalHeight } = img;\r\n            const width = naturalWidth * ratioSize;\r\n            const height = naturalHeight * ratioSize;\r\n            this._pdf.doc.addImage(img, x, yPos - height, width, height);\r\n            yPos -= height;\r\n        });\r\n    }\r\n}\r\n\r\n/**\r\n * **_[interface]_**\r\n * @protected\r\n */\r\ninterface IMargins {\r\n    top: number;\r\n    right: number;\r\n    bottom: number;\r\n    left: number;\r\n}\r\n\r\n/**\r\n * **_[interface]_**\r\n * @protected\r\n */\r\ninterface IWindow extends Window {\r\n    jspdf: any;\r\n    pdfjsLib: any;\r\n}\r\n\r\n/**\r\n * **_[interface]_**\r\n * @protected\r\n */\r\nexport interface IPdf {\r\n    doc: jsPDF;\r\n    width: number;\r\n    height: number;\r\n}\r\n\r\ninterface IPdfOptions {\r\n    map: Map;\r\n    form: IPrintOptions;\r\n    i18n: I18n;\r\n    config: Options;\r\n    height: number;\r\n    width: number;\r\n    scaleResolution: number;\r\n}\r\n","/**\n * Vanilla JS Modal compatible with Bootstrap\n * modal-vanilla 0.12.0 <https://github.com/KaneCohen/modal-vanilla>\n * Copyright 2020 Kane Cohen <https://github.com/KaneCohen>\n * Available under BSD-3-Clause license\n */\nimport EventEmitter from 'events';\n\nlet _factory = null;\n\nconst _defaults = Object.freeze({\n  el: null,               // Existing DOM element that will be 'Modal-ized'.\n  animate: true,          // Show Modal using animation.\n  animateClass: 'fade',   //\n  animateInClass: 'show', //\n  appendTo: 'body',       // DOM element to which constructed Modal will be appended.\n  backdrop: true,         // Boolean or 'static', Show Modal backdrop blocking content.\n  keyboard: true,         // Close modal on esc key.\n  title: false,           // Content of the title in the constructed dialog.\n  header: true,           // Show header content.\n  content: false,         // Either string or an HTML element.\n  footer: true,           // Footer content. By default will use buttons.\n  buttons: null,          //\n  headerClose: true,      // Show close button in the header.\n  construct: false,       // Creates new HTML with a given content.\n  transition: 300,        //\n  backdropTransition: 150 //\n});\n\nconst _buttons = deepFreeze({\n  dialog: [\n    {text: 'Cancel',\n      value: false,\n      attr: {\n        'class': 'btn btn-default',\n        'data-dismiss': 'modal'\n      }\n    },\n    {text: 'OK',\n      value: true,\n      attr: {\n        'class': 'btn btn-primary',\n        'data-dismiss': 'modal'\n      }\n    }\n  ],\n  alert: [\n    {text: 'OK',\n      attr: {\n        'class': 'btn btn-primary',\n        'data-dismiss': 'modal'\n      }\n    }\n  ],\n  confirm: [\n    {text: 'Cancel',\n      value: false,\n      attr: {\n        'class': 'btn btn-default',\n        'data-dismiss': 'modal'\n      }\n    },\n    {text: 'OK',\n      value: true,\n      attr: {\n        'class': 'btn btn-primary',\n        'data-dismiss': 'modal'\n      }\n    }\n  ]\n});\n\nconst _templates = {\n  container: '<div class=\"modal\"></div>',\n  dialog: '<div class=\"modal-dialog\"></div>',\n  content: '<div class=\"modal-content\"></div>',\n  header: '<div class=\"modal-header\"></div>',\n  headerClose: '<button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Close\"><span aria-hidden=\"true\">Ã—</span></button>',\n  body: '<div class=\"modal-body\"></div>',\n  footer: '<div class=\"modal-footer\"></div>',\n  backdrop: '<div class=\"modal-backdrop\"></div>'\n};\n\nfunction deepFreeze(obj) {\n  for (let k in obj) {\n    if (Array.isArray(obj[k])) {\n      obj[k].forEach(v => {\n        deepFreeze(v);\n      });\n    } else if (obj[k] !== null && typeof obj[k] === 'object') {\n      Object.freeze(obj[k]);\n    }\n  }\n  return Object.freeze(obj);\n}\n\nfunction guid() {\n  return (((1 + Math.random()) * 0x10000) | 0).toString(16) +\n    (((1 + Math.random()) * 0x10000) | 0).toString(16);\n}\n\nfunction data(el, prop, value) {\n let prefix = 'data';\n let elData = el[prefix] || {};\n if (typeof value === 'undefined') {\n   if (el[prefix] && el[prefix][prop]) {\n     return el[prefix][prop];\n   } else {\n     var dataAttr = el.getAttribute(`${prefix}-${prop}`);\n     if (typeof dataAttr !== 'undefined') {\n       return dataAttr;\n     }\n     return null;\n   }\n } else {\n   elData[prop] = value;\n   el[prefix] = elData;\n   return el;\n }\n}\n\nfunction build(html, all) {\n  if (html.nodeName) return html;\n  html = html.replace(/(\\t|\\n$)/g, '');\n\n  if (!_factory) {\n    _factory = document.createElement('div');\n  }\n\n  _factory.innerHTML = '';\n  _factory.innerHTML = html;\n  if (all === true) {\n    return _factory.childNodes;\n  } else {\n    return _factory.childNodes[0];\n  }\n}\n\nfunction calcScrollbarWidth() {\n  let inner;\n  let width;\n  let outerWidth;\n  let outer = document.createElement('div');\n  Object.assign(outer.style, {\n    visibility: 'hidden',\n    width: '100px'\n  });\n  document.body.appendChild(outer);\n\n  outerWidth = outer.offsetWidth;\n  outer.style.overflow = 'scroll';\n\n  inner = document.createElement('div');\n  inner.style.width = '100%';\n  outer.appendChild(inner);\n\n  width = outerWidth - inner.offsetWidth;\n  document.body.removeChild(outer);\n\n  return width;\n}\n\nfunction getPath(node) {\n  let nodes = [node];\n  while (node.parentNode) {\n    node = node.parentNode;\n    nodes.push(node);\n  }\n  return nodes;\n}\n\nclass Modal extends EventEmitter {\n  static set templates(templates) {\n    this._baseTemplates = templates;\n  }\n\n  static get templates() {\n    return Object.assign({}, _templates, Modal._baseTemplates || {});\n  }\n\n  static set buttons(buttons) {\n    this._baseButtons = buttons;\n  }\n\n  static get buttons() {\n    return Object.assign({}, _buttons, Modal._baseButtons || {});\n  }\n\n  static set options(options) {\n    this._baseOptions = options;\n  }\n\n  static get options() {\n    return Object.assign({}, _defaults, Modal._baseOptions || {});\n  }\n\n  static get version() {\n    return '0.12.0';\n  }\n\n  static alert(message, _options = {}) {\n    let options = Object.assign({},\n      _defaults,\n      {\n        title:  message,\n        content: false,\n        construct: true,\n        headerClose: false,\n        buttons: Modal.buttons.alert\n      },\n      _options\n    );\n\n    return new Modal(options);\n  }\n\n  static confirm(question, _options = {}) {\n    let options = Object.assign({},\n      _defaults,\n      {\n        title:  question,\n        content: false,\n        construct: true,\n        headerClose: false,\n        buttons: Modal.buttons.confirm\n      },\n      _options\n    );\n\n    return new Modal(options);\n  }\n\n  constructor(options = {}) {\n    super();\n\n    this.id = guid();\n    this.el = null;\n    this._html = {};\n    this._events = {};\n    this._visible = false;\n    this._pointerInContent = false;\n    this._options = Object.assign({}, Modal.options, options);\n    this._templates = Object.assign({}, Modal.templates, options.templates || {});\n    this._html.appendTo = document.querySelector(this._options.appendTo);\n    this._scrollbarWidth = calcScrollbarWidth();\n\n    if (this._options.buttons === null) {\n      this._options.buttons = Modal.buttons.dialog;\n    }\n\n    if (this._options.el) {\n      let el = this._options.el;\n      if (typeof this._options.el == 'string') {\n        el = document.querySelector(this._options.el);\n        if (! el) {\n          throw new Error(`Selector: DOM Element ${this._options.el} not found.`);\n        }\n      }\n      data(el, 'modal', this);\n      this.el = el;\n    } else {\n      this._options.construct = true;\n    }\n\n    if (this._options.construct) {\n      this._render();\n    } else {\n      this._mapDom();\n    }\n  }\n\n  _render() {\n    let html = this._html;\n    let o = this._options;\n    let t = this._templates;\n    let animate = o.animate ? o.animateClass : false;\n\n    html.container = build(t.container);\n    html.dialog = build(t.dialog);\n    html.content = build(t.content);\n    html.header = build(t.header);\n    html.headerClose = build(t.headerClose);\n    html.body = build(t.body);\n    html.footer = build(t.footer);\n    if (animate) html.container.classList.add(animate);\n\n    this._setHeader();\n    this._setContent();\n    this._setFooter();\n\n    this.el = html.container;\n\n    html.dialog.appendChild(html.content);\n    html.container.appendChild(html.dialog);\n\n    return this;\n  }\n\n  _mapDom() {\n    let html = this._html;\n    let o = this._options;\n\n    if (this.el.classList.contains(o.animateClass)) {\n      o.animate = true;\n    }\n\n    html.container = this.el;\n    html.dialog = this.el.querySelector('.modal-dialog');\n    html.content = this.el.querySelector('.modal-content');\n    html.header = this.el.querySelector('.modal-header');\n    html.headerClose = this.el.querySelector('.modal-header .close');\n    html.body = this.el.querySelector('.modal-body');\n    html.footer = this.el.querySelector('.modal-footer');\n\n    this._setHeader();\n    this._setContent();\n    this._setFooter();\n\n    return this;\n  }\n\n  _setHeader() {\n    let html = this._html;\n    let o = this._options;\n\n    if (o.header && html.header) {\n      if (o.title.nodeName) {\n        html.header.innerHTML = o.title.outerHTML;\n      } else if (typeof o.title === 'string') {\n        html.header.innerHTML = `<h4 class=\"modal-title\">${o.title}</h4>`;\n      }\n      // Add header close button only to constructed modals.\n      if (this.el === null && html.headerClose && o.headerClose) {\n        html.header.appendChild(html.headerClose);\n      }\n      if (o.construct) {\n        html.content.appendChild(html.header);\n      }\n    }\n  }\n\n  _setContent() {\n    let html = this._html;\n    let o = this._options;\n\n    if (o.content && html.body) {\n      if (typeof o.content === 'string') {\n        html.body.innerHTML = o.content;\n      } else {\n        html.body.innerHTML = o.content.outerHTML;\n      }\n      if (o.construct) {\n        html.content.appendChild(html.body);\n      }\n    }\n  }\n\n  _setFooter() {\n    let html = this._html;\n    let o = this._options;\n\n    if (o.footer && html.footer) {\n      if (o.footer.nodeName) {\n        html.footer.ineerHTML = o.footer.outerHTML;\n      } else if (typeof o.footer === 'string') {\n        html.footer.innerHTML = o.footer;\n      } else if (! html.footer.children.length) {\n        o.buttons.forEach((button) => {\n          let el = document.createElement('button');\n          data(el, 'button', button);\n          el.innerHTML = button.text;\n          el.setAttribute('type', 'button');\n          for (let j in button.attr) {\n            el.setAttribute(j, button.attr[j]);\n          }\n          html.footer.appendChild(el);\n        });\n      }\n      if (o.construct) {\n        html.content.appendChild(html.footer);\n      }\n    }\n\n  }\n\n  _setEvents() {\n    let o = this._options;\n    let html = this._html;\n\n    this._events.keydownHandler = this._handleKeydownEvent.bind(this);\n    document.body.addEventListener('keydown',\n      this._events.keydownHandler\n    );\n\n    this._events.mousedownHandler = this._handleMousedownEvent.bind(this);\n    html.container.addEventListener('mousedown',\n      this._events.mousedownHandler\n    );\n\n    this._events.clickHandler = this._handleClickEvent.bind(this);\n    html.container.addEventListener('click',\n      this._events.clickHandler\n    );\n\n    this._events.resizeHandler = this._handleResizeEvent.bind(this);\n    window.addEventListener('resize',\n      this._events.resizeHandler\n    );\n  }\n\n  _handleMousedownEvent(e) {\n    this._pointerInContent = false;\n    let path = getPath(e.target);\n    path.every(node => {\n      if (node.classList && node.classList.contains('modal-content')) {\n        this._pointerInContent = true;\n        return false;\n      }\n      return true;\n    });\n  }\n\n  _handleClickEvent(e) {\n    let path = getPath(e.target);\n    path.every(node => {\n      if (node.tagName === 'HTML') {\n        return false;\n      }\n      if (this._options.backdrop !== true && node.classList.contains('modal')) {\n        return false;\n      }\n      if (node.classList.contains('modal-content')) {\n        return false;\n      }\n      if (node.getAttribute('data-dismiss') === 'modal') {\n        this.emit('dismiss', this, e, data(e.target, 'button'));\n        this.hide();\n        return false;\n      }\n\n      if (!this._pointerInContent && node.classList.contains('modal')) {\n        this.emit('dismiss', this, e, null);\n        this.hide();\n        return false;\n      }\n      return true;\n    });\n\n    this._pointerInContent = false;\n  }\n\n  _handleKeydownEvent(e) {\n    if (e.which === 27 && this._options.keyboard) {\n      this.emit('dismiss', this, e, null);\n      this.hide();\n    }\n  }\n\n  _handleResizeEvent(e) {\n    this._resize();\n  }\n\n  show() {\n    let o = this._options;\n    let html = this._html;\n    this.emit('show', this);\n\n    this._checkScrollbar();\n    this._setScrollbar();\n    document.body.classList.add('modal-open');\n\n    if (o.construct) {\n      html.appendTo.appendChild(html.container);\n    }\n\n    html.container.style.display = 'block';\n    html.container.scrollTop = 0;\n\n    if (o.backdrop !== false) {\n      this.once('showBackdrop', () => {\n        this._setEvents();\n\n        if (o.animate) html.container.offsetWidth; // Force reflow\n\n        html.container.classList.add(o.animateInClass);\n\n        setTimeout(() => {\n          this._visible = true;\n          this.emit('shown', this);\n        }, o.transition);\n      });\n      this._backdrop();\n    } else {\n      this._setEvents();\n\n      if (o.animate) html.container.offsetWidth; // Force reflow\n\n      html.container.classList.add(o.animateInClass);\n\n      setTimeout(() => {\n        this._visible = true;\n        this.emit('shown', this);\n      }, o.transition);\n    }\n    this._resize();\n\n    return this;\n  }\n\n  toggle() {\n    if (this._visible) {\n      this.hide();\n    } else {\n      this.show();\n    }\n  }\n\n  _resize() {\n    var modalIsOverflowing =\n      this._html.container.scrollHeight > document.documentElement.clientHeight;\n\n    this._html.container.style.paddingLeft =\n      ! this.bodyIsOverflowing && modalIsOverflowing ? this._scrollbarWidth + 'px' : '';\n\n    this._html.container.style.paddingRight =\n      this.bodyIsOverflowing && ! modalIsOverflowing ? this._scrollbarWidth + 'px' : '';\n  }\n\n  _backdrop() {\n    let html = this._html;\n    let t = this._templates;\n    let o = this._options;\n    let animate = o.animate ? o.animateClass : false;\n\n    html.backdrop = build(t.backdrop);\n    if (animate) html.backdrop.classList.add(animate);\n    html.appendTo.appendChild(html.backdrop);\n\n    if (animate) html.backdrop.offsetWidth;\n\n    html.backdrop.classList.add(o.animateInClass);\n\n    setTimeout(() => {\n      this.emit('showBackdrop', this);\n    }, this._options.backdropTransition);\n  }\n\n  hide() {\n    let html = this._html;\n    let o = this._options;\n    let contCList = html.container.classList;\n    this.emit('hide', this);\n\n    contCList.remove(o.animateInClass);\n\n    if (o.backdrop) {\n      let backCList = html.backdrop.classList;\n      backCList.remove(o.animateInClass);\n    }\n\n    this._removeEvents();\n\n    setTimeout(() => {\n      document.body.classList.remove('modal-open');\n      document.body.style.paddingRight = this.originalBodyPad;\n    }, o.backdropTransition);\n\n    setTimeout(() => {\n      if (o.backdrop) {\n        html.backdrop.parentNode.removeChild(html.backdrop);\n      }\n      html.container.style.display = 'none';\n\n      if (o.construct) {\n        html.container.parentNode.removeChild(html.container);\n      }\n\n      this._visible = false;\n      this.emit('hidden', this);\n    }, o.transition);\n\n    return this;\n  }\n\n  _removeEvents() {\n    if (this._events.keydownHandler) {\n      document.body.removeEventListener('keydown',\n        this._events.keydownHandler\n      );\n    }\n\n    this._html.container.removeEventListener('mousedown',\n      this._events.mousedownHandler\n    );\n\n    this._html.container.removeEventListener('click',\n      this._events.clickHandler\n    );\n\n    window.removeEventListener('resize',\n      this._events.resizeHandler\n    );\n  }\n\n  _checkScrollbar() {\n    this.bodyIsOverflowing = document.body.clientWidth < window.innerWidth;\n  }\n\n  _setScrollbar() {\n    this.originalBodyPad = document.body.style.paddingRight || '';\n    if (this.bodyIsOverflowing) {\n      let basePadding = parseInt(this.originalBodyPad || 0, 10);\n      document.body.style.paddingRight = basePadding + this._scrollbarWidth + 'px';\n    }\n  }\n}\n\nexport default Modal;\n","/**\r\n * @protected\r\n */\r\nexport const CLASS_PRINT_MODE = 'printMode';\r\nexport const CLASS_HIDE_CONTROLS = 'hideControls';\r\n","import Map from 'ol/Map.js';\r\nimport View from 'ol/View.js';\r\nimport Polygon from 'ol/geom/Polygon';\r\nimport Overlay from 'ol/Overlay';\r\nimport { Extent } from 'ol/extent';\r\n\r\nimport { I18n, Options } from '../ol-pdf-printer';\r\n\r\nimport { CLASS_HIDE_CONTROLS } from '../classnames';\r\n\r\nimport myPragma from '../myPragma';\r\n\r\nimport rotateRight from '../assets/images/rotateRight.svg';\r\nimport rotateLeft from '../assets/images/rotateLeft.svg';\r\nimport zoomIn from '../assets/images/zoomIn.svg';\r\nimport zoomOut from '../assets/images/zoomOut.svg';\r\n\r\nconst CLASS_OVERLAY = 'opp-overlay-frame';\r\nconst CLASS_OVERLAY_RECTANGLE = CLASS_OVERLAY + '-rectangle';\r\nconst CLASS_OVERLAY_CONTROLS = CLASS_OVERLAY + '-controls';\r\nconst CLASS_OVERLAY_ZOOM_ENABLED = CLASS_OVERLAY + '-zoom-enabled';\r\nconst CLASS_OVERLAY_CANCEL_BTN = CLASS_OVERLAY + '-cancel-btn';\r\nconst CLASS_OVERLAY_SAVE_BTN = CLASS_OVERLAY + '-save-btn';\r\nconst CLASS_OVERLAY_REFRAME_HINT = CLASS_OVERLAY + '-reframe-hint';\r\n\r\nexport default class ReframeROI {\r\n    private _map: Map;\r\n    private _view: View;\r\n\r\n    private _callback: (extent: Extent | Polygon) => void;\r\n\r\n    private _escapeKeyListener: EventListener;\r\n    private _saveButton: HTMLButtonElement;\r\n    private _cancelButton: HTMLButtonElement;\r\n    private _rectangle: HTMLElement;\r\n    private _overlay: Overlay;\r\n    private _controlButtons: HTMLElement;\r\n\r\n    constructor(map: Map, i18n: I18n, options: Options) {\r\n        this._map = map;\r\n        this._view = this._map.getView();\r\n\r\n        this._saveButton = (\r\n            <button\r\n                type=\"button\"\r\n                className={`btn btn-lg btn-primary ${CLASS_OVERLAY_SAVE_BTN}`}\r\n            >\r\n                {i18n.process}\r\n            </button>\r\n        );\r\n\r\n        this._cancelButton = (\r\n            <button\r\n                type=\"button\"\r\n                className={`btn-close btn-close-white ${CLASS_OVERLAY_CANCEL_BTN}`}\r\n                onclick={() => this.hideOverlay()}\r\n                title={i18n.escapeHint}\r\n            >\r\n                <span aria-hidden=\"true\">Ã—</span>\r\n            </button>\r\n        );\r\n\r\n        this._controlButtons = <div className={CLASS_OVERLAY_CONTROLS}></div>;\r\n\r\n        if (options.zoomControlOnReframe) {\r\n            this._controlButtons.append(\r\n                <div className=\"opp-zoom ol-control ol-unselectable\">\r\n                    <button\r\n                        type=\"button\"\r\n                        className=\"opp-zoom-in\"\r\n                        onClick={() => this._zoom('in')}\r\n                        title={i18n.zoomIn}\r\n                    >\r\n                        {zoomIn()}\r\n                    </button>\r\n                    <button\r\n                        type=\"button\"\r\n                        className=\"opp-zoom-out\"\r\n                        onClick={() => this._zoom('out')}\r\n                        title={i18n.zoomOut}\r\n                    >\r\n                        {zoomOut()}\r\n                    </button>\r\n                </div>\r\n            );\r\n        }\r\n\r\n        if (options.rotationControlOnReframe) {\r\n            this._controlButtons.append(\r\n                <div className=\"opp-rotation ol-control ol-unselectable\">\r\n                    <button\r\n                        type=\"button\"\r\n                        className=\"opp-rotation-left\"\r\n                        onClick={() => this._rotate('left')}\r\n                        title={i18n.rotateLeft}\r\n                    >\r\n                        {rotateLeft()}\r\n                    </button>\r\n                    <button\r\n                        type=\"button\"\r\n                        className=\"opp-rotation-right\"\r\n                        onClick={() => this._rotate('right')}\r\n                        title={i18n.rotateRight}\r\n                    >\r\n                        {rotateRight()}\r\n                    </button>\r\n                </div>\r\n            );\r\n        }\r\n\r\n        this._rectangle = (\r\n            <div\r\n                className={`${CLASS_OVERLAY_RECTANGLE} ${\r\n                    options.zoomControlOnReframe\r\n                        ? CLASS_OVERLAY_ZOOM_ENABLED\r\n                        : ''\r\n                }`}\r\n            >\r\n                {this._cancelButton}\r\n                <div>\r\n                    <div>{this._saveButton}</div>\r\n                    <div className={CLASS_OVERLAY_REFRAME_HINT}>\r\n                        {i18n.reframeHint}\r\n                    </div>\r\n                </div>\r\n                {(options.zoomControlOnReframe ||\r\n                    options.rotationControlOnReframe) &&\r\n                    this._controlButtons}\r\n            </div>\r\n        );\r\n    }\r\n\r\n    public showOverlay(\r\n        mode: 'landscape' | 'portrait',\r\n        callback: (polygon: Extent | Polygon) => void\r\n    ): void {\r\n        this._map.getTargetElement().classList.add(CLASS_HIDE_CONTROLS);\r\n\r\n        this._overlay = new Overlay({\r\n            className: `${CLASS_OVERLAY} ${mode}-mode`,\r\n            element: this._rectangle,\r\n            stopEvent: true\r\n        });\r\n\r\n        this._map.addOverlay(this._overlay);\r\n\r\n        this._view.setConstrainResolution(false);\r\n\r\n        this._addEvents();\r\n        this._callback = callback;\r\n\r\n        this._saveButton.onclick = () => {\r\n            callback(this._getExtent());\r\n            setTimeout(() => {\r\n                this.hideOverlay();\r\n            }, 10);\r\n        };\r\n    }\r\n\r\n    public hideOverlay(): void {\r\n        if (this._overlay) {\r\n            this._map.removeOverlay(this._overlay);\r\n        }\r\n        this._removeEvents();\r\n        this._map.getTargetElement().classList.remove(CLASS_HIDE_CONTROLS);\r\n\r\n        if (this._callback) {\r\n            this._callback(null);\r\n        }\r\n    }\r\n\r\n    private _zoom(direction: 'in' | 'out', delta = 0.5): void {\r\n        const rotate = 0.261799 * delta;\r\n        const dd = direction === 'in' ? '' : '-';\r\n        this._view.adjustZoom(Number(dd + rotate));\r\n    }\r\n\r\n    private _rotate(direction: 'left' | 'right', delta = 0.5): void {\r\n        const rotate = 0.261799 * delta;\r\n        const dd = direction === 'right' ? '' : '-';\r\n        this._view.adjustRotation(Number(dd + rotate));\r\n    }\r\n\r\n    private _getExtent(): Polygon {\r\n        const mapBounds = this._map.getTargetElement().getBoundingClientRect();\r\n\r\n        const overlayFrameBounds = this._rectangle.getBoundingClientRect();\r\n\r\n        const relativePosition = {\r\n            left: overlayFrameBounds.left - mapBounds.left,\r\n            top: overlayFrameBounds.top - mapBounds.top\r\n        };\r\n\r\n        const topLeft = this._map.getCoordinateFromPixel([\r\n            relativePosition.left,\r\n            relativePosition.top\r\n        ]);\r\n\r\n        const topRight = this._map.getCoordinateFromPixel([\r\n            relativePosition.left + overlayFrameBounds.width,\r\n            relativePosition.top\r\n        ]);\r\n\r\n        const bottomLeft = this._map.getCoordinateFromPixel([\r\n            relativePosition.left,\r\n            relativePosition.top + overlayFrameBounds.height\r\n        ]);\r\n\r\n        const bottomRight = this._map.getCoordinateFromPixel([\r\n            relativePosition.left + overlayFrameBounds.width,\r\n            relativePosition.top + overlayFrameBounds.height\r\n        ]);\r\n\r\n        return new Polygon([[topLeft, topRight, bottomRight, bottomLeft]]);\r\n    }\r\n\r\n    private _addEvents(): void {\r\n        const escapeKeyListener = ({ key }) => {\r\n            if (key === 'Escape') {\r\n                this.hideOverlay();\r\n            }\r\n        };\r\n\r\n        this._escapeKeyListener = escapeKeyListener.bind(this);\r\n        document.addEventListener('keydown', this._escapeKeyListener);\r\n    }\r\n\r\n    private _removeEvents = (): void => {\r\n        document.removeEventListener('keydown', this._escapeKeyListener);\r\n    };\r\n}\r\n","import Map from 'ol/Map.js';\r\nimport { Extent } from 'ol/extent';\r\nimport { Polygon } from 'ol/geom';\r\n\r\nimport Modal from 'modal-vanilla';\r\n\r\nimport ReframeROI from './ReframeROI';\r\n\r\nimport { I18n, IPrintOptions, Options } from '../ol-pdf-printer';\r\n\r\nimport myPragma from '../myPragma';\r\n\r\n/**\r\n * @private\r\n */\r\nexport default class SettingsModal {\r\n    protected _modal: Modal;\r\n    protected _reframeROI: ReframeROI;\r\n\r\n    constructor(\r\n        map: Map,\r\n        options: Options,\r\n        i18n: I18n,\r\n        printMap: (\r\n            values: IPrintOptions | false,\r\n            showLoading?: boolean,\r\n            delay?: number\r\n        ) => void\r\n    ) {\r\n        this._modal = new Modal({\r\n            headerClose: true,\r\n            header: true,\r\n            animate: true,\r\n            title: i18n.printPdf,\r\n            content: this.Content(i18n, options),\r\n            footer: this.Footer(i18n, options),\r\n            ...options.modal\r\n        });\r\n\r\n        if (options.allowReframeRegionOfInterest) {\r\n            this._reframeROI = new ReframeROI(map, i18n, options);\r\n        }\r\n\r\n        this._modal.el.classList.add('settingsModal');\r\n\r\n        this._modal.on('dismiss', (modal: Modal, event: Event): void => {\r\n            const print = (event.target as HTMLElement).dataset.print;\r\n            if (!print) return;\r\n\r\n            const form = document.getElementById('printMap') as HTMLFormElement;\r\n\r\n            const formData = new FormData(form);\r\n\r\n            const values: IPrintOptions = {\r\n                format: formData.get('printFormat') as string,\r\n                orientation: formData.get(\r\n                    'printOrientation'\r\n                ) as IPrintOptions['orientation'],\r\n                resolution: Number(formData.get('printResolution')),\r\n                description: formData.get('printDescription') as string,\r\n                compass: formData.get('printCompass') as unknown as boolean,\r\n                attributions: formData.get(\r\n                    'printAttributions'\r\n                ) as unknown as boolean,\r\n                scalebar: formData.get('printScalebar') as unknown as boolean,\r\n                legends: formData.get('printLegends') as unknown as boolean,\r\n                url: formData.get('printUrl') as unknown as boolean,\r\n                date: formData.get('printDate') as unknown as boolean,\r\n                specs: formData.get('printSpecs') as unknown as boolean,\r\n                safeMargins: formData.get('safeMargins') as unknown as boolean,\r\n                typeExport: this._modal.el.querySelector<HTMLSelectElement>(\r\n                    'select[name=\"printTypeExport\"]'\r\n                ).value\r\n            };\r\n\r\n            if (this._reframeROI) {\r\n                const callback = (extent: Extent | Polygon | false) => {\r\n                    if (extent) {\r\n                        printMap(\r\n                            { regionOfInterest: extent, ...values },\r\n                            /* showLoading */ true,\r\n                            /* delay */ options.modal.transition\r\n                        );\r\n                    } else {\r\n                        //cancel\r\n                        printMap(false);\r\n                    }\r\n                };\r\n                this._reframeROI.showOverlay(values.orientation, callback);\r\n            } else {\r\n                printMap(\r\n                    values,\r\n                    /* showLoading */ true,\r\n                    /* delay */ options.modal.transition\r\n                );\r\n            }\r\n        });\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param i18n\r\n     * @param options\r\n     * @returns\r\n     * @protected\r\n     */\r\n    Content(i18n: I18n, options: Options): HTMLElement {\r\n        const { dpi, mapElements, extraInfo, description, paperSizes } =\r\n            options;\r\n\r\n        return (\r\n            <form id=\"printMap\">\r\n                <section>\r\n                    <div className=\"printFields-container\">\r\n                        <div className=\"printField\">\r\n                            <label htmlFor=\"printFormat\">\r\n                                {i18n.paperSize}\r\n                            </label>\r\n                            <select name=\"printFormat\" id=\"printFormat\">\r\n                                {paperSizes.map((paper) => (\r\n                                    <option\r\n                                        value={paper.value}\r\n                                        {...(paper.selected\r\n                                            ? { selected: 'selected' }\r\n                                            : {})}\r\n                                    >\r\n                                        {paper.value}\r\n                                    </option>\r\n                                ))}\r\n                            </select>\r\n                        </div>\r\n                        <div className=\"printField\">\r\n                            <label htmlFor=\"printOrientation\">\r\n                                {i18n.orientation}\r\n                            </label>\r\n                            <select\r\n                                name=\"printOrientation\"\r\n                                id=\"printOrientation\"\r\n                            >\r\n                                <option value=\"landscape\" selected>\r\n                                    {i18n.landscape}\r\n                                </option>\r\n                                <option value=\"portrait\">\r\n                                    {i18n.portrait}\r\n                                </option>\r\n                            </select>\r\n                        </div>\r\n                        <div className=\"printField\">\r\n                            <label htmlFor=\"printResolution\">\r\n                                {i18n.resolution}\r\n                            </label>\r\n                            <select name=\"printResolution\" id=\"printResolution\">\r\n                                {dpi.map((d) => (\r\n                                    <option\r\n                                        value={d.value}\r\n                                        {...(d.selected\r\n                                            ? { selected: 'selected' }\r\n                                            : {})}\r\n                                    >\r\n                                        {d.value} dpi\r\n                                    </option>\r\n                                ))}\r\n                            </select>\r\n                        </div>\r\n                    </div>\r\n                    <div>\r\n                        {description && (\r\n                            <div>\r\n                                <label htmlFor=\"printDescription\">\r\n                                    {i18n.addNote}\r\n                                </label>\r\n                                <textarea\r\n                                    id=\"printDescription\"\r\n                                    name=\"printDescription\"\r\n                                    rows=\"4\"\r\n                                ></textarea>\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n                </section>\r\n                {mapElements && (\r\n                    <fieldset className=\"sectionChecks mapElements\">\r\n                        <legend>{i18n.mapElements}</legend>\r\n                        <div className=\"sectionChecksList\">\r\n                            {mapElements.compass && (\r\n                                <label htmlFor=\"printCompass\">\r\n                                    <input\r\n                                        type=\"checkbox\"\r\n                                        id=\"printCompass\"\r\n                                        name=\"printCompass\"\r\n                                        checked\r\n                                    />\r\n                                    <span>{i18n.compass}</span>\r\n                                </label>\r\n                            )}\r\n                            {mapElements.scalebar && (\r\n                                <label htmlFor=\"printScalebar\">\r\n                                    <input\r\n                                        type=\"checkbox\"\r\n                                        id=\"printScalebar\"\r\n                                        name=\"printScalebar\"\r\n                                        checked\r\n                                    />\r\n                                    <span>{i18n.scale}</span>\r\n                                </label>\r\n                            )}\r\n                            {mapElements.legends && (\r\n                                <label htmlFor=\"printLegends\">\r\n                                    <input\r\n                                        type=\"checkbox\"\r\n                                        id=\"printLegends\"\r\n                                        name=\"printLegends\"\r\n                                        checked\r\n                                    />\r\n                                    <span>{i18n.legends}</span>\r\n                                </label>\r\n                            )}\r\n                            {mapElements.attributions && (\r\n                                <label htmlFor=\"printAttributions\">\r\n                                    <input\r\n                                        type=\"checkbox\"\r\n                                        id=\"printAttributions\"\r\n                                        name=\"printAttributions\"\r\n                                        checked\r\n                                    />\r\n                                    <span>{i18n.layersAttributions}</span>\r\n                                </label>\r\n                            )}\r\n                        </div>\r\n                    </fieldset>\r\n                )}\r\n                {extraInfo && (\r\n                    <fieldset className=\"sectionChecks extraInfo\">\r\n                        <legend>{i18n.extraInfo}</legend>\r\n                        <div className=\"sectionChecksList\">\r\n                            {extraInfo.url && (\r\n                                <label htmlFor=\"printUrl\">\r\n                                    <input\r\n                                        type=\"checkbox\"\r\n                                        id=\"printUrl\"\r\n                                        name=\"printUrl\"\r\n                                        checked\r\n                                    />\r\n                                    <span>{i18n.url}</span>\r\n                                </label>\r\n                            )}\r\n                            {extraInfo.date && (\r\n                                <label htmlFor=\"printDate\">\r\n                                    <input\r\n                                        type=\"checkbox\"\r\n                                        id=\"printDate\"\r\n                                        name=\"printDate\"\r\n                                        checked\r\n                                    />\r\n                                    <span>{i18n.date}</span>\r\n                                </label>\r\n                            )}\r\n                            {extraInfo.specs && (\r\n                                <label htmlFor=\"printSpecs\">\r\n                                    <input\r\n                                        type=\"checkbox\"\r\n                                        id=\"printSpecs\"\r\n                                        name=\"printSpecs\"\r\n                                        checked\r\n                                    />\r\n                                    <span>{i18n.specs}</span>\r\n                                </label>\r\n                            )}\r\n                        </div>\r\n                    </fieldset>\r\n                )}\r\n                <div className=\"safeMarginsSection sectionChecks\">\r\n                    <label htmlFor=\"safeMargins\">\r\n                        <input\r\n                            type=\"checkbox\"\r\n                            id=\"safeMargins\"\r\n                            name=\"safeMargins\"\r\n                        />\r\n                        <span> {i18n.printerMargins}</span>\r\n                    </label>\r\n                </div>\r\n            </form>\r\n        );\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param i18n\r\n     * @returns\r\n     * @protected\r\n     */\r\n    Footer(i18n: I18n, options: Options): string {\r\n        const { mimeTypeExports } = options;\r\n\r\n        return (\r\n            <div>\r\n                <button\r\n                    type=\"button\"\r\n                    className=\"btn-sm btn btn-secondary\"\r\n                    data-dismiss=\"modal\"\r\n                >\r\n                    {i18n.cancel}\r\n                </button>\r\n                <div class=\"typeExportContainer\">\r\n                    <button\r\n                        type=\"button\"\r\n                        className=\"btn-sm btn btn-primary\"\r\n                        data-print=\"true\"\r\n                        data-dismiss=\"modal\"\r\n                    >\r\n                        {i18n.print}\r\n                    </button>\r\n                    <select\r\n                        className=\"typeExport\"\r\n                        name=\"printTypeExport\"\r\n                        id=\"printTypeExport\"\r\n                    >\r\n                        {mimeTypeExports.map((type) => (\r\n                            <option\r\n                                value={type.value}\r\n                                {...(type.selected\r\n                                    ? { selected: 'selected' }\r\n                                    : {})}\r\n                            >\r\n                                {type.value}\r\n                            </option>\r\n                        ))}\r\n                    </select>\r\n                </div>\r\n            </div>\r\n        ).outerHTML;\r\n    }\r\n\r\n    hide(): void {\r\n        this._modal.hide();\r\n    }\r\n\r\n    show(): void {\r\n        if (!this._modal._visible) this._modal.show();\r\n    }\r\n}\r\n","import Modal from 'modal-vanilla';\r\nimport { I18n, Options } from '../ol-pdf-printer';\r\n\r\n/**\r\n * @private\r\n */\r\nexport default class ProcessingModal {\r\n    protected _modal: Modal;\r\n    protected _footer: string;\r\n    protected _i18n: I18n;\r\n    protected _message: HTMLElement = document.createElement('div');\r\n    protected _loaderContainer: HTMLElement = document.createElement('div');\r\n\r\n    /**\r\n     *\r\n     * @param i18n\r\n     * @param options\r\n     * @param onEndPrint\r\n     * @protected\r\n     */\r\n    constructor(i18n: I18n, options: Options, onEndPrint: () => void) {\r\n        this._i18n = i18n;\r\n\r\n        this._modal = new Modal({\r\n            headerClose: false,\r\n            title: this._i18n.printing,\r\n            backdrop: 'static', // To prevent close on clicking backdrop\r\n            content: ' ',\r\n            footer: `\r\n            <button\r\n                type=\"button\"\r\n                class=\"btn-sm btn btn-secondary\"\r\n                data-dismiss=\"modal\"\r\n            >\r\n                ${this._i18n.cancel}\r\n            </button>\r\n            `,\r\n            ...options.modal\r\n        });\r\n\r\n        this._modal.el.classList.add('processingModal');\r\n\r\n        this._modal.once('shown', () => {\r\n            if (options.loader) {\r\n                this._loaderContainer.className = 'printLoader-container';\r\n                if (typeof options.loader === 'string') {\r\n                    this._loaderContainer.innerHTML = options.loader;\r\n                } else {\r\n                    this._loaderContainer.appendChild(options.loader);\r\n                }\r\n            }\r\n\r\n            this._modal._html.body.append(this._message);\r\n            this._modal._html.body.append(this._loaderContainer);\r\n        });\r\n\r\n        this._modal.on('dismiss', () => {\r\n            onEndPrint();\r\n        });\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param string\r\n     * @protected\r\n     */\r\n    _setContentModal(string: string | number): void {\r\n        this._message.innerHTML = String(string);\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param string\r\n     * @protected\r\n     */\r\n    _setFooterModal(string: string): void {\r\n        this._modal._html.footer.innerHTML = string;\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param string\r\n     * @param footer\r\n     * @protected\r\n     */\r\n    show(): void {\r\n        this._modal.show();\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param string\r\n     * @param footer\r\n     * @protected\r\n     */\r\n    set(string: string | number): void {\r\n        if (!this._modal._visible) return;\r\n        this._setContentModal(string);\r\n    }\r\n\r\n    setLoading(bool = true): void {\r\n        if (bool) {\r\n            this._modal.el.classList.add('showLoader');\r\n        } else {\r\n            this._modal.el.classList.remove('showLoader');\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @protected\r\n     */\r\n    hide(): void {\r\n        this._modal.hide();\r\n    }\r\n}\r\n","import Map from 'ol/Map.js';\r\nimport View from 'ol/View.js';\r\nimport Control, { Options as ControlOptions } from 'ol/control/Control.js';\r\nimport { getPointResolution } from 'ol/proj.js';\r\nimport { EventsKey } from 'ol/events.js';\r\nimport { unByKey } from 'ol/Observable.js';\r\nimport Cluster from 'ol/source/Cluster.js';\r\nimport VectorLayer from 'ol/layer/Vector.js';\r\nimport TileWMS from 'ol/source/TileWMS.js';\r\nimport { Extent } from 'ol/extent';\r\nimport { Coordinate } from 'ol/coordinate.js';\r\nimport Polygon from 'ol/geom/Polygon';\r\n\r\nimport domtoimage from 'dom-to-image-more';\r\n\r\nimport { Locale } from 'locale-enum';\r\n\r\nimport Pdf from './components/Pdf';\r\nimport SettingsModal from './components/SettingsModal';\r\nimport ProcessingModal from './components/ProcessingModal';\r\nimport { LegendsOptions } from './components/MapElements/Legends';\r\nimport { getMapScale } from './components/Helpers';\r\nimport { defaultOptions, DEFAULT_LANGUAGE } from './defaults';\r\n\r\nimport { CLASS_HIDE_CONTROLS, CLASS_PRINT_MODE } from './classnames';\r\n\r\n/*eslint import/namespace: ['error', { allowComputed: true }]*/\r\nimport * as i18n from './components/i18n';\r\n\r\nimport pdfIcon from './assets/images/pdf.svg';\r\n\r\n// Style\r\nimport './assets/scss/-ol-pdf-printer.bootstrap5.scss';\r\nimport './assets/scss/ol-pdf-printer.scss';\r\n\r\n/**\r\n * @protected\r\n */\r\nfunction deepObjectAssign(target, ...sources) {\r\n    sources.forEach((source) => {\r\n        Object.keys(source).forEach((key) => {\r\n            const s_val = source[key];\r\n            const t_val = target[key];\r\n            target[key] =\r\n                t_val &&\r\n                s_val &&\r\n                typeof t_val === 'object' &&\r\n                typeof s_val === 'object' &&\r\n                !Array.isArray(t_val) // Don't merge arrays\r\n                    ? deepObjectAssign(t_val, s_val)\r\n                    : s_val;\r\n        });\r\n    });\r\n    return target;\r\n}\r\n\r\n/**\r\n * @constructor\r\n * @extends {ol/control/Control~Control}\r\n * @params options\r\n */\r\nexport default class PdfPrinter extends Control {\r\n    protected _i18n: I18n;\r\n\r\n    protected _map: Map;\r\n    protected _view: View;\r\n    protected _mapTarget: HTMLElement;\r\n\r\n    protected _pdf: Pdf;\r\n\r\n    protected _processingModal: ProcessingModal;\r\n    protected _settingsModal: SettingsModal;\r\n\r\n    protected _initialized: boolean;\r\n\r\n    protected _timeoutProcessing: ReturnType<typeof setTimeout>;\r\n\r\n    protected _initialViewResolution: number;\r\n    protected _initialViewCoords: Coordinate;\r\n    protected _initialConstrainRes: boolean;\r\n\r\n    protected _options: Options;\r\n\r\n    protected _renderCompleteKey: EventsKey | EventsKey[];\r\n\r\n    protected _isCanceled: boolean;\r\n    protected _eventsKey: EventsKey[];\r\n    protected _imageCount: number;\r\n\r\n    constructor(opt_options?: Options) {\r\n        const controlElement = document.createElement('button');\r\n\r\n        super({\r\n            target: opt_options.target,\r\n            element:\r\n                opt_options.showControlBtn === false\r\n                    ? document.createElement('div')\r\n                    : controlElement\r\n        });\r\n\r\n        // Check if the selected language exists\r\n        this._i18n =\r\n            opt_options.language && opt_options.language in i18n\r\n                ? i18n[opt_options.language]\r\n                : i18n[DEFAULT_LANGUAGE];\r\n\r\n        if (opt_options.i18n) {\r\n            // Merge custom translations\r\n            this._i18n = {\r\n                ...this._i18n,\r\n                ...opt_options.i18n\r\n            };\r\n        }\r\n\r\n        // Default options\r\n        this._options = defaultOptions(this._i18n);\r\n\r\n        // Merge options\r\n        this._options = deepObjectAssign(this._options, opt_options);\r\n\r\n        if (this._options.showControlBtn) {\r\n            controlElement.className = `ol-print-btn-menu ${this._options.ctrlBtnClass}`;\r\n            controlElement.title = this._i18n.printPdf;\r\n            controlElement.onclick = () => this.showPrintSettingsModal();\r\n            controlElement.append(pdfIcon());\r\n        }\r\n    }\r\n\r\n    public setMap(map: Map) {\r\n        super.setMap(map);\r\n        if (!this._initialized && map) this._init();\r\n        this._initialConstrainRes = this._view.getConstrainResolution();\r\n    }\r\n\r\n    /**\r\n     * @protected\r\n     */\r\n    protected _init(): void {\r\n        this._map = this.getMap();\r\n        this._view = this._map.getView();\r\n        this._mapTarget = this._map.getTargetElement();\r\n        this._settingsModal = new SettingsModal(\r\n            this._map,\r\n            this._options,\r\n            this._i18n,\r\n            this._printMap.bind(this)\r\n        );\r\n\r\n        this._processingModal = new ProcessingModal(\r\n            this._i18n,\r\n            this._options,\r\n            this._onEndPrint.bind(this)\r\n        );\r\n\r\n        this._initialized = true;\r\n    }\r\n\r\n    /**\r\n     *\r\n     */\r\n    protected _restoreConstrains(): void {\r\n        this._view.setConstrainResolution(this._initialConstrainRes);\r\n    }\r\n\r\n    /**\r\n     * Restore inital view, remove classes, disable loading\r\n     * @protected\r\n     */\r\n    protected _onEndPrint(): void {\r\n        this._mapTarget.style.width = '';\r\n        this._mapTarget.style.height = '';\r\n        this._map.updateSize();\r\n        this._view.setResolution(this._initialViewResolution);\r\n        this._view.setCenter(this._initialViewCoords);\r\n\r\n        this._restoreConstrains();\r\n\r\n        this._mapTarget.classList.remove(CLASS_PRINT_MODE, CLASS_HIDE_CONTROLS);\r\n\r\n        this._updateDPI(90);\r\n        this._removeListeners();\r\n\r\n        clearTimeout(this._timeoutProcessing);\r\n        this._processingModal.setLoading(false);\r\n\r\n        this._cancel();\r\n    }\r\n\r\n    /**\r\n     * @protected\r\n     */\r\n    protected _prepareLoading(): void {\r\n        this._processingModal.show();\r\n        this._processingModal.setLoading(true);\r\n        this._processingModal.set(this._i18n.pleaseWait);\r\n    }\r\n\r\n    /**\r\n     * @protected\r\n     */\r\n    protected _disableLoading(): void {\r\n        this._processingModal.hide();\r\n        this._processingModal.setLoading(false);\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param dpi\r\n     * @protected\r\n     */\r\n    protected _updateDPI(dpi = 90): void {\r\n        const pixelRatio = dpi / 90;\r\n\r\n        // @ts-expect-error There is no public method to do this\r\n        this._map.pixelRatio_ = pixelRatio;\r\n        this._map.getLayers().forEach((layer) => {\r\n            if (\r\n                layer.getVisible() &&\r\n                'getSource' in layer &&\r\n                typeof layer.getSource === 'function'\r\n            ) {\r\n                const source = layer.getSource() as TileWMS;\r\n\r\n                // @ts-expect-error There is no public method to do this\r\n                if (source.tilePixelRatio_ !== undefined) {\r\n                    // @ts-expect-error There is no public method to do this\r\n                    source.tilePixelRatio_ = pixelRatio;\r\n                    source.refresh();\r\n                } else {\r\n                    if (layer instanceof VectorLayer) {\r\n                        if (source instanceof Cluster) {\r\n                            source.getSource().changed();\r\n                        } else {\r\n                            source.changed();\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        });\r\n        this._map.updateSize();\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param form\r\n     * @param showLoading\r\n     * @param delay Delay to prevent glitching with modals animation\r\n     * @protected\r\n     */\r\n    protected _printMap(\r\n        form: IPrintOptions | false,\r\n        showLoading = true,\r\n        delay = 0\r\n    ): void {\r\n        // the print was canceled on the reframe instance\r\n        if (!form) {\r\n            return this._restoreConstrains();\r\n        }\r\n\r\n        if (showLoading) {\r\n            this._mapTarget.classList.add(\r\n                CLASS_PRINT_MODE,\r\n                CLASS_HIDE_CONTROLS\r\n            );\r\n        }\r\n\r\n        setTimeout(() => {\r\n            if (showLoading) {\r\n                this._prepareLoading();\r\n            }\r\n\r\n            this._isCanceled = false;\r\n\r\n            this._addDownloadCountListener();\r\n\r\n            // Save current resolution to restore it later\r\n            this._initialViewResolution = this._view.getResolution();\r\n            this._initialViewCoords = this._view.getCenter();\r\n\r\n            // To allow intermediate zoom levels\r\n            this._view.setConstrainResolution(false);\r\n\r\n            let dim = this._options.paperSizes.find(\r\n                (e) => e.value === form.format\r\n            ).size;\r\n\r\n            dim =\r\n                form.orientation === 'landscape'\r\n                    ? dim\r\n                    : ([...dim].reverse() as [number, number]);\r\n\r\n            const widthPaper = dim[0];\r\n            const heightPaper = dim[1];\r\n\r\n            this._updateDPI(form.resolution);\r\n\r\n            const pixelsPerMapMillimeter = form.resolution / 25.4;\r\n\r\n            const width = Math.round(widthPaper * pixelsPerMapMillimeter);\r\n            const height = Math.round(heightPaper * pixelsPerMapMillimeter);\r\n\r\n            const scale =\r\n                form.scale && !form.regionOfInterest\r\n                    ? form.scale\r\n                    : getMapScale(this._map) / 1000;\r\n\r\n            const scaleResolution =\r\n                scale /\r\n                getPointResolution(\r\n                    this._view.getProjection(),\r\n                    pixelsPerMapMillimeter,\r\n                    this._view.getCenter()\r\n                );\r\n\r\n            this._renderCompleteKey = this._map.once('rendercomplete', () => {\r\n                this._processingModal.set(this._i18n.downloadFinished);\r\n\r\n                domtoimage\r\n                    .toJpeg(\r\n                        this._mapTarget.querySelector(\r\n                            '.ol-unselectable.ol-layers'\r\n                        ),\r\n                        {\r\n                            width,\r\n                            height\r\n                        }\r\n                    )\r\n                    .then(async (dataUrl: string) => {\r\n                        if (this._isCanceled) return;\r\n\r\n                        this._pdf = new Pdf({\r\n                            form,\r\n                            scaleResolution,\r\n                            map: this._map,\r\n                            i18n: this._i18n,\r\n                            config: this._options,\r\n                            height: heightPaper,\r\n                            width: widthPaper\r\n                        });\r\n\r\n                        this._pdf.addMapImage(dataUrl);\r\n                        await this._pdf.addMapHelpers();\r\n\r\n                        if (this._isCanceled) return;\r\n\r\n                        await this._pdf.savePdf();\r\n\r\n                        // Reset original map size\r\n                        this._onEndPrint();\r\n\r\n                        if (showLoading) this._disableLoading();\r\n                    })\r\n                    .catch((err: Error) => {\r\n                        const message =\r\n                            typeof err === 'string' ? err : this._i18n.error;\r\n                        console.error(err);\r\n                        this._onEndPrint();\r\n                        this._processingModal.set(message);\r\n                    });\r\n            });\r\n\r\n            // Adjust the size of the map target\r\n            this._mapTarget.style.width = width + 'px';\r\n            this._mapTarget.style.height = height + 'px';\r\n\r\n            this._map.getView().setResolution(scaleResolution);\r\n            this._map.updateSize();\r\n\r\n            if (form.regionOfInterest) {\r\n                this._view.fit(form.regionOfInterest, {\r\n                    size: this._map.getSize(),\r\n                    nearest: false\r\n                });\r\n            }\r\n        }, delay);\r\n    }\r\n\r\n    /**\r\n     * Add tile listener to show downloaded images count\r\n     */\r\n    protected _addDownloadCountListener() {\r\n        const increaseCount = () => {\r\n            this._imageCount = this._imageCount + 1;\r\n            if (this._imageCount % 10 == 0) {\r\n                this._processingModal.set(\r\n                    this._i18n.downloadingImages +\r\n                        ': <b>' +\r\n                        this._imageCount +\r\n                        '</b>'\r\n                );\r\n            }\r\n        };\r\n\r\n        this._eventsKey = [];\r\n        this._imageCount = 0;\r\n\r\n        this._map\r\n            .getLayers()\r\n            .getArray()\r\n            .forEach((l) => {\r\n                if ('getSource' in l && typeof l.getSource === 'function') {\r\n                    this._eventsKey.push(\r\n                        l.getSource().on('tileloadend', () => increaseCount())\r\n                    );\r\n                    this._eventsKey.push(\r\n                        l.getSource().on('imageloadend', () => increaseCount())\r\n                    );\r\n                }\r\n            });\r\n    }\r\n\r\n    /**\r\n     * Remove WMS listeners\r\n     */\r\n    protected _removeListeners() {\r\n        unByKey(this._eventsKey);\r\n    }\r\n\r\n    /**\r\n     * @protected\r\n     */\r\n    protected _cancel(): void {\r\n        if (this._renderCompleteKey) {\r\n            unByKey(this._renderCompleteKey);\r\n        }\r\n\r\n        this._isCanceled = true;\r\n    }\r\n\r\n    /**\r\n     * Show the Settings Modal\r\n     * @public\r\n     */\r\n    showPrintSettingsModal(): void {\r\n        this._settingsModal.show();\r\n    }\r\n\r\n    /**\r\n     * Hide the Settings Modal\r\n     * @public\r\n     */\r\n    hidePrintSettingsModal(): void {\r\n        this._settingsModal.hide();\r\n    }\r\n\r\n    /**\r\n     * Create PDF programatically without displaying the Settings Modal\r\n     * @param options\r\n     * @public\r\n     */\r\n    createPdf(options: IPrintOptions, showLoading: boolean): void {\r\n        options = {};\r\n        this._printMap(\r\n            {\r\n                format: (\r\n                    this._options.paperSizes.find((p) => p.selected) ||\r\n                    this._options.paperSizes[0]\r\n                ).value,\r\n                resolution: (\r\n                    this._options.dpi.find((p) => p.selected) ||\r\n                    this._options.dpi[0]\r\n                ).value,\r\n                orientation: 'landscape',\r\n                compass: true,\r\n                attributions: true,\r\n                scalebar: true,\r\n                legends: true,\r\n                regionOfInterest: null,\r\n                typeExport: 'pdf',\r\n                ...options\r\n            },\r\n            showLoading\r\n        );\r\n    }\r\n}\r\n\r\n/**\r\n * **_[enum]_**\r\n */\r\nexport enum UnitsSystem {\r\n    Metric = 'metric',\r\n    Imperial = 'imperial'\r\n}\r\n\r\n/**\r\n * **_[interface]_**\r\n */\r\nexport interface IPrintOptions {\r\n    /**\r\n     *\r\n     */\r\n    format?: IPaperSize['value'];\r\n    /**\r\n     *\r\n     */\r\n    orientation?: 'landscape' | 'portrait';\r\n    /**\r\n     *\r\n     */\r\n    resolution?: IDpi['value'];\r\n    /**\r\n     *\r\n     */\r\n    scale?: number;\r\n\r\n    /**\r\n     * Area of interest. If this is provided,\r\n     * the scale value is not used\r\n     */\r\n    regionOfInterest?: Extent | Polygon;\r\n\r\n    /**\r\n     *\r\n     */\r\n    description?: string;\r\n    /**\r\n     *\r\n     */\r\n    compass?: boolean;\r\n    /**\r\n     *\r\n     */\r\n    attributions?: boolean;\r\n    /**\r\n     *\r\n     */\r\n    scalebar?: boolean;\r\n    /**\r\n     *\r\n     */\r\n    legends?: LegendsOptions | boolean;\r\n    /**\r\n     *\r\n     */\r\n    safeMargins?: boolean;\r\n    /**\r\n     *\r\n     */\r\n    typeExport?: IMimeTypeExport['value'];\r\n    /**\r\n     *\r\n     */\r\n    url?: boolean;\r\n    /**\r\n     *\r\n     */\r\n    date?: boolean;\r\n    /**\r\n     *\r\n     */\r\n    specs?: boolean;\r\n}\r\n\r\n/**\r\n * **_[interface]_** - Custom translations specified when creating an instance\r\n */\r\nexport interface I18n {\r\n    printPdf: string;\r\n    pleaseWait: string;\r\n    downloadFinished: string;\r\n    downloadingImages: string;\r\n    error: string;\r\n    errorImage: string;\r\n    printing: string;\r\n    cancel: string;\r\n    close: string;\r\n    print: string;\r\n    mapElements: string;\r\n    extraInfo: string;\r\n    url: string;\r\n    date: string;\r\n    specs: string;\r\n    compass: string;\r\n    scale: string;\r\n    legends: string;\r\n    layersAttributions: string;\r\n    addNote: string;\r\n    resolution: string;\r\n    orientation: string;\r\n    paperSize: string;\r\n    landscape: string;\r\n    portrait: string;\r\n    current: string;\r\n    paper: string;\r\n    printerMargins: string;\r\n    escapeHint: string;\r\n    reframeHint: string;\r\n    process?: string;\r\n    zoomIn?: string;\r\n    zoomOut?: string;\r\n    rotateLeft?: string;\r\n    rotateRight?: string;\r\n}\r\n\r\n/**\r\n * **_[interface]_**\r\n */\r\ninterface IPaperSize {\r\n    /**\r\n     *\r\n     */\r\n    size: [number, number];\r\n    /**\r\n     *\r\n     */\r\n    value: string;\r\n    /**\r\n     *\r\n     */\r\n    selected?: boolean;\r\n}\r\n\r\n/**\r\n * **_[interface]_**\r\n */\r\ninterface IDpi {\r\n    /**\r\n     *\r\n     */\r\n    value: number;\r\n    /**\r\n     *\r\n     */\r\n    selected?: boolean;\r\n}\r\n\r\n/**\r\n * **_[interface]_**\r\n */\r\ninterface IStyle {\r\n    /**\r\n     * Only added if `Add printer margins` is checked\r\n     */\r\n    paperMargin?:\r\n        | number\r\n        | {\r\n              top: number;\r\n              right: number;\r\n              bottom: number;\r\n              left: number;\r\n          };\r\n\r\n    watermark?: {\r\n        /**\r\n         * Watermark border color\r\n         */\r\n        brcolor?: string;\r\n\r\n        /**\r\n         * Watermark background color\r\n         */\r\n        bkcolor?: string;\r\n\r\n        /**\r\n         * Watermark title color\r\n         */\r\n        txcolortitle?: string;\r\n\r\n        /**\r\n         * Watermark subtitle color\r\n         */\r\n        txcolorsubtitle?: string;\r\n    };\r\n\r\n    url?: {\r\n        /**\r\n         * Url border color\r\n         */\r\n        brcolor?: string;\r\n\r\n        /**\r\n         * Url background color\r\n         */\r\n        bkcolor?: string;\r\n\r\n        /**\r\n         * Url text color\r\n         */\r\n        txcolor?: string;\r\n    };\r\n\r\n    attributions?: {\r\n        /**\r\n         * Attributions border color\r\n         */\r\n        brcolor?: string;\r\n\r\n        /**\r\n         * Attributions background color\r\n         */\r\n        bkcolor?: string;\r\n\r\n        /**\r\n         * Attributions text color\r\n         */\r\n        txcolor?: string;\r\n\r\n        /**\r\n         * Attributions links color\r\n         */\r\n        txcolorlink?: string;\r\n    };\r\n\r\n    scalebar?: {\r\n        /**\r\n         * Scalebar border color\r\n         */\r\n        brcolor?: string;\r\n\r\n        /**\r\n         * Scalebar background color\r\n         */\r\n        bkcolor?: string;\r\n\r\n        /**\r\n         * Scalebar text and graph color\r\n         */\r\n        txcolor?: string;\r\n    };\r\n\r\n    specs?: {\r\n        /**\r\n         * Specs border color\r\n         */\r\n        brcolor?: string;\r\n\r\n        /**\r\n         * Specs background color\r\n         */\r\n        bkcolor?: string;\r\n\r\n        /**\r\n         * Specs text color\r\n         */\r\n        txcolor?: string;\r\n    };\r\n\r\n    legends?: {\r\n        /**\r\n         * Legends border color\r\n         */\r\n        brcolor?: string;\r\n\r\n        /**\r\n         * Legends background color\r\n         */\r\n        bkcolor?: string;\r\n\r\n        /**\r\n         * Legends text color\r\n         */\r\n        txcolor?: string;\r\n    };\r\n\r\n    description?: {\r\n        /**\r\n         * Description border color\r\n         */\r\n        brcolor?: string;\r\n\r\n        /**\r\n         * Description background color\r\n         */\r\n        bkcolor?: string;\r\n\r\n        /**\r\n         * Description text color\r\n         */\r\n        txcolor?: string;\r\n    };\r\n\r\n    compass?: {\r\n        /**\r\n         * Compass border color\r\n         */\r\n        brcolor?: string;\r\n\r\n        /**\r\n         * Compass background color\r\n         */\r\n        bkcolor?: string;\r\n    };\r\n}\r\n\r\n/**\r\n * **_[interface]_**\r\n */\r\ninterface IMimeTypeExport {\r\n    value: 'pdf' | 'png' | 'jpeg' | 'webp';\r\n    selected?: boolean;\r\n}\r\n\r\n/**\r\n * **_[interface]_**\r\n */\r\ninterface IModal {\r\n    /**\r\n     *\r\n     */\r\n    animateClass?: string;\r\n    /**\r\n     *\r\n     */\r\n    animateInClass?: string;\r\n    /**\r\n     *\r\n     */\r\n    transition?: number;\r\n    /**\r\n     *\r\n     */\r\n    backdropTransition?: number;\r\n    /**\r\n     *\r\n     */\r\n    templates?: {\r\n        dialog?: string | HTMLElement;\r\n        headerClose?: string | HTMLElement;\r\n    };\r\n}\r\n\r\n/**\r\n * **_[interface]_**\r\n */\r\nexport interface IWatermark {\r\n    /**\r\n     * Check style section to change the color\r\n     */\r\n    title?: string;\r\n\r\n    /**\r\n     * Check style section to change the color\r\n     */\r\n    subtitle?: string;\r\n\r\n    /**\r\n     * Display a small logo next to the title\r\n     * Uns PNG format if you provide a base64 string\r\n     */\r\n    logo?: false | string | HTMLImageElement | SVGElement;\r\n}\r\n\r\n/**\r\n * **_[interface]_** - Print information at the bottom of the PDF\r\n */\r\nexport interface IExtraInfo {\r\n    /**\r\n     * Print Date\r\n     */\r\n    date?: boolean;\r\n    /**\r\n     * Current site url\r\n     */\r\n    url?: boolean;\r\n    /**\r\n     * DPI, Format and Scale information\r\n     */\r\n    specs?: boolean;\r\n}\r\n\r\n/**\r\n * **_[interface]_** - MapElements\r\n * @public\r\n */\r\nexport interface IMapElements {\r\n    /**\r\n     * Layers attributions\r\n     */\r\n    attributions?: boolean;\r\n    /**\r\n     * Scalebar\r\n     */\r\n    scalebar?: boolean;\r\n    /**\r\n     * Compass image. North must be pointing to the top\r\n     */\r\n    compass?: false | string | HTMLImageElement | SVGElement;\r\n    /**\r\n     * Display WMS legends\r\n     */\r\n    legends?: LegendsOptions | boolean;\r\n}\r\n\r\n/**\r\n * **_[interface]_** - Options specified when creating an instance\r\n */\r\nexport interface Options extends ControlOptions {\r\n    /**\r\n     * Export filename\r\n     */\r\n    filename?: string;\r\n\r\n    /**\r\n     * Map unit mode\r\n     */\r\n    units?: UnitsSystem;\r\n\r\n    /**\r\n     * Allow to reframe a precise Region of Interest before exporting\r\n     */\r\n    allowReframeRegionOfInterest?: boolean;\r\n\r\n    /**\r\n     * Show zoom control when the reframe insatnce is active\r\n     */\r\n    zoomControlOnReframe?: boolean;\r\n\r\n    /**\r\n     * Show rotation control when the reframe insatnce is active\r\n     */\r\n    rotationControlOnReframe?: boolean;\r\n\r\n    /**\r\n     * Some basic PDF style configuration\r\n     */\r\n    style?: IStyle;\r\n\r\n    /**\r\n     * Information to be inserted at the bottom of the PDF\r\n     * False to disable\r\n     */\r\n    extraInfo?: false | IExtraInfo;\r\n\r\n    /**\r\n     * Allow add extra description to the print\r\n     * False to disable\r\n     */\r\n    description?: boolean;\r\n\r\n    /**\r\n     * Elements to be showed on the PDF and in the Settings Modal.\r\n     * False to disable\r\n     */\r\n    mapElements?: false | IMapElements;\r\n\r\n    /**\r\n     * Watermark to be inserted in the PDF.\r\n     * False to disable\r\n     */\r\n    watermark?: false | IWatermark;\r\n\r\n    /**\r\n     * Paper sizes options to be shown in the settings modal\r\n     */\r\n    paperSizes?: IPaperSize[];\r\n\r\n    /**\r\n     * DPI resolutions options to be shown in the settings modal\r\n     */\r\n    dpi?: IDpi[];\r\n\r\n    /**\r\n     * Export format\r\n     */\r\n    mimeTypeExports?: IMimeTypeExport[];\r\n\r\n    /**\r\n     * Locale time zone. Default varies according to browser locale\r\n     * https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date/toLocaleDateString#using_locales\r\n     */\r\n    dateFormat?: Locale;\r\n\r\n    /**\r\n     * Show the Btn toggler on the map\r\n     */\r\n    showControlBtn?: boolean;\r\n\r\n    /**\r\n     * ClassName to add to the Btn Control\r\n     */\r\n    ctrlBtnClass?: string;\r\n\r\n    /**\r\n     * Modal configuration\r\n     */\r\n    modal?: IModal;\r\n\r\n    /**\r\n     * Element to be displayed while processing in the modal\r\n     */\r\n    loader?: HTMLElement | string | false;\r\n\r\n    /**\r\n     * Language support\r\n     */\r\n    language?: 'es' | 'en';\r\n\r\n    /**\r\n     * Add custom translations\r\n     */\r\n    i18n?: I18n;\r\n}\r\n","import { I18n } from '../../ol-pdf-printer';\r\n\r\nexport const en: I18n = {\r\n    printPdf: 'Print PDF',\r\n    pleaseWait: 'Please wait...',\r\n    downloadFinished: 'Download finished, processing...',\r\n    downloadingImages: 'Downloading images',\r\n    error: 'An error occurred while printing',\r\n    errorImage: 'An error ocurred while loading an image',\r\n    printing: 'Exporting',\r\n    cancel: 'Cancel',\r\n    close: 'Close',\r\n    print: 'Export',\r\n    mapElements: 'Map elements',\r\n    extraInfo: 'Extra information',\r\n    url: 'URL',\r\n    date: 'Date',\r\n    specs: 'Specifications',\r\n    compass: 'Compass',\r\n    scale: 'Scale',\r\n    legends: 'Legends',\r\n    layersAttributions: 'Layer attributions',\r\n    addNote: 'Add note',\r\n    resolution: 'Resolution',\r\n    orientation: 'Orientation',\r\n    paperSize: 'Paper size',\r\n    landscape: 'Landscape',\r\n    portrait: 'Portrait',\r\n    current: 'Current',\r\n    paper: 'Paper',\r\n    printerMargins: 'Add printer margins',\r\n    escapeHint: 'Press here or Escape to cancel',\r\n    reframeHint: 'Pan and zoom to adjust the print area',\r\n    process: 'Process',\r\n    zoomIn: 'Zoom in',\r\n    zoomOut: 'Zoom out',\r\n    rotateLeft: 'Rotate left',\r\n    rotateRight: 'Rotate right'\r\n};\r\n","import { I18n } from '../../ol-pdf-printer';\r\n\r\nexport const es: I18n = {\r\n    printPdf: 'Exportar PDF',\r\n    pleaseWait: 'Por favor espere...',\r\n    downloadFinished: 'Descarga completada, procesando...',\r\n    downloadingImages: 'Descargando imÃ¡genes',\r\n    error: 'Error al generar pdf',\r\n    errorImage: 'OcurriÃ³ un error al tratar de cargar una imagen',\r\n    printing: 'Exportando',\r\n    cancel: 'Cancelar',\r\n    close: 'Cerrar',\r\n    print: 'Exportar',\r\n    mapElements: 'Elementos en el mapa',\r\n    extraInfo: 'InformaciÃ³n adicional',\r\n    url: 'URL',\r\n    date: 'Fecha',\r\n    specs: 'Especificaciones',\r\n    compass: 'BrÃºjula',\r\n    scale: 'Escala',\r\n    legends: 'Leyendas',\r\n    layersAttributions: 'Atribuciones de capas',\r\n    addNote: 'Agregar nota',\r\n    resolution: 'ResoluciÃ³n',\r\n    orientation: 'OrientaciÃ³n',\r\n    paperSize: 'TamaÃ±o de pÃ¡gina',\r\n    landscape: 'Paisaje',\r\n    portrait: 'Retrato',\r\n    current: 'Actual',\r\n    paper: 'Hoja',\r\n    printerMargins: 'AÃ±adir mÃ¡rgenes de impresiÃ³n',\r\n    escapeHint: 'PresionÃ¡ aquÃ­ o Escape para cancelar',\r\n    reframeHint: 'PaneÃ¡ y zoomeÃ¡ para ajustar el Ã¡rea de impresiÃ³n',\r\n    process: 'Procesar',\r\n    zoomIn: 'Acercar',\r\n    zoomOut: ' Alejar',\r\n    rotateLeft: 'Rotatar a la izquierda',\r\n    rotateRight: 'Rotate a la derecha'\r\n};\r\n","import compassIcon from './assets/images/compass.svg';\r\nimport { I18n, Options, UnitsSystem } from './ol-pdf-printer';\r\n\r\nexport const DEFAULT_LANGUAGE = 'en';\r\n\r\nexport const defaultOptions = (i18n: I18n): Options => ({\r\n    language: DEFAULT_LANGUAGE,\r\n    filename: 'Ol Pdf Printer',\r\n    allowReframeRegionOfInterest: true,\r\n    zoomControlOnReframe: true,\r\n    rotationControlOnReframe: true,\r\n    style: {\r\n        paperMargin: {\r\n            left: 4,\r\n            top: 4,\r\n            right: 4,\r\n            bottom: 4\r\n        },\r\n        watermark: {\r\n            brcolor: '#000000',\r\n            bkcolor: '#ffffff',\r\n            txcolortitle: '#d54b4b',\r\n            txcolorsubtitle: '#444444'\r\n        },\r\n        url: {\r\n            brcolor: '#000000',\r\n            bkcolor: '#ffffff',\r\n            txcolor: '#0077cc'\r\n        },\r\n        specs: {\r\n            brcolor: '#000000',\r\n            bkcolor: '#ffffff',\r\n            txcolor: '#000000'\r\n        },\r\n        scalebar: {\r\n            brcolor: '#000000',\r\n            bkcolor: '#ffffff',\r\n            txcolor: '#000000'\r\n        },\r\n        attributions: {\r\n            brcolor: '#ffffff',\r\n            bkcolor: '#ffffff',\r\n            txcolor: '#666666',\r\n            txcolorlink: '#0077cc'\r\n        },\r\n        legends: {\r\n            brcolor: '#000000',\r\n            bkcolor: '#ffffff',\r\n            txcolor: '#000000'\r\n        },\r\n        description: {\r\n            brcolor: '#333333',\r\n            bkcolor: '#333333',\r\n            txcolor: '#ffffff'\r\n        },\r\n        compass: {\r\n            brcolor: '#000000',\r\n            bkcolor: '#333333'\r\n        }\r\n    },\r\n    extraInfo: {\r\n        date: true,\r\n        url: true,\r\n        specs: true\r\n    },\r\n    description: true,\r\n    mapElements: {\r\n        attributions: true,\r\n        scalebar: true,\r\n        legends: true,\r\n        compass: compassIcon() as SVGElement\r\n    },\r\n    watermark: {\r\n        title: 'Ol Pdf Printer',\r\n        subtitle: 'https://github.com/GastonZalba/ol-pdf-printer',\r\n        logo: false\r\n    },\r\n    paperSizes: [\r\n        // { size: [1189, 841], value: 'A0' },\r\n        // { size: [841, 594], value: 'A1' },\r\n        { size: [594, 420], value: 'A2' },\r\n        { size: [420, 297], value: 'A3' },\r\n        { size: [297, 210], value: 'A4', selected: true },\r\n        { size: [210, 148], value: 'A5' }\r\n    ],\r\n    dpi: [\r\n        { value: 96 },\r\n        { value: 150, selected: true },\r\n        { value: 200 },\r\n        { value: 300 }\r\n    ],\r\n    mimeTypeExports: [\r\n        { value: 'pdf', selected: true },\r\n        { value: 'png' },\r\n        { value: 'jpeg' },\r\n        { value: 'webp' }\r\n    ],\r\n    units: UnitsSystem.Metric,\r\n    dateFormat: undefined,\r\n    showControlBtn: true,\r\n    ctrlBtnClass: '',\r\n    loader: '<span class=\"printLoader\"></span>',\r\n    modal: {\r\n        animateClass: 'fade',\r\n        animateInClass: 'show',\r\n        transition: 150,\r\n        backdropTransition: 0,\r\n        templates: {\r\n            dialog: '<div class=\"modal-dialog modal-dialog-centered\"></div>',\r\n            headerClose: `<button type=\"button\" class=\"btn-close\" data-dismiss=\"modal\" aria-label=\"${i18n.close}\"><span aria-hidden=\"true\">Ã—</span></button>`\r\n        }\r\n    }\r\n});\r\n","import PdfPrinter from './ol-pdf-printer';\r\nimport * as utils from './ol-pdf-printer';\r\n\r\n// make enums and other methods accesible\r\nObject.assign(PdfPrinter, utils);\r\nexport default PdfPrinter;\r\n"],"names":["s","f","e","escape","replace","isDataUrl","search","canvasToBlob","t","toBlob","Promise","r","l","toDataURL","split","n","length","o","Uint8Array","charCodeAt","Blob","type","resolveUrl","document","implementation","createHTMLDocument","createElement","head","appendChild","body","href","getAndEncode","c","impl","urlCache","find","url","promise","push","options","cacheBust","test","Date","getTime","httpTimeout","XMLHttpRequest","onreadystatechange","readyState","status","i","FileReader","onloadend","result","readAsDataURL","response","ontimeout","responseType","timeout","useCredentials","withCredentials","corsImg","indexOf","window","location","origin","method","toUpperCase","open","headers","u","Object","keys","forEach","setRequestHeader","JSON","parse","stringify","data","send","console","error","imagePlaceholder","uid","Math","random","pow","toString","slice","delay","setTimeout","asArray","escapeXhtml","makeImage","Image","crossOrigin","onload","requestAnimationFrame","onerror","src","resolve","width","isNaN","scrollWidth","height","scrollHeight","getWindow","isElement","isElementHostForOpenShadowRoot","shadowRoot","isShadowRoot","isInShadowRoot","isHTMLElement","HTMLElement","isHTMLCanvasElement","HTMLCanvasElement","isHTMLInputElement","HTMLInputElement","isHTMLImageElement","HTMLImageElement","isHTMLLinkElement","HTMLLinkElement","isHTMLScriptElement","HTMLScriptElement","isHTMLStyleElement","HTMLStyleElement","isHTMLTextAreaElement","HTMLTextAreaElement","isShadowSlotElement","HTMLSlotElement","isSVGElement","SVGElement","isSVGRectElement","SVGRectElement","isDimensionMissing","ownerDocument","defaultView","ShadowRoot","prototype","hasOwnProperty","call","getRootNode","Element","nodeType","a","m","getPropertyValue","parseFloat","NaN","inlineAll","then","shouldProcess","readUrls","inline","exec","filter","RegExp","resolveAll","all","map","join","readAll","styleSheets","getPrototypeOf","cssRules","bind","CSSRule","FONT_FACE_RULE","style","parentStyleSheet","cssText","getPropertyPriority","setProperty","childNodes","newImage","copyDefaultStyles","styleCaching","toSvg","d","toPng","toJpeg","quality","toPixelData","getContext","getImageData","toCanvas","fontFaces","images","util","inliner","module","exports","Node","ELEMENT_NODE","getComputedStyle","globalThis","atob","parentNode","replaceChild","append","parent","child","wrapper","h","cloneNode","host","assignedNodes","font","fontFamily","fontFeatureSettings","fontKerning","fontSize","fontStretch","fontStyle","fontVariant","fontVariantCaps","fontVariantEastAsian","fontVariantLigatures","fontVariantNumeric","fontVariationSettings","fontWeight","y","removeProperty","getAttribute","setAttribute","createTextNode","innerHTML","value","p","g","bgcolor","backgroundColor","onclone","XMLSerializer","serializeToString","pop","removeChild","w","clearTimeout","E","scale","fillStyle","fillRect","msImageSmoothingEnabled","imageSmoothingEnabled","drawImage","tagName","v","includes","contentWindow","characterSet","doctype","name","publicId","systemId","trim","id","visibility","position","write","documentElement","outerHTML","contentDocument","title","innerText","textContent","parentElement","this","legendsDefaultConfig","fontAntiAliasing","fontColor","bgColor","forceLabels","forceTitles","Legends","constructor","_legendOptions","_requestParams","_map","_view","getView","_order","legendOptions","requestParams","order","assign","getImages","dpi","txcolor","bkcolor","wmsLayers","getWmsLegendLayers","wmsLayer","image","_getLegends","_orderImagesByIndex","getLayers","getArray","layer","ImageLayer","TileLayer","getSource","TileWMS","ImageWMS","isWmsLayer","getVisible","getMapProjection","getProjection","getViewExtent","calculateExtent","getSize","srcs","_getSrcFromParams","img","dataset","index","String","getZIndex","naturalHeight","sourceParams","getParams","proj","getCode","legend_options","params","SERVICE","VERSION","REQUEST","FORMAT","LEGEND_OPTIONS","entries","STYLE","STYLES","CQL_FILTER","SLD_BODY","SLD","ENV","SRS","SRCWIDTH","SRCHEIGHT","SCALE","_getScale","layersName","LAYERS","layerNames","Array","isArray","_getLegendUrl","LAYER","source","getUrls","getUrl","undefined","appendParams","from","sort","x","xIndex","Number","yIndex","reverse","getResolution","getMetersPerUnit","attrs","children","elem","DocumentFragment","startsWith","toLowerCase","addEventListener","substr","Pdf","_accumulativeOffsetBottomLeft","addMapHelpers","async","mapElements","extraInfo","description","watermark","_config","_addWatermark","_form","_addDescription","_addExtraInfo","compass","_addCompass","scalebar","_addScaleBar","attributions","_addAttributions","legends","_addLegends","safeMargins","_fllWhite","_processSvgImage","svg","reject","getSvgUrl","URL","createObjectURL","svgUrlToPng","svgUrl","callback","svgImage","err","_i18n","errorImage","canvas","clientWidth","clientHeight","imgData","revokeObjectURL","svgToPng","_calculateOffsetByPosition","offset","size","_printingMargins","left","top","_pdf","bottom","_addRoundedBox","brcolor","doc","setDrawColor","setFillColor","roundedRect","_addText","color","align","str","setTextColor","setFontSize","text","_addTextByOffset","fixX","date","specs","_style","getTextDimensions","maxWidth","paddingBack","getImageElement","logoImage","logoSizeWidth","fontSizeSubtitle","back","marginRight","backBoxHeight","titleYPosition","subtitleYPosition","logoSpace","logo","subtitle","txcolortitle","setFont","wSub","widthBack","txcolorsubtitle","addImage","_addUrl","_addSpecsAndDate","_scaleDenominator","toLocaleString","paper","format","resolution","_getDate","now","toLocaleDateString","dateFormat","flatMap","attr","getAttributions","attributionsList","Set","myPragma","ATTRI_SEPATATOR","xPos","attributionsText","whiteSpaceWidth","attribution","node","content","txcolorlink","textWithLink","log10","log","LOG10E","unit","unitConversionFactor","maxLength","units","metre","inch","mile","yard","unroundedLength","numberOfDigits","floor","factor","mapped","percentageMargin","paperMargin","right","fullSize","scaleBarX","scaleBarY","rect","round","imgSrc","rotationRadians","getRotation","imageSize","addRotation","context","translate","rotate","xCircle","yCircle","circle","rotatedCanvas","xImage","yImage","sizeImage","form","i18n","config","scaleResolution","create","orientation","_calculateScaleDenominator","_legends","_a","jspdf","jsPDF","addMapImage","dataUrl","savePdf","typeExport","save","filename","pdf","output","versionPdfJS","pdfjsLib","version","GlobalWorkerOptions","workerSrc","getDocument","getPage","page","viewport","getViewport","display","render","canvasContext","uri","link","download","click","downloadURI","remove","pixelsPerMapMillimeter","_getMeterPerPixel","getPointResolution","getCenter","yPos","ratioSize","largestWidth","max","naturalWidth","accumulativeHeight","reduce","acc","curr","_factory","_defaults","freeze","el","animate","animateClass","animateInClass","appendTo","backdrop","keyboard","header","footer","buttons","headerClose","construct","transition","backdropTransition","_buttons","deepFreeze","obj","k","dialog","class","alert","confirm","_templates","container","prop","prefix","elData","dataAttr","build","html","nodeName","getPath","nodes","Modal","EventEmitter","templates","_baseTemplates","_baseButtons","_baseOptions","message","_options","question","super","_html","_events","_visible","_pointerInContent","querySelector","_scrollbarWidth","inner","outerWidth","outer","offsetWidth","overflow","calcScrollbarWidth","Error","_render","_mapDom","classList","add","_setHeader","_setContent","_setFooter","contains","ineerHTML","button","j","_setEvents","keydownHandler","_handleKeydownEvent","mousedownHandler","_handleMousedownEvent","clickHandler","_handleClickEvent","resizeHandler","_handleResizeEvent","target","every","emit","hide","which","_resize","show","_checkScrollbar","_setScrollbar","scrollTop","once","_backdrop","toggle","modalIsOverflowing","paddingLeft","bodyIsOverflowing","paddingRight","contCList","_removeEvents","originalBodyPad","removeEventListener","innerWidth","basePadding","parseInt","CLASS_PRINT_MODE","CLASS_HIDE_CONTROLS","CLASS_OVERLAY","CLASS_OVERLAY_RECTANGLE","CLASS_OVERLAY_CONTROLS","CLASS_OVERLAY_ZOOM_ENABLED","CLASS_OVERLAY_CANCEL_BTN","CLASS_OVERLAY_SAVE_BTN","CLASS_OVERLAY_REFRAME_HINT","ReframeROI","_escapeKeyListener","_saveButton","className","process","_cancelButton","onclick","hideOverlay","escapeHint","_controlButtons","zoomControlOnReframe","onClick","_zoom","zoomIn","zoomOut","rotationControlOnReframe","_rotate","rotateLeft","rotateRight","_rectangle","reframeHint","showOverlay","mode","getTargetElement","_overlay","Overlay","element","stopEvent","addOverlay","setConstrainResolution","_addEvents","_callback","_getExtent","removeOverlay","direction","delta","dd","adjustZoom","adjustRotation","mapBounds","getBoundingClientRect","overlayFrameBounds","relativePosition","topLeft","getCoordinateFromPixel","topRight","bottomLeft","bottomRight","Polygon","key","SettingsModal","printMap","_modal","printPdf","Content","Footer","modal","allowReframeRegionOfInterest","_reframeROI","on","event","print","getElementById","formData","FormData","values","get","extent","regionOfInterest","paperSizes","htmlFor","paperSize","selected","landscape","portrait","addNote","rows","checked","layersAttributions","printerMargins","mimeTypeExports","cancel","ProcessingModal","onEndPrint","_message","_loaderContainer","printing","loader","_setContentModal","string","_setFooterModal","set","setLoading","bool","UnitsSystem","pleaseWait","downloadFinished","downloadingImages","close","current","deepObjectAssign","sources","s_val","t_val","PdfPrinter","Control","opt_options","controlElement","showControlBtn","language","Metric","ctrlBtnClass","defaultOptions","showPrintSettingsModal","setMap","_initialized","_init","_initialConstrainRes","getConstrainResolution","getMap","_mapTarget","_settingsModal","_printMap","_processingModal","_onEndPrint","_restoreConstrains","updateSize","setResolution","_initialViewResolution","setCenter","_initialViewCoords","_updateDPI","_removeListeners","_timeoutProcessing","_cancel","_prepareLoading","_disableLoading","pixelRatio","pixelRatio_","tilePixelRatio_","refresh","VectorLayer","Cluster","changed","showLoading","_isCanceled","_addDownloadCountListener","dim","widthPaper","heightPaper","opt_round","view","getUnits","METERS_PER_UNIT","getMapScale","_renderCompleteKey","domtoimage","catch","fit","nearest","increaseCount","_imageCount","_eventsKey","unByKey","hidePrintSettingsModal","createPdf","utils"],"mappings":"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","x_google_ignoreList":[0,5]}