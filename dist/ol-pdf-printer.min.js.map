{"version":3,"file":"ol-pdf-printer.min.js","sources":["../src/components/Helpers.ts","../src/components/MapElements/Legends.tsx","../src/myPragma.ts","../src/components/Pdf.tsx","../node_modules/modal-vanilla/lib/modal.js","../src/classnames.ts","../src/components/ReframeROI.tsx","../src/components/SettingsModal.tsx","../src/components/ProcessingModal.ts","../src/ol-pdf-printer.ts","../src/components/i18n/en.ts","../src/components/i18n/es.ts","../src/defaults.ts","../src/index-umd.ts"],"sourcesContent":["import Map from 'ol/Map.js';\r\nimport { METERS_PER_UNIT } from 'ol/proj/Units.js';\r\nimport ImageWMS from 'ol/source/ImageWMS.js';\r\nimport TileLayer from 'ol/layer/Tile.js';\r\nimport ImageLayer from 'ol/layer/Image.js';\r\nimport BaseLayer from 'ol/layer/Base.js';\r\nimport TileWMS from 'ol/source/TileWMS.js';\r\n\r\n/**\r\n *\r\n * @param map\r\n * @param opt_round\r\n * @returns\r\n * @protected\r\n */\r\nexport const getMapScale = (map: Map, opt_round = true): number => {\r\n    const dpi = 25.4 / 0.28;\r\n\r\n    const view = map.getView();\r\n    const unit = view.getProjection().getUnits();\r\n\r\n    const res = view.getResolutionForZoom(view.getZoom());\r\n\r\n    const inchesPerMetre = 39.37;\r\n\r\n    let scale = res * METERS_PER_UNIT[unit] * inchesPerMetre * dpi;\r\n\r\n    if (opt_round) {\r\n        scale = Math.round(scale);\r\n    }\r\n\r\n    return scale;\r\n};\r\n\r\n/**\r\n *\r\n * @param layer\r\n * @returns\r\n */\r\nexport const isWmsLayer = (layer: BaseLayer): boolean => {\r\n    return (\r\n        (layer instanceof ImageLayer || layer instanceof TileLayer) &&\r\n        (layer.getSource() instanceof TileWMS ||\r\n            layer.getSource() instanceof ImageWMS)\r\n    );\r\n};\r\n","import View from 'ol/View.js';\r\nimport Map from 'ol/Map.js';\r\nimport BaseLayer from 'ol/layer/Base.js';\r\nimport TileWMS from 'ol/source/TileWMS.js';\r\nimport ImageWMS from 'ol/source/ImageWMS.js';\r\nimport TileLayer from 'ol/layer/Tile.js';\r\nimport ImageLayer from 'ol/layer/Image.js';\r\nimport { appendParams } from 'ol/uri.js';\r\nimport { Projection } from 'ol/proj.js';\r\n\r\nimport { isWmsLayer } from '../Helpers';\r\n\r\nexport const legendsDefaultConfig = {\r\n    legendOptions: {\r\n        fontAntiAliasing: 'true',\r\n        fontColor: '0x000000',\r\n        bgColor: '0xffffff',\r\n        forceLabels: 'on',\r\n        forceTitles: 'on',\r\n        fontSize: 8\r\n    },\r\n    requestParams: {},\r\n    order: true\r\n};\r\n\r\nexport interface LegendsOptions {\r\n    /**\r\n     * To control legend appearance\r\n     * https://docs.geoserver.org/latest/en/user/services/wms/get_legend_graphic/index.html#controlling-legend-appearance-with-legend-options\r\n     */\r\n    legendOptions?: { [key: string]: string | number };\r\n\r\n    /**\r\n     * Extra params to add/overwrite the default `GetLegendGraphic` request\r\n     * https://docs.geoserver.org/latest/en/user/services/wms/get_legend_graphic/index.html#getlegendgraphic\r\n     */\r\n    requestParams?: { [key: string]: string };\r\n\r\n    /**\r\n     * Order control legends by layer zindex\r\n     * Default is `true`\r\n     */\r\n    order?: boolean;\r\n}\r\n\r\nexport default class Legends {\r\n    private _map: Map;\r\n    private _view: View;\r\n\r\n    private _legendOptions: { [key: string]: string | number } = {};\r\n    private _requestParams: { [key: string]: string } = {};\r\n\r\n    private _order: boolean;\r\n\r\n    constructor(options: LegendsOptions | true, map: Map) {\r\n        this._map = map;\r\n        this._view = map.getView();\r\n\r\n        this._legendOptions = legendsDefaultConfig.legendOptions;\r\n        this._requestParams = legendsDefaultConfig.requestParams;\r\n        this._order = legendsDefaultConfig.order;\r\n\r\n        if (typeof options === 'object') {\r\n            const { legendOptions, requestParams, order } = options;\r\n            this._legendOptions = {\r\n                ...this._legendOptions,\r\n                ...(legendOptions || {})\r\n            };\r\n            this._requestParams = {\r\n                ...this._requestParams,\r\n                ...(requestParams || {})\r\n            };\r\n            this._order = typeof order !== 'undefined' ? order : this._order;\r\n        }\r\n    }\r\n\r\n    public async getImages(\r\n        dpi: number,\r\n        txcolor: string,\r\n        bkcolor: string\r\n    ): Promise<HTMLImageElement[]> {\r\n        const images: HTMLImageElement[] = [];\r\n        const wmsLayers = this.getWmsLegendLayers();\r\n        this._legendOptions = {\r\n            ...this._legendOptions,\r\n            dpi,\r\n            fontColor: '0x' + txcolor.replace('#', ''),\r\n            bgColor: '0x' + bkcolor.replace('#', '')\r\n        };\r\n\r\n        for (const wmsLayer of wmsLayers) {\r\n            const image = await this._getLegends(wmsLayer);\r\n            if (image) {\r\n                images.push(image);\r\n            }\r\n        }\r\n\r\n        if (this._order && images.length) {\r\n            return this._orderImagesByIndex(images);\r\n        }\r\n\r\n        return images;\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @returns\r\n     */\r\n    public getWmsLegendLayers(): Array<\r\n        TileLayer<TileWMS> | ImageLayer<ImageWMS>\r\n    > {\r\n        return this._map\r\n            .getLayers()\r\n            .getArray()\r\n            .filter(\r\n                (layer) => isWmsLayer(layer) && layer.getVisible()\r\n            ) as Array<TileLayer<TileWMS> | ImageLayer<ImageWMS>>;\r\n    }\r\n\r\n    public getMapProjection(): Projection {\r\n        return this._view.getProjection();\r\n    }\r\n\r\n    public getViewExtent(): number[] {\r\n        return this._view.calculateExtent(this._map.getSize());\r\n    }\r\n\r\n    protected async _getLegends(layer: BaseLayer): Promise<HTMLImageElement> {\r\n        return new Promise((resolve) => {\r\n            const srcs = this._getSrcFromParams(layer);\r\n\r\n            if (!srcs) {\r\n                return resolve(null);\r\n            }\r\n\r\n            srcs.forEach((src) => {\r\n                const img = new Image();\r\n                // to enable reorder\r\n                img.dataset.index = String(layer.getZIndex());\r\n\r\n                img.onerror = () => {\r\n                    resolve(null);\r\n                };\r\n                img.onload = () => {\r\n                    // discard empty images\r\n                    if (img.naturalHeight <= 1) {\r\n                        resolve(null);\r\n                    } else {\r\n                        resolve(img);\r\n                    }\r\n                };\r\n                img.src = src;\r\n            });\r\n        });\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param layer\r\n     * @param inline\r\n     * @returns\r\n     */\r\n    protected _getSrcFromParams(layer): string[] {\r\n        const sourceParams = layer.getSource().getParams();\r\n\r\n        const proj = this.getMapProjection().getCode();\r\n\r\n        const params = {\r\n            SERVICE: 'WMS',\r\n            VERSION: '1.1.0',\r\n            REQUEST: 'GetLegendGraphic',\r\n            FORMAT: 'image/png',\r\n            LEGEND_OPTIONS: Object.entries(this._legendOptions)\r\n                .map((a) => `${a[0]}:${a[1]}`)\r\n                .join(';'),\r\n            STYLE: sourceParams.STYLES,\r\n            CQL_FILTER: sourceParams.CQL_FILTER,\r\n            SLD_BODY: sourceParams.SLD_BODY,\r\n            SLD: sourceParams.SLD,\r\n            ENV: sourceParams.ENV,\r\n            SRS: proj,\r\n            SRCWIDTH: this._map.getSize()[0],\r\n            SRCHEIGHT: this._map.getSize()[1],\r\n            SCALE: this._getScale(),\r\n            ...this._requestParams\r\n            // bug showing empty spaces betweeen labels\r\n            //TRANSPARENT: true\r\n        };\r\n\r\n        const layersName = sourceParams.LAYERS;\r\n        const layerNames = !Array.isArray(layersName)\r\n            ? layersName.split(',')\r\n            : layersName;\r\n\r\n        return [\r\n            this._getLegendUrl(layer.getSource() as TileWMS | ImageWMS, {\r\n                ...params,\r\n                LAYER: layerNames[0]\r\n            })\r\n        ];\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param source\r\n     * @param params\r\n     * @returns\r\n     */\r\n    protected _getLegendUrl(source: TileWMS | ImageWMS, params) {\r\n        const url =\r\n            'getUrls' in source\r\n                ? source.getUrls()[0]\r\n                : 'getUrl' in source\r\n                ? source.getUrl()\r\n                : undefined;\r\n\r\n        if (!url) return undefined;\r\n\r\n        return appendParams(url, params);\r\n    }\r\n\r\n    /**\r\n     *\r\n     */\r\n    protected _orderImagesByIndex(\r\n        images: HTMLImageElement[]\r\n    ): HTMLImageElement[] {\r\n        const t = Array.from(images).sort((x, y) => {\r\n            const xIndex = Number(x.dataset.index);\r\n            const yIndex = Number(y.dataset.index);\r\n            if (xIndex > yIndex) return -1;\r\n            if (xIndex < yIndex) return 1;\r\n            return 0;\r\n        });\r\n\r\n        return t.reverse();\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @returns\r\n     */\r\n    protected _getScale() {\r\n        const resolution = this._view.getResolution();\r\n        const mpu = this.getMapProjection()\r\n            ? this.getMapProjection().getMetersPerUnit()\r\n            : 1;\r\n        const pixelSize = 0.00028;\r\n        return (resolution * mpu) / pixelSize;\r\n    }\r\n}\r\n","export default function createElement(tagName, attrs = {}, ...children) {\r\n    if (typeof tagName === 'function') return tagName(attrs, children);\r\n\r\n    const elem =\r\n        tagName === null\r\n            ? new DocumentFragment()\r\n            : document.createElement(tagName);\r\n\r\n    Object.entries(attrs || {}).forEach(([name, value]) => {\r\n        if (\r\n            typeof value !== 'undefined' &&\r\n            value !== null &&\r\n            value !== undefined\r\n        ) {\r\n            if (name.startsWith('on') && name.toLowerCase() in window)\r\n                elem.addEventListener(name.toLowerCase().substr(2), value);\r\n            else {\r\n                if (name === 'className')\r\n                    elem.setAttribute('class', value.toString());\r\n                else if (name === 'htmlFor')\r\n                    elem.setAttribute('for', value.toString());\r\n                else elem.setAttribute(name, value.toString());\r\n            }\r\n        }\r\n    });\r\n\r\n    for (const child of children) {\r\n        if (!child) continue;\r\n        if (Array.isArray(child)) elem.append(...child);\r\n        else {\r\n            if (child.nodeType === undefined) elem.innerHTML += child;\r\n            else elem.appendChild(child);\r\n        }\r\n    }\r\n    return elem;\r\n}\r\n","import Map from 'ol/Map';\r\nimport View from 'ol/View.js';\r\nimport { getPointResolution } from 'ol/proj.js';\r\nimport { AttributionLike } from 'ol/source/Source';\r\n\r\nimport { jsPDF, TextOptionsLight } from 'jspdf';\r\nimport { getDocument, GlobalWorkerOptions, version } from 'pdfjs-dist';\r\n\r\nimport {\r\n    I18n,\r\n    Options,\r\n    IPrintOptions,\r\n    IWatermark,\r\n    IExtraInfo\r\n} from '../ol-pdf-printer';\r\nimport Legends from './MapElements/Legends';\r\n\r\nimport myPragma from '../myPragma';\r\n\r\n/**\r\n * @private\r\n */\r\nexport default class Pdf {\r\n    protected _pdf: IPdf;\r\n    protected _view: View;\r\n    protected _map: Map;\r\n    protected _scaleDenominator: number;\r\n    protected _legends: Legends;\r\n    protected _form: IPrintOptions;\r\n    protected _style: Options['style'];\r\n    protected _i18n: I18n;\r\n    protected _printingMargins: IMargins;\r\n    protected _accumulativeOffsetBottomLeft = 0;\r\n\r\n    protected _config: Options;\r\n\r\n    constructor(params: IPdfOptions) {\r\n        const { map, form, i18n, config, height, width, scaleResolution } =\r\n            params;\r\n\r\n        this._map = map;\r\n        this._view = map.getView();\r\n        this._form = form;\r\n        this._i18n = i18n;\r\n        this._config = config;\r\n\r\n        this._style = config.style;\r\n\r\n        if (this._form.safeMargins) {\r\n            this._printingMargins =\r\n                typeof config.style.paperMargin === 'number'\r\n                    ? {\r\n                          top: config.style.paperMargin,\r\n                          left: config.style.paperMargin,\r\n                          right: config.style.paperMargin,\r\n                          bottom: config.style.paperMargin\r\n                      }\r\n                    : config.style.paperMargin;\r\n        } else {\r\n            this._printingMargins = {\r\n                top: 0,\r\n                left: 0,\r\n                right: 0,\r\n                bottom: 0\r\n            };\r\n        }\r\n\r\n        this._pdf = this.create(\r\n            this._form.orientation,\r\n            this._form.format,\r\n            height,\r\n            width\r\n        );\r\n\r\n        this._scaleDenominator = this._calculateScaleDenominator(\r\n            this._form.resolution,\r\n            scaleResolution\r\n        );\r\n\r\n        if (config.mapElements && config.mapElements.legends) {\r\n            this._legends = new Legends(config.mapElements.legends, map);\r\n        }\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param orientation\r\n     * @param format\r\n     * @param width\r\n     * @param height\r\n     * @returns\r\n     * @protected\r\n     */\r\n    create(\r\n        orientation: IPrintOptions['orientation'],\r\n        format: IPrintOptions['format'],\r\n        height: number,\r\n        width: number\r\n    ): IPdf {\r\n        // UMD support\r\n        const _jsPDF =\r\n            (window as IWindow & typeof globalThis).jspdf?.jsPDF || jsPDF;\r\n\r\n        return {\r\n            doc: new _jsPDF({ orientation, format }),\r\n            height: height,\r\n            width: width\r\n        };\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param dataUrl\r\n     * @protected\r\n     */\r\n    addMapImage(dataUrl: string): void {\r\n        this._pdf.doc.addImage(\r\n            dataUrl,\r\n            'JPEG',\r\n            this._printingMargins.left, // Add margins\r\n            this._printingMargins.top,\r\n            this._pdf.width -\r\n                (this._printingMargins.left + this._printingMargins.right),\r\n            this._pdf.height -\r\n                (this._printingMargins.top + this._printingMargins.bottom)\r\n        );\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @protected\r\n     */\r\n    addMapHelpers = async (): Promise<void> => {\r\n        const { mapElements, extraInfo, description, watermark } = this._config;\r\n\r\n        if (watermark) {\r\n            await this._addWatermark(watermark);\r\n        }\r\n\r\n        if (description && this._form.description) {\r\n            this._addDescription();\r\n        }\r\n\r\n        if (extraInfo) {\r\n            this._addExtraInfo(extraInfo);\r\n        }\r\n\r\n        if (mapElements) {\r\n            if (mapElements.compass && this._form.compass) {\r\n                await this._addCompass(mapElements.compass);\r\n            }\r\n\r\n            if (mapElements.scalebar && this._form.scalebar) {\r\n                this._addScaleBar();\r\n            }\r\n\r\n            if (mapElements.attributions && this._form.attributions) {\r\n                this._addAttributions();\r\n            }\r\n\r\n            if (mapElements.legends && this._form.legends) {\r\n                await this._addLegends();\r\n            }\r\n        }\r\n\r\n        if (this._form.safeMargins) this._fllWhite();\r\n    };\r\n\r\n    /**\r\n     * @protected\r\n     */\r\n    savePdf(): Promise<void> {\r\n        const downloadURI = (uri: string, name: string): void => {\r\n            const link = <a download={name} href={uri}></a>;\r\n            document.body.appendChild(link);\r\n            link.click();\r\n            document.body.removeChild(link);\r\n        };\r\n\r\n        return new Promise((resolve, reject) => {\r\n            if (this._form.typeExport === 'pdf') {\r\n                this._pdf.doc.save(this._config.filename + '.pdf');\r\n                resolve();\r\n            } else {\r\n                const pdf = this._pdf.doc.output('dataurlstring');\r\n\r\n                // UMD support\r\n                const versionPdfJS =\r\n                    (window as IWindow & typeof globalThis)?.pdfjsLib\r\n                        ?.version || version;\r\n\r\n                GlobalWorkerOptions.workerSrc = `https://cdnjs.cloudflare.com/ajax/libs/pdf.js/${versionPdfJS}/pdf.worker.js`;\r\n\r\n                getDocument(pdf).promise.then(\r\n                    (pdf) => {\r\n                        pdf.getPage(1).then((page) => {\r\n                            // transform DPI correctly\r\n                            const scale = (this._form.resolution / 100) * 1.39;\r\n\r\n                            const viewport = page.getViewport({ scale });\r\n\r\n                            // Prepare canvas\r\n                            const canvas = <canvas />;\r\n                            canvas.style.display = 'none';\r\n                            document.body.appendChild(canvas);\r\n                            const context = canvas.getContext('2d');\r\n                            canvas.height = viewport.height;\r\n                            canvas.width = viewport.width;\r\n\r\n                            // Render PDF page into canvas context\r\n                            const task = page.render({\r\n                                canvasContext: context,\r\n                                viewport: viewport\r\n                            });\r\n                            task.promise.then(() => {\r\n                                downloadURI(\r\n                                    canvas.toDataURL(\r\n                                        `image/${this._form.typeExport}`\r\n                                    ),\r\n                                    this._config.filename +\r\n                                        `.${this._form.typeExport}`\r\n                                );\r\n                                canvas.remove();\r\n                                resolve();\r\n                            });\r\n                        });\r\n                    },\r\n                    (error: Error) => {\r\n                        reject(error);\r\n                        console.log(error);\r\n                    }\r\n                );\r\n            }\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Add white rectangles to hide elements outside the map\r\n     */\r\n    protected _fllWhite(): void {\r\n        this._pdf.doc.setFillColor('#ffffff');\r\n        this._pdf.doc.rect(\r\n            0,\r\n            0,\r\n            this._printingMargins.left,\r\n            this._pdf.height,\r\n            'F'\r\n        );\r\n        this._pdf.doc.rect(\r\n            this._pdf.width - this._printingMargins.right,\r\n            0,\r\n            this._printingMargins.right,\r\n            this._pdf.height,\r\n            'F'\r\n        );\r\n        this._pdf.doc.rect(\r\n            0,\r\n            0,\r\n            this._pdf.width,\r\n            this._printingMargins.top,\r\n            'F'\r\n        );\r\n        this._pdf.doc.rect(\r\n            0,\r\n            this._pdf.height - this._printingMargins.bottom,\r\n            this._pdf.width,\r\n            this._printingMargins.bottom,\r\n            'F'\r\n        );\r\n    }\r\n\r\n    /**\r\n     * Convert an SVGElement to an PNG string\r\n     * @param svg\r\n     * @returns\r\n     */\r\n    _processSvgImage = (svg: SVGElement): Promise<string> => {\r\n        // https://stackoverflow.com/questions/3975499/convert-svg-to-image-jpeg-png-etc-in-the-browser#answer-58142441\r\n        return new Promise((resolve, reject) => {\r\n            const svgToPng = (svg: SVGElement, callback) => {\r\n                const url = getSvgUrl(svg);\r\n                svgUrlToPng(url, (imgData: string) => {\r\n                    callback(imgData);\r\n                    URL.revokeObjectURL(url);\r\n                });\r\n            };\r\n\r\n            const getSvgUrl = (svg: SVGElement) => {\r\n                const data = new XMLSerializer().serializeToString(svg);\r\n                return URL.createObjectURL(\r\n                    new Blob([data], { type: 'image/svg+xml' })\r\n                );\r\n            };\r\n\r\n            const svgUrlToPng = (svgUrl: string, callback) => {\r\n                const svgImage = document.createElement('img');\r\n                document.body.appendChild(svgImage);\r\n\r\n                svgImage.onerror = (err) => {\r\n                    console.error(err);\r\n                    return reject(this._i18n.errorImage);\r\n                };\r\n\r\n                svgImage.onload = () => {\r\n                    try {\r\n                        const canvas = document.createElement('canvas');\r\n                        canvas.width = svgImage.clientWidth;\r\n                        canvas.height = svgImage.clientHeight;\r\n                        const canvasCtx = canvas.getContext('2d');\r\n                        canvasCtx.drawImage(svgImage, 0, 0);\r\n                        const imgData = canvas\r\n                            .toDataURL('image/png')\r\n                            .replace('image/png', 'octet/stream');\r\n                        callback(imgData);\r\n                        document.body.removeChild(svgImage);\r\n                    } catch (err) {\r\n                        return reject(err);\r\n                    }\r\n                };\r\n                svgImage.src = svgUrl;\r\n            };\r\n\r\n            svgToPng(svg, (imgData: string) => {\r\n                resolve(imgData);\r\n            });\r\n        });\r\n    };\r\n\r\n    /**\r\n     * Adapted from http://hg.intevation.de/gemma/file/tip/client/src/components/Pdftool.vue#l252\r\n     * @protected\r\n     */\r\n    _calculateScaleDenominator(\r\n        resolution: number,\r\n        scaleResolution: number\r\n    ): number {\r\n        const pixelsPerMapMillimeter = resolution / 25.4;\r\n        return Math.round(\r\n            1000 *\r\n                pixelsPerMapMillimeter *\r\n                this._getMeterPerPixel(scaleResolution)\r\n        );\r\n    }\r\n\r\n    /**\r\n     * @protected\r\n     */\r\n    _getMeterPerPixel(scaleResolution: number): number {\r\n        const proj = this._view.getProjection();\r\n        return (\r\n            getPointResolution(proj, scaleResolution, this._view.getCenter()) *\r\n            proj.getMetersPerUnit()\r\n        );\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param position\r\n     * @param offset\r\n     * @param size\r\n     * @returns\r\n     * @protected\r\n     */\r\n    _calculateOffsetByPosition = (\r\n        position: string,\r\n        offset: { x: number; y: number },\r\n        size = 0\r\n    ): { x: number; y: number } => {\r\n        let x: number, y: number;\r\n\r\n        switch (position) {\r\n            case 'topleft':\r\n                x = offset.x + this._printingMargins.left;\r\n                y = offset.y + this._printingMargins.top + size;\r\n                break;\r\n\r\n            case 'topright':\r\n                x = this._pdf.width - offset.x - this._printingMargins.left;\r\n                y = offset.y + this._printingMargins.top + size;\r\n                break;\r\n\r\n            case 'bottomright':\r\n                x = this._pdf.width - offset.x - this._printingMargins.left;\r\n                y =\r\n                    this._pdf.height -\r\n                    offset.y -\r\n                    this._printingMargins.bottom -\r\n                    size;\r\n                break;\r\n\r\n            case 'bottomleft':\r\n                y =\r\n                    this._pdf.height -\r\n                    offset.y -\r\n                    this._printingMargins.bottom -\r\n                    size;\r\n                x = offset.x + this._printingMargins.left;\r\n                break;\r\n        }\r\n\r\n        return { x, y };\r\n    };\r\n\r\n    /**\r\n     *\r\n     * @param x\r\n     * @param y\r\n     * @param width\r\n     * @param height\r\n     * @param bkcolor\r\n     * @param brcolor\r\n     * @protected\r\n     */\r\n    _addRoundedBox = (\r\n        x: number,\r\n        y: number,\r\n        width: number,\r\n        height: number,\r\n        bkcolor: string,\r\n        brcolor: string\r\n    ): void => {\r\n        const rounding = 1;\r\n\r\n        this._pdf.doc.setDrawColor(brcolor);\r\n        this._pdf.doc.setFillColor(bkcolor);\r\n\r\n        this._pdf.doc.roundedRect(\r\n            x,\r\n            y,\r\n            width,\r\n            height,\r\n            rounding,\r\n            rounding,\r\n            'FD'\r\n        );\r\n    };\r\n\r\n    /**\r\n     *\r\n     * @param x\r\n     * @param y\r\n     * @param width\r\n     * @param fontSize\r\n     * @param color\r\n     * @param align\r\n     * @param str\r\n     * @protected\r\n     */\r\n    _addText = (\r\n        x: number,\r\n        y: number,\r\n        fontSize: number,\r\n        color: string,\r\n        align: TextOptionsLight['align'] = 'left',\r\n        str: string\r\n    ): void => {\r\n        this._pdf.doc.setTextColor(color);\r\n        this._pdf.doc.setFontSize(fontSize);\r\n\r\n        this._pdf.doc.text(str, x, y, {\r\n            align\r\n        });\r\n    };\r\n\r\n    /**\r\n     *\r\n     * @param position\r\n     * @param offset\r\n     * @param width\r\n     * @param fontSize\r\n     * @param color\r\n     * @param align\r\n     * @param str\r\n     * @protected\r\n     */\r\n    _addTextByOffset = (\r\n        position: string,\r\n        offset: { x: number; y: number },\r\n        width: number,\r\n        fontSize: number,\r\n        color: string,\r\n        align: TextOptionsLight['align'],\r\n        str: string\r\n    ): void => {\r\n        const { x, y } = this._calculateOffsetByPosition(position, offset);\r\n        const fixX = align === 'center' ? x - width / 2 : x;\r\n        this._addText(fixX, y, fontSize, color, align, str);\r\n    };\r\n\r\n    /**\r\n     * @protected\r\n     */\r\n    _addDescription = (): void => {\r\n        const str = this._form.description.trim();\r\n        const position = 'topleft';\r\n        const offset = {\r\n            x: -0.7,\r\n            y:\r\n                this._config.extraInfo &&\r\n                ((this._config.extraInfo.date && this._form.date) ||\r\n                    (this._config.extraInfo.specs && this._form.specs))\r\n                    ? 10\r\n                    : 2\r\n        };\r\n        const fontSize = 8;\r\n        const maxWidth = 50;\r\n\r\n        const paddingBack = 2;\r\n\r\n        const { x, y } = this._calculateOffsetByPosition(position, offset);\r\n\r\n        this._pdf.doc.setTextColor(this._style.description.txcolor);\r\n        this._pdf.doc.setFontSize(fontSize);\r\n\r\n        const { w, h } = this._pdf.doc.getTextDimensions(str, {\r\n            maxWidth,\r\n            fontSize\r\n        });\r\n\r\n        this._addRoundedBox(\r\n            x,\r\n            y,\r\n            w + paddingBack * 2,\r\n            h + paddingBack * 2,\r\n            this._style.description.bkcolor,\r\n            this._style.description.brcolor\r\n        );\r\n\r\n        this._pdf.doc.text(str, x + paddingBack, y + paddingBack * 2, {\r\n            align: 'left',\r\n            maxWidth\r\n        });\r\n    };\r\n\r\n    /**\r\n     * This function is a mess\r\n     * @returns\r\n     * @protected\r\n     */\r\n    _addWatermark = async (watermark: IWatermark): Promise<void> => {\r\n        const getImageElement = async (\r\n            image: string | SVGElement\r\n        ): Promise<HTMLImageElement> => {\r\n            let imgData: string;\r\n\r\n            if (typeof image === 'string') {\r\n                imgData = image;\r\n            } else if (image instanceof SVGElement) {\r\n                imgData = await this._processSvgImage(image);\r\n            } else {\r\n                throw this._i18n.errorImage;\r\n            }\r\n\r\n            return new Promise((resolve, reject) => {\r\n                const image = new Image();\r\n                image.onload = () => {\r\n                    try {\r\n                        resolve(image);\r\n                    } catch (err) {\r\n                        return reject(err);\r\n                    }\r\n                };\r\n                image.onerror = () => {\r\n                    return reject(this._i18n.errorImage);\r\n                };\r\n                image.src = imgData;\r\n            });\r\n        };\r\n\r\n        let logoImage: HTMLImageElement;\r\n\r\n        const position = 'topright';\r\n        const offset = { x: 2, y: 2 };\r\n        const fontSize = 14;\r\n\r\n        const logoSizeHeight = 12;\r\n        let logoSizeWidth: number;\r\n\r\n        const fontSizeSubtitle = fontSize / 1.8;\r\n\r\n        let back = false;\r\n\r\n        const { x, y } = this._calculateOffsetByPosition(position, offset);\r\n\r\n        const paddingBack = 2;\r\n\r\n        let marginRight = 0;\r\n\r\n        let backBoxHeight = paddingBack * 2;\r\n\r\n        let titleYPosition = y + paddingBack + 1.5;\r\n\r\n        let subtitleYPosition = y + paddingBack;\r\n\r\n        let logoSpace = 0;\r\n\r\n        if (watermark.logo) {\r\n            if (watermark.logo instanceof Image) {\r\n                logoImage = watermark.logo;\r\n            } else {\r\n                logoImage = await getImageElement(watermark.logo);\r\n            }\r\n\r\n            const aspectRatio = logoImage.width / logoImage.height;\r\n\r\n            logoSizeWidth = logoSizeHeight * aspectRatio;\r\n\r\n            // space between text and logo\r\n            logoSpace = 3;\r\n\r\n            marginRight = logoSizeWidth + logoSpace;\r\n\r\n            backBoxHeight += 14;\r\n\r\n            if (watermark.title) {\r\n                titleYPosition += 4;\r\n                subtitleYPosition += 2;\r\n            }\r\n\r\n            if (watermark.subtitle) {\r\n                subtitleYPosition += 5;\r\n                titleYPosition -= 2;\r\n            }\r\n        } else {\r\n            if (watermark.title) {\r\n                backBoxHeight += 5;\r\n                subtitleYPosition += 5;\r\n            }\r\n\r\n            if (watermark.subtitle) {\r\n                backBoxHeight += 3;\r\n            }\r\n\r\n            if (watermark.title && watermark.subtitle) {\r\n                backBoxHeight += 1;\r\n            }\r\n        }\r\n\r\n        if (watermark.title) {\r\n            this._pdf.doc.setTextColor(this._style.watermark.txcolortitle);\r\n            this._pdf.doc.setFontSize(fontSize);\r\n            this._pdf.doc.setFont('helvetica', 'bold');\r\n\r\n            let { w } = this._pdf.doc.getTextDimensions(watermark.title);\r\n\r\n            if (watermark.subtitle) {\r\n                this._pdf.doc.setFontSize(fontSizeSubtitle);\r\n                this._pdf.doc.setFont('helvetica', 'normal');\r\n                const wSub = this._pdf.doc.getTextDimensions(\r\n                    watermark.subtitle\r\n                ).w;\r\n                w = wSub > w ? wSub : w;\r\n                this._pdf.doc.setFontSize(fontSize);\r\n            }\r\n\r\n            // Adaptable width, fixed height\r\n            const widthBack = w + paddingBack * 2;\r\n\r\n            this._addRoundedBox(\r\n                x - widthBack + 2 - marginRight,\r\n                y - 4,\r\n                widthBack + paddingBack + marginRight + logoSpace,\r\n                backBoxHeight,\r\n                this._style.watermark.bkcolor,\r\n                this._style.watermark.brcolor\r\n            );\r\n            back = true;\r\n            this._pdf.doc.setFont('helvetica', 'bold');\r\n            this._pdf.doc.text(\r\n                watermark.title,\r\n                x - marginRight,\r\n                titleYPosition,\r\n                {\r\n                    align: 'right'\r\n                }\r\n            );\r\n        }\r\n\r\n        if (watermark.subtitle) {\r\n            this._pdf.doc.setTextColor(this._style.watermark.txcolorsubtitle);\r\n            this._pdf.doc.setFontSize(fontSizeSubtitle);\r\n            this._pdf.doc.setFont('helvetica', 'normal');\r\n\r\n            // only subtitle, no title\r\n            if (!back) {\r\n                const { w } = this._pdf.doc.getTextDimensions(\r\n                    watermark.subtitle\r\n                );\r\n                const widthBack = paddingBack * 2 + w;\r\n                this._addRoundedBox(\r\n                    x - widthBack + 2 - marginRight,\r\n                    y - 4,\r\n                    widthBack + paddingBack + marginRight,\r\n                    backBoxHeight,\r\n                    this._style.watermark.bkcolor,\r\n                    this._style.watermark.brcolor\r\n                );\r\n                back = true;\r\n            }\r\n\r\n            this._pdf.doc.text(\r\n                watermark.subtitle,\r\n                x - marginRight,\r\n                subtitleYPosition,\r\n                {\r\n                    align: 'right'\r\n                }\r\n            );\r\n        }\r\n\r\n        if (!watermark.logo) return;\r\n\r\n        if (!back) {\r\n            const widthBack = marginRight + paddingBack;\r\n            this._addRoundedBox(\r\n                x,\r\n                y - 4,\r\n                widthBack,\r\n                16,\r\n                this._style.watermark.bkcolor,\r\n                this._style.watermark.brcolor\r\n            );\r\n        }\r\n\r\n        this._pdf.doc.addImage(\r\n            logoImage,\r\n            'PNG',\r\n            x - logoSizeWidth,\r\n            y,\r\n            logoSizeWidth,\r\n            logoSizeHeight\r\n        );\r\n    };\r\n\r\n    /**\r\n     * Info displayed at the bottom of the map\r\n     * @protected\r\n     */\r\n    protected _addExtraInfo = (extraInfo: IExtraInfo): void => {\r\n        if (extraInfo.url && this._form.url) {\r\n            this._addUrl();\r\n        }\r\n\r\n        if (\r\n            (extraInfo.specs && this._form.specs) ||\r\n            (extraInfo.date && this._form.date)\r\n        ) {\r\n            this._addSpecsAndDate();\r\n        }\r\n    };\r\n\r\n    /**\r\n     * @protected\r\n     */\r\n    protected _addSpecsAndDate = (): void => {\r\n        const position = 'topleft';\r\n        const offset = {\r\n            x: 1,\r\n            y: 2.5\r\n        };\r\n        const fontSize = 6;\r\n        const txcolor = this._style.specs.txcolor;\r\n        const align = 'left';\r\n\r\n        const { x, y } = this._calculateOffsetByPosition(position, offset);\r\n\r\n        this._pdf.doc.setFont('helvetica', 'bold');\r\n        this._pdf.doc.setFontSize(fontSize);\r\n\r\n        let str = '';\r\n\r\n        if (\r\n            this._form.specs &&\r\n            this._config.extraInfo &&\r\n            this._config.extraInfo.specs\r\n        ) {\r\n            const scale = `${\r\n                this._i18n.scale\r\n            } 1:${this._scaleDenominator.toLocaleString('de')}`;\r\n            const paper = `${\r\n                this._i18n.paper\r\n            } ${this._form.format.toUpperCase()}`;\r\n            const dpi = `${this._form.resolution} DPI`;\r\n            const specs = [scale, dpi, paper];\r\n            str = specs.join(' - ');\r\n        }\r\n\r\n        if (\r\n            this._form.date &&\r\n            this._config.extraInfo &&\r\n            this._config.extraInfo.date\r\n        ) {\r\n            const date = this._getDate();\r\n\r\n            if (str) {\r\n                str += ` (${date})`;\r\n            } else {\r\n                str = date;\r\n            }\r\n        }\r\n\r\n        const { w, h } = this._pdf.doc.getTextDimensions(str, { fontSize });\r\n\r\n        const paddingBack = 2;\r\n\r\n        this._addRoundedBox(\r\n            x - paddingBack * 2,\r\n            y - h - paddingBack * 2,\r\n            w + paddingBack * 3,\r\n            h + paddingBack * 3,\r\n            this._style.specs.bkcolor,\r\n            this._style.specs.brcolor\r\n        );\r\n\r\n        this._addTextByOffset(\r\n            position,\r\n            offset,\r\n            w,\r\n            fontSize,\r\n            txcolor,\r\n            align,\r\n            str\r\n        );\r\n    };\r\n\r\n    /**\r\n     * @protected\r\n     */\r\n    protected _addUrl = (): void => {\r\n        const position = 'bottomleft';\r\n        const width = 250;\r\n        const offset = {\r\n            x: 1,\r\n            y: 1\r\n        };\r\n\r\n        const fontSize = 6;\r\n        const txcolor = this._style.url.txcolor;\r\n        const align = 'left';\r\n\r\n        this._pdf.doc.setFont('helvetica', 'italic');\r\n        const str = window.location.href;\r\n\r\n        const { x, y } = this._calculateOffsetByPosition(position, offset);\r\n\r\n        const { w, h } = this._pdf.doc.getTextDimensions(str, {\r\n            fontSize\r\n        });\r\n\r\n        const paddingBack = 2;\r\n\r\n        this._addRoundedBox(\r\n            x - paddingBack * 2,\r\n            y - h - 1,\r\n            w + paddingBack * 3,\r\n            h + paddingBack * 3,\r\n            this._style.url.bkcolor,\r\n            this._style.url.brcolor\r\n        );\r\n\r\n        this._addTextByOffset(\r\n            position,\r\n            offset,\r\n            width,\r\n            fontSize,\r\n            txcolor,\r\n            align,\r\n            str\r\n        );\r\n\r\n        this._accumulativeOffsetBottomLeft = offset.y + h + 1;\r\n    };\r\n\r\n    /**\r\n     * @protected\r\n     */\r\n    protected _getDate = (): string => {\r\n        return String(\r\n            new Date(Date.now()).toLocaleDateString(this._config.dateFormat)\r\n        );\r\n    };\r\n\r\n    /**\r\n     * The attributions are obtained from the Control in the DOM.\r\n     * @protected\r\n     */\r\n    protected _addAttributions = (): void => {\r\n        const createNode = (content: string): HTMLElement => {\r\n            return <span>{content}</span>;\r\n        };\r\n\r\n        const attributions: string[] = this._map\r\n            .getLayers()\r\n            .getArray()\r\n            .flatMap((l) => {\r\n                if ('getSource' in l && typeof l.getSource === 'function') {\r\n                    const attr = l\r\n                        .getSource()\r\n                        .getAttributions() as AttributionLike;\r\n                    if (attr) {\r\n                        if (typeof attr === 'function') {\r\n                            try {\r\n                                return attr(null);\r\n                            } catch (err) {\r\n                                console.error(err);\r\n                            }\r\n                        }\r\n                        return attr as string | string[];\r\n                    }\r\n                }\r\n                return [];\r\n            });\r\n\r\n        if (!attributions.length) return;\r\n\r\n        // remove duplicates and create nodes\r\n        const attributionsList = [...new Set(attributions)].map((a) => {\r\n            return createNode(a);\r\n        });\r\n\r\n        const ATTRI_SEPATATOR = ' Â· ';\r\n\r\n        const position = 'bottomright';\r\n        const offset = { x: 1, y: 1 };\r\n        const fontSize = 7;\r\n\r\n        this._pdf.doc.setFont('helvetica', 'normal');\r\n        this._pdf.doc.setFontSize(fontSize);\r\n        const { x, y } = this._calculateOffsetByPosition(position, offset);\r\n\r\n        let xPos = x;\r\n\r\n        const attributionsText = attributionsList\r\n            .map((a) => a.textContent)\r\n            .join(ATTRI_SEPATATOR);\r\n\r\n        const { w, h } = this._pdf.doc.getTextDimensions(attributionsText, {\r\n            fontSize\r\n        });\r\n\r\n        const paddingBack = 4;\r\n\r\n        const whiteSpaceWidth = this._pdf.doc.getTextDimensions(\r\n            ATTRI_SEPATATOR,\r\n            { fontSize }\r\n        ).w;\r\n\r\n        this._addRoundedBox(\r\n            x - w - 2,\r\n            y - h,\r\n            w + paddingBack + 2,\r\n            h + paddingBack,\r\n            this._style.attributions.bkcolor,\r\n            this._style.attributions.brcolor\r\n        );\r\n\r\n        Array.from(attributionsList)\r\n            .reverse()\r\n            .forEach((attribution, index) => {\r\n                Array.from(attribution.childNodes)\r\n                    .reverse()\r\n                    .forEach((node) => {\r\n                        const content = node.textContent;\r\n\r\n                        if ('href' in node) {\r\n                            this._pdf.doc.setTextColor(\r\n                                this._style.attributions.txcolorlink\r\n                            );\r\n                            this._pdf.doc.textWithLink(content, xPos, y, {\r\n                                align: 'right',\r\n                                url: (node as HTMLAnchorElement).href\r\n                            });\r\n                        } else {\r\n                            this._pdf.doc.setTextColor(\r\n                                this._style.attributions.txcolor\r\n                            );\r\n                            this._pdf.doc.text(content, xPos, y, {\r\n                                align: 'right'\r\n                            });\r\n                        }\r\n\r\n                        const { w } = this._pdf.doc.getTextDimensions(content);\r\n                        xPos -= w;\r\n                    });\r\n\r\n                // Excldue last element\r\n                if (index !== attributionsList.length - 1) {\r\n                    // To add separation between diferents attributtions\r\n                    this._pdf.doc.text(ATTRI_SEPATATOR, xPos, y, {\r\n                        align: 'right'\r\n                    });\r\n\r\n                    xPos -= whiteSpaceWidth;\r\n                }\r\n            });\r\n    };\r\n\r\n    /**\r\n     * Adapted from http://hg.intevation.de/gemma/file/tip/client/src/components/Pdftool.vue#l252\r\n     * @protected\r\n     */\r\n    protected _addScaleBar = (): void => {\r\n        const offset = {\r\n            x: -0.7,\r\n            y:\r\n                this._config.extraInfo &&\r\n                ((this._form.url && this._config.extraInfo.url) ||\r\n                    (this._form.specs && this._config.extraInfo.specs))\r\n                    ? this._accumulativeOffsetBottomLeft + 12\r\n                    : 12\r\n        };\r\n\r\n        const position = 'bottomleft';\r\n\r\n        const { x, y } = this._calculateOffsetByPosition(position, offset);\r\n\r\n        const maxWidth = 90; // in mm\r\n\r\n        // from https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Math/log10#Polyfill\r\n        const log10 =\r\n            Math.log10 || // more precise, but unsupported by IE\r\n            function (x) {\r\n                return Math.log(x) * Math.LOG10E;\r\n            };\r\n\r\n        let maxLength = maxWidth * this._scaleDenominator;\r\n\r\n        let unit: string;\r\n        let unitConversionFactor: number;\r\n\r\n        if (this._config.units === 'metric') {\r\n            unit = 'mm';\r\n\r\n            const millimetre = 1;\r\n            const metre = 1000;\r\n            const kilometre = metre * 1000;\r\n\r\n            unitConversionFactor = millimetre;\r\n\r\n            if (maxLength >= kilometre * 10) {\r\n                unit = 'km';\r\n                unitConversionFactor = 1e6;\r\n            } else if (maxLength >= metre * 10) {\r\n                unit = 'm';\r\n                unitConversionFactor = metre;\r\n            }\r\n        } else if (this._config.units === 'imperial') {\r\n            const inch = 25.4; // Millimetre to inch\r\n            const mile = inch * 63360;\r\n            const yard = inch * 36;\r\n\r\n            unit = 'in';\r\n            unitConversionFactor = inch;\r\n\r\n            if (maxLength >= mile * 10) {\r\n                unit = 'mi';\r\n                unitConversionFactor = mile;\r\n            } else if (maxLength >= yard * 10) {\r\n                unit = 'yd';\r\n                unitConversionFactor = yard;\r\n            }\r\n        }\r\n\r\n        maxLength /= unitConversionFactor;\r\n\r\n        const unroundedLength = maxLength;\r\n\r\n        const numberOfDigits = Math.floor(log10(unroundedLength));\r\n        const factor = Math.pow(10, numberOfDigits);\r\n        const mapped = unroundedLength / factor;\r\n\r\n        let length = Math.floor(maxLength); // just to have an upper limit\r\n\r\n        // manually only use numbers that are very nice to devide by 4\r\n        // note that this is taken into account for rounding later\r\n        if (mapped > 8) {\r\n            length = 8 * factor;\r\n        } else if (mapped > 4) {\r\n            length = 4 * factor;\r\n        } else if (mapped > 2) {\r\n            length = 2 * factor;\r\n        } else {\r\n            length = factor;\r\n        }\r\n\r\n        let size = (length * unitConversionFactor) / this._scaleDenominator / 4;\r\n\r\n        const percentageMargin = this._form.safeMargins\r\n            ? ((this._printingMargins.left + this._printingMargins.right) /\r\n                  this._pdf.width) *\r\n              100\r\n            : null;\r\n\r\n        // Reduce length acording to margins\r\n        size = percentageMargin\r\n            ? (size / 100) * (100 - percentageMargin)\r\n            : size;\r\n\r\n        const fullSize = size * 4;\r\n\r\n        // to give the outer white box 4mm padding\r\n        const scaleBarX = x + 4;\r\n        const scaleBarY = y + 5; // 5, a little more, to make space for the numbers above\r\n\r\n        // draw outer box\r\n        this._addRoundedBox(\r\n            x,\r\n            y,\r\n            fullSize + 8,\r\n            10,\r\n            this._style.scalebar.bkcolor,\r\n            this._style.scalebar.brcolor\r\n        );\r\n\r\n        // draw first part of scalebar\r\n        this._pdf.doc.setDrawColor(this._style.scalebar.txcolor);\r\n        this._pdf.doc.setFillColor(this._style.scalebar.txcolor);\r\n        this._pdf.doc.rect(scaleBarX, scaleBarY, size, 1, 'FD');\r\n\r\n        // draw second part of scalebar\r\n        this._pdf.doc.setDrawColor(this._style.scalebar.txcolor);\r\n        this._pdf.doc.setFillColor(this._style.scalebar.bkcolor);\r\n        this._pdf.doc.rect(scaleBarX + size, scaleBarY, size, 1, 'FD');\r\n\r\n        // draw third part of scalebar\r\n        this._pdf.doc.setDrawColor(this._style.scalebar.txcolor);\r\n        this._pdf.doc.setFillColor(this._style.scalebar.txcolor);\r\n        this._pdf.doc.rect(scaleBarX + size * 2, scaleBarY, size * 2, 1, 'FD');\r\n\r\n        // draw numeric labels above scalebar\r\n        this._pdf.doc.setTextColor(this._style.scalebar.txcolor);\r\n        this._pdf.doc.setFontSize(6);\r\n        this._pdf.doc.text('0', scaleBarX, scaleBarY - 1);\r\n        // /4 and could give 2.5. We still round, because of floating point arith\r\n        this._pdf.doc.text(\r\n            String(Math.round((length * 10) / 4) / 10),\r\n            scaleBarX + size - 1,\r\n            scaleBarY - 1\r\n        );\r\n        this._pdf.doc.text(\r\n            String(Math.round(length / 2)),\r\n            scaleBarX + size * 2 - 2,\r\n            scaleBarY - 1\r\n        );\r\n        this._pdf.doc.text(\r\n            Math.round(length).toString() + ' ' + unit,\r\n            scaleBarX + size * 4 - 4,\r\n            scaleBarY - 1\r\n        );\r\n\r\n        this._accumulativeOffsetBottomLeft = offset.y;\r\n    };\r\n\r\n    /**\r\n     *\r\n     * @param imgSrc\r\n     * @returns\r\n     * @protected\r\n     */\r\n    protected _addCompass = async (\r\n        imgSrc: HTMLImageElement | string | SVGElement\r\n    ): Promise<void> => {\r\n        const position = 'bottomright';\r\n        const offset = { x: 2, y: 6 };\r\n        const size = 6;\r\n        const rotationRadians = this._view.getRotation();\r\n        const imageSize = 100;\r\n\r\n        const { x, y } = this._calculateOffsetByPosition(\r\n            position,\r\n            offset,\r\n            size\r\n        );\r\n\r\n        const addRotation = (image: CanvasImageSource) => {\r\n            const canvas = document.createElement('canvas');\r\n\r\n            // Must be bigger than the image to prevent clipping\r\n            canvas.height = 120;\r\n            canvas.width = 120;\r\n            const context = canvas.getContext('2d');\r\n\r\n            context.translate(canvas.width * 0.5, canvas.height * 0.5);\r\n            context.rotate(rotationRadians);\r\n            context.translate(-canvas.width * 0.5, -canvas.height * 0.5);\r\n            context.drawImage(\r\n                image,\r\n                (canvas.height - imageSize) / 2,\r\n                (canvas.width - imageSize) / 2,\r\n                imageSize,\r\n                imageSize\r\n            );\r\n\r\n            // Add back circle\r\n            const xCircle = x - size;\r\n            const yCircle = y;\r\n            this._pdf.doc.setDrawColor(this._style.compass.brcolor);\r\n            this._pdf.doc.setFillColor(this._style.compass.bkcolor);\r\n            this._pdf.doc.circle(xCircle, yCircle, size, 'FD');\r\n\r\n            return canvas;\r\n        };\r\n\r\n        const addImage = (image: CanvasImageSource): void => {\r\n            const rotatedCanvas = addRotation(image);\r\n\r\n            const sizeImage = size * 1.5;\r\n            const xImage = x - sizeImage - size / 4.3;\r\n            const yImage = y - sizeImage / 2;\r\n\r\n            this._pdf.doc.addImage(\r\n                rotatedCanvas,\r\n                'PNG',\r\n                xImage,\r\n                yImage,\r\n                sizeImage,\r\n                sizeImage\r\n            );\r\n        };\r\n\r\n        let image: HTMLImageElement;\r\n\r\n        if (imgSrc instanceof Image) {\r\n            addImage(image);\r\n            return;\r\n        } else {\r\n            let imgData: string;\r\n\r\n            if (typeof imgSrc === 'string') {\r\n                imgData = imgSrc;\r\n            } else if (imgSrc instanceof SVGElement) {\r\n                imgData = await this._processSvgImage(imgSrc);\r\n            } else {\r\n                throw this._i18n.errorImage;\r\n            }\r\n\r\n            return new Promise((resolve, reject) => {\r\n                const image = new Image(imageSize, imageSize);\r\n\r\n                image.onload = () => {\r\n                    addImage(image);\r\n                    resolve();\r\n                };\r\n\r\n                image.onerror = () => {\r\n                    reject(this._i18n.errorImage);\r\n                };\r\n\r\n                image.src = imgData;\r\n            });\r\n        }\r\n    };\r\n\r\n    protected async _addLegends() {\r\n        const position = 'bottomleft';\r\n\r\n        const offset = {\r\n            x: 1,\r\n            y: this._accumulativeOffsetBottomLeft + 3\r\n        };\r\n\r\n        const { x, y } = this._calculateOffsetByPosition(position, offset);\r\n\r\n        let yPos = y;\r\n\r\n        const images: HTMLImageElement[] = await this._legends.getImages(\r\n            this._form.resolution * 1.5,\r\n            this._style.legends.txcolor,\r\n            this._style.legends.bkcolor\r\n        );\r\n\r\n        if (!images.length) {\r\n            return;\r\n        }\r\n\r\n        const ratioSize = 1 / (this._form.resolution / 15);\r\n\r\n        const largestWidth =\r\n            Math.max(...images.map((i) => i.naturalWidth)) * ratioSize;\r\n        const accumulativeHeight = images.reduce(\r\n            (acc, curr) => acc + curr.naturalHeight * ratioSize,\r\n            0\r\n        );\r\n\r\n        const paddingBack = 1;\r\n\r\n        this._addRoundedBox(\r\n            x - paddingBack * 3,\r\n            y - accumulativeHeight - paddingBack,\r\n            largestWidth + paddingBack * 2 * 3,\r\n            accumulativeHeight + paddingBack * 2,\r\n            this._style.legends.bkcolor,\r\n            this._style.legends.brcolor\r\n        );\r\n\r\n        images.forEach((img) => {\r\n            const { naturalWidth, naturalHeight } = img;\r\n            const width = naturalWidth * ratioSize;\r\n            const height = naturalHeight * ratioSize;\r\n            this._pdf.doc.addImage(img, x, yPos - height, width, height);\r\n            yPos -= height;\r\n        });\r\n    }\r\n}\r\n\r\n/**\r\n * **_[interface]_**\r\n * @protected\r\n */\r\ninterface IMargins {\r\n    top: number;\r\n    right: number;\r\n    bottom: number;\r\n    left: number;\r\n}\r\n\r\n/**\r\n * **_[interface]_**\r\n * @protected\r\n */\r\ninterface IWindow extends Window {\r\n    jspdf: any;\r\n    pdfjsLib: any;\r\n}\r\n\r\n/**\r\n * **_[interface]_**\r\n * @protected\r\n */\r\nexport interface IPdf {\r\n    doc: jsPDF;\r\n    width: number;\r\n    height: number;\r\n}\r\n\r\ninterface IPdfOptions {\r\n    map: Map;\r\n    form: IPrintOptions;\r\n    i18n: I18n;\r\n    config: Options;\r\n    height: number;\r\n    width: number;\r\n    scaleResolution: number;\r\n}\r\n","/**\n * Vanilla JS Modal compatible with Bootstrap\n * modal-vanilla 0.12.0 <https://github.com/KaneCohen/modal-vanilla>\n * Copyright 2020 Kane Cohen <https://github.com/KaneCohen>\n * Available under BSD-3-Clause license\n */\nimport EventEmitter from 'events';\n\nlet _factory = null;\n\nconst _defaults = Object.freeze({\n  el: null,               // Existing DOM element that will be 'Modal-ized'.\n  animate: true,          // Show Modal using animation.\n  animateClass: 'fade',   //\n  animateInClass: 'show', //\n  appendTo: 'body',       // DOM element to which constructed Modal will be appended.\n  backdrop: true,         // Boolean or 'static', Show Modal backdrop blocking content.\n  keyboard: true,         // Close modal on esc key.\n  title: false,           // Content of the title in the constructed dialog.\n  header: true,           // Show header content.\n  content: false,         // Either string or an HTML element.\n  footer: true,           // Footer content. By default will use buttons.\n  buttons: null,          //\n  headerClose: true,      // Show close button in the header.\n  construct: false,       // Creates new HTML with a given content.\n  transition: 300,        //\n  backdropTransition: 150 //\n});\n\nconst _buttons = deepFreeze({\n  dialog: [\n    {text: 'Cancel',\n      value: false,\n      attr: {\n        'class': 'btn btn-default',\n        'data-dismiss': 'modal'\n      }\n    },\n    {text: 'OK',\n      value: true,\n      attr: {\n        'class': 'btn btn-primary',\n        'data-dismiss': 'modal'\n      }\n    }\n  ],\n  alert: [\n    {text: 'OK',\n      attr: {\n        'class': 'btn btn-primary',\n        'data-dismiss': 'modal'\n      }\n    }\n  ],\n  confirm: [\n    {text: 'Cancel',\n      value: false,\n      attr: {\n        'class': 'btn btn-default',\n        'data-dismiss': 'modal'\n      }\n    },\n    {text: 'OK',\n      value: true,\n      attr: {\n        'class': 'btn btn-primary',\n        'data-dismiss': 'modal'\n      }\n    }\n  ]\n});\n\nconst _templates = {\n  container: '<div class=\"modal\"></div>',\n  dialog: '<div class=\"modal-dialog\"></div>',\n  content: '<div class=\"modal-content\"></div>',\n  header: '<div class=\"modal-header\"></div>',\n  headerClose: '<button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Close\"><span aria-hidden=\"true\">Ã</span></button>',\n  body: '<div class=\"modal-body\"></div>',\n  footer: '<div class=\"modal-footer\"></div>',\n  backdrop: '<div class=\"modal-backdrop\"></div>'\n};\n\nfunction deepFreeze(obj) {\n  for (let k in obj) {\n    if (Array.isArray(obj[k])) {\n      obj[k].forEach(v => {\n        deepFreeze(v);\n      });\n    } else if (obj[k] !== null && typeof obj[k] === 'object') {\n      Object.freeze(obj[k]);\n    }\n  }\n  return Object.freeze(obj);\n}\n\nfunction guid() {\n  return (((1 + Math.random()) * 0x10000) | 0).toString(16) +\n    (((1 + Math.random()) * 0x10000) | 0).toString(16);\n}\n\nfunction data(el, prop, value) {\n let prefix = 'data';\n let elData = el[prefix] || {};\n if (typeof value === 'undefined') {\n   if (el[prefix] && el[prefix][prop]) {\n     return el[prefix][prop];\n   } else {\n     var dataAttr = el.getAttribute(`${prefix}-${prop}`);\n     if (typeof dataAttr !== 'undefined') {\n       return dataAttr;\n     }\n     return null;\n   }\n } else {\n   elData[prop] = value;\n   el[prefix] = elData;\n   return el;\n }\n}\n\nfunction build(html, all) {\n  if (html.nodeName) return html;\n  html = html.replace(/(\\t|\\n$)/g, '');\n\n  if (!_factory) {\n    _factory = document.createElement('div');\n  }\n\n  _factory.innerHTML = '';\n  _factory.innerHTML = html;\n  if (all === true) {\n    return _factory.childNodes;\n  } else {\n    return _factory.childNodes[0];\n  }\n}\n\nfunction calcScrollbarWidth() {\n  let inner;\n  let width;\n  let outerWidth;\n  let outer = document.createElement('div');\n  Object.assign(outer.style, {\n    visibility: 'hidden',\n    width: '100px'\n  });\n  document.body.appendChild(outer);\n\n  outerWidth = outer.offsetWidth;\n  outer.style.overflow = 'scroll';\n\n  inner = document.createElement('div');\n  inner.style.width = '100%';\n  outer.appendChild(inner);\n\n  width = outerWidth - inner.offsetWidth;\n  document.body.removeChild(outer);\n\n  return width;\n}\n\nfunction getPath(node) {\n  let nodes = [node];\n  while (node.parentNode) {\n    node = node.parentNode;\n    nodes.push(node);\n  }\n  return nodes;\n}\n\nclass Modal extends EventEmitter {\n  static set templates(templates) {\n    this._baseTemplates = templates;\n  }\n\n  static get templates() {\n    return Object.assign({}, _templates, Modal._baseTemplates || {});\n  }\n\n  static set buttons(buttons) {\n    this._baseButtons = buttons;\n  }\n\n  static get buttons() {\n    return Object.assign({}, _buttons, Modal._baseButtons || {});\n  }\n\n  static set options(options) {\n    this._baseOptions = options;\n  }\n\n  static get options() {\n    return Object.assign({}, _defaults, Modal._baseOptions || {});\n  }\n\n  static get version() {\n    return '0.12.0';\n  }\n\n  static alert(message, _options = {}) {\n    let options = Object.assign({},\n      _defaults,\n      {\n        title:  message,\n        content: false,\n        construct: true,\n        headerClose: false,\n        buttons: Modal.buttons.alert\n      },\n      _options\n    );\n\n    return new Modal(options);\n  }\n\n  static confirm(question, _options = {}) {\n    let options = Object.assign({},\n      _defaults,\n      {\n        title:  question,\n        content: false,\n        construct: true,\n        headerClose: false,\n        buttons: Modal.buttons.confirm\n      },\n      _options\n    );\n\n    return new Modal(options);\n  }\n\n  constructor(options = {}) {\n    super();\n\n    this.id = guid();\n    this.el = null;\n    this._html = {};\n    this._events = {};\n    this._visible = false;\n    this._pointerInContent = false;\n    this._options = Object.assign({}, Modal.options, options);\n    this._templates = Object.assign({}, Modal.templates, options.templates || {});\n    this._html.appendTo = document.querySelector(this._options.appendTo);\n    this._scrollbarWidth = calcScrollbarWidth();\n\n    if (this._options.buttons === null) {\n      this._options.buttons = Modal.buttons.dialog;\n    }\n\n    if (this._options.el) {\n      let el = this._options.el;\n      if (typeof this._options.el == 'string') {\n        el = document.querySelector(this._options.el);\n        if (! el) {\n          throw new Error(`Selector: DOM Element ${this._options.el} not found.`);\n        }\n      }\n      data(el, 'modal', this);\n      this.el = el;\n    } else {\n      this._options.construct = true;\n    }\n\n    if (this._options.construct) {\n      this._render();\n    } else {\n      this._mapDom();\n    }\n  }\n\n  _render() {\n    let html = this._html;\n    let o = this._options;\n    let t = this._templates;\n    let animate = o.animate ? o.animateClass : false;\n\n    html.container = build(t.container);\n    html.dialog = build(t.dialog);\n    html.content = build(t.content);\n    html.header = build(t.header);\n    html.headerClose = build(t.headerClose);\n    html.body = build(t.body);\n    html.footer = build(t.footer);\n    if (animate) html.container.classList.add(animate);\n\n    this._setHeader();\n    this._setContent();\n    this._setFooter();\n\n    this.el = html.container;\n\n    html.dialog.appendChild(html.content);\n    html.container.appendChild(html.dialog);\n\n    return this;\n  }\n\n  _mapDom() {\n    let html = this._html;\n    let o = this._options;\n\n    if (this.el.classList.contains(o.animateClass)) {\n      o.animate = true;\n    }\n\n    html.container = this.el;\n    html.dialog = this.el.querySelector('.modal-dialog');\n    html.content = this.el.querySelector('.modal-content');\n    html.header = this.el.querySelector('.modal-header');\n    html.headerClose = this.el.querySelector('.modal-header .close');\n    html.body = this.el.querySelector('.modal-body');\n    html.footer = this.el.querySelector('.modal-footer');\n\n    this._setHeader();\n    this._setContent();\n    this._setFooter();\n\n    return this;\n  }\n\n  _setHeader() {\n    let html = this._html;\n    let o = this._options;\n\n    if (o.header && html.header) {\n      if (o.title.nodeName) {\n        html.header.innerHTML = o.title.outerHTML;\n      } else if (typeof o.title === 'string') {\n        html.header.innerHTML = `<h4 class=\"modal-title\">${o.title}</h4>`;\n      }\n      // Add header close button only to constructed modals.\n      if (this.el === null && html.headerClose && o.headerClose) {\n        html.header.appendChild(html.headerClose);\n      }\n      if (o.construct) {\n        html.content.appendChild(html.header);\n      }\n    }\n  }\n\n  _setContent() {\n    let html = this._html;\n    let o = this._options;\n\n    if (o.content && html.body) {\n      if (typeof o.content === 'string') {\n        html.body.innerHTML = o.content;\n      } else {\n        html.body.innerHTML = o.content.outerHTML;\n      }\n      if (o.construct) {\n        html.content.appendChild(html.body);\n      }\n    }\n  }\n\n  _setFooter() {\n    let html = this._html;\n    let o = this._options;\n\n    if (o.footer && html.footer) {\n      if (o.footer.nodeName) {\n        html.footer.ineerHTML = o.footer.outerHTML;\n      } else if (typeof o.footer === 'string') {\n        html.footer.innerHTML = o.footer;\n      } else if (! html.footer.children.length) {\n        o.buttons.forEach((button) => {\n          let el = document.createElement('button');\n          data(el, 'button', button);\n          el.innerHTML = button.text;\n          el.setAttribute('type', 'button');\n          for (let j in button.attr) {\n            el.setAttribute(j, button.attr[j]);\n          }\n          html.footer.appendChild(el);\n        });\n      }\n      if (o.construct) {\n        html.content.appendChild(html.footer);\n      }\n    }\n\n  }\n\n  _setEvents() {\n    let o = this._options;\n    let html = this._html;\n\n    this._events.keydownHandler = this._handleKeydownEvent.bind(this);\n    document.body.addEventListener('keydown',\n      this._events.keydownHandler\n    );\n\n    this._events.mousedownHandler = this._handleMousedownEvent.bind(this);\n    html.container.addEventListener('mousedown',\n      this._events.mousedownHandler\n    );\n\n    this._events.clickHandler = this._handleClickEvent.bind(this);\n    html.container.addEventListener('click',\n      this._events.clickHandler\n    );\n\n    this._events.resizeHandler = this._handleResizeEvent.bind(this);\n    window.addEventListener('resize',\n      this._events.resizeHandler\n    );\n  }\n\n  _handleMousedownEvent(e) {\n    this._pointerInContent = false;\n    let path = getPath(e.target);\n    path.every(node => {\n      if (node.classList && node.classList.contains('modal-content')) {\n        this._pointerInContent = true;\n        return false;\n      }\n      return true;\n    });\n  }\n\n  _handleClickEvent(e) {\n    let path = getPath(e.target);\n    path.every(node => {\n      if (node.tagName === 'HTML') {\n        return false;\n      }\n      if (this._options.backdrop !== true && node.classList.contains('modal')) {\n        return false;\n      }\n      if (node.classList.contains('modal-content')) {\n        return false;\n      }\n      if (node.getAttribute('data-dismiss') === 'modal') {\n        this.emit('dismiss', this, e, data(e.target, 'button'));\n        this.hide();\n        return false;\n      }\n\n      if (!this._pointerInContent && node.classList.contains('modal')) {\n        this.emit('dismiss', this, e, null);\n        this.hide();\n        return false;\n      }\n      return true;\n    });\n\n    this._pointerInContent = false;\n  }\n\n  _handleKeydownEvent(e) {\n    if (e.which === 27 && this._options.keyboard) {\n      this.emit('dismiss', this, e, null);\n      this.hide();\n    }\n  }\n\n  _handleResizeEvent(e) {\n    this._resize();\n  }\n\n  show() {\n    let o = this._options;\n    let html = this._html;\n    this.emit('show', this);\n\n    this._checkScrollbar();\n    this._setScrollbar();\n    document.body.classList.add('modal-open');\n\n    if (o.construct) {\n      html.appendTo.appendChild(html.container);\n    }\n\n    html.container.style.display = 'block';\n    html.container.scrollTop = 0;\n\n    if (o.backdrop !== false) {\n      this.once('showBackdrop', () => {\n        this._setEvents();\n\n        if (o.animate) html.container.offsetWidth; // Force reflow\n\n        html.container.classList.add(o.animateInClass);\n\n        setTimeout(() => {\n          this._visible = true;\n          this.emit('shown', this);\n        }, o.transition);\n      });\n      this._backdrop();\n    } else {\n      this._setEvents();\n\n      if (o.animate) html.container.offsetWidth; // Force reflow\n\n      html.container.classList.add(o.animateInClass);\n\n      setTimeout(() => {\n        this._visible = true;\n        this.emit('shown', this);\n      }, o.transition);\n    }\n    this._resize();\n\n    return this;\n  }\n\n  toggle() {\n    if (this._visible) {\n      this.hide();\n    } else {\n      this.show();\n    }\n  }\n\n  _resize() {\n    var modalIsOverflowing =\n      this._html.container.scrollHeight > document.documentElement.clientHeight;\n\n    this._html.container.style.paddingLeft =\n      ! this.bodyIsOverflowing && modalIsOverflowing ? this._scrollbarWidth + 'px' : '';\n\n    this._html.container.style.paddingRight =\n      this.bodyIsOverflowing && ! modalIsOverflowing ? this._scrollbarWidth + 'px' : '';\n  }\n\n  _backdrop() {\n    let html = this._html;\n    let t = this._templates;\n    let o = this._options;\n    let animate = o.animate ? o.animateClass : false;\n\n    html.backdrop = build(t.backdrop);\n    if (animate) html.backdrop.classList.add(animate);\n    html.appendTo.appendChild(html.backdrop);\n\n    if (animate) html.backdrop.offsetWidth;\n\n    html.backdrop.classList.add(o.animateInClass);\n\n    setTimeout(() => {\n      this.emit('showBackdrop', this);\n    }, this._options.backdropTransition);\n  }\n\n  hide() {\n    let html = this._html;\n    let o = this._options;\n    let contCList = html.container.classList;\n    this.emit('hide', this);\n\n    contCList.remove(o.animateInClass);\n\n    if (o.backdrop) {\n      let backCList = html.backdrop.classList;\n      backCList.remove(o.animateInClass);\n    }\n\n    this._removeEvents();\n\n    setTimeout(() => {\n      document.body.classList.remove('modal-open');\n      document.body.style.paddingRight = this.originalBodyPad;\n    }, o.backdropTransition);\n\n    setTimeout(() => {\n      if (o.backdrop) {\n        html.backdrop.parentNode.removeChild(html.backdrop);\n      }\n      html.container.style.display = 'none';\n\n      if (o.construct) {\n        html.container.parentNode.removeChild(html.container);\n      }\n\n      this._visible = false;\n      this.emit('hidden', this);\n    }, o.transition);\n\n    return this;\n  }\n\n  _removeEvents() {\n    if (this._events.keydownHandler) {\n      document.body.removeEventListener('keydown',\n        this._events.keydownHandler\n      );\n    }\n\n    this._html.container.removeEventListener('mousedown',\n      this._events.mousedownHandler\n    );\n\n    this._html.container.removeEventListener('click',\n      this._events.clickHandler\n    );\n\n    window.removeEventListener('resize',\n      this._events.resizeHandler\n    );\n  }\n\n  _checkScrollbar() {\n    this.bodyIsOverflowing = document.body.clientWidth < window.innerWidth;\n  }\n\n  _setScrollbar() {\n    this.originalBodyPad = document.body.style.paddingRight || '';\n    if (this.bodyIsOverflowing) {\n      let basePadding = parseInt(this.originalBodyPad || 0, 10);\n      document.body.style.paddingRight = basePadding + this._scrollbarWidth + 'px';\n    }\n  }\n}\n\nexport default Modal;\n","/**\r\n * @protected\r\n */\r\nexport const CLASS_PRINT_MODE = 'printMode';\r\nexport const CLASS_HIDE_CONTROLS = 'hideControls';\r\n","import Map from 'ol/Map.js';\r\nimport View from 'ol/View.js';\r\nimport Polygon from 'ol/geom/Polygon';\r\nimport Overlay from 'ol/Overlay';\r\nimport { Extent } from 'ol/extent';\r\n\r\nimport { I18n, Options } from '../ol-pdf-printer';\r\n\r\nimport { CLASS_HIDE_CONTROLS } from '../classnames';\r\n\r\nimport myPragma from '../myPragma';\r\n\r\nimport rotateRight from '../assets/images/rotateRight.svg';\r\nimport rotateLeft from '../assets/images/rotateLeft.svg';\r\nimport zoomIn from '../assets/images/zoomIn.svg';\r\nimport zoomOut from '../assets/images/zoomOut.svg';\r\n\r\nconst CLASS_OVERLAY = 'opp-overlay-frame';\r\nconst CLASS_OVERLAY_RECTANGLE = CLASS_OVERLAY + '-rectangle';\r\nconst CLASS_OVERLAY_CONTROLS = CLASS_OVERLAY + '-controls';\r\nconst CLASS_OVERLAY_ZOOM_ENABLED = CLASS_OVERLAY + '-zoom-enabled';\r\nconst CLASS_OVERLAY_CANCEL_BTN = CLASS_OVERLAY + '-cancel-btn';\r\nconst CLASS_OVERLAY_SAVE_BTN = CLASS_OVERLAY + '-save-btn';\r\nconst CLASS_OVERLAY_REFRAME_HINT = CLASS_OVERLAY + '-reframe-hint';\r\n\r\nexport default class ReframeROI {\r\n    private _map: Map;\r\n    private _view: View;\r\n\r\n    private _callback: (extent: Extent | Polygon) => void;\r\n\r\n    private _escapeKeyListener: EventListener;\r\n    private _saveButton: HTMLButtonElement;\r\n    private _cancelButton: HTMLButtonElement;\r\n    private _rectangle: HTMLElement;\r\n    private _overlay: Overlay;\r\n    private _controlButtons: HTMLElement;\r\n\r\n    constructor(map: Map, i18n: I18n, options: Options) {\r\n        this._map = map;\r\n        this._view = this._map.getView();\r\n\r\n        this._saveButton = (\r\n            <button\r\n                type=\"button\"\r\n                className={`btn btn-lg btn-primary ${CLASS_OVERLAY_SAVE_BTN}`}\r\n            >\r\n                {i18n.process}\r\n            </button>\r\n        );\r\n\r\n        this._cancelButton = (\r\n            <button\r\n                type=\"button\"\r\n                className={`btn-close btn-close-white ${CLASS_OVERLAY_CANCEL_BTN}`}\r\n                onclick={() => this.cancel()}\r\n                title={i18n.escapeHint}\r\n            >\r\n                <span aria-hidden=\"true\">Ã</span>\r\n            </button>\r\n        );\r\n\r\n        this._controlButtons = <div className={CLASS_OVERLAY_CONTROLS}></div>;\r\n\r\n        if (options.zoomControlOnReframe) {\r\n            this._controlButtons.append(\r\n                <div className=\"opp-zoom ol-control ol-unselectable\">\r\n                    <button\r\n                        type=\"button\"\r\n                        className=\"opp-zoom-in\"\r\n                        onClick={() => this._zoom('in')}\r\n                        title={i18n.zoomIn}\r\n                    >\r\n                        {zoomIn()}\r\n                    </button>\r\n                    <button\r\n                        type=\"button\"\r\n                        className=\"opp-zoom-out\"\r\n                        onClick={() => this._zoom('out')}\r\n                        title={i18n.zoomOut}\r\n                    >\r\n                        {zoomOut()}\r\n                    </button>\r\n                </div>\r\n            );\r\n        }\r\n\r\n        if (options.rotationControlOnReframe) {\r\n            this._controlButtons.append(\r\n                <div className=\"opp-rotation ol-control ol-unselectable\">\r\n                    <button\r\n                        type=\"button\"\r\n                        className=\"opp-rotation-left\"\r\n                        onClick={() => this._rotate('left')}\r\n                        title={i18n.rotateLeft}\r\n                    >\r\n                        {rotateLeft()}\r\n                    </button>\r\n                    <button\r\n                        type=\"button\"\r\n                        className=\"opp-rotation-right\"\r\n                        onClick={() => this._rotate('right')}\r\n                        title={i18n.rotateRight}\r\n                    >\r\n                        {rotateRight()}\r\n                    </button>\r\n                </div>\r\n            );\r\n        }\r\n\r\n        this._rectangle = (\r\n            <div\r\n                className={`${CLASS_OVERLAY_RECTANGLE} ${\r\n                    options.zoomControlOnReframe\r\n                        ? CLASS_OVERLAY_ZOOM_ENABLED\r\n                        : ''\r\n                }`}\r\n            >\r\n                {this._cancelButton}\r\n                <div>\r\n                    <div>{this._saveButton}</div>\r\n                    <div className={CLASS_OVERLAY_REFRAME_HINT}>\r\n                        {i18n.reframeHint}\r\n                    </div>\r\n                </div>\r\n                {(options.zoomControlOnReframe ||\r\n                    options.rotationControlOnReframe) &&\r\n                    this._controlButtons}\r\n            </div>\r\n        );\r\n    }\r\n\r\n    public showOverlay(\r\n        mode: 'landscape' | 'portrait',\r\n        callback: (polygon: Extent | Polygon) => void\r\n    ): void {\r\n        this._map.getTargetElement().classList.add(CLASS_HIDE_CONTROLS);\r\n\r\n        this._overlay = new Overlay({\r\n            className: `${CLASS_OVERLAY} ${mode}-mode`,\r\n            element: this._rectangle,\r\n            stopEvent: true\r\n        });\r\n\r\n        this._map.addOverlay(this._overlay);\r\n\r\n        this._view.setConstrainResolution(false);\r\n\r\n        this._addEvents();\r\n        this._callback = callback;\r\n\r\n        this._saveButton.onclick = () => {\r\n            callback(this._getExtent());\r\n            setTimeout(() => {\r\n                this.hideOverlay();\r\n            }, 10);\r\n        };\r\n    }\r\n\r\n    public cancel(): void {\r\n        this.hideOverlay();\r\n        if (this._callback) {\r\n            this._callback(null);\r\n        }\r\n    }\r\n\r\n    public hideOverlay(): void {\r\n        if (this._overlay) {\r\n            this._map.removeOverlay(this._overlay);\r\n        }\r\n        this._removeEvents();\r\n        this._map.getTargetElement().classList.remove(CLASS_HIDE_CONTROLS);\r\n    }\r\n\r\n    private _zoom(direction: 'in' | 'out', delta = 0.5): void {\r\n        const rotate = 0.261799 * delta;\r\n        const dd = direction === 'in' ? '' : '-';\r\n        this._view.adjustZoom(Number(dd + rotate));\r\n    }\r\n\r\n    private _rotate(direction: 'left' | 'right', delta = 0.5): void {\r\n        const rotate = 0.261799 * delta;\r\n        const dd = direction === 'right' ? '' : '-';\r\n        this._view.adjustRotation(Number(dd + rotate));\r\n    }\r\n\r\n    private _getExtent(): Polygon {\r\n        const mapBounds = this._map.getTargetElement().getBoundingClientRect();\r\n\r\n        const overlayFrameBounds = this._rectangle.getBoundingClientRect();\r\n\r\n        const relativePosition = {\r\n            left: overlayFrameBounds.left - mapBounds.left,\r\n            top: overlayFrameBounds.top - mapBounds.top\r\n        };\r\n\r\n        const topLeft = this._map.getCoordinateFromPixel([\r\n            relativePosition.left,\r\n            relativePosition.top\r\n        ]);\r\n\r\n        const topRight = this._map.getCoordinateFromPixel([\r\n            relativePosition.left + overlayFrameBounds.width,\r\n            relativePosition.top\r\n        ]);\r\n\r\n        const bottomLeft = this._map.getCoordinateFromPixel([\r\n            relativePosition.left,\r\n            relativePosition.top + overlayFrameBounds.height\r\n        ]);\r\n\r\n        const bottomRight = this._map.getCoordinateFromPixel([\r\n            relativePosition.left + overlayFrameBounds.width,\r\n            relativePosition.top + overlayFrameBounds.height\r\n        ]);\r\n\r\n        return new Polygon([[topLeft, topRight, bottomRight, bottomLeft]]);\r\n    }\r\n\r\n    private _addEvents(): void {\r\n        const escapeKeyListener = ({ key }) => {\r\n            if (key === 'Escape') {\r\n                this.cancel();\r\n            }\r\n        };\r\n\r\n        this._escapeKeyListener = escapeKeyListener.bind(this);\r\n        document.addEventListener('keydown', this._escapeKeyListener);\r\n    }\r\n\r\n    private _removeEvents = (): void => {\r\n        document.removeEventListener('keydown', this._escapeKeyListener);\r\n    };\r\n}\r\n","import Map from 'ol/Map.js';\r\nimport { Extent } from 'ol/extent';\r\nimport { Polygon } from 'ol/geom';\r\n\r\nimport Modal from 'modal-vanilla';\r\n\r\nimport ReframeROI from './ReframeROI';\r\n\r\nimport { I18n, IPrintOptions, Options } from '../ol-pdf-printer';\r\n\r\nimport myPragma from '../myPragma';\r\n\r\n/**\r\n * @private\r\n */\r\nexport default class SettingsModal {\r\n    protected _modal: Modal;\r\n    protected _reframeROI: ReframeROI;\r\n\r\n    constructor(\r\n        map: Map,\r\n        options: Options,\r\n        i18n: I18n,\r\n        printMap: (\r\n            values: IPrintOptions | false,\r\n            showLoading?: boolean,\r\n            delay?: number\r\n        ) => void\r\n    ) {\r\n        this._modal = new Modal({\r\n            headerClose: true,\r\n            header: true,\r\n            animate: true,\r\n            title: i18n.printPdf,\r\n            content: this.Content(i18n, options),\r\n            footer: this.Footer(i18n, options),\r\n            ...options.modal\r\n        });\r\n\r\n        if (options.allowReframeRegionOfInterest) {\r\n            this._reframeROI = new ReframeROI(map, i18n, options);\r\n        }\r\n\r\n        this._modal.el.classList.add('settingsModal');\r\n\r\n        this._modal.on('dismiss', (modal: Modal, event: Event): void => {\r\n            const print = (event.target as HTMLElement).dataset.print;\r\n            if (!print) return;\r\n\r\n            const form = document.getElementById('printMap') as HTMLFormElement;\r\n\r\n            const formData = new FormData(form);\r\n\r\n            const values: IPrintOptions = {\r\n                format: formData.get('printFormat') as string,\r\n                orientation: formData.get(\r\n                    'printOrientation'\r\n                ) as IPrintOptions['orientation'],\r\n                resolution: Number(formData.get('printResolution')),\r\n                description: formData.get('printDescription') as string,\r\n                compass: formData.get('printCompass') as unknown as boolean,\r\n                attributions: formData.get(\r\n                    'printAttributions'\r\n                ) as unknown as boolean,\r\n                scalebar: formData.get('printScalebar') as unknown as boolean,\r\n                legends: formData.get('printLegends') as unknown as boolean,\r\n                url: formData.get('printUrl') as unknown as boolean,\r\n                date: formData.get('printDate') as unknown as boolean,\r\n                specs: formData.get('printSpecs') as unknown as boolean,\r\n                safeMargins: formData.get('safeMargins') as unknown as boolean,\r\n                typeExport: this._modal.el.querySelector<HTMLSelectElement>(\r\n                    'select[name=\"printTypeExport\"]'\r\n                ).value\r\n            };\r\n\r\n            if (this._reframeROI) {\r\n                const callback = (extent: Extent | Polygon | false) => {\r\n                    if (extent) {\r\n                        printMap(\r\n                            { regionOfInterest: extent, ...values },\r\n                            /* showLoading */ true,\r\n                            /* delay */ options.modal.transition\r\n                        );\r\n                    } else {\r\n                        //cancel\r\n                        printMap(false);\r\n                    }\r\n                };\r\n                this._reframeROI.showOverlay(values.orientation, callback);\r\n            } else {\r\n                printMap(\r\n                    values,\r\n                    /* showLoading */ true,\r\n                    /* delay */ options.modal.transition\r\n                );\r\n            }\r\n        });\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param i18n\r\n     * @param options\r\n     * @returns\r\n     * @protected\r\n     */\r\n    Content(i18n: I18n, options: Options): HTMLElement {\r\n        const { dpi, mapElements, extraInfo, description, paperSizes } =\r\n            options;\r\n\r\n        return (\r\n            <form id=\"printMap\">\r\n                <section>\r\n                    <div className=\"printFields-container\">\r\n                        <div className=\"printField\">\r\n                            <label htmlFor=\"printFormat\">\r\n                                {i18n.paperSize}\r\n                            </label>\r\n                            <select name=\"printFormat\" id=\"printFormat\">\r\n                                {paperSizes.map((paper) => (\r\n                                    <option\r\n                                        value={paper.value}\r\n                                        {...(paper.selected\r\n                                            ? { selected: 'selected' }\r\n                                            : {})}\r\n                                    >\r\n                                        {paper.value}\r\n                                    </option>\r\n                                ))}\r\n                            </select>\r\n                        </div>\r\n                        <div className=\"printField\">\r\n                            <label htmlFor=\"printOrientation\">\r\n                                {i18n.orientation}\r\n                            </label>\r\n                            <select\r\n                                name=\"printOrientation\"\r\n                                id=\"printOrientation\"\r\n                            >\r\n                                <option value=\"landscape\" selected>\r\n                                    {i18n.landscape}\r\n                                </option>\r\n                                <option value=\"portrait\">\r\n                                    {i18n.portrait}\r\n                                </option>\r\n                            </select>\r\n                        </div>\r\n                        <div className=\"printField\">\r\n                            <label htmlFor=\"printResolution\">\r\n                                {i18n.resolution}\r\n                            </label>\r\n                            <select name=\"printResolution\" id=\"printResolution\">\r\n                                {dpi.map((d) => (\r\n                                    <option\r\n                                        value={d.value}\r\n                                        {...(d.selected\r\n                                            ? { selected: 'selected' }\r\n                                            : {})}\r\n                                    >\r\n                                        {d.value} dpi\r\n                                    </option>\r\n                                ))}\r\n                            </select>\r\n                        </div>\r\n                    </div>\r\n                    <div>\r\n                        {description && (\r\n                            <div>\r\n                                <label htmlFor=\"printDescription\">\r\n                                    {i18n.addNote}\r\n                                </label>\r\n                                <textarea\r\n                                    id=\"printDescription\"\r\n                                    name=\"printDescription\"\r\n                                    rows=\"4\"\r\n                                ></textarea>\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n                </section>\r\n                {mapElements && (\r\n                    <fieldset className=\"sectionChecks mapElements\">\r\n                        <legend>{i18n.mapElements}</legend>\r\n                        <div className=\"sectionChecksList\">\r\n                            {mapElements.compass && (\r\n                                <label htmlFor=\"printCompass\">\r\n                                    <input\r\n                                        type=\"checkbox\"\r\n                                        id=\"printCompass\"\r\n                                        name=\"printCompass\"\r\n                                        checked\r\n                                    />\r\n                                    <span>{i18n.compass}</span>\r\n                                </label>\r\n                            )}\r\n                            {mapElements.scalebar && (\r\n                                <label htmlFor=\"printScalebar\">\r\n                                    <input\r\n                                        type=\"checkbox\"\r\n                                        id=\"printScalebar\"\r\n                                        name=\"printScalebar\"\r\n                                        checked\r\n                                    />\r\n                                    <span>{i18n.scale}</span>\r\n                                </label>\r\n                            )}\r\n                            {mapElements.legends && (\r\n                                <label htmlFor=\"printLegends\">\r\n                                    <input\r\n                                        type=\"checkbox\"\r\n                                        id=\"printLegends\"\r\n                                        name=\"printLegends\"\r\n                                        checked\r\n                                    />\r\n                                    <span>{i18n.legends}</span>\r\n                                </label>\r\n                            )}\r\n                            {mapElements.attributions && (\r\n                                <label htmlFor=\"printAttributions\">\r\n                                    <input\r\n                                        type=\"checkbox\"\r\n                                        id=\"printAttributions\"\r\n                                        name=\"printAttributions\"\r\n                                        checked\r\n                                    />\r\n                                    <span>{i18n.layersAttributions}</span>\r\n                                </label>\r\n                            )}\r\n                        </div>\r\n                    </fieldset>\r\n                )}\r\n                {extraInfo && (\r\n                    <fieldset className=\"sectionChecks extraInfo\">\r\n                        <legend>{i18n.extraInfo}</legend>\r\n                        <div className=\"sectionChecksList\">\r\n                            {extraInfo.url && (\r\n                                <label htmlFor=\"printUrl\">\r\n                                    <input\r\n                                        type=\"checkbox\"\r\n                                        id=\"printUrl\"\r\n                                        name=\"printUrl\"\r\n                                        checked\r\n                                    />\r\n                                    <span>{i18n.url}</span>\r\n                                </label>\r\n                            )}\r\n                            {extraInfo.date && (\r\n                                <label htmlFor=\"printDate\">\r\n                                    <input\r\n                                        type=\"checkbox\"\r\n                                        id=\"printDate\"\r\n                                        name=\"printDate\"\r\n                                        checked\r\n                                    />\r\n                                    <span>{i18n.date}</span>\r\n                                </label>\r\n                            )}\r\n                            {extraInfo.specs && (\r\n                                <label htmlFor=\"printSpecs\">\r\n                                    <input\r\n                                        type=\"checkbox\"\r\n                                        id=\"printSpecs\"\r\n                                        name=\"printSpecs\"\r\n                                        checked\r\n                                    />\r\n                                    <span>{i18n.specs}</span>\r\n                                </label>\r\n                            )}\r\n                        </div>\r\n                    </fieldset>\r\n                )}\r\n                <div className=\"safeMarginsSection sectionChecks\">\r\n                    <label htmlFor=\"safeMargins\">\r\n                        <input\r\n                            type=\"checkbox\"\r\n                            id=\"safeMargins\"\r\n                            name=\"safeMargins\"\r\n                        />\r\n                        <span> {i18n.printerMargins}</span>\r\n                    </label>\r\n                </div>\r\n            </form>\r\n        );\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param i18n\r\n     * @returns\r\n     * @protected\r\n     */\r\n    Footer(i18n: I18n, options: Options): string {\r\n        const { mimeTypeExports } = options;\r\n\r\n        return (\r\n            <div>\r\n                <button\r\n                    type=\"button\"\r\n                    className=\"btn-sm btn btn-secondary\"\r\n                    data-dismiss=\"modal\"\r\n                >\r\n                    {i18n.cancel}\r\n                </button>\r\n                <div class=\"typeExportContainer\">\r\n                    <button\r\n                        type=\"button\"\r\n                        className=\"btn-sm btn btn-primary\"\r\n                        data-print=\"true\"\r\n                        data-dismiss=\"modal\"\r\n                    >\r\n                        {i18n.print}\r\n                    </button>\r\n                    <select\r\n                        className=\"typeExport\"\r\n                        name=\"printTypeExport\"\r\n                        id=\"printTypeExport\"\r\n                    >\r\n                        {mimeTypeExports.map((type) => (\r\n                            <option\r\n                                value={type.value}\r\n                                {...(type.selected\r\n                                    ? { selected: 'selected' }\r\n                                    : {})}\r\n                            >\r\n                                {type.value}\r\n                            </option>\r\n                        ))}\r\n                    </select>\r\n                </div>\r\n            </div>\r\n        ).outerHTML;\r\n    }\r\n\r\n    hide(): void {\r\n        this._modal.hide();\r\n    }\r\n\r\n    show(): void {\r\n        if (!this._modal._visible) this._modal.show();\r\n    }\r\n}\r\n","import Modal from 'modal-vanilla';\r\nimport { I18n, Options } from '../ol-pdf-printer';\r\n\r\n/**\r\n * @private\r\n */\r\nexport default class ProcessingModal {\r\n    protected _modal: Modal;\r\n    protected _footer: string;\r\n    protected _i18n: I18n;\r\n    protected _message: HTMLElement = document.createElement('div');\r\n    protected _loaderContainer: HTMLElement = document.createElement('div');\r\n\r\n    /**\r\n     *\r\n     * @param i18n\r\n     * @param options\r\n     * @param onEndPrint\r\n     * @protected\r\n     */\r\n    constructor(i18n: I18n, options: Options, onEndPrint: () => void) {\r\n        this._i18n = i18n;\r\n\r\n        this._modal = new Modal({\r\n            headerClose: false,\r\n            title: this._i18n.printing,\r\n            backdrop: 'static', // To prevent close on clicking backdrop\r\n            content: ' ',\r\n            footer: `\r\n            <button\r\n                type=\"button\"\r\n                class=\"btn-sm btn btn-secondary\"\r\n                data-dismiss=\"modal\"\r\n            >\r\n                ${this._i18n.cancel}\r\n            </button>\r\n            `,\r\n            ...options.modal\r\n        });\r\n\r\n        this._modal.el.classList.add('processingModal');\r\n\r\n        this._modal.once('shown', () => {\r\n            if (options.loader) {\r\n                this._loaderContainer.className = 'printLoader-container';\r\n                if (typeof options.loader === 'string') {\r\n                    this._loaderContainer.innerHTML = options.loader;\r\n                } else {\r\n                    this._loaderContainer.appendChild(options.loader);\r\n                }\r\n            }\r\n\r\n            this._modal._html.body.append(this._message);\r\n            this._modal._html.body.append(this._loaderContainer);\r\n        });\r\n\r\n        this._modal.on('dismiss', () => {\r\n            onEndPrint();\r\n        });\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param string\r\n     * @protected\r\n     */\r\n    _setContentModal(string: string | number): void {\r\n        this._message.innerHTML = String(string);\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param string\r\n     * @protected\r\n     */\r\n    _setFooterModal(string: string): void {\r\n        this._modal._html.footer.innerHTML = string;\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param string\r\n     * @param footer\r\n     * @protected\r\n     */\r\n    show(): void {\r\n        this._modal.show();\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param string\r\n     * @param footer\r\n     * @protected\r\n     */\r\n    set(string: string | number): void {\r\n        if (!this._modal._visible) return;\r\n        this._setContentModal(string);\r\n    }\r\n\r\n    setLoading(bool = true): void {\r\n        if (bool) {\r\n            this._modal.el.classList.add('showLoader');\r\n        } else {\r\n            this._modal.el.classList.remove('showLoader');\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @protected\r\n     */\r\n    hide(): void {\r\n        this._modal.hide();\r\n    }\r\n}\r\n","import Map from 'ol/Map.js';\r\nimport View from 'ol/View.js';\r\nimport Control, { Options as ControlOptions } from 'ol/control/Control.js';\r\nimport { getPointResolution } from 'ol/proj.js';\r\nimport { EventsKey } from 'ol/events.js';\r\nimport { unByKey } from 'ol/Observable.js';\r\nimport Cluster from 'ol/source/Cluster.js';\r\nimport VectorLayer from 'ol/layer/Vector.js';\r\nimport TileWMS from 'ol/source/TileWMS.js';\r\nimport { Extent } from 'ol/extent';\r\nimport { Coordinate } from 'ol/coordinate.js';\r\nimport Polygon from 'ol/geom/Polygon';\r\nimport ImageWMS from 'ol/source/ImageWMS';\r\n\r\nimport { Locale } from 'locale-enum';\r\n\r\nimport Pdf from './components/Pdf';\r\nimport SettingsModal from './components/SettingsModal';\r\nimport ProcessingModal from './components/ProcessingModal';\r\nimport { LegendsOptions } from './components/MapElements/Legends';\r\nimport { getMapScale } from './components/Helpers';\r\nimport { defaultOptions, DEFAULT_LANGUAGE } from './defaults';\r\n\r\nimport { CLASS_HIDE_CONTROLS, CLASS_PRINT_MODE } from './classnames';\r\n\r\n/*eslint import/namespace: ['error', { allowComputed: true }]*/\r\nimport * as i18n from './components/i18n';\r\n\r\nimport pdfIcon from './assets/images/pdf.svg';\r\n\r\n// Style\r\nimport './assets/scss/-ol-pdf-printer.bootstrap5.scss';\r\nimport './assets/scss/ol-pdf-printer.scss';\r\n\r\n/**\r\n * @protected\r\n */\r\nfunction deepObjectAssign(target, ...sources) {\r\n    sources.forEach((source) => {\r\n        Object.keys(source).forEach((key) => {\r\n            const s_val = source[key];\r\n            const t_val = target[key];\r\n            target[key] =\r\n                t_val &&\r\n                s_val &&\r\n                typeof t_val === 'object' &&\r\n                typeof s_val === 'object' &&\r\n                !Array.isArray(t_val) // Don't merge arrays\r\n                    ? deepObjectAssign(t_val, s_val)\r\n                    : s_val;\r\n        });\r\n    });\r\n    return target;\r\n}\r\n\r\n/**\r\n * @constructor\r\n * @extends {ol/control/Control~Control}\r\n * @params options\r\n */\r\nexport default class PdfPrinter extends Control {\r\n    protected _i18n: I18n;\r\n\r\n    protected _map: Map;\r\n    protected _view: View;\r\n\r\n    protected _pdf: Pdf;\r\n\r\n    protected _processingModal: ProcessingModal;\r\n    protected _settingsModal: SettingsModal;\r\n\r\n    protected _initialized: boolean;\r\n\r\n    protected _timeoutProcessing: ReturnType<typeof setTimeout>;\r\n\r\n    protected _initialViewResolution: number;\r\n    protected _initialViewCoords: Coordinate;\r\n    protected _initialConstrainRes: boolean;\r\n    protected _initialSize: number[];\r\n\r\n    protected _options: Options;\r\n\r\n    protected _renderCompleteKey: EventsKey | EventsKey[];\r\n\r\n    protected _isCanceled: boolean;\r\n    protected _eventsKey: EventsKey[];\r\n    protected _imageCount: number;\r\n\r\n    constructor(opt_options?: Options) {\r\n        const controlElement = document.createElement('button');\r\n\r\n        super({\r\n            target: opt_options.target,\r\n            element:\r\n                opt_options.showControlBtn === false\r\n                    ? document.createElement('div')\r\n                    : controlElement\r\n        });\r\n\r\n        // Check if the selected language exists\r\n        this._i18n =\r\n            opt_options.language && opt_options.language in i18n\r\n                ? i18n[opt_options.language]\r\n                : i18n[DEFAULT_LANGUAGE];\r\n\r\n        if (opt_options.i18n) {\r\n            // Merge custom translations\r\n            this._i18n = {\r\n                ...this._i18n,\r\n                ...opt_options.i18n\r\n            };\r\n        }\r\n\r\n        // Default options\r\n        this._options = defaultOptions(this._i18n);\r\n\r\n        // Merge options\r\n        this._options = deepObjectAssign(this._options, opt_options);\r\n\r\n        if (this._options.showControlBtn) {\r\n            controlElement.className = `ol-print-btn-menu ${this._options.ctrlBtnClass}`;\r\n            controlElement.title = this._i18n.printPdf;\r\n            controlElement.onclick = () => this.showPrintSettingsModal();\r\n            controlElement.append(pdfIcon());\r\n        }\r\n    }\r\n\r\n    public setMap(map: Map) {\r\n        super.setMap(map);\r\n        if (!this._initialized && map) this._init();\r\n        this._initialConstrainRes = this._view.getConstrainResolution();\r\n    }\r\n\r\n    /**\r\n     * @protected\r\n     */\r\n    protected _init(): void {\r\n        this._map = this.getMap();\r\n        this._view = this._map.getView();\r\n        this._settingsModal = new SettingsModal(\r\n            this._map,\r\n            this._options,\r\n            this._i18n,\r\n            this._printMap.bind(this)\r\n        );\r\n\r\n        this._processingModal = new ProcessingModal(\r\n            this._i18n,\r\n            this._options,\r\n            this._onEndPrint.bind(this)\r\n        );\r\n\r\n        this._initialized = true;\r\n    }\r\n\r\n    /**\r\n     *\r\n     */\r\n    protected _restoreConstrains(): void {\r\n        this._view.setConstrainResolution(this._initialConstrainRes);\r\n    }\r\n\r\n    /**\r\n     * Restore inital view, remove classes, disable loading\r\n     * @protected\r\n     */\r\n    protected _onEndPrint(): void {\r\n        this._map.setSize(this._initialSize);\r\n        this._view.setResolution(this._initialViewResolution);\r\n        this._view.setCenter(this._initialViewCoords);\r\n\r\n        this._restoreConstrains();\r\n\r\n        this._map\r\n            .getTargetElement()\r\n            .classList.remove(CLASS_PRINT_MODE, CLASS_HIDE_CONTROLS);\r\n\r\n        this._updateDPI(90);\r\n        this._removeListeners();\r\n\r\n        clearTimeout(this._timeoutProcessing);\r\n        this._processingModal.setLoading(false);\r\n\r\n        this._cancel();\r\n    }\r\n\r\n    /**\r\n     * @protected\r\n     */\r\n    protected _prepareLoading(): void {\r\n        this._processingModal.show();\r\n        this._processingModal.setLoading(true);\r\n        this._processingModal.set(this._i18n.pleaseWait);\r\n    }\r\n\r\n    /**\r\n     * @protected\r\n     */\r\n    protected _disableLoading(): void {\r\n        this._processingModal.hide();\r\n        this._processingModal.setLoading(false);\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param dpi\r\n     * @protected\r\n     */\r\n    protected _updateDPI(dpi = 90): void {\r\n        const pixelRatio = dpi / 90;\r\n\r\n        // @ts-expect-error There is no public method to do this\r\n        this._map.pixelRatio_ = pixelRatio;\r\n        this._map.getLayers().forEach((layer) => {\r\n            if (\r\n                layer.getVisible() &&\r\n                'getSource' in layer &&\r\n                typeof layer.getSource === 'function'\r\n            ) {\r\n                const source = layer.getSource() as TileWMS;\r\n\r\n                // @ts-expect-error There is no public method to do this\r\n                if (source.tilePixelRatio_ !== undefined) {\r\n                    // @ts-expect-error There is no public method to do this\r\n                    source.tilePixelRatio_ = pixelRatio;\r\n                    source.refresh();\r\n                } else {\r\n                    if (layer instanceof VectorLayer) {\r\n                        if (source instanceof Cluster) {\r\n                            source.getSource().changed();\r\n                        } else {\r\n                            source.changed();\r\n                        }\r\n                    } else {\r\n                        const source = layer.getSource();\r\n                        if (\r\n                            source instanceof ImageWMS ||\r\n                            source instanceof TileWMS\r\n                        ) {\r\n                            const params = source.getParams();\r\n                            // To force reload the images\r\n                            params['_pixelRatio'] = pixelRatio;\r\n                            source.updateParams(params);\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        });\r\n        this._map.updateSize();\r\n    }\r\n\r\n    /**\r\n     *\r\n     * @param form\r\n     * @param showLoading\r\n     * @param delay Delay to prevent glitching with modals animation\r\n     * @protected\r\n     */\r\n    protected _printMap(\r\n        form: IPrintOptions | false,\r\n        showLoading = true,\r\n        delay = 0\r\n    ): void {\r\n        // the print was canceled on the reframe instance\r\n        if (!form) {\r\n            return this._restoreConstrains();\r\n        }\r\n\r\n        if (showLoading) {\r\n            this._map\r\n                .getTargetElement()\r\n                .classList.add(CLASS_PRINT_MODE, CLASS_HIDE_CONTROLS);\r\n        }\r\n\r\n        setTimeout(() => {\r\n            if (showLoading) {\r\n                this._prepareLoading();\r\n            }\r\n\r\n            this._isCanceled = false;\r\n\r\n            this._addDownloadCountListener();\r\n\r\n            // Save current resolution to restore it later\r\n            this._initialViewResolution = this._view.getResolution();\r\n            this._initialViewCoords = this._view.getCenter();\r\n            this._initialSize = this._map.getSize();\r\n\r\n            // To allow intermediate zoom levels\r\n            this._view.setConstrainResolution(false);\r\n\r\n            let dim = this._options.paperSizes.find(\r\n                (e) => e.value === form.format\r\n            ).size;\r\n\r\n            dim =\r\n                form.orientation === 'landscape'\r\n                    ? dim\r\n                    : ([...dim].reverse() as [number, number]);\r\n\r\n            const widthPaper = dim[0];\r\n            const heightPaper = dim[1];\r\n\r\n            this._updateDPI(form.resolution);\r\n\r\n            const pixelsPerMapMillimeter = form.resolution / 25.4;\r\n\r\n            const width = Math.round(widthPaper * pixelsPerMapMillimeter);\r\n            const height = Math.round(heightPaper * pixelsPerMapMillimeter);\r\n\r\n            const scale =\r\n                form.scale && !form.regionOfInterest\r\n                    ? form.scale\r\n                    : getMapScale(this._map) / 1000;\r\n\r\n            console.log(getMapScale(this._map) / 1000);\r\n\r\n            const scaleResolution =\r\n                scale /\r\n                getPointResolution(\r\n                    this._view.getProjection(),\r\n                    pixelsPerMapMillimeter,\r\n                    this._view.getCenter()\r\n                );\r\n\r\n            this._renderCompleteKey = this._map.once(\r\n                'rendercomplete',\r\n                async () => {\r\n                    try {\r\n                        const mapCanvas = document.createElement('canvas');\r\n                        mapCanvas.width = width;\r\n                        mapCanvas.height = height;\r\n                        const mapContext = mapCanvas.getContext('2d');\r\n                        Array.prototype.forEach.call(\r\n                            this._map\r\n                                .getTargetElement()\r\n                                .querySelector('.ol-layers') // to not match map overviews\r\n                                .querySelectorAll('.ol-layer canvas'),\r\n                            function (canvas: HTMLCanvasElement) {\r\n                                if (canvas.width > 0) {\r\n                                    const opacity = (\r\n                                        canvas.parentNode as HTMLElement\r\n                                    ).style.opacity;\r\n                                    mapContext.globalAlpha =\r\n                                        opacity === '' ? 1 : Number(opacity);\r\n                                    const transform = canvas.style.transform;\r\n                                    // Get the transform parameters from the style's transform matrix\r\n                                    const matrix = transform\r\n                                        .match(/^matrix\\(([^(]*)\\)$/)[1]\r\n                                        .split(',')\r\n                                        .map(Number);\r\n                                    // Apply the transform to the export map context\r\n                                    CanvasRenderingContext2D.prototype.setTransform.apply(\r\n                                        mapContext,\r\n                                        matrix\r\n                                    );\r\n                                    mapContext.drawImage(canvas, 0, 0);\r\n                                }\r\n                            }\r\n                        );\r\n                        mapContext.globalAlpha = 1;\r\n                        mapContext.setTransform(1, 0, 0, 1, 0, 0);\r\n\r\n                        this._processingModal.set(this._i18n.downloadFinished);\r\n\r\n                        if (this._isCanceled) return;\r\n\r\n                        this._pdf = new Pdf({\r\n                            form,\r\n                            scaleResolution,\r\n                            map: this._map,\r\n                            i18n: this._i18n,\r\n                            config: this._options,\r\n                            height: heightPaper,\r\n                            width: widthPaper\r\n                        });\r\n\r\n                        this._pdf.addMapImage(\r\n                            mapCanvas.toDataURL('image/jpeg')\r\n                        );\r\n\r\n                        await this._pdf.addMapHelpers();\r\n\r\n                        if (this._isCanceled) return;\r\n\r\n                        await this._pdf.savePdf();\r\n\r\n                        // Reset original map size\r\n                        this._onEndPrint();\r\n\r\n                        if (showLoading) this._disableLoading();\r\n                    } catch (err) {\r\n                        const message =\r\n                            typeof err === 'string' ? err : this._i18n.error;\r\n                        console.error(err);\r\n                        this._onEndPrint();\r\n                        this._processingModal.set(message);\r\n                    }\r\n                }\r\n            );\r\n\r\n            this._map.setSize([width, height]);\r\n            this._map.getView().setResolution(scaleResolution);\r\n\r\n            if (form.regionOfInterest) {\r\n                this._view.fit(form.regionOfInterest, {\r\n                    size: this._map.getSize(),\r\n                    nearest: false\r\n                });\r\n            }\r\n        }, delay);\r\n    }\r\n\r\n    /**\r\n     * Add tile listener to show downloaded images count\r\n     */\r\n    protected _addDownloadCountListener() {\r\n        const increaseCount = () => {\r\n            this._imageCount = this._imageCount + 1;\r\n            if (this._imageCount % 10 == 0) {\r\n                this._processingModal.set(\r\n                    this._i18n.downloadingImages +\r\n                        ': <b>' +\r\n                        this._imageCount +\r\n                        '</b>'\r\n                );\r\n            }\r\n        };\r\n\r\n        this._eventsKey = [];\r\n        this._imageCount = 0;\r\n\r\n        this._map\r\n            .getLayers()\r\n            .getArray()\r\n            .forEach((l) => {\r\n                if ('getSource' in l && typeof l.getSource === 'function') {\r\n                    this._eventsKey.push(\r\n                        l.getSource().on('tileloadend', () => increaseCount())\r\n                    );\r\n                    this._eventsKey.push(\r\n                        l.getSource().on('imageloadend', () => increaseCount())\r\n                    );\r\n                }\r\n            });\r\n    }\r\n\r\n    /**\r\n     * Remove WMS listeners\r\n     */\r\n    protected _removeListeners() {\r\n        unByKey(this._eventsKey);\r\n    }\r\n\r\n    /**\r\n     * @protected\r\n     */\r\n    protected _cancel(): void {\r\n        if (this._renderCompleteKey) {\r\n            unByKey(this._renderCompleteKey);\r\n        }\r\n\r\n        this._isCanceled = true;\r\n    }\r\n\r\n    /**\r\n     * Show the Settings Modal\r\n     * @public\r\n     */\r\n    showPrintSettingsModal(): void {\r\n        this._settingsModal.show();\r\n    }\r\n\r\n    /**\r\n     * Hide the Settings Modal\r\n     * @public\r\n     */\r\n    hidePrintSettingsModal(): void {\r\n        this._settingsModal.hide();\r\n    }\r\n\r\n    /**\r\n     * Create PDF programatically without displaying the Settings Modal\r\n     * @param options\r\n     * @public\r\n     */\r\n    createPdf(options: IPrintOptions, showLoading: boolean): void {\r\n        options = {};\r\n        this._printMap(\r\n            {\r\n                format: (\r\n                    this._options.paperSizes.find((p) => p.selected) ||\r\n                    this._options.paperSizes[0]\r\n                ).value,\r\n                resolution: (\r\n                    this._options.dpi.find((p) => p.selected) ||\r\n                    this._options.dpi[0]\r\n                ).value,\r\n                orientation: 'landscape',\r\n                compass: true,\r\n                attributions: true,\r\n                scalebar: true,\r\n                legends: true,\r\n                regionOfInterest: null,\r\n                typeExport: 'pdf',\r\n                ...options\r\n            },\r\n            showLoading\r\n        );\r\n    }\r\n}\r\n\r\n/**\r\n * **_[enum]_**\r\n */\r\nexport enum UnitsSystem {\r\n    Metric = 'metric',\r\n    Imperial = 'imperial'\r\n}\r\n\r\n/**\r\n * **_[interface]_**\r\n */\r\nexport interface IPrintOptions {\r\n    /**\r\n     *\r\n     */\r\n    format?: IPaperSize['value'];\r\n    /**\r\n     *\r\n     */\r\n    orientation?: 'landscape' | 'portrait';\r\n    /**\r\n     *\r\n     */\r\n    resolution?: IDpi['value'];\r\n    /**\r\n     *\r\n     */\r\n    scale?: number;\r\n\r\n    /**\r\n     * Area of interest. If this is provided,\r\n     * the scale value is not used\r\n     */\r\n    regionOfInterest?: Extent | Polygon;\r\n\r\n    /**\r\n     *\r\n     */\r\n    description?: string;\r\n    /**\r\n     *\r\n     */\r\n    compass?: boolean;\r\n    /**\r\n     *\r\n     */\r\n    attributions?: boolean;\r\n    /**\r\n     *\r\n     */\r\n    scalebar?: boolean;\r\n    /**\r\n     *\r\n     */\r\n    legends?: LegendsOptions | boolean;\r\n    /**\r\n     *\r\n     */\r\n    safeMargins?: boolean;\r\n    /**\r\n     *\r\n     */\r\n    typeExport?: IMimeTypeExport['value'];\r\n    /**\r\n     *\r\n     */\r\n    url?: boolean;\r\n    /**\r\n     *\r\n     */\r\n    date?: boolean;\r\n    /**\r\n     *\r\n     */\r\n    specs?: boolean;\r\n}\r\n\r\n/**\r\n * **_[interface]_** - Custom translations specified when creating an instance\r\n */\r\nexport interface I18n {\r\n    printPdf: string;\r\n    pleaseWait: string;\r\n    downloadFinished: string;\r\n    downloadingImages: string;\r\n    error: string;\r\n    errorImage: string;\r\n    printing: string;\r\n    cancel: string;\r\n    close: string;\r\n    print: string;\r\n    mapElements: string;\r\n    extraInfo: string;\r\n    url: string;\r\n    date: string;\r\n    specs: string;\r\n    compass: string;\r\n    scale: string;\r\n    legends: string;\r\n    layersAttributions: string;\r\n    addNote: string;\r\n    resolution: string;\r\n    orientation: string;\r\n    paperSize: string;\r\n    landscape: string;\r\n    portrait: string;\r\n    current: string;\r\n    paper: string;\r\n    printerMargins: string;\r\n    escapeHint: string;\r\n    reframeHint: string;\r\n    process?: string;\r\n    zoomIn?: string;\r\n    zoomOut?: string;\r\n    rotateLeft?: string;\r\n    rotateRight?: string;\r\n}\r\n\r\n/**\r\n * **_[interface]_**\r\n */\r\ninterface IPaperSize {\r\n    /**\r\n     *\r\n     */\r\n    size: [number, number];\r\n    /**\r\n     *\r\n     */\r\n    value: string;\r\n    /**\r\n     *\r\n     */\r\n    selected?: boolean;\r\n}\r\n\r\n/**\r\n * **_[interface]_**\r\n */\r\ninterface IDpi {\r\n    /**\r\n     *\r\n     */\r\n    value: number;\r\n    /**\r\n     *\r\n     */\r\n    selected?: boolean;\r\n}\r\n\r\n/**\r\n * **_[interface]_**\r\n */\r\ninterface IStyle {\r\n    /**\r\n     * Only added if `Add printer margins` is checked\r\n     */\r\n    paperMargin?:\r\n        | number\r\n        | {\r\n              top: number;\r\n              right: number;\r\n              bottom: number;\r\n              left: number;\r\n          };\r\n\r\n    watermark?: {\r\n        /**\r\n         * Watermark border color\r\n         */\r\n        brcolor?: string;\r\n\r\n        /**\r\n         * Watermark background color\r\n         */\r\n        bkcolor?: string;\r\n\r\n        /**\r\n         * Watermark title color\r\n         */\r\n        txcolortitle?: string;\r\n\r\n        /**\r\n         * Watermark subtitle color\r\n         */\r\n        txcolorsubtitle?: string;\r\n    };\r\n\r\n    url?: {\r\n        /**\r\n         * Url border color\r\n         */\r\n        brcolor?: string;\r\n\r\n        /**\r\n         * Url background color\r\n         */\r\n        bkcolor?: string;\r\n\r\n        /**\r\n         * Url text color\r\n         */\r\n        txcolor?: string;\r\n    };\r\n\r\n    attributions?: {\r\n        /**\r\n         * Attributions border color\r\n         */\r\n        brcolor?: string;\r\n\r\n        /**\r\n         * Attributions background color\r\n         */\r\n        bkcolor?: string;\r\n\r\n        /**\r\n         * Attributions text color\r\n         */\r\n        txcolor?: string;\r\n\r\n        /**\r\n         * Attributions links color\r\n         */\r\n        txcolorlink?: string;\r\n    };\r\n\r\n    scalebar?: {\r\n        /**\r\n         * Scalebar border color\r\n         */\r\n        brcolor?: string;\r\n\r\n        /**\r\n         * Scalebar background color\r\n         */\r\n        bkcolor?: string;\r\n\r\n        /**\r\n         * Scalebar text and graph color\r\n         */\r\n        txcolor?: string;\r\n    };\r\n\r\n    specs?: {\r\n        /**\r\n         * Specs border color\r\n         */\r\n        brcolor?: string;\r\n\r\n        /**\r\n         * Specs background color\r\n         */\r\n        bkcolor?: string;\r\n\r\n        /**\r\n         * Specs text color\r\n         */\r\n        txcolor?: string;\r\n    };\r\n\r\n    legends?: {\r\n        /**\r\n         * Legends border color\r\n         */\r\n        brcolor?: string;\r\n\r\n        /**\r\n         * Legends background color\r\n         */\r\n        bkcolor?: string;\r\n\r\n        /**\r\n         * Legends text color\r\n         */\r\n        txcolor?: string;\r\n    };\r\n\r\n    description?: {\r\n        /**\r\n         * Description border color\r\n         */\r\n        brcolor?: string;\r\n\r\n        /**\r\n         * Description background color\r\n         */\r\n        bkcolor?: string;\r\n\r\n        /**\r\n         * Description text color\r\n         */\r\n        txcolor?: string;\r\n    };\r\n\r\n    compass?: {\r\n        /**\r\n         * Compass border color\r\n         */\r\n        brcolor?: string;\r\n\r\n        /**\r\n         * Compass background color\r\n         */\r\n        bkcolor?: string;\r\n    };\r\n}\r\n\r\n/**\r\n * **_[interface]_**\r\n */\r\ninterface IMimeTypeExport {\r\n    value: 'pdf' | 'png' | 'jpeg' | 'webp';\r\n    selected?: boolean;\r\n}\r\n\r\n/**\r\n * **_[interface]_**\r\n */\r\ninterface IModal {\r\n    /**\r\n     *\r\n     */\r\n    animateClass?: string;\r\n    /**\r\n     *\r\n     */\r\n    animateInClass?: string;\r\n    /**\r\n     *\r\n     */\r\n    transition?: number;\r\n    /**\r\n     *\r\n     */\r\n    backdropTransition?: number;\r\n    /**\r\n     *\r\n     */\r\n    templates?: {\r\n        dialog?: string | HTMLElement;\r\n        headerClose?: string | HTMLElement;\r\n    };\r\n}\r\n\r\n/**\r\n * **_[interface]_**\r\n */\r\nexport interface IWatermark {\r\n    /**\r\n     * Check style section to change the color\r\n     */\r\n    title?: string;\r\n\r\n    /**\r\n     * Check style section to change the color\r\n     */\r\n    subtitle?: string;\r\n\r\n    /**\r\n     * Display a small logo next to the title\r\n     * Uns PNG format if you provide a base64 string\r\n     */\r\n    logo?: false | string | HTMLImageElement | SVGElement;\r\n}\r\n\r\n/**\r\n * **_[interface]_** - Print information at the bottom of the PDF\r\n */\r\nexport interface IExtraInfo {\r\n    /**\r\n     * Print Date\r\n     */\r\n    date?: boolean;\r\n    /**\r\n     * Current site url\r\n     */\r\n    url?: boolean;\r\n    /**\r\n     * DPI, Format and Scale information\r\n     */\r\n    specs?: boolean;\r\n}\r\n\r\n/**\r\n * **_[interface]_** - MapElements\r\n * @public\r\n */\r\nexport interface IMapElements {\r\n    /**\r\n     * Layers attributions\r\n     */\r\n    attributions?: boolean;\r\n    /**\r\n     * Scalebar\r\n     */\r\n    scalebar?: boolean;\r\n    /**\r\n     * Compass image. North must be pointing to the top\r\n     */\r\n    compass?: false | string | HTMLImageElement | SVGElement;\r\n    /**\r\n     * Display WMS legends\r\n     */\r\n    legends?: LegendsOptions | boolean;\r\n}\r\n\r\n/**\r\n * **_[interface]_** - Options specified when creating an instance\r\n */\r\nexport interface Options extends ControlOptions {\r\n    /**\r\n     * Export filename\r\n     */\r\n    filename?: string;\r\n\r\n    /**\r\n     * Map unit mode\r\n     */\r\n    units?: UnitsSystem;\r\n\r\n    /**\r\n     * Allow to reframe a precise Region of Interest before exporting\r\n     */\r\n    allowReframeRegionOfInterest?: boolean;\r\n\r\n    /**\r\n     * Show zoom control when the reframe insatnce is active\r\n     */\r\n    zoomControlOnReframe?: boolean;\r\n\r\n    /**\r\n     * Show rotation control when the reframe insatnce is active\r\n     */\r\n    rotationControlOnReframe?: boolean;\r\n\r\n    /**\r\n     * Some basic PDF style configuration\r\n     */\r\n    style?: IStyle;\r\n\r\n    /**\r\n     * Information to be inserted at the bottom of the PDF\r\n     * False to disable\r\n     */\r\n    extraInfo?: false | IExtraInfo;\r\n\r\n    /**\r\n     * Allow add extra description to the print\r\n     * False to disable\r\n     */\r\n    description?: boolean;\r\n\r\n    /**\r\n     * Elements to be showed on the PDF and in the Settings Modal.\r\n     * False to disable\r\n     */\r\n    mapElements?: false | IMapElements;\r\n\r\n    /**\r\n     * Watermark to be inserted in the PDF.\r\n     * False to disable\r\n     */\r\n    watermark?: false | IWatermark;\r\n\r\n    /**\r\n     * Paper sizes options to be shown in the settings modal\r\n     */\r\n    paperSizes?: IPaperSize[];\r\n\r\n    /**\r\n     * DPI resolutions options to be shown in the settings modal\r\n     */\r\n    dpi?: IDpi[];\r\n\r\n    /**\r\n     * Export format\r\n     */\r\n    mimeTypeExports?: IMimeTypeExport[];\r\n\r\n    /**\r\n     * Locale time zone. Default varies according to browser locale\r\n     * https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date/toLocaleDateString#using_locales\r\n     */\r\n    dateFormat?: Locale;\r\n\r\n    /**\r\n     * Show the Btn toggler on the map\r\n     */\r\n    showControlBtn?: boolean;\r\n\r\n    /**\r\n     * ClassName to add to the Btn Control\r\n     */\r\n    ctrlBtnClass?: string;\r\n\r\n    /**\r\n     * Modal configuration\r\n     */\r\n    modal?: IModal;\r\n\r\n    /**\r\n     * Element to be displayed while processing in the modal\r\n     */\r\n    loader?: HTMLElement | string | false;\r\n\r\n    /**\r\n     * Language support\r\n     */\r\n    language?: 'es' | 'en';\r\n\r\n    /**\r\n     * Add custom translations\r\n     */\r\n    i18n?: I18n;\r\n}\r\n","import { I18n } from '../../ol-pdf-printer';\r\n\r\nexport const en: I18n = {\r\n    printPdf: 'Print PDF',\r\n    pleaseWait: 'Please wait...',\r\n    downloadFinished: 'Download finished, processing...',\r\n    downloadingImages: 'Downloading images',\r\n    error: 'An error occurred while printing',\r\n    errorImage: 'An error ocurred while loading an image',\r\n    printing: 'Exporting',\r\n    cancel: 'Cancel',\r\n    close: 'Close',\r\n    print: 'Export',\r\n    mapElements: 'Map elements',\r\n    extraInfo: 'Extra information',\r\n    url: 'URL',\r\n    date: 'Date',\r\n    specs: 'Specifications',\r\n    compass: 'Compass',\r\n    scale: 'Scale',\r\n    legends: 'Legends',\r\n    layersAttributions: 'Layer attributions',\r\n    addNote: 'Add note',\r\n    resolution: 'Resolution',\r\n    orientation: 'Orientation',\r\n    paperSize: 'Paper size',\r\n    landscape: 'Landscape',\r\n    portrait: 'Portrait',\r\n    current: 'Current',\r\n    paper: 'Paper',\r\n    printerMargins: 'Add printer margins',\r\n    escapeHint: 'Press here or Escape to cancel',\r\n    reframeHint: 'Pan and zoom to adjust the print area',\r\n    process: 'Process',\r\n    zoomIn: 'Zoom in',\r\n    zoomOut: 'Zoom out',\r\n    rotateLeft: 'Rotate left',\r\n    rotateRight: 'Rotate right'\r\n};\r\n","import { I18n } from '../../ol-pdf-printer';\r\n\r\nexport const es: I18n = {\r\n    printPdf: 'Exportar PDF',\r\n    pleaseWait: 'Por favor espere...',\r\n    downloadFinished: 'Descarga completada, procesando...',\r\n    downloadingImages: 'Descargando imÃ¡genes',\r\n    error: 'Error al generar pdf',\r\n    errorImage: 'OcurriÃ³ un error al tratar de cargar una imagen',\r\n    printing: 'Exportando',\r\n    cancel: 'Cancelar',\r\n    close: 'Cerrar',\r\n    print: 'Exportar',\r\n    mapElements: 'Elementos en el mapa',\r\n    extraInfo: 'InformaciÃ³n adicional',\r\n    url: 'URL',\r\n    date: 'Fecha',\r\n    specs: 'Especificaciones',\r\n    compass: 'BrÃºjula',\r\n    scale: 'Escala',\r\n    legends: 'Leyendas',\r\n    layersAttributions: 'Atribuciones de capas',\r\n    addNote: 'Agregar nota',\r\n    resolution: 'ResoluciÃ³n',\r\n    orientation: 'OrientaciÃ³n',\r\n    paperSize: 'TamaÃ±o de pÃ¡gina',\r\n    landscape: 'Paisaje',\r\n    portrait: 'Retrato',\r\n    current: 'Actual',\r\n    paper: 'Hoja',\r\n    printerMargins: 'AÃ±adir mÃ¡rgenes de impresiÃ³n',\r\n    escapeHint: 'PresionÃ¡ aquÃ­ o Escape para cancelar',\r\n    reframeHint: 'PaneÃ¡ y zoomeÃ¡ para ajustar el Ã¡rea de impresiÃ³n',\r\n    process: 'Procesar',\r\n    zoomIn: 'Acercar',\r\n    zoomOut: ' Alejar',\r\n    rotateLeft: 'Rotatar a la izquierda',\r\n    rotateRight: 'Rotate a la derecha'\r\n};\r\n","import compassIcon from './assets/images/compass.svg';\r\nimport { I18n, Options, UnitsSystem } from './ol-pdf-printer';\r\n\r\nexport const DEFAULT_LANGUAGE = 'en';\r\n\r\nexport const defaultOptions = (i18n: I18n): Options => ({\r\n    language: DEFAULT_LANGUAGE,\r\n    filename: 'Ol Pdf Printer',\r\n    allowReframeRegionOfInterest: true,\r\n    zoomControlOnReframe: true,\r\n    rotationControlOnReframe: true,\r\n    style: {\r\n        paperMargin: {\r\n            left: 4,\r\n            top: 4,\r\n            right: 4,\r\n            bottom: 4\r\n        },\r\n        watermark: {\r\n            brcolor: '#000000',\r\n            bkcolor: '#ffffff',\r\n            txcolortitle: '#d54b4b',\r\n            txcolorsubtitle: '#444444'\r\n        },\r\n        url: {\r\n            brcolor: '#000000',\r\n            bkcolor: '#ffffff',\r\n            txcolor: '#0077cc'\r\n        },\r\n        specs: {\r\n            brcolor: '#000000',\r\n            bkcolor: '#ffffff',\r\n            txcolor: '#000000'\r\n        },\r\n        scalebar: {\r\n            brcolor: '#000000',\r\n            bkcolor: '#ffffff',\r\n            txcolor: '#000000'\r\n        },\r\n        attributions: {\r\n            brcolor: '#ffffff',\r\n            bkcolor: '#ffffff',\r\n            txcolor: '#666666',\r\n            txcolorlink: '#0077cc'\r\n        },\r\n        legends: {\r\n            brcolor: '#000000',\r\n            bkcolor: '#ffffff',\r\n            txcolor: '#000000'\r\n        },\r\n        description: {\r\n            brcolor: '#333333',\r\n            bkcolor: '#333333',\r\n            txcolor: '#ffffff'\r\n        },\r\n        compass: {\r\n            brcolor: '#000000',\r\n            bkcolor: '#333333'\r\n        }\r\n    },\r\n    extraInfo: {\r\n        date: true,\r\n        url: true,\r\n        specs: true\r\n    },\r\n    description: true,\r\n    mapElements: {\r\n        attributions: true,\r\n        scalebar: true,\r\n        legends: true,\r\n        compass: compassIcon() as SVGElement\r\n    },\r\n    watermark: {\r\n        title: 'Ol Pdf Printer',\r\n        subtitle: 'https://github.com/GastonZalba/ol-pdf-printer',\r\n        logo: false\r\n    },\r\n    paperSizes: [\r\n        // { size: [1189, 841], value: 'A0' },\r\n        // { size: [841, 594], value: 'A1' },\r\n        { size: [594, 420], value: 'A2' },\r\n        { size: [420, 297], value: 'A3' },\r\n        { size: [297, 210], value: 'A4', selected: true },\r\n        { size: [210, 148], value: 'A5' }\r\n    ],\r\n    dpi: [\r\n        { value: 96 },\r\n        { value: 150, selected: true },\r\n        { value: 200 },\r\n        { value: 300 }\r\n    ],\r\n    mimeTypeExports: [\r\n        { value: 'pdf', selected: true },\r\n        { value: 'png' },\r\n        { value: 'jpeg' },\r\n        { value: 'webp' }\r\n    ],\r\n    units: UnitsSystem.Metric,\r\n    dateFormat: undefined,\r\n    showControlBtn: true,\r\n    ctrlBtnClass: '',\r\n    loader: '<span class=\"printLoader\"></span>',\r\n    modal: {\r\n        animateClass: 'fade',\r\n        animateInClass: 'show',\r\n        transition: 150,\r\n        backdropTransition: 0,\r\n        templates: {\r\n            dialog: '<div class=\"modal-dialog modal-dialog-centered\"></div>',\r\n            headerClose: `<button type=\"button\" class=\"btn-close\" data-dismiss=\"modal\" aria-label=\"${i18n.close}\"><span aria-hidden=\"true\">Ã</span></button>`\r\n        }\r\n    }\r\n});\r\n","import PdfPrinter from './ol-pdf-printer';\r\nimport * as utils from './ol-pdf-printer';\r\n\r\n// make enums and other methods accesible\r\nObject.assign(PdfPrinter, utils);\r\nexport default PdfPrinter;\r\n"],"names":["getMapScale","map","opt_round","view","getView","unit","getProjection","getUnits","scale","getResolutionForZoom","getZoom","METERS_PER_UNIT","Math","round","legendsDefaultConfig","fontAntiAliasing","fontColor","bgColor","forceLabels","forceTitles","fontSize","Legends","constructor","options","this","_legendOptions","_requestParams","_map","_view","_order","legendOptions","requestParams","order","Object","assign","getImages","dpi","txcolor","bkcolor","images","wmsLayers","getWmsLegendLayers","replace","wmsLayer","image","_getLegends","push","length","_orderImagesByIndex","getLayers","getArray","filter","layer","ImageLayer","TileLayer","getSource","TileWMS","ImageWMS","isWmsLayer","getVisible","getMapProjection","getViewExtent","calculateExtent","getSize","Promise","resolve","srcs","_getSrcFromParams","forEach","src","img","Image","dataset","index","String","getZIndex","onerror","onload","naturalHeight","sourceParams","getParams","proj","getCode","params","SERVICE","VERSION","REQUEST","FORMAT","LEGEND_OPTIONS","entries","a","join","STYLE","STYLES","CQL_FILTER","SLD_BODY","SLD","ENV","SRS","SRCWIDTH","SRCHEIGHT","SCALE","_getScale","layersName","LAYERS","layerNames","Array","isArray","split","_getLegendUrl","LAYER","source","url","getUrls","getUrl","undefined","appendParams","from","sort","x","y","xIndex","Number","yIndex","reverse","getResolution","getMetersPerUnit","createElement","tagName","attrs","children","elem","DocumentFragment","document","name","value","startsWith","toLowerCase","window","addEventListener","substr","setAttribute","toString","child","append","nodeType","innerHTML","appendChild","Pdf","_accumulativeOffsetBottomLeft","addMapHelpers","async","mapElements","extraInfo","description","watermark","_config","_addWatermark","_form","_addDescription","_addExtraInfo","compass","_addCompass","scalebar","_addScaleBar","attributions","_addAttributions","legends","_addLegends","safeMargins","_fllWhite","_processSvgImage","svg","reject","getSvgUrl","data","XMLSerializer","serializeToString","URL","createObjectURL","Blob","type","svgUrlToPng","svgUrl","callback","svgImage","body","err","console","error","_i18n","errorImage","canvas","width","clientWidth","height","clientHeight","getContext","drawImage","imgData","toDataURL","removeChild","revokeObjectURL","svgToPng","_calculateOffsetByPosition","position","offset","size","_printingMargins","left","top","_pdf","bottom","_addRoundedBox","brcolor","doc","setDrawColor","setFillColor","roundedRect","_addText","color","align","str","setTextColor","setFontSize","text","_addTextByOffset","fixX","trim","date","specs","_style","w","h","getTextDimensions","maxWidth","paddingBack","getImageElement","SVGElement","logoImage","logoSizeWidth","fontSizeSubtitle","back","marginRight","backBoxHeight","titleYPosition","subtitleYPosition","logoSpace","logo","title","subtitle","txcolortitle","setFont","wSub","widthBack","txcolorsubtitle","addImage","_addUrl","_addSpecsAndDate","_scaleDenominator","toLocaleString","paper","format","toUpperCase","resolution","_getDate","location","href","Date","now","toLocaleDateString","dateFormat","flatMap","l","attr","getAttributions","attributionsList","Set","myPragma","ATTRI_SEPATATOR","xPos","attributionsText","textContent","whiteSpaceWidth","attribution","childNodes","node","content","txcolorlink","textWithLink","log10","log","LOG10E","unitConversionFactor","maxLength","units","metre","inch","mile","yard","unroundedLength","numberOfDigits","floor","factor","pow","mapped","percentageMargin","right","fullSize","scaleBarX","scaleBarY","rect","imgSrc","rotationRadians","getRotation","imageSize","addRotation","context","translate","rotate","xCircle","yCircle","circle","rotatedCanvas","xImage","yImage","sizeImage","form","i18n","config","scaleResolution","style","paperMargin","create","orientation","_calculateScaleDenominator","_legends","_a","jspdf","jsPDF","addMapImage","dataUrl","savePdf","typeExport","save","filename","pdf","output","versionPdfJS","pdfjsLib","version","GlobalWorkerOptions","workerSrc","getDocument","promise","then","getPage","page","viewport","getViewport","display","render","canvasContext","uri","link","download","click","downloadURI","remove","pixelsPerMapMillimeter","_getMeterPerPixel","getPointResolution","getCenter","yPos","ratioSize","largestWidth","max","i","naturalWidth","accumulativeHeight","reduce","acc","curr","_factory","_defaults","freeze","el","animate","animateClass","animateInClass","appendTo","backdrop","keyboard","header","footer","buttons","headerClose","construct","transition","backdropTransition","_buttons","deepFreeze","obj","k","v","dialog","class","alert","confirm","_templates","container","prop","prefix","elData","dataAttr","getAttribute","build","html","all","nodeName","getPath","nodes","parentNode","Modal","EventEmitter","templates","_baseTemplates","_baseButtons","_baseOptions","message","_options","question","super","id","random","_html","_events","_visible","_pointerInContent","querySelector","_scrollbarWidth","inner","outerWidth","outer","visibility","offsetWidth","overflow","calcScrollbarWidth","Error","_render","_mapDom","o","t","classList","add","_setHeader","_setContent","_setFooter","contains","outerHTML","ineerHTML","button","j","_setEvents","keydownHandler","_handleKeydownEvent","bind","mousedownHandler","_handleMousedownEvent","clickHandler","_handleClickEvent","resizeHandler","_handleResizeEvent","e","target","every","emit","hide","which","_resize","show","_checkScrollbar","_setScrollbar","scrollTop","once","setTimeout","_backdrop","toggle","modalIsOverflowing","scrollHeight","documentElement","paddingLeft","bodyIsOverflowing","paddingRight","contCList","_removeEvents","originalBodyPad","removeEventListener","innerWidth","basePadding","parseInt","CLASS_PRINT_MODE","CLASS_HIDE_CONTROLS","CLASS_OVERLAY","CLASS_OVERLAY_RECTANGLE","CLASS_OVERLAY_CONTROLS","CLASS_OVERLAY_ZOOM_ENABLED","CLASS_OVERLAY_CANCEL_BTN","CLASS_OVERLAY_SAVE_BTN","CLASS_OVERLAY_REFRAME_HINT","ReframeROI","_escapeKeyListener","_saveButton","className","process","_cancelButton","onclick","cancel","escapeHint","_controlButtons","zoomControlOnReframe","onClick","_zoom","zoomIn","zoomOut","rotationControlOnReframe","_rotate","rotateLeft","rotateRight","_rectangle","reframeHint","showOverlay","mode","getTargetElement","_overlay","Overlay","element","stopEvent","addOverlay","setConstrainResolution","_addEvents","_callback","_getExtent","hideOverlay","removeOverlay","direction","delta","dd","adjustZoom","adjustRotation","mapBounds","getBoundingClientRect","overlayFrameBounds","relativePosition","topLeft","getCoordinateFromPixel","topRight","bottomLeft","bottomRight","Polygon","key","SettingsModal","printMap","_modal","printPdf","Content","Footer","modal","allowReframeRegionOfInterest","_reframeROI","on","event","print","getElementById","formData","FormData","values","get","extent","regionOfInterest","paperSizes","htmlFor","paperSize","selected","landscape","portrait","d","addNote","rows","checked","layersAttributions","printerMargins","mimeTypeExports","ProcessingModal","onEndPrint","_message","_loaderContainer","printing","loader","_setContentModal","string","_setFooterModal","set","setLoading","bool","UnitsSystem","pleaseWait","downloadFinished","downloadingImages","close","current","deepObjectAssign","sources","keys","s_val","t_val","PdfPrinter","Control","opt_options","controlElement","showControlBtn","language","Metric","ctrlBtnClass","defaultOptions","showPrintSettingsModal","setMap","_initialized","_init","_initialConstrainRes","getConstrainResolution","getMap","_settingsModal","_printMap","_processingModal","_onEndPrint","_restoreConstrains","setSize","_initialSize","setResolution","_initialViewResolution","setCenter","_initialViewCoords","_updateDPI","_removeListeners","clearTimeout","_timeoutProcessing","_cancel","_prepareLoading","_disableLoading","pixelRatio","pixelRatio_","tilePixelRatio_","refresh","VectorLayer","Cluster","changed","updateParams","updateSize","showLoading","delay","_isCanceled","_addDownloadCountListener","dim","find","widthPaper","heightPaper","_renderCompleteKey","mapCanvas","mapContext","prototype","call","querySelectorAll","opacity","globalAlpha","matrix","transform","match","CanvasRenderingContext2D","setTransform","apply","fit","nearest","increaseCount","_imageCount","_eventsKey","unByKey","hidePrintSettingsModal","createPdf","p","utils"],"mappings":"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","x_google_ignoreList":[4]}