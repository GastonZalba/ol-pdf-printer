/*!
 * ol-pdf-printer - v2.1.2
 * https://github.com/GastonZalba/ol-pdf-printer#readme
 * Built: Fri Oct 13 2023 14:08:34 GMT-0300 (Argentina Standard Time)
*/
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("ol/control/Control.js"),require("ol/proj.js"),require("ol/Observable.js"),require("ol/source/Cluster.js"),require("ol/layer/Vector.js"),require("ol/source/TileWMS.js"),require("ol/source/ImageWMS"),require("jspdf"),require("pdfjs-dist"),require("ol/uri.js"),require("ol/proj/Units.js"),require("ol/source/ImageWMS.js"),require("ol/layer/Tile.js"),require("ol/layer/Image.js"),require("ol/geom/Polygon"),require("ol/Overlay")):"function"==typeof define&&define.amd?define(["ol/control/Control.js","ol/proj.js","ol/Observable.js","ol/source/Cluster.js","ol/layer/Vector.js","ol/source/TileWMS.js","ol/source/ImageWMS","jspdf","pdfjs-dist","ol/uri.js","ol/proj/Units.js","ol/source/ImageWMS.js","ol/layer/Tile.js","ol/layer/Image.js","ol/geom/Polygon","ol/Overlay"],e):(t="undefined"!=typeof globalThis?globalThis:t||self).PdfPrinter=e(t.ol.control.Control,t.ol.proj,t.ol.Observable,t.ol.source.Cluster,t.ol.layer.Vector,t.ol.source.TileWMS,t.ol.source.ImageWMS,t.jsPDF,t.pdfjsLib,t.ol.uri,t.ol.proj.Units,t.ol.source.ImageWMS,t.ol.layer.Tile,t.ol.layer.Image,t.ol.geom.Polygon,t.ol.Overlay)}(this,(function(t,e,i,s,o,n,r,a,l,c,d,h,p,m,f,g){"use strict";window;const u=(t,e=!0)=>{const i=t.getView(),s=i.getProjection().getUnits();let o=i.getResolutionForZoom(i.getZoom())*d.METERS_PER_UNIT[s]*39.37*(25.4/.28);return e&&(o=Math.round(o)),o},_={fontAntiAliasing:"true",fontColor:"0x000000",bgColor:"0xffffff",forceLabels:"on",forceTitles:"on",fontSize:8},b={},v=!0;class y{constructor(t,e){if(this._legendOptions={},this._requestParams={},this._map=e,this._view=e.getView(),this._legendOptions=_,this._requestParams=b,this._order=v,"object"==typeof t){const{legendOptions:e,requestParams:i,order:s}=t;this._legendOptions=Object.assign(Object.assign({},this._legendOptions),e||{}),this._requestParams=Object.assign(Object.assign({},this._requestParams),i||{}),this._order=void 0!==s?s:this._order}}async getImages(t,e,i){const s=[],o=this.getWmsLegendLayers();this._legendOptions=Object.assign(Object.assign({},this._legendOptions),{dpi:t,fontColor:"0x"+e.replace("#",""),bgColor:"0x"+i.replace("#","")});for(const t of o){const e=await this._getLegends(t);e&&s.push(e)}return this._order&&s.length?this._orderImagesByIndex(s):s}getWmsLegendLayers(){return this._map.getLayers().getArray().filter((t=>(t=>(t instanceof m||t instanceof p)&&(t.getSource()instanceof n||t.getSource()instanceof h))(t)&&t.getVisible()))}getMapProjection(){return this._view.getProjection()}getViewExtent(){return this._view.calculateExtent(this._map.getSize())}async _getLegends(t){return new Promise((e=>{const i=this._getSrcFromParams(t);if(!i)return e(null);i.forEach((i=>{const s=new Image;s.dataset.index=String(t.getZIndex()),s.onerror=()=>{e(null)},s.onload=()=>{s.naturalHeight<=1?e(null):e(s)},s.src=i}))}))}_getSrcFromParams(t){const e=t.getSource().getParams(),i=this.getMapProjection().getCode(),s=Object.assign({SERVICE:"WMS",VERSION:"1.1.0",REQUEST:"GetLegendGraphic",FORMAT:"image/png",LEGEND_OPTIONS:Object.entries(this._legendOptions).map((t=>`${t[0]}:${t[1]}`)).join(";"),STYLE:e.STYLES,CQL_FILTER:e.CQL_FILTER,SLD_BODY:e.SLD_BODY,SLD:e.SLD,ENV:e.ENV,SRS:i,SRCWIDTH:this._map.getSize()[0],SRCHEIGHT:this._map.getSize()[1],SCALE:this._getScale()},this._requestParams),o=e.LAYERS,n=Array.isArray(o)?o:o.split(",");return[this._getLegendUrl(t.getSource(),Object.assign(Object.assign({},s),{LAYER:n[0]}))]}_getLegendUrl(t,e){const i="getUrls"in t?t.getUrls()[0]:"getUrl"in t?t.getUrl():void 0;if(i)return c.appendParams(i,e)}_orderImagesByIndex(t){return Array.from(t).sort(((t,e)=>{const i=Number(t.dataset.index),s=Number(e.dataset.index);return i>s?-1:i<s?1:0})).reverse()}_getScale(){return this._view.getResolution()*(this.getMapProjection()?this.getMapProjection().getMetersPerUnit():1)/28e-5}}function w(t,e={},...i){if("function"==typeof t)return t(e,i);const s=null===t?new DocumentFragment:document.createElement(t);Object.entries(e||{}).forEach((([t,e])=>{null!=e&&void 0!==e&&(t.startsWith("on")&&t.toLowerCase()in window?s.addEventListener(t.toLowerCase().substr(2),e):"className"===t?s.setAttribute("class",e.toString()):"htmlFor"===t?s.setAttribute("for",e.toString()):s.setAttribute(t,e.toString()))}));for(const t of i)t&&(Array.isArray(t)?s.append(...t):void 0===t.nodeType?s.innerHTML+=t:s.appendChild(t));return s}class x{constructor(t){this._accumulativeOffsetBottomLeft=0,this.addMapHelpers=async()=>{const{mapElements:t,extraInfo:e,description:i,watermark:s}=this._config;s&&await this._addWatermark(s),i&&this._form.description&&this._addDescription(),e&&this._addExtraInfo(e),t&&(t.compass&&this._form.compass&&await this._addCompass(t.compass),t.scalebar&&this._form.scalebar&&this._addScaleBar(),t.attributions&&this._form.attributions&&this._addAttributions(),t.legends&&this._form.legends&&await this._addLegends()),this._form.safeMargins&&this._fllWhite()},this._processSvgImage=t=>new Promise(((e,i)=>{const s=t=>{const e=(new XMLSerializer).serializeToString(t);return URL.createObjectURL(new Blob([e],{type:"image/svg+xml"}))},o=(t,e)=>{const s=document.createElement("img");document.body.appendChild(s),s.onerror=t=>(console.error(t),i(this._i18n.errorImage)),s.onload=()=>{try{const t=document.createElement("canvas");t.width=s.clientWidth,t.height=s.clientHeight;t.getContext("2d").drawImage(s,0,0);const i=t.toDataURL("image/png").replace("image/png","octet/stream");e(i),document.body.removeChild(s)}catch(t){return i(t)}},s.src=t};((t,e)=>{const i=s(t);o(i,(t=>{e(t),URL.revokeObjectURL(i)}))})(t,(t=>{e(t)}))})),this._calculateOffsetByPosition=(t,e,i=0)=>{let s,o;switch(t){case"topleft":s=e.x+this._printingMargins.left,o=e.y+this._printingMargins.top+i;break;case"topright":s=this._pdf.width-e.x-this._printingMargins.left,o=e.y+this._printingMargins.top+i;break;case"bottomright":s=this._pdf.width-e.x-this._printingMargins.left,o=this._pdf.height-e.y-this._printingMargins.bottom-i;break;case"bottomleft":o=this._pdf.height-e.y-this._printingMargins.bottom-i,s=e.x+this._printingMargins.left}return{x:s,y:o}},this._addRoundedBox=(t,e,i,s,o,n)=>{this._pdf.doc.setDrawColor(n),this._pdf.doc.setFillColor(o),this._pdf.doc.roundedRect(t,e,i,s,1,1,"FD")},this._addText=(t,e,i,s,o="left",n)=>{this._pdf.doc.setTextColor(s),this._pdf.doc.setFontSize(i),this._pdf.doc.text(n,t,e,{align:o})},this._addTextByOffset=(t,e,i,s,o,n,r)=>{const{x:a,y:l}=this._calculateOffsetByPosition(t,e),c="center"===n?a-i/2:a;this._addText(c,l,s,o,n,r)},this._addDescription=()=>{const t=this._form.description.trim(),e={x:-.7,y:this._config.extraInfo&&(this._config.extraInfo.date&&this._form.date||this._config.extraInfo.specs&&this._form.specs)?10:2},{x:i,y:s}=this._calculateOffsetByPosition("topleft",e);this._pdf.doc.setTextColor(this._style.description.txcolor),this._pdf.doc.setFontSize(8);const{w:o,h:n}=this._pdf.doc.getTextDimensions(t,{maxWidth:50,fontSize:8});this._addRoundedBox(i,s,o+4,n+4,this._style.description.bkcolor,this._style.description.brcolor),this._pdf.doc.text(t,i+2,s+4,{align:"left",maxWidth:50})},this._addWatermark=async t=>{const e=async t=>{let e;if("string"==typeof t)e=t;else{if(!(t instanceof SVGElement))throw this._i18n.errorImage;e=await this._processSvgImage(t)}return new Promise(((t,i)=>{const s=new Image;s.onload=()=>{try{t(s)}catch(t){return i(t)}},s.onerror=()=>i(this._i18n.errorImage),s.src=e}))};let i;let s;const o=14/1.8;let n=!1;const{x:r,y:a}=this._calculateOffsetByPosition("topright",{x:2,y:2});let l=0,c=4,d=a+2+1.5,h=a+2,p=0;if(t.logo){i=t.logo instanceof Image?t.logo:await e(t.logo);s=12*(i.width/i.height),p=3,l=s+p,c+=14,t.title&&(d+=4,h+=2),t.subtitle&&(h+=5,d-=2)}else t.title&&(c+=5,h+=5),t.subtitle&&(c+=3),t.title&&t.subtitle&&(c+=1);if(t.title){this._pdf.doc.setTextColor(this._style.watermark.txcolortitle),this._pdf.doc.setFontSize(14),this._pdf.doc.setFont("helvetica","bold");let{w:e}=this._pdf.doc.getTextDimensions(t.title);if(t.subtitle){this._pdf.doc.setFontSize(o),this._pdf.doc.setFont("helvetica","normal");const i=this._pdf.doc.getTextDimensions(t.subtitle).w;e=i>e?i:e,this._pdf.doc.setFontSize(14)}const i=e+4;this._addRoundedBox(r-i+2-l,a-4,i+2+l+p,c,this._style.watermark.bkcolor,this._style.watermark.brcolor),n=!0,this._pdf.doc.setFont("helvetica","bold"),this._pdf.doc.text(t.title,r-l,d,{align:"right"})}if(t.subtitle){if(this._pdf.doc.setTextColor(this._style.watermark.txcolorsubtitle),this._pdf.doc.setFontSize(o),this._pdf.doc.setFont("helvetica","normal"),!n){const{w:e}=this._pdf.doc.getTextDimensions(t.subtitle),i=4+e;this._addRoundedBox(r-i+2-l,a-4,i+2+l,c,this._style.watermark.bkcolor,this._style.watermark.brcolor),n=!0}this._pdf.doc.text(t.subtitle,r-l,h,{align:"right"})}if(t.logo){if(!n){const t=l+2;this._addRoundedBox(r,a-4,t,16,this._style.watermark.bkcolor,this._style.watermark.brcolor)}this._pdf.doc.addImage(i,"PNG",r-s,a,s,12)}},this._addExtraInfo=t=>{t.url&&this._form.url&&this._addUrl(),(t.specs&&this._form.specs||t.date&&this._form.date)&&this._addSpecsAndDate()},this._addSpecsAndDate=()=>{const t="topleft",e={x:1,y:2.5},i=this._style.specs.txcolor,{x:s,y:o}=this._calculateOffsetByPosition(t,e);this._pdf.doc.setFont("helvetica","bold"),this._pdf.doc.setFontSize(6);let n="";if(this._form.specs&&this._config.extraInfo&&this._config.extraInfo.specs){const t=`${this._i18n.scale} 1:${this._scaleDenominator.toLocaleString("de")}`,e=`${this._i18n.paper} ${this._form.format.toUpperCase()}`;n=[t,`${this._form.resolution} DPI`,e].join(" - ")}if(this._form.date&&this._config.extraInfo&&this._config.extraInfo.date){const t=this._getDate();n?n+=` (${t})`:n=t}const{w:r,h:a}=this._pdf.doc.getTextDimensions(n,{fontSize:6});this._addRoundedBox(s-4,o-a-4,r+6,a+6,this._style.specs.bkcolor,this._style.specs.brcolor),this._addTextByOffset(t,e,r,6,i,"left",n)},this._addUrl=()=>{const t="bottomleft",e={x:1,y:1},i=this._style.url.txcolor;this._pdf.doc.setFont("helvetica","italic");const s=window.location.href,{x:o,y:n}=this._calculateOffsetByPosition(t,e),{w:r,h:a}=this._pdf.doc.getTextDimensions(s,{fontSize:6});this._addRoundedBox(o-4,n-a-1,r+6,a+6,this._style.url.bkcolor,this._style.url.brcolor),this._addTextByOffset(t,e,250,6,i,"left",s),this._accumulativeOffsetBottomLeft=e.y+a+1},this._getDate=()=>String(new Date(Date.now()).toLocaleDateString(this._config.dateFormat)),this._addAttributions=()=>{const t=this._map.getLayers().getArray().flatMap((t=>{if("getSource"in t&&"function"==typeof t.getSource){const e=t.getSource().getAttributions();if(e){if("function"==typeof e)try{return e(null)}catch(t){console.error(t)}return e}}return[]}));if(!t.length)return;const e=[...new Set(t)].map((t=>w("span",null,t))),i=" · ";this._pdf.doc.setFont("helvetica","normal"),this._pdf.doc.setFontSize(7);const{x:s,y:o}=this._calculateOffsetByPosition("bottomright",{x:1,y:1});let n=s;const r=e.map((t=>t.textContent)).join(i),{w:a,h:l}=this._pdf.doc.getTextDimensions(r,{fontSize:7}),c=this._pdf.doc.getTextDimensions(i,{fontSize:7}).w;this._addRoundedBox(s-a-2,o-l,a+4+2,l+4,this._style.attributions.bkcolor,this._style.attributions.brcolor),Array.from(e).reverse().forEach(((t,s)=>{Array.from(t.childNodes).reverse().forEach((t=>{const e=t.textContent;"href"in t?(this._pdf.doc.setTextColor(this._style.attributions.txcolorlink),this._pdf.doc.textWithLink(e,n,o,{align:"right",url:t.href})):(this._pdf.doc.setTextColor(this._style.attributions.txcolor),this._pdf.doc.text(e,n,o,{align:"right"}));const{w:i}=this._pdf.doc.getTextDimensions(e);n-=i})),s!==e.length-1&&(this._pdf.doc.text(i,n,o,{align:"right"}),n-=c)}))},this._addScaleBar=()=>{const t={x:-.7,y:this._config.extraInfo&&(this._form.url&&this._config.extraInfo.url||this._form.specs&&this._config.extraInfo.specs)?this._accumulativeOffsetBottomLeft+12:12},{x:e,y:i}=this._calculateOffsetByPosition("bottomleft",t),s=Math.log10||function(t){return Math.log(t)*Math.LOG10E};let o,n,r=90*this._scaleDenominator;if("metric"===this._config.units){o="mm";const t=1e3;n=1,r>=10*(1e3*t)?(o="km",n=1e6):r>=10*t&&(o="m",n=t)}else if("imperial"===this._config.units){const t=25.4,e=63360*t,i=36*t;o="in",n=t,r>=10*e?(o="mi",n=e):r>=10*i&&(o="yd",n=i)}r/=n;const a=r,l=Math.floor(s(a)),c=Math.pow(10,l),d=a/c;let h=Math.floor(r);h=d>8?8*c:d>4?4*c:d>2?2*c:c;let p=h*n/this._scaleDenominator/4;const m=this._form.safeMargins?(this._printingMargins.left+this._printingMargins.right)/this._pdf.width*100:null;p=m?p/100*(100-m):p;const f=4*p,g=e+4,u=i+5;this._addRoundedBox(e,i,f+8,10,this._style.scalebar.bkcolor,this._style.scalebar.brcolor),this._pdf.doc.setDrawColor(this._style.scalebar.txcolor),this._pdf.doc.setFillColor(this._style.scalebar.txcolor),this._pdf.doc.rect(g,u,p,1,"FD"),this._pdf.doc.setDrawColor(this._style.scalebar.txcolor),this._pdf.doc.setFillColor(this._style.scalebar.bkcolor),this._pdf.doc.rect(g+p,u,p,1,"FD"),this._pdf.doc.setDrawColor(this._style.scalebar.txcolor),this._pdf.doc.setFillColor(this._style.scalebar.txcolor),this._pdf.doc.rect(g+2*p,u,2*p,1,"FD"),this._pdf.doc.setTextColor(this._style.scalebar.txcolor),this._pdf.doc.setFontSize(6),this._pdf.doc.text("0",g,u-1),this._pdf.doc.text(String(Math.round(10*h/4)/10),g+p-1,u-1),this._pdf.doc.text(String(Math.round(h/2)),g+2*p-2,u-1),this._pdf.doc.text(Math.round(h).toString()+" "+o,g+4*p-4,u-1),this._accumulativeOffsetBottomLeft=t.y},this._addCompass=async t=>{const e=this._view.getRotation(),i=100,{x:s,y:o}=this._calculateOffsetByPosition("bottomright",{x:2,y:6},6),n=t=>{const n=document.createElement("canvas");n.height=120,n.width=120;const r=n.getContext("2d");r.translate(.5*n.width,.5*n.height),r.rotate(e),r.translate(.5*-n.width,.5*-n.height),r.drawImage(t,(n.height-i)/2,(n.width-i)/2,i,i);const a=s-6,l=o;return this._pdf.doc.setDrawColor(this._style.compass.brcolor),this._pdf.doc.setFillColor(this._style.compass.bkcolor),this._pdf.doc.circle(a,l,6,"FD"),n},r=t=>{const e=n(t),i=s-9-6/4.3,r=o-4.5;this._pdf.doc.addImage(e,"PNG",i,r,9,9)};if(!(t instanceof Image)){let e;if("string"==typeof t)e=t;else{if(!(t instanceof SVGElement))throw this._i18n.errorImage;e=await this._processSvgImage(t)}return new Promise(((t,s)=>{const o=new Image(i,i);o.onload=()=>{r(o),t()},o.onerror=()=>{s(this._i18n.errorImage)},o.src=e}))}r(undefined)};const{map:e,form:i,i18n:s,config:o,height:n,width:r,scaleResolution:a}=t;this._map=e,this._view=e.getView(),this._form=i,this._i18n=s,this._config=o,this._style=o.style,this._form.safeMargins?this._printingMargins="number"==typeof o.style.paperMargin?{top:o.style.paperMargin,left:o.style.paperMargin,right:o.style.paperMargin,bottom:o.style.paperMargin}:o.style.paperMargin:this._printingMargins={top:0,left:0,right:0,bottom:0},this._pdf=this.create(this._form.orientation,this._form.format,n,r),this._scaleDenominator=this._calculateScaleDenominator(this._form.resolution,a),o.mapElements&&o.mapElements.legends&&(this._legends=new y(o.mapElements.legends,e))}create(t,e,i,s){var o;return{doc:new((null===(o=window.jspdf)||void 0===o?void 0:o.jsPDF)||a.jsPDF)({orientation:t,format:e}),height:i,width:s}}addMapImage(t){this._pdf.doc.addImage(t,"JPEG",this._printingMargins.left,this._printingMargins.top,this._pdf.width-(this._printingMargins.left+this._printingMargins.right),this._pdf.height-(this._printingMargins.top+this._printingMargins.bottom))}savePdf(){return new Promise(((t,e)=>{var i;if("pdf"===this._form.typeExport)this._pdf.doc.save(this._config.filename+".pdf"),t();else{const s=this._pdf.doc.output("dataurlstring"),o=(null===(i=null===window||void 0===window?void 0:window.pdfjsLib)||void 0===i?void 0:i.version)||l.version;l.GlobalWorkerOptions.workerSrc=`https://cdnjs.cloudflare.com/ajax/libs/pdf.js/${o}/pdf.worker.js`,l.getDocument(s).promise.then((e=>{e.getPage(1).then((e=>{const i=this._form.resolution/100*1.39,s=e.getViewport({scale:i}),o=w("canvas",null);o.style.display="none",document.body.appendChild(o);const n=o.getContext("2d");o.height=s.height,o.width=s.width;e.render({canvasContext:n,viewport:s}).promise.then((()=>{((t,e)=>{const i=w("a",{download:e,href:t});document.body.appendChild(i),i.click(),document.body.removeChild(i)})(o.toDataURL(`image/${this._form.typeExport}`),this._config.filename+`.${this._form.typeExport}`),o.remove(),t()}))}))}),(t=>{e(t),console.log(t)}))}}))}_fllWhite(){this._pdf.doc.setFillColor("#ffffff"),this._pdf.doc.rect(0,0,this._printingMargins.left,this._pdf.height,"F"),this._pdf.doc.rect(this._pdf.width-this._printingMargins.right,0,this._printingMargins.right,this._pdf.height,"F"),this._pdf.doc.rect(0,0,this._pdf.width,this._printingMargins.top,"F"),this._pdf.doc.rect(0,this._pdf.height-this._printingMargins.bottom,this._pdf.width,this._printingMargins.bottom,"F")}_calculateScaleDenominator(t,e){const i=t/25.4;return Math.round(1e3*i*this._getMeterPerPixel(e))}_getMeterPerPixel(t){const i=this._view.getProjection();return e.getPointResolution(i,t,this._view.getCenter())*i.getMetersPerUnit()}async _addLegends(){const t={x:1,y:this._accumulativeOffsetBottomLeft+3},{x:e,y:i}=this._calculateOffsetByPosition("bottomleft",t);let s=i;const o=await this._legends.getImages(1.5*this._form.resolution,this._style.legends.txcolor,this._style.legends.bkcolor);if(!o.length)return;const n=1/(this._form.resolution/15),r=Math.max(...o.map((t=>t.naturalWidth)))*n,a=o.reduce(((t,e)=>t+e.naturalHeight*n),0);this._addRoundedBox(e-3,i-a-1,r+6,a+2,this._style.legends.bkcolor,this._style.legends.brcolor),o.forEach((t=>{const{naturalWidth:i,naturalHeight:o}=t,r=i*n,a=o*n;this._pdf.doc.addImage(t,e,s-a,r,a),s-=a}))}}function C(){}function L(){L.init.call(this)}function M(t){return void 0===t._maxListeners?L.defaultMaxListeners:t._maxListeners}function E(t,e,i,s){var o,n,r,a;if("function"!=typeof i)throw new TypeError('"listener" argument must be a function');if((n=t._events)?(n.newListener&&(t.emit("newListener",e,i.listener?i.listener:i),n=t._events),r=n[e]):(n=t._events=new C,t._eventsCount=0),r){if("function"==typeof r?r=n[e]=s?[i,r]:[r,i]:s?r.unshift(i):r.push(i),!r.warned&&(o=M(t))&&o>0&&r.length>o){r.warned=!0;var l=new Error("Possible EventEmitter memory leak detected. "+r.length+" "+e+" listeners added. Use emitter.setMaxListeners() to increase limit");l.name="MaxListenersExceededWarning",l.emitter=t,l.type=e,l.count=r.length,a=l,"function"==typeof console.warn?console.warn(a):console.log(a)}}else r=n[e]=i,++t._eventsCount;return t}function S(t,e,i){var s=!1;function o(){t.removeListener(e,o),s||(s=!0,i.apply(t,arguments))}return o.listener=i,o}function k(t){var e=this._events;if(e){var i=e[t];if("function"==typeof i)return 1;if(i)return i.length}return 0}function O(t,e){for(var i=new Array(e);e--;)i[e]=t[e];return i}C.prototype=Object.create(null),L.EventEmitter=L,L.usingDomains=!1,L.prototype.domain=void 0,L.prototype._events=void 0,L.prototype._maxListeners=void 0,L.defaultMaxListeners=10,L.init=function(){this.domain=null,L.usingDomains&&undefined.active,this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=new C,this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},L.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||isNaN(t))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=t,this},L.prototype.getMaxListeners=function(){return M(this)},L.prototype.emit=function(t){var e,i,s,o,n,r,a,l="error"===t;if(r=this._events)l=l&&null==r.error;else if(!l)return!1;if(a=this.domain,l){if(e=arguments[1],!a){if(e instanceof Error)throw e;var c=new Error('Uncaught, unspecified "error" event. ('+e+")");throw c.context=e,c}return e||(e=new Error('Uncaught, unspecified "error" event')),e.domainEmitter=this,e.domain=a,e.domainThrown=!1,a.emit("error",e),!1}if(!(i=r[t]))return!1;var d="function"==typeof i;switch(s=arguments.length){case 1:!function(t,e,i){if(e)t.call(i);else for(var s=t.length,o=O(t,s),n=0;n<s;++n)o[n].call(i)}(i,d,this);break;case 2:!function(t,e,i,s){if(e)t.call(i,s);else for(var o=t.length,n=O(t,o),r=0;r<o;++r)n[r].call(i,s)}(i,d,this,arguments[1]);break;case 3:!function(t,e,i,s,o){if(e)t.call(i,s,o);else for(var n=t.length,r=O(t,n),a=0;a<n;++a)r[a].call(i,s,o)}(i,d,this,arguments[1],arguments[2]);break;case 4:!function(t,e,i,s,o,n){if(e)t.call(i,s,o,n);else for(var r=t.length,a=O(t,r),l=0;l<r;++l)a[l].call(i,s,o,n)}(i,d,this,arguments[1],arguments[2],arguments[3]);break;default:for(o=new Array(s-1),n=1;n<s;n++)o[n-1]=arguments[n];!function(t,e,i,s){if(e)t.apply(i,s);else for(var o=t.length,n=O(t,o),r=0;r<o;++r)n[r].apply(i,s)}(i,d,this,o)}return!0},L.prototype.addListener=function(t,e){return E(this,t,e,!1)},L.prototype.on=L.prototype.addListener,L.prototype.prependListener=function(t,e){return E(this,t,e,!0)},L.prototype.once=function(t,e){if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');return this.on(t,S(this,t,e)),this},L.prototype.prependOnceListener=function(t,e){if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');return this.prependListener(t,S(this,t,e)),this},L.prototype.removeListener=function(t,e){var i,s,o,n,r;if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');if(!(s=this._events))return this;if(!(i=s[t]))return this;if(i===e||i.listener&&i.listener===e)0==--this._eventsCount?this._events=new C:(delete s[t],s.removeListener&&this.emit("removeListener",t,i.listener||e));else if("function"!=typeof i){for(o=-1,n=i.length;n-- >0;)if(i[n]===e||i[n].listener&&i[n].listener===e){r=i[n].listener,o=n;break}if(o<0)return this;if(1===i.length){if(i[0]=void 0,0==--this._eventsCount)return this._events=new C,this;delete s[t]}else!function(t,e){for(var i=e,s=i+1,o=t.length;s<o;i+=1,s+=1)t[i]=t[s];t.pop()}(i,o);s.removeListener&&this.emit("removeListener",t,r||e)}return this},L.prototype.off=function(t,e){return this.removeListener(t,e)},L.prototype.removeAllListeners=function(t){var e,i;if(!(i=this._events))return this;if(!i.removeListener)return 0===arguments.length?(this._events=new C,this._eventsCount=0):i[t]&&(0==--this._eventsCount?this._events=new C:delete i[t]),this;if(0===arguments.length){for(var s,o=Object.keys(i),n=0;n<o.length;++n)"removeListener"!==(s=o[n])&&this.removeAllListeners(s);return this.removeAllListeners("removeListener"),this._events=new C,this._eventsCount=0,this}if("function"==typeof(e=i[t]))this.removeListener(t,e);else if(e)do{this.removeListener(t,e[e.length-1])}while(e[0]);return this},L.prototype.listeners=function(t){var e,i=this._events;return i&&(e=i[t])?"function"==typeof e?[e.listener||e]:function(t){for(var e=new Array(t.length),i=0;i<e.length;++i)e[i]=t[i].listener||t[i];return e}(e):[]},L.listenerCount=function(t,e){return"function"==typeof t.listenerCount?t.listenerCount(e):k.call(t,e)},L.prototype.listenerCount=k,L.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};let P=null;const j=Object.freeze({el:null,animate:!0,animateClass:"fade",animateInClass:"show",appendTo:"body",backdrop:!0,keyboard:!0,title:!1,header:!0,content:!1,footer:!0,buttons:null,headerClose:!0,construct:!1,transition:300,backdropTransition:150}),I=function t(e){for(let i in e)Array.isArray(e[i])?e[i].forEach((e=>{t(e)})):null!==e[i]&&"object"==typeof e[i]&&Object.freeze(e[i]);return Object.freeze(e)}({dialog:[{text:"Cancel",value:!1,attr:{class:"btn btn-default","data-dismiss":"modal"}},{text:"OK",value:!0,attr:{class:"btn btn-primary","data-dismiss":"modal"}}],alert:[{text:"OK",attr:{class:"btn btn-primary","data-dismiss":"modal"}}],confirm:[{text:"Cancel",value:!1,attr:{class:"btn btn-default","data-dismiss":"modal"}},{text:"OK",value:!0,attr:{class:"btn btn-primary","data-dismiss":"modal"}}]}),T={container:'<div class="modal"></div>',dialog:'<div class="modal-dialog"></div>',content:'<div class="modal-content"></div>',header:'<div class="modal-header"></div>',headerClose:'<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>',body:'<div class="modal-body"></div>',footer:'<div class="modal-footer"></div>',backdrop:'<div class="modal-backdrop"></div>'};function z(t,e,i){let s="data",o=t[s]||{};if(void 0===i){if(t[s]&&t[s][e])return t[s][e];var n=t.getAttribute(`${s}-${e}`);return void 0!==n?n:null}return o[e]=i,t[s]=o,t}function R(t,e){return t.nodeName?t:(t=t.replace(/(\t|\n$)/g,""),P||(P=document.createElement("div")),P.innerHTML="",P.innerHTML=t,!0===e?P.childNodes:P.childNodes[0])}function F(t){let e=[t];for(;t.parentNode;)t=t.parentNode,e.push(t);return e}class D extends L{static set templates(t){this._baseTemplates=t}static get templates(){return Object.assign({},T,D._baseTemplates||{})}static set buttons(t){this._baseButtons=t}static get buttons(){return Object.assign({},I,D._baseButtons||{})}static set options(t){this._baseOptions=t}static get options(){return Object.assign({},j,D._baseOptions||{})}static get version(){return"0.12.0"}static alert(t,e={}){let i=Object.assign({},j,{title:t,content:!1,construct:!0,headerClose:!1,buttons:D.buttons.alert},e);return new D(i)}static confirm(t,e={}){let i=Object.assign({},j,{title:t,content:!1,construct:!0,headerClose:!1,buttons:D.buttons.confirm},e);return new D(i)}constructor(t={}){if(super(),this.id=(65536*(1+Math.random())|0).toString(16)+(65536*(1+Math.random())|0).toString(16),this.el=null,this._html={},this._events={},this._visible=!1,this._pointerInContent=!1,this._options=Object.assign({},D.options,t),this._templates=Object.assign({},D.templates,t.templates||{}),this._html.appendTo=document.querySelector(this._options.appendTo),this._scrollbarWidth=function(){let t,e,i,s=document.createElement("div");return Object.assign(s.style,{visibility:"hidden",width:"100px"}),document.body.appendChild(s),i=s.offsetWidth,s.style.overflow="scroll",t=document.createElement("div"),t.style.width="100%",s.appendChild(t),e=i-t.offsetWidth,document.body.removeChild(s),e}(),null===this._options.buttons&&(this._options.buttons=D.buttons.dialog),this._options.el){let t=this._options.el;if("string"==typeof this._options.el&&(t=document.querySelector(this._options.el),!t))throw new Error(`Selector: DOM Element ${this._options.el} not found.`);z(t,"modal",this),this.el=t}else this._options.construct=!0;this._options.construct?this._render():this._mapDom()}_render(){let t=this._html,e=this._options,i=this._templates,s=!!e.animate&&e.animateClass;return t.container=R(i.container),t.dialog=R(i.dialog),t.content=R(i.content),t.header=R(i.header),t.headerClose=R(i.headerClose),t.body=R(i.body),t.footer=R(i.footer),s&&t.container.classList.add(s),this._setHeader(),this._setContent(),this._setFooter(),this.el=t.container,t.dialog.appendChild(t.content),t.container.appendChild(t.dialog),this}_mapDom(){let t=this._html,e=this._options;return this.el.classList.contains(e.animateClass)&&(e.animate=!0),t.container=this.el,t.dialog=this.el.querySelector(".modal-dialog"),t.content=this.el.querySelector(".modal-content"),t.header=this.el.querySelector(".modal-header"),t.headerClose=this.el.querySelector(".modal-header .close"),t.body=this.el.querySelector(".modal-body"),t.footer=this.el.querySelector(".modal-footer"),this._setHeader(),this._setContent(),this._setFooter(),this}_setHeader(){let t=this._html,e=this._options;e.header&&t.header&&(e.title.nodeName?t.header.innerHTML=e.title.outerHTML:"string"==typeof e.title&&(t.header.innerHTML=`<h4 class="modal-title">${e.title}</h4>`),null===this.el&&t.headerClose&&e.headerClose&&t.header.appendChild(t.headerClose),e.construct&&t.content.appendChild(t.header))}_setContent(){let t=this._html,e=this._options;e.content&&t.body&&("string"==typeof e.content?t.body.innerHTML=e.content:t.body.innerHTML=e.content.outerHTML,e.construct&&t.content.appendChild(t.body))}_setFooter(){let t=this._html,e=this._options;e.footer&&t.footer&&(e.footer.nodeName?t.footer.ineerHTML=e.footer.outerHTML:"string"==typeof e.footer?t.footer.innerHTML=e.footer:t.footer.children.length||e.buttons.forEach((e=>{let i=document.createElement("button");z(i,"button",e),i.innerHTML=e.text,i.setAttribute("type","button");for(let t in e.attr)i.setAttribute(t,e.attr[t]);t.footer.appendChild(i)})),e.construct&&t.content.appendChild(t.footer))}_setEvents(){this._options;let t=this._html;this._events.keydownHandler=this._handleKeydownEvent.bind(this),document.body.addEventListener("keydown",this._events.keydownHandler),this._events.mousedownHandler=this._handleMousedownEvent.bind(this),t.container.addEventListener("mousedown",this._events.mousedownHandler),this._events.clickHandler=this._handleClickEvent.bind(this),t.container.addEventListener("click",this._events.clickHandler),this._events.resizeHandler=this._handleResizeEvent.bind(this),window.addEventListener("resize",this._events.resizeHandler)}_handleMousedownEvent(t){this._pointerInContent=!1,F(t.target).every((t=>!t.classList||!t.classList.contains("modal-content")||(this._pointerInContent=!0,!1)))}_handleClickEvent(t){F(t.target).every((e=>"HTML"!==e.tagName&&((!0===this._options.backdrop||!e.classList.contains("modal"))&&(!e.classList.contains("modal-content")&&("modal"===e.getAttribute("data-dismiss")?(this.emit("dismiss",this,t,z(t.target,"button")),this.hide(),!1):!(!this._pointerInContent&&e.classList.contains("modal"))||(this.emit("dismiss",this,t,null),this.hide(),!1)))))),this._pointerInContent=!1}_handleKeydownEvent(t){27===t.which&&this._options.keyboard&&(this.emit("dismiss",this,t,null),this.hide())}_handleResizeEvent(t){this._resize()}show(){let t=this._options,e=this._html;return this.emit("show",this),this._checkScrollbar(),this._setScrollbar(),document.body.classList.add("modal-open"),t.construct&&e.appendTo.appendChild(e.container),e.container.style.display="block",e.container.scrollTop=0,!1!==t.backdrop?(this.once("showBackdrop",(()=>{this._setEvents(),t.animate&&e.container.offsetWidth,e.container.classList.add(t.animateInClass),setTimeout((()=>{this._visible=!0,this.emit("shown",this)}),t.transition)})),this._backdrop()):(this._setEvents(),t.animate&&e.container.offsetWidth,e.container.classList.add(t.animateInClass),setTimeout((()=>{this._visible=!0,this.emit("shown",this)}),t.transition)),this._resize(),this}toggle(){this._visible?this.hide():this.show()}_resize(){var t=this._html.container.scrollHeight>document.documentElement.clientHeight;this._html.container.style.paddingLeft=!this.bodyIsOverflowing&&t?this._scrollbarWidth+"px":"",this._html.container.style.paddingRight=this.bodyIsOverflowing&&!t?this._scrollbarWidth+"px":""}_backdrop(){let t=this._html,e=this._templates,i=this._options,s=!!i.animate&&i.animateClass;t.backdrop=R(e.backdrop),s&&t.backdrop.classList.add(s),t.appendTo.appendChild(t.backdrop),s&&t.backdrop.offsetWidth,t.backdrop.classList.add(i.animateInClass),setTimeout((()=>{this.emit("showBackdrop",this)}),this._options.backdropTransition)}hide(){let t=this._html,e=this._options,i=t.container.classList;if(this.emit("hide",this),i.remove(e.animateInClass),e.backdrop){t.backdrop.classList.remove(e.animateInClass)}return this._removeEvents(),setTimeout((()=>{document.body.classList.remove("modal-open"),document.body.style.paddingRight=this.originalBodyPad}),e.backdropTransition),setTimeout((()=>{e.backdrop&&t.backdrop.parentNode.removeChild(t.backdrop),t.container.style.display="none",e.construct&&t.container.parentNode.removeChild(t.container),this._visible=!1,this.emit("hidden",this)}),e.transition),this}_removeEvents(){this._events.keydownHandler&&document.body.removeEventListener("keydown",this._events.keydownHandler),this._html.container.removeEventListener("mousedown",this._events.mousedownHandler),this._html.container.removeEventListener("click",this._events.clickHandler),window.removeEventListener("resize",this._events.resizeHandler)}_checkScrollbar(){this.bodyIsOverflowing=document.body.clientWidth<window.innerWidth}_setScrollbar(){if(this.originalBodyPad=document.body.style.paddingRight||"",this.bodyIsOverflowing){let t=parseInt(this.originalBodyPad||0,10);document.body.style.paddingRight=t+this._scrollbarWidth+"px"}}}const B="printMode",A="hideControls";const N="opp-overlay-frame",H=N+"-rectangle",W=N+"-controls",q=N+"-zoom-enabled",U=N+"-cancel-btn",V=N+"-save-btn",$=N+"-reframe-hint";class K{constructor(t,e,i){this._removeEvents=()=>{document.removeEventListener("keydown",this._escapeKeyListener)},this._map=t,this._view=this._map.getView(),this._saveButton=w("button",{type:"button",className:`btn btn-lg btn-primary ${V}`},e.process),this._cancelButton=w("button",{type:"button",className:`btn-close btn-close-white ${U}`,onclick:()=>this.cancel(),title:e.escapeHint},w("span",{"aria-hidden":"true"},"×")),this._controlButtons=w("div",{className:W}),i.zoomControlOnReframe&&this._controlButtons.append(w("div",{className:"opp-zoom ol-control ol-unselectable"},w("button",{type:"button",className:"opp-zoom-in",onClick:()=>this._zoom("in"),title:e.zoomIn},(new DOMParser).parseFromString('<svg version="1.1" xmlns="http://www.w3.org/2000/svg" width="352" height="448" viewBox="0 0 352 448">\r\n<path d="M352 184v48c0 13.25-10.75 24-24 24h-104v104c0 13.25-10.75 24-24 24h-48c-13.25 0-24-10.75-24-24v-104h-104c-13.25 0-24-10.75-24-24v-48c0-13.25 10.75-24 24-24h104v-104c0-13.25 10.75-24 24-24h48c13.25 0 24 10.75 24 24v104h104c13.25 0 24 10.75 24 24z"></path>\r\n</svg>\r\n',"image/svg+xml").firstChild),w("button",{type:"button",className:"opp-zoom-out",onClick:()=>this._zoom("out"),title:e.zoomOut},(new DOMParser).parseFromString('<svg version="1.1" xmlns="http://www.w3.org/2000/svg" width="352" height="448" viewBox="0 0 352 448">\r\n<path d="M352 184v48c0 13.25-10.75 24-24 24h-304c-13.25 0-24-10.75-24-24v-48c0-13.25 10.75-24 24-24h304c13.25 0 24 10.75 24 24z"></path>\r\n</svg>\r\n',"image/svg+xml").firstChild))),i.rotationControlOnReframe&&this._controlButtons.append(w("div",{className:"opp-rotation ol-control ol-unselectable"},w("button",{type:"button",className:"opp-rotation-left",onClick:()=>this._rotate("left"),title:e.rotateLeft},(new DOMParser).parseFromString('<svg version="1.1" xmlns="http://www.w3.org/2000/svg" width="384" height="448" viewBox="0 0 384 448">\r\n<path d="M384 224c0 105.75-86.25 192-192 192-57.25 0-111.25-25.25-147.75-69.25-2.5-3.25-2.25-8 0.5-10.75l34.25-34.5c1.75-1.5 4-2.25 6.25-2.25 2.25 0.25 4.5 1.25 5.75 3 24.5 31.75 61.25 49.75 101 49.75 70.5 0 128-57.5 128-128s-57.5-128-128-128c-32.75 0-63.75 12.5-87 34.25l34.25 34.5c4.75 4.5 6 11.5 3.5 17.25-2.5 6-8.25 10-14.75 10h-112c-8.75 0-16-7.25-16-16v-112c0-6.5 4-12.25 10-14.75 5.75-2.5 12.75-1.25 17.25 3.5l32.5 32.25c35.25-33.25 83-53 132.25-53 105.75 0 192 86.25 192 192z"></path>\r\n</svg>\r\n',"image/svg+xml").firstChild),w("button",{type:"button",className:"opp-rotation-right",onClick:()=>this._rotate("right"),title:e.rotateRight},(new DOMParser).parseFromString('<svg version="1.1" xmlns="http://www.w3.org/2000/svg" width="384" height="448" viewBox="0 0 384 448">\r\n<path d="M384 64v112c0 8.75-7.25 16-16 16h-112c-6.5 0-12.25-4-14.75-10-2.5-5.75-1.25-12.75 3.5-17.25l34.5-34.5c-23.5-21.75-54.5-34.25-87.25-34.25-70.5 0-128 57.5-128 128s57.5 128 128 128c39.75 0 76.5-18 101-49.75 1.25-1.75 3.5-2.75 5.75-3 2.25 0 4.5 0.75 6.25 2.25l34.25 34.5c3 2.75 3 7.5 0.5 10.75-36.5 44-90.5 69.25-147.75 69.25-105.75 0-192-86.25-192-192s86.25-192 192-192c49.25 0 97 19.75 132.25 53l32.5-32.25c4.5-4.75 11.5-6 17.5-3.5 5.75 2.5 9.75 8.25 9.75 14.75z"></path>\r\n</svg>\r\n',"image/svg+xml").firstChild))),this._rectangle=w("div",{className:`${H} ${i.zoomControlOnReframe?q:""}`},this._cancelButton,w("div",null,w("div",null,this._saveButton),w("div",{className:$},e.reframeHint)),(i.zoomControlOnReframe||i.rotationControlOnReframe)&&this._controlButtons)}showOverlay(t,e){this._map.getTargetElement().classList.add(A),this._overlay=new g({className:`${N} ${t}-mode`,element:this._rectangle,stopEvent:!0}),this._map.addOverlay(this._overlay),this._view.setConstrainResolution(!1),this._addEvents(),this._callback=e,this._saveButton.onclick=()=>{e(this._getExtent()),setTimeout((()=>{this.hideOverlay()}),10)}}cancel(){this.hideOverlay(),this._callback&&this._callback(null)}hideOverlay(){this._overlay&&this._map.removeOverlay(this._overlay),this._removeEvents(),this._map.getTargetElement().classList.remove(A)}_zoom(t,e=.5){const i=.261799*e,s="in"===t?"":"-";this._view.adjustZoom(Number(s+i))}_rotate(t,e=.5){const i=.261799*e,s="right"===t?"":"-";this._view.adjustRotation(Number(s+i))}_getExtent(){const t=this._map.getTargetElement().getBoundingClientRect(),e=this._rectangle.getBoundingClientRect(),i={left:e.left-t.left,top:e.top-t.top},s=this._map.getCoordinateFromPixel([i.left,i.top]),o=this._map.getCoordinateFromPixel([i.left+e.width,i.top]),n=this._map.getCoordinateFromPixel([i.left,i.top+e.height]),r=this._map.getCoordinateFromPixel([i.left+e.width,i.top+e.height]);return new f([[s,o,r,n]])}_addEvents(){this._escapeKeyListener=(({key:t})=>{"Escape"===t&&this.cancel()}).bind(this),document.addEventListener("keydown",this._escapeKeyListener)}}class G{constructor(t,e,i,s){this._modal=new D(Object.assign({headerClose:!0,header:!0,animate:!0,title:i.printPdf,content:this.Content(i,e),footer:this.Footer(i,e)},e.modal)),e.allowReframeRegionOfInterest&&(this._reframeROI=new K(t,i,e)),this._modal.el.classList.add("settingsModal"),this._modal.on("dismiss",((t,i)=>{if(!i.target.dataset.print)return;const o=document.getElementById("printMap"),n=new FormData(o),r={format:n.get("printFormat"),orientation:n.get("printOrientation"),resolution:Number(n.get("printResolution")),description:n.get("printDescription"),compass:n.get("printCompass"),attributions:n.get("printAttributions"),scalebar:n.get("printScalebar"),legends:n.get("printLegends"),url:n.get("printUrl"),date:n.get("printDate"),specs:n.get("printSpecs"),safeMargins:n.get("safeMargins"),typeExport:this._modal.el.querySelector('select[name="printTypeExport"]').value};if(this._reframeROI){const t=t=>{t?s(Object.assign({regionOfInterest:t},r),!0,e.modal.transition):s(!1)};this._reframeROI.showOverlay(r.orientation,t)}else s(r,!0,e.modal.transition)}))}Content(t,e){const{dpi:i,mapElements:s,extraInfo:o,description:n,paperSizes:r}=e;return w("form",{id:"printMap"},w("section",null,w("div",{className:"printFields-container"},w("div",{className:"printField"},w("label",{htmlFor:"printFormat"},t.paperSize),w("select",{name:"printFormat",id:"printFormat"},r.map((t=>w("option",Object.assign({value:t.value},t.selected?{selected:"selected"}:{}),t.value))))),w("div",{className:"printField"},w("label",{htmlFor:"printOrientation"},t.orientation),w("select",{name:"printOrientation",id:"printOrientation"},w("option",{value:"landscape",selected:!0},t.landscape),w("option",{value:"portrait"},t.portrait))),w("div",{className:"printField"},w("label",{htmlFor:"printResolution"},t.resolution),w("select",{name:"printResolution",id:"printResolution"},i.map((t=>w("option",Object.assign({value:t.value},t.selected?{selected:"selected"}:{}),t.value," dpi")))))),w("div",null,n&&w("div",null,w("label",{htmlFor:"printDescription"},t.addNote),w("textarea",{id:"printDescription",name:"printDescription",rows:"4"})))),s&&w("fieldset",{className:"sectionChecks mapElements"},w("legend",null,t.mapElements),w("div",{className:"sectionChecksList"},s.compass&&w("label",{htmlFor:"printCompass"},w("input",{type:"checkbox",id:"printCompass",name:"printCompass",checked:!0}),w("span",null,t.compass)),s.scalebar&&w("label",{htmlFor:"printScalebar"},w("input",{type:"checkbox",id:"printScalebar",name:"printScalebar",checked:!0}),w("span",null,t.scale)),s.legends&&w("label",{htmlFor:"printLegends"},w("input",{type:"checkbox",id:"printLegends",name:"printLegends",checked:!0}),w("span",null,t.legends)),s.attributions&&w("label",{htmlFor:"printAttributions"},w("input",{type:"checkbox",id:"printAttributions",name:"printAttributions",checked:!0}),w("span",null,t.layersAttributions)))),o&&w("fieldset",{className:"sectionChecks extraInfo"},w("legend",null,t.extraInfo),w("div",{className:"sectionChecksList"},o.url&&w("label",{htmlFor:"printUrl"},w("input",{type:"checkbox",id:"printUrl",name:"printUrl",checked:!0}),w("span",null,t.url)),o.date&&w("label",{htmlFor:"printDate"},w("input",{type:"checkbox",id:"printDate",name:"printDate",checked:!0}),w("span",null,t.date)),o.specs&&w("label",{htmlFor:"printSpecs"},w("input",{type:"checkbox",id:"printSpecs",name:"printSpecs",checked:!0}),w("span",null,t.specs)))),w("div",{className:"safeMarginsSection sectionChecks"},w("label",{htmlFor:"safeMargins"},w("input",{type:"checkbox",id:"safeMargins",name:"safeMargins"}),w("span",null," ",t.printerMargins))))}Footer(t,e){const{mimeTypeExports:i}=e;return w("div",null,w("button",{type:"button",className:"btn-sm btn btn-secondary","data-dismiss":"modal"},t.cancel),w("div",{class:"typeExportContainer"},w("button",{type:"button",className:"btn-sm btn btn-primary","data-print":"true","data-dismiss":"modal"},t.print),w("select",{className:"typeExport",name:"printTypeExport",id:"printTypeExport"},i.map((t=>w("option",Object.assign({value:t.value},t.selected?{selected:"selected"}:{}),t.value)))))).outerHTML}hide(){this._modal.hide()}show(){this._modal._visible||this._modal.show()}}class Z{constructor(t,e,i){this._message=document.createElement("div"),this._loaderContainer=document.createElement("div"),this._i18n=t,this._modal=new D(Object.assign({headerClose:!1,title:this._i18n.printing,backdrop:"static",content:" ",footer:`\n            <button\n                type="button"\n                class="btn-sm btn btn-secondary"\n                data-dismiss="modal"\n            >\n                ${this._i18n.cancel}\n            </button>\n            `},e.modal)),this._modal.el.classList.add("processingModal"),this._modal.once("shown",(()=>{e.loader&&(this._loaderContainer.className="printLoader-container","string"==typeof e.loader?this._loaderContainer.innerHTML=e.loader:this._loaderContainer.appendChild(e.loader)),this._modal._html.body.append(this._message),this._modal._html.body.append(this._loaderContainer)})),this._modal.on("dismiss",(()=>{i()}))}_setContentModal(t){this._message.innerHTML=String(t)}_setFooterModal(t){this._modal._html.footer.innerHTML=t}show(){this._modal.show()}set(t){this._modal._visible&&this._setContentModal(t)}setLoading(t=!0){t?this._modal.el.classList.add("showLoader"):this._modal.el.classList.remove("showLoader")}hide(){this._modal.hide()}}var Y,Q=Object.freeze({__proto__:null,en:{printPdf:"Print PDF",pleaseWait:"Please wait...",downloadFinished:"Download finished, processing...",downloadingImages:"Downloading images",error:"An error occurred while printing",errorImage:"An error ocurred while loading an image",printing:"Exporting",cancel:"Cancel",close:"Close",print:"Export",mapElements:"Map elements",extraInfo:"Extra information",url:"URL",date:"Date",specs:"Specifications",compass:"Compass",scale:"Scale",legends:"Legends",layersAttributions:"Layer attributions",addNote:"Add note",resolution:"Resolution",orientation:"Orientation",paperSize:"Paper size",landscape:"Landscape",portrait:"Portrait",current:"Current",paper:"Paper",printerMargins:"Add printer margins",escapeHint:"Press here or Escape to cancel",reframeHint:"Pan and zoom to adjust the print area",process:"Process",zoomIn:"Zoom in",zoomOut:"Zoom out",rotateLeft:"Rotate left",rotateRight:"Rotate right"},es:{printPdf:"Exportar PDF",pleaseWait:"Por favor espere...",downloadFinished:"Descarga completada, procesando...",downloadingImages:"Descargando imágenes",error:"Error al generar pdf",errorImage:"Ocurrió un error al tratar de cargar una imagen",printing:"Exportando",cancel:"Cancelar",close:"Cerrar",print:"Exportar",mapElements:"Elementos en el mapa",extraInfo:"Información adicional",url:"URL",date:"Fecha",specs:"Especificaciones",compass:"Brújula",scale:"Escala",legends:"Leyendas",layersAttributions:"Atribuciones de capas",addNote:"Agregar nota",resolution:"Resolución",orientation:"Orientación",paperSize:"Tamaño de página",landscape:"Paisaje",portrait:"Retrato",current:"Actual",paper:"Hoja",printerMargins:"Añadir márgenes de impresión",escapeHint:"Presioná aquí o Escape para cancelar",reframeHint:"Paneá y zoomeá para ajustar el área de impresión",process:"Procesar",zoomIn:"Acercar",zoomOut:" Alejar",rotateLeft:"Rotatar a la izquierda",rotateRight:"Rotate a la derecha"}});function J(t,...e){return e.forEach((e=>{Object.keys(e).forEach((i=>{const s=e[i],o=t[i];t[i]=o&&s&&"object"==typeof o&&"object"==typeof s&&!Array.isArray(o)?J(o,s):s}))})),t}class X extends t{constructor(t){const e=document.createElement("button");super({target:t.target,element:!1===t.showControlBtn?document.createElement("div"):e}),this._i18n=t.language&&t.language in Q?Q[t.language]:Q.en,t.i18n&&(this._i18n=Object.assign(Object.assign({},this._i18n),t.i18n)),this._options=(t=>({language:"en",filename:"Ol Pdf Printer",allowReframeRegionOfInterest:!0,zoomControlOnReframe:!0,rotationControlOnReframe:!0,style:{paperMargin:{left:4,top:4,right:4,bottom:4},watermark:{brcolor:"#000000",bkcolor:"#ffffff",txcolortitle:"#d54b4b",txcolorsubtitle:"#444444"},url:{brcolor:"#000000",bkcolor:"#ffffff",txcolor:"#0077cc"},specs:{brcolor:"#000000",bkcolor:"#ffffff",txcolor:"#000000"},scalebar:{brcolor:"#000000",bkcolor:"#ffffff",txcolor:"#000000"},attributions:{brcolor:"#ffffff",bkcolor:"#ffffff",txcolor:"#666666",txcolorlink:"#0077cc"},legends:{brcolor:"#000000",bkcolor:"#ffffff",txcolor:"#000000"},description:{brcolor:"#333333",bkcolor:"#333333",txcolor:"#ffffff"},compass:{brcolor:"#000000",bkcolor:"#333333"}},extraInfo:{date:!0,url:!0,specs:!0},description:!0,mapElements:{attributions:!0,scalebar:!0,legends:!0,compass:(new DOMParser).parseFromString('<?xml version="1.0" encoding="utf-8"?>\r\n<svg version="1.1" id="compass" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"\r\n\t viewBox="0 0 300 300" xml:space="preserve" width="50" height="50">\r\n<style type="text/css">\r\n\t.st0{fill:#d54b4b;}\r\n</style>\r\n<g>\r\n\t<g>\r\n\t\t<g>\r\n\t\t\t<g>\r\n\t\t\t\t<g>\r\n\t\t\t\t\t<path class="st0" d="M146.3,9.1L75.5,287.2c-0.5,1.8,0.5,3.7,2.1,4.4c1.8,0.8,3.7,0.2,4.7-1.5l68.4-106.7l66.8,106.7\r\n\t\t\t\t\t\tc0.6,1.1,1.9,1.8,3.2,1.8c0.5,0,1-0.2,1.5-0.3c1.8-0.8,2.6-2.6,2.3-4.4L153.7,9.1C152.9,5.7,147.2,5.7,146.3,9.1z M154.2,174.2\r\n\t\t\t\t\t\tc-0.6-1.1-1.9-1.8-3.2-1.8l0,0c-1.3,0-2.6,0.6-3.2,1.8l-59,92L150,25.5l61.1,239.9L154.2,174.2z"/>\r\n\t\t\t\t</g>\r\n\t\t\t</g>\r\n\t\t\t<g>\r\n\t\t\t\t<g>\r\n\t\t\t\t\t<path class="st0" d="M220.8,293.1c-1.8,0-3.4-1-4.2-2.3l-65.8-105.1L83.4,290.8c-1.3,1.9-4,2.9-6.1,1.9c-2.3-1-3.4-3.4-2.9-5.8\r\n\t\t\t\t\t\tL145.1,8.8c0.5-2.1,2.4-3.4,4.9-3.4s4.4,1.3,4.9,3.4l70.8,278.1c0.6,2.4-0.6,4.9-2.9,5.8C222.1,292.9,221.5,293.1,220.8,293.1z\r\n\t\t\t\t\t\t M150.8,181.2l1,1.6l66.8,106.7c0.6,1,1.9,1.5,3.2,1c1.1-0.5,1.8-1.8,1.5-3.1L152.4,9.3c-0.3-1.1-1.6-1.6-2.6-1.6\r\n\t\t\t\t\t\ts-2.3,0.5-2.6,1.6L76.4,287.4c-0.3,1.3,0.3,2.6,1.5,3.1c1.1,0.5,2.6,0,3.2-1L150.8,181.2z M85.6,273.2L150,20.6l64.2,251.9\r\n\t\t\t\t\t\tl-61.1-97.7c-1-1.6-3.4-1.5-4.4,0L85.6,273.2z"/>\r\n\t\t\t\t</g>\r\n\t\t\t</g>\r\n\t\t</g>\r\n\t</g>\r\n</g>\r\n</svg>\r\n',"image/svg+xml").firstChild},watermark:{title:"Ol Pdf Printer",subtitle:"https://github.com/GastonZalba/ol-pdf-printer",logo:!1},paperSizes:[{size:[594,420],value:"A2"},{size:[420,297],value:"A3"},{size:[297,210],value:"A4",selected:!0},{size:[210,148],value:"A5"}],dpi:[{value:96},{value:150,selected:!0},{value:200},{value:300}],mimeTypeExports:[{value:"pdf",selected:!0},{value:"png"},{value:"jpeg"},{value:"webp"}],units:Y.Metric,dateFormat:void 0,showControlBtn:!0,ctrlBtnClass:"",loader:'<span class="printLoader"></span>',modal:{animateClass:"fade",animateInClass:"show",transition:150,backdropTransition:0,templates:{dialog:'<div class="modal-dialog modal-dialog-centered"></div>',headerClose:`<button type="button" class="btn-close" data-dismiss="modal" aria-label="${t.close}"><span aria-hidden="true">×</span></button>`}}}))(this._i18n),this._options=J(this._options,t),this._options.showControlBtn&&(e.className=`ol-print-btn-menu ${this._options.ctrlBtnClass}`,e.title=this._i18n.printPdf,e.onclick=()=>this.showPrintSettingsModal(),e.append((new DOMParser).parseFromString('<?xml version="1.0" encoding="utf-8"?>\r\n<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"\r\n\t viewBox="0 0 256 256" style="enable-background:new 0 0 256 256;" xml:space="preserve">\r\n<g id="Layer_1">\r\n</g>\r\n<g id="Layer_2">\r\n\t<g>\r\n\t\t<path d="M77.4,175.5H64.1v23.7h13.2c3.7,0,6.7-3,6.7-6.7v-10.2C84.1,178.5,81.1,175.5,77.4,175.5z"/>\r\n\t\t<path d="M222.9,177.6v-31.2h-190v31.2v31.6v32.3c0,7,5.7,12.8,12.8,12.8h164.4c7,0,12.8-5.7,12.8-12.8L222.9,177.6\r\n\t\t\tL222.9,177.6z M94.7,192.4c0,9.6-7.8,17.3-17.3,17.3H64.1v18.2c0,2.9-2.4,5.3-5.3,5.3s-5.3-2.4-5.3-5.3v-23.5v-34.3\r\n\t\t\tc0-2.9,2.4-5.3,5.3-5.3h18.5c9.6,0,17.3,7.8,17.3,17.3V192.4z M147.9,214.7c0,10.2-8.3,18.6-18.6,18.6H112c-2.9,0-5.3-2.4-5.3-5.3\r\n\t\t\tv-57.8c0-2.9,2.4-5.3,5.3-5.3h17.3c10.2,0,18.6,8.3,18.6,18.6V214.7z M196.9,175.5h-25.3v18.3h14.7c2.9,0,5.3,2.4,5.3,5.3\r\n\t\t\ts-2.4,5.3-5.3,5.3h-14.7v23.6c0,2.9-2.4,5.3-5.3,5.3s-5.3-2.4-5.3-5.3v-57.8c0-2.9,2.4-5.3,5.3-5.3h30.6c2.9,0,5.3,2.4,5.3,5.3\r\n\t\t\tS199.8,175.5,196.9,175.5z"/>\r\n\t\t<path d="M129.3,175.5h-12v47.2h12c4.4,0,8-3.6,8-8v-31.2C137.3,179,133.7,175.5,129.3,175.5z"/>\r\n\t\t<path d="M222.9,59c0-3.4-1.3-6.6-3.7-9L174.3,5.1c-2.4-2.4-5.6-3.7-9-3.7H45.6c-7,0-12.8,5.7-12.8,12.8v108.5v18.9\r\n\t\t\th190V59z M164.2,86.3l-34.3,34.3c-0.5,0.5-1.3,0.8-2,0.8s-1.4-0.3-2-0.8L91.6,86.3c-0.8-0.8-1-2-0.6-3.1c0.4-1,1.5-1.7,2.6-1.7\r\n\t\t\tH107V48.4c0-1.6,1.3-2.8,2.8-2.8h36c1.6,0,2.8,1.3,2.8,2.8v33.1h13.5c1.1,0,2.2,0.7,2.6,1.7C165.2,84.3,165,85.5,164.2,86.3z"/>\r\n\t</g>\r\n</g>\r\n</svg>\r\n',"image/svg+xml").firstChild))}setMap(t){super.setMap(t),!this._initialized&&t&&this._init(),this._initialConstrainRes=this._view.getConstrainResolution()}_init(){this._map=this.getMap(),this._view=this._map.getView(),this._settingsModal=new G(this._map,this._options,this._i18n,this._printMap.bind(this)),this._processingModal=new Z(this._i18n,this._options,this._onEndPrint.bind(this)),this._initialized=!0}_restoreConstrains(){this._view.setConstrainResolution(this._initialConstrainRes)}_onEndPrint(){this._map.setSize(this._initialSize),this._view.setResolution(this._initialViewResolution),this._view.setCenter(this._initialViewCoords),this._restoreConstrains(),this._map.getTargetElement().classList.remove(B,A),this._updateDPI(90),this._removeListeners(),clearTimeout(this._timeoutProcessing),this._processingModal.setLoading(!1),this._cancel()}_prepareLoading(){this._processingModal.show(),this._processingModal.setLoading(!0),this._processingModal.set(this._i18n.pleaseWait)}_disableLoading(){this._processingModal.hide(),this._processingModal.setLoading(!1)}_updateDPI(t=90){const e=t/90;this._map.pixelRatio_=e,this._map.getLayers().forEach((t=>{if(t.getVisible()&&"getSource"in t&&"function"==typeof t.getSource){const i=t.getSource();if(void 0!==i.tilePixelRatio_)i.tilePixelRatio_=e,i.refresh();else if(t instanceof o)i instanceof s?i.getSource().changed():i.changed();else{const i=t.getSource();if(i instanceof r||i instanceof n){const t=i.getParams();t._pixelRatio=e,i.updateParams(t)}}}})),this._map.updateSize()}_printMap(t,i=!0,s=0){if(!t)return this._restoreConstrains();i&&this._map.getTargetElement().classList.add(B,A),setTimeout((()=>{i&&this._prepareLoading(),this._isCanceled=!1,this._addDownloadCountListener(),this._initialViewResolution=this._view.getResolution(),this._initialViewCoords=this._view.getCenter(),this._initialSize=this._map.getSize(),this._view.setConstrainResolution(!1);let s=this._options.paperSizes.find((e=>e.value===t.format)).size;s="landscape"===t.orientation?s:[...s].reverse();const o=s[0],n=s[1];this._updateDPI(t.resolution);const r=t.resolution/25.4,a=Math.round(o*r),l=Math.round(n*r),c=t.scale&&!t.regionOfInterest?t.scale:u(this._map)/1e3;console.log(u(this._map)/1e3);const d=c/e.getPointResolution(this._view.getProjection(),r,this._view.getCenter());this._renderCompleteKey=this._map.once("rendercomplete",(async()=>{try{const e=document.createElement("canvas");e.width=a,e.height=l;const s=e.getContext("2d");if(Array.prototype.forEach.call(this._map.getTargetElement().querySelector(".ol-layers").querySelectorAll(".ol-layer canvas"),(function(t){if(t.width>0){const e=t.parentNode.style.opacity;s.globalAlpha=""===e?1:Number(e);const i=t.style.transform.match(/^matrix\(([^(]*)\)$/)[1].split(",").map(Number);CanvasRenderingContext2D.prototype.setTransform.apply(s,i),s.drawImage(t,0,0)}})),s.globalAlpha=1,s.setTransform(1,0,0,1,0,0),this._processingModal.set(this._i18n.downloadFinished),this._isCanceled)return;if(this._pdf=new x({form:t,scaleResolution:d,map:this._map,i18n:this._i18n,config:this._options,height:n,width:o}),this._pdf.addMapImage(e.toDataURL("image/jpeg")),await this._pdf.addMapHelpers(),this._isCanceled)return;await this._pdf.savePdf(),this._onEndPrint(),i&&this._disableLoading()}catch(t){const e="string"==typeof t?t:this._i18n.error;console.error(t),this._onEndPrint(),this._processingModal.set(e)}})),this._map.setSize([a,l]),this._map.getView().setResolution(d),t.regionOfInterest&&this._view.fit(t.regionOfInterest,{size:this._map.getSize(),nearest:!1})}),s)}_addDownloadCountListener(){const t=()=>{this._imageCount=this._imageCount+1,this._imageCount%10==0&&this._processingModal.set(this._i18n.downloadingImages+": <b>"+this._imageCount+"</b>")};this._eventsKey=[],this._imageCount=0,this._map.getLayers().getArray().forEach((e=>{"getSource"in e&&"function"==typeof e.getSource&&(this._eventsKey.push(e.getSource().on("tileloadend",(()=>t()))),this._eventsKey.push(e.getSource().on("imageloadend",(()=>t()))))}))}_removeListeners(){i.unByKey(this._eventsKey)}_cancel(){this._renderCompleteKey&&i.unByKey(this._renderCompleteKey),this._isCanceled=!0}showPrintSettingsModal(){this._settingsModal.show()}hidePrintSettingsModal(){this._settingsModal.hide()}createPdf(t,e){t={},this._printMap(Object.assign({format:(this._options.paperSizes.find((t=>t.selected))||this._options.paperSizes[0]).value,resolution:(this._options.dpi.find((t=>t.selected))||this._options.dpi[0]).value,orientation:"landscape",compass:!0,attributions:!0,scalebar:!0,legends:!0,regionOfInterest:null,typeExport:"pdf"},t),e)}}!function(t){t.Metric="metric",t.Imperial="imperial"}(Y||(Y={}));var tt=Object.freeze({__proto__:null,get UnitsSystem(){return Y},default:X});return Object.assign(X,tt),X}));
//# sourceMappingURL=ol-pdf-printer.min.js.map
