!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("ol/proj"),require("ol/control/Control"),require("ol/source/TileWMS"),require("ol/layer/Tile"),require("ol/Observable"),require("jspdf"),require("pdfjs-dist"),require("ol/proj/Units")):"function"==typeof define&&define.amd?define(["ol/proj","ol/control/Control","ol/source/TileWMS","ol/layer/Tile","ol/Observable","jspdf","pdfjs-dist","ol/proj/Units"],e):(t="undefined"!=typeof globalThis?globalThis:t||self).PdfPrinter=e(t.ol.proj,t.ol.control.Control,t.ol.source.TileWMS,t.ol.layer.Tile,t.ol.Observable,t.jsPDF,t.pdfjsLib,t.ol.proj.Units)}(this,(function(t,e,n,i,o,r,s,a){"use strict";window;function l(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var c=l(e),d=l(n),h=l(i);
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */
function u(t,e,n,i){return new(n||(n=Promise))((function(o,r){function s(t){try{l(i.next(t))}catch(t){r(t)}}function a(t){try{l(i.throw(t))}catch(t){r(t)}}function l(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}l((i=i.apply(t,e||[])).next())}))}function p(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function f(t){if(t.__esModule)return t;var e=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(t).forEach((function(n){var i=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(e,n,i.get?i:{enumerable:!0,get:function(){return t[n]}})})),e}function m(t){var e={exports:{}};return t(e,e.exports),e.exports}var g=m((function(t,e){!function(e){var n=function(){return{escape:function(t){return t.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1")},parseExtension:e,mimeType:function(t){var n=e(t).toLowerCase();return(i="application/font-woff",o="image/jpeg",{woff:i,woff2:i,ttf:"application/font-truetype",eot:"application/vnd.ms-fontobject",png:"image/png",jpg:o,jpeg:o,gif:"image/gif",tiff:"image/tiff",svg:"image/svg+xml"})[n]||"";var i,o},dataAsUrl:function(t,e){return"data:"+e+";base64,"+t},isDataUrl:function(t){return-1!==t.search(/^(data:)/)},canvasToBlob:function(t){return t.toBlob?new Promise((function(e){t.toBlob(e)})):function(t){return new Promise((function(e){for(var n=window.atob(t.toDataURL().split(",")[1]),i=n.length,o=new Uint8Array(i),r=0;r<i;r++)o[r]=n.charCodeAt(r);e(new Blob([o],{type:"image/png"}))}))}(t)},resolveUrl:function(t,e){var n=document.implementation.createHTMLDocument(),i=n.createElement("base");n.head.appendChild(i);var o=n.createElement("a");return n.body.appendChild(o),i.href=e,o.href=t,o.href},getAndEncode:function(t){var e=3e4;a.impl.options.cacheBust&&(t+=(/\?/.test(t)?"&":"?")+(new Date).getTime());return new Promise((function(n){var i,o=new XMLHttpRequest;if(o.onreadystatechange=s,o.ontimeout=l,o.responseType="blob",o.timeout=e,a.impl.options.useCredentials&&(o.withCredentials=!0),o.open("GET",t,!0),o.send(),a.impl.options.imagePlaceholder){var r=a.impl.options.imagePlaceholder.split(/,/);r&&r[1]&&(i=r[1])}function s(){if(4===o.readyState)if(200===o.status){var e=new FileReader;e.onloadend=function(){var t=e.result.split(/,/)[1];n(t)},e.readAsDataURL(o.response)}else i?n(i):c("cannot fetch resource: "+t+", status: "+o.status)}function l(){i?n(i):c("timeout of "+e+"ms occured while fetching resource: "+t)}function c(t){console.error(t),n("")}}))},uid:(t=0,function(){return"u"+e()+t++;function e(){return("0000"+(Math.random()*Math.pow(36,4)<<0).toString(36)).slice(-4)}}),delay:function(t){return function(e){return new Promise((function(n){setTimeout((function(){n(e)}),t)}))}},asArray:function(t){for(var e=[],n=t.length,i=0;i<n;i++)e.push(t[i]);return e},isChrome:function(){return/chrome/i.test(navigator.userAgent)},escapeXhtml:function(t){return t.replace(/#/g,"%23").replace(/\n/g,"%0A")},makeImage:function(t){return"data:,"===t?Promise.resolve():new Promise((function(e,n){var i=new Image;a.impl.options.useCredentials&&(i.crossOrigin="use-credentials"),i.onload=function(){e(i)},i.onerror=n,i.src=t}))},width:function(t){var e=n(t,"border-left-width"),i=n(t,"border-right-width");return t.scrollWidth+e+i},height:function(t){var e=n(t,"border-top-width"),i=n(t,"border-bottom-width");return t.scrollHeight+e+i}};var t;function e(t){var e=/\.([^\.\/]*?)(\?|$)/g.exec(t);return e?e[1]:""}function n(t,e){var n=window.getComputedStyle(t).getPropertyValue(e);return parseFloat(n.replace("px",""))}}(),i=function(){var t=/url\(['"]?([^'"]+?)['"]?\)/g;return{inlineAll:function(t,n,r){return s()?Promise.resolve(t):Promise.resolve(t).then(i).then((function(e){var i=Promise.resolve(t);return e.forEach((function(t){i=i.then((function(e){return o(e,t,n,r)}))})),i}));function s(){return!e(t)}},shouldProcess:e,impl:{readUrls:i,inline:o}};function e(e){return-1!==e.search(t)}function i(e){for(var i,o=[];null!==(i=t.exec(e));)o.push(i[1]);return o.filter((function(t){return!n.isDataUrl(t)}))}function o(t,e,i,o){return Promise.resolve(e).then((function(t){return i?n.resolveUrl(t,i):t})).then(o||n.getAndEncode).then((function(t){return n.dataAsUrl(t,n.mimeType(e))})).then((function(i){return t.replace(function(t){return new RegExp("(url\\(['\"]?)("+n.escape(t)+")(['\"]?\\))","g")}(e),"$1"+i+"$3")}))}}(),o=function(){return{resolveAll:function(){return t().then((function(t){return Promise.all(t.map((function(t){return t.resolve()})))})).then((function(t){return t.join("\n")}))},impl:{readAll:t}};function t(){return Promise.resolve(n.asArray(document.styleSheets)).then((function(t){var e=[];return t.forEach((function(t){if(t.hasOwnProperty("cssRules"))try{n.asArray(t.cssRules||[]).forEach(e.push.bind(e))}catch(e){console.log("Error while reading CSS rules from "+t.href,e.toString())}})),e})).then((function(t){return t.filter((function(t){return t.type===CSSRule.FONT_FACE_RULE})).filter((function(t){return i.shouldProcess(t.style.getPropertyValue("src"))}))})).then((function(e){return e.map(t)}));function t(t){return{resolve:function(){var e=(t.parentStyleSheet||{}).href;return i.inlineAll(t.cssText,e)},src:function(){return t.style.getPropertyValue("src")}}}}}(),r=function(){return{inlineAll:function e(o){return o instanceof Element?r(o).then((function(){return o instanceof HTMLImageElement?t(o).inline():Promise.all(n.asArray(o.childNodes).map((function(t){return e(t)})))})):Promise.resolve(o);function r(t){var e=t.style.getPropertyValue("background");return e?i.inlineAll(e).then((function(e){t.style.setProperty("background",e,t.style.getPropertyPriority("background"))})).then((function(){return t})):Promise.resolve(t)}},impl:{newImage:t}};function t(t){return{inline:function(e){return n.isDataUrl(t.src)?Promise.resolve():Promise.resolve(t.src).then(e||n.getAndEncode).then((function(e){return n.dataAsUrl(e,n.mimeType(t.src))})).then((function(e){return new Promise((function(n,i){t.onload=n,t.onerror=n,t.src=e}))}))}}}}(),s={imagePlaceholder:void 0,cacheBust:!1,useCredentials:!1},a={toSvg:l,toPng:function(t,e){return c(t,e||{}).then((function(t){return t.toDataURL()}))},toJpeg:function(t,e){return c(t,e=e||{}).then((function(t){return t.toDataURL("image/jpeg",e.quality||1)}))},toBlob:function(t,e){return c(t,e||{}).then(n.canvasToBlob)},toPixelData:function(t,e){return c(t,e||{}).then((function(e){return e.getContext("2d").getImageData(0,0,n.width(t),n.height(t)).data}))},toCanvas:function(t,e){return c(t,e||{})},impl:{fontFaces:o,images:r,util:n,inliner:i,options:{}}};function l(t,e){return function(t){void 0===t.imagePlaceholder?a.impl.options.imagePlaceholder=s.imagePlaceholder:a.impl.options.imagePlaceholder=t.imagePlaceholder;void 0===t.cacheBust?a.impl.options.cacheBust=s.cacheBust:a.impl.options.cacheBust=t.cacheBust;void 0===t.useCredentials?a.impl.options.useCredentials=s.useCredentials:a.impl.options.useCredentials=t.useCredentials}(e=e||{}),Promise.resolve(t).then((function(t){return d(t,e.filter,!0)})).then(h).then(u).then((function(t){e.bgcolor&&(t.style.backgroundColor=e.bgcolor);e.width&&(t.style.width=e.width+"px");e.height&&(t.style.height=e.height+"px");e.style&&Object.keys(e.style).forEach((function(n){t.style[n]=e.style[n]}));return t})).then((function(i){return function(t,e,i){return Promise.resolve(t).then((function(t){return t.setAttribute("xmlns","http://www.w3.org/1999/xhtml"),(new XMLSerializer).serializeToString(t)})).then(n.escapeXhtml).then((function(t){return'<foreignObject x="0" y="0" width="100%" height="100%">'+t+"</foreignObject>"})).then((function(t){return'<svg xmlns="http://www.w3.org/2000/svg" width="'+e+'" height="'+i+'">'+t+"</svg>"})).then((function(t){return"data:image/svg+xml;charset=utf-8,"+t}))}(i,e.width||n.width(t),e.height||n.height(t))}))}function c(t,e){return l(t,e).then(n.makeImage).then(n.delay(100)).then((function(i){var o="number"!=typeof e.scale?1:e.scale;console.log("scale",o);var r=function(t,i){var o=document.createElement("canvas");if(o.width=(e.width||n.width(t))*i,o.height=(e.height||n.height(t))*i,console.log(o.width,o.height),e.bgcolor){var r=o.getContext("2d");r.fillStyle=e.bgcolor,r.fillRect(0,0,o.width,o.height)}return o}(t,o),s=r.getContext("2d");return i&&(s.scale(o,o),e.canvas&&e.canvas.width&&(r.width=e.canvas.width),e.canvas&&e.canvas.height&&(r.height=e.canvas.height),e.canvas?(console.log("canv",e.canvas),s.drawImage(i,e.canvas.sx||0,e.canvas.sy||0,e.canvas.sw||e.width,e.canvas.sh||e.height,e.canvas.dx||0,e.canvas.dy||0,e.canvas.dw||e.width,e.canvas.dh||e.height)):s.drawImage(i,0,0)),r}))}function d(t,e,i){return i||!e||e(t)?Promise.resolve(t).then((function(t){return t instanceof HTMLCanvasElement?n.makeImage(t.toDataURL()):t.cloneNode(!1)})).then((function(i){return function(t,e,i){var o="use"===t.tagName?function(t){return[document.getElementById(t.href.baseVal.replace("#","")).cloneNode(!0)]}(t):t.childNodes;return 0===o.length?Promise.resolve(e):r(e,n.asArray(o),i).then((function(){return e}));function r(t,e,n){var i=Promise.resolve();return e.forEach((function(e){i=i.then((function(){return d(e,n)})).then((function(e){e&&t.appendChild(e)}))})),i}}(t,i,e)})).then((function(e){return function(t,e){return e instanceof Element?Promise.resolve().then(i).then(o).then(r).then(s).then((function(){return e})):e;function i(){function i(t,e){function i(t,e){n.asArray(t).forEach((function(n){e.setProperty(n,t.getPropertyValue(n),t.getPropertyPriority(n))}))}t.cssText?(e.cssText=t.cssText,e.font=t.font):i(t,e)}i(window.getComputedStyle(t),e.style),n.isChrome()&&e.style.marker&&("line"===e.tagName||"path"===e.tagName)&&(e.style.marker="")}function o(){function i(i){var o=window.getComputedStyle(t,i),r=o.getPropertyValue("content");if(""!==r&&"none"!==r){var s=n.uid(),a=e.getAttribute("class");a&&e.setAttribute("class",a+" "+s);var l=document.createElement("style");l.appendChild(c(s,i,o)),e.appendChild(l)}function c(t,e,i){var o="."+t+":"+e,r=i.cssText?s(i):a(i);return document.createTextNode(o+"{"+r+"}");function s(t){var e=t.getPropertyValue("content");return t.cssText+" content: "+e+";"}function a(t){return n.asArray(t).map(e).join("; ")+";";function e(e){return e+": "+t.getPropertyValue(e)+(t.getPropertyPriority(e)?" !important":"")}}}}[":before",":after"].forEach((function(t){i(t)}))}function r(){t instanceof HTMLTextAreaElement&&(e.innerHTML=t.value),t instanceof HTMLInputElement&&e.setAttribute("value",t.value)}function s(){e instanceof SVGElement&&(e.setAttribute("xmlns","http://www.w3.org/2000/svg"),e instanceof SVGRectElement&&["width","height"].forEach((function(t){var n=e.getAttribute(t);n&&e.style.setProperty(t,n)})))}}(t,e)})):Promise.resolve()}function h(t){return o.resolveAll().then((function(e){var n=document.createElement("style");return t.appendChild(n),n.appendChild(document.createTextNode(e)),t}))}function u(t){return r.inlineAll(t).then((function(){return t}))}t.exports=a}()})),_=m((function(t){t.exports=function(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i},t.exports.__esModule=!0,t.exports.default=t.exports})),v=m((function(t){t.exports=function(t){if(Array.isArray(t))return _(t)},t.exports.__esModule=!0,t.exports.default=t.exports})),y=m((function(t){t.exports=function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)},t.exports.__esModule=!0,t.exports.default=t.exports})),b=m((function(t){t.exports=function(t,e){if(t){if("string"==typeof t)return _(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_(t,e):void 0}},t.exports.__esModule=!0,t.exports.default=t.exports})),w=m((function(t){t.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},t.exports.__esModule=!0,t.exports.default=t.exports})),x=p(m((function(t){t.exports=function(t){return v(t)||y(t)||b(t)||w()},t.exports.__esModule=!0,t.exports.default=t.exports}))),C=m((function(t){t.exports=function(t){if(Array.isArray(t))return t},t.exports.__esModule=!0,t.exports.default=t.exports})),M=m((function(t){t.exports=function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var i,o,r=[],s=!0,a=!1;try{for(n=n.call(t);!(s=(i=n.next()).done)&&(r.push(i.value),!e||r.length!==e);s=!0);}catch(t){a=!0,o=t}finally{try{s||null==n.return||n.return()}finally{if(a)throw o}}return r}},t.exports.__esModule=!0,t.exports.default=t.exports})),P=m((function(t){t.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},t.exports.__esModule=!0,t.exports.default=t.exports})),E=p(m((function(t){t.exports=function(t,e){return C(t)||M(t,e)||b(t,e)||P()},t.exports.__esModule=!0,t.exports.default=t.exports})));function T(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length,i=new Array(n>2?n-2:0),o=2;o<n;o++)i[o-2]=arguments[o];if("null"===t)return i;if("function"==typeof t)return t(e,i);var r=document.createElement(t);Object.entries(e||{}).forEach((function(t){var e=E(t,2),n=e[0],i=e[1];n.startsWith("on")&&n.toLowerCase()in window?r.addEventListener(n.toLowerCase().substr(2),i):"className"===n?r.setAttribute("class",i.toString()):"htmlFor"===n?r.setAttribute("for",i.toString()):r.setAttribute(n,i.toString())}));for(var s=0,a=i;s<a.length;s++){var l=a[s];l&&(Array.isArray(l)?r.append.apply(r,x(l)):r.appendChild(void 0===l.nodeType?document.createTextNode(l.toString()):l))}return r}class L{constructor(t){this.addMapHelpers=()=>u(this,void 0,void 0,(function*(){const{mapElements:t,extraInfo:e,style:n,watermark:i}=this._config;this._style=n,i&&(yield this._addWatermark(i)),t&&(t.compass&&this._form.compass&&(yield this._addCompass(t.compass)),t.description&&this._form.description&&this._addDescription(),t.scalebar&&this._form.scalebar&&this._addScaleBar(),t.attributions&&this._form.attributions&&this._addAttributions()),e&&(e.url&&this._addUrl(),e.date&&this._addDate(),e.specs&&this._addSpecs())})),this._processSvgImage=t=>new Promise(((e,n)=>{const i=t=>URL.createObjectURL(new Blob([t.outerHTML],{type:"image/svg+xml"})),o=(t,e)=>{const i=document.createElement("img");document.body.appendChild(i),i.onerror=t=>(console.error(t),n(this._i18n.errorImage)),i.onload=()=>{try{const t=document.createElement("canvas");t.width=i.clientWidth,t.height=i.clientHeight;t.getContext("2d").drawImage(i,0,0);const n=t.toDataURL("image/png");e(n),document.body.removeChild(i)}catch(t){return n(t)}},i.src=t};((t,e)=>{const n=i(t);o(n,(t=>{e(t),URL.revokeObjectURL(n)}))})(t,(t=>{e(t)}))})),this._calculateOffsetByPosition=(t,e,n=0)=>{let i,o;switch(t){case"topleft":i=e.x+this._style.paperMargin,o=e.y+this._style.paperMargin+n;break;case"topright":i=this._pdf.width-e.x-this._style.paperMargin,o=e.y+this._style.paperMargin+n;break;case"bottomright":i=this._pdf.width-e.x-this._style.paperMargin,o=this._pdf.height-e.y-this._style.paperMargin-n;break;case"bottomleft":o=this._pdf.height-e.y-this._style.paperMargin-n,i=e.x+this._style.paperMargin}return{x:i,y:o}},this._addRoundedBox=(t,e,n,i,o,r)=>{this._pdf.doc.setDrawColor(r),this._pdf.doc.setFillColor(o),this._pdf.doc.roundedRect(t,e,n,i,1,1,"FD")},this._addText=(t,e,n,i,o,r="left",s)=>{this._pdf.doc.setTextColor(o),this._pdf.doc.setFontSize(i),this._pdf.doc.text(s,t,e,{align:r})},this._addTextByOffset=(t,e,n,i,o,r,s)=>{const{x:a,y:l}=this._calculateOffsetByPosition(t,e),c="center"===r?a-n/2:a;this._addText(c,l,n,i,o,r,s)},this._addDescription=()=>{const t=this._form.description.trim(),{x:e,y:n}=this._calculateOffsetByPosition("topleft",{x:2,y:2});this._pdf.doc.setTextColor(this._style.txcolor),this._pdf.doc.setFontSize(8);const{w:i,h:o}=this._pdf.doc.getTextDimensions(t,{maxWidth:50});this._addRoundedBox(e,n,i+8,o+4,this._style.bkcolor,this._style.brcolor),this._pdf.doc.text(t,e+4,n+4,{align:"left",maxWidth:50})},this._addWatermark=t=>u(this,void 0,void 0,(function*(){const e=14/1.8;let n=!1;const{x:i,y:o}=this._calculateOffsetByPosition("topright",{x:0,y:0});let r=t.logo?12.5:0;if(t.title){this._pdf.doc.setTextColor(t.titleColor),this._pdf.doc.setFontSize(14),this._pdf.doc.setFont("helvetica","bold");let{w:s}=this._pdf.doc.getTextDimensions(t.title);if(t.subtitle){this._pdf.doc.setFontSize(e);const n=this._pdf.doc.getTextDimensions(t.subtitle).w;s=n-4>s?n:s+4,this._pdf.doc.setFontSize(14)}else s+=4;const a=16,l=s+2;this._addRoundedBox(i-l+4-r,o-4,l+r,a,"#ffffff","#ffffff"),n=!0,this._pdf.doc.text(t.title,i,o+2+3+(t.subtitle?0:2),{align:"right"}),r+=s}if(t.subtitle){if(this._pdf.doc.setTextColor(t.subtitleColor),this._pdf.doc.setFontSize(e),this._pdf.doc.setFont("helvetica","normal"),!n){const{w:e}=this._pdf.doc.getTextDimensions(t.subtitle),s=4+e;this._addRoundedBox(i-s+3-r,o-4,s+r,16,"#ffffff","#ffffff"),r+=s,n=!0}const s=t.title?7:4;this._pdf.doc.text(t.subtitle,i,o+2+s,{align:"right"})}if(!t.logo)return;const s=t=>{this._pdf.doc.addImage(t,"PNG",i-r+4-1,o-1,12,12)};if(!n){const t=r+2;this._addRoundedBox(i-t+4,o-4,t,16,"#ffffff","#ffffff")}if(!(t.logo instanceof Image)){let e;if("string"==typeof t.logo)e=t.logo;else{if(!(t.logo instanceof SVGElement))throw this._i18n.errorImage;e=yield this._processSvgImage(t.logo)}return new Promise(((t,n)=>{const i=new Image(12,12);i.onload=()=>{try{s(i),t()}catch(t){return n(t)}},i.onerror=()=>n(this._i18n.errorImage),i.src=e}))}s(t.logo)})),this._addDate=()=>{this._pdf.doc.setFont("helvetica","normal");const t=new Date(Date.now()).toLocaleDateString(this._config.dateFormat);this._addTextByOffset("bottomright",{x:0,y:-5},250,7,"#000000","right",t)},this._addUrl=()=>{this._pdf.doc.setFont("helvetica","italic");const t=window.location.href;this._addTextByOffset("bottomleft",{x:0,y:-6.5},250,6,"#000000","left",t)},this._addSpecs=()=>{this._pdf.doc.setFont("helvetica","bold"),this._pdf.doc.setFontSize(6);const t=`${this._i18n.scale} 1:${this._scaleDenominator.toLocaleString("de")}`,e=`${this._i18n.paper} ${this._form.format.toUpperCase()}`,n=[t,`${this._form.resolution} DPI`,e].join(" - "),{w:i}=this._pdf.doc.getTextDimensions(n);this._addTextByOffset("bottomleft",{x:0,y:-3.5},i,6,"#000000","left",n)},this._addAttributions=()=>{const t=document.querySelector(".ol-attribution ul");if(!t)return;this._pdf.doc.setFont("helvetica","normal"),this._pdf.doc.setFontSize(7);const{x:e,y:n}=this._calculateOffsetByPosition("bottomright",{x:1,y:1});let i=e;const{w:o,h:r}=this._pdf.doc.getTextDimensions(t.textContent),s=this._pdf.doc.getTextDimensions(" · ").w,a=document.querySelectorAll(".ol-attribution li"),l=s*(a.length-1);this._addRoundedBox(e-o-l-2,n-r,o+4+l+2,r+4,"#ffffff","#ffffff"),Array.from(a).reverse().forEach(((t,e)=>{Array.from(t.childNodes).reverse().forEach((t=>{const e=t.textContent;"href"in t?(this._pdf.doc.setTextColor("#0077cc"),this._pdf.doc.textWithLink(e,i,n,{align:"right",url:t.href})):(this._pdf.doc.setTextColor("#666666"),this._pdf.doc.text(e,i,n,{align:"right"}));const{w:o}=this._pdf.doc.getTextDimensions(e);i-=o})),e!==a.length-1&&(this._pdf.doc.text(" · ",i,n,{align:"right"}),i-=s)}))},this._addScaleBar=()=>{const t=2,e=2,n=Math.log10||function(t){return Math.log(t)*Math.LOG10E};let i,o,r=90*this._scaleDenominator;if("metric"===this._config.units){i="mm";const t=1e3;o=1,r>=10*(1e3*t)?(i="km",o=1e6):r>=10*t&&(i="m",o=t)}else if("imperial"===this._config.units){const t=25.4,e=63360*t,n=36*t;i="in",o=t,r>=10*e?(i="mi",o=e):r>=10*n&&(i="yd",o=n)}r/=o;const s=r,a=Math.floor(n(s)),l=Math.pow(10,a),c=s/l;let d=Math.floor(r);d=c>8?8*l:c>4?4*l:c>2?2*l:l;let h=d*o/this._scaleDenominator/4;const u=this._style.paperMargin?2*this._style.paperMargin/this._pdf.width*100:null;h=u?h/100*(100-u):h;const p=4*h,f=t+this._style.paperMargin;let m=e+this._style.paperMargin;m=this._pdf.height-e-10-this._style.paperMargin;const g=f+4,_=m+5;this._addRoundedBox(f,m,p+8,10,this._style.bkcolor,this._style.brcolor),this._pdf.doc.setDrawColor(this._style.brcolor),this._pdf.doc.setFillColor(0,0,0),this._pdf.doc.rect(g,_,h,1,"FD"),this._pdf.doc.setDrawColor(this._style.brcolor),this._pdf.doc.setFillColor(255,255,255),this._pdf.doc.rect(g+h,_,h,1,"FD"),this._pdf.doc.setDrawColor(this._style.brcolor),this._pdf.doc.setFillColor(0,0,0),this._pdf.doc.rect(g+2*h,_,2*h,1,"FD"),this._pdf.doc.setTextColor(this._style.txcolor),this._pdf.doc.setFontSize(6),this._pdf.doc.text("0",g,_-1),this._pdf.doc.text(String(Math.round(10*d/4)/10),g+h-1,_-1),this._pdf.doc.text(String(Math.round(d/2)),g+2*h-2,_-1),this._pdf.doc.text(Math.round(d).toString()+" "+i,g+4*h-4,_-1)},this._addCompass=t=>u(this,void 0,void 0,(function*(){const e=this._view.getRotation(),n=100,{x:i,y:o}=this._calculateOffsetByPosition("bottomright",{x:2,y:6},6),r=t=>{const r=document.createElement("canvas");r.height=120,r.width=120;const s=r.getContext("2d");s.translate(.5*r.width,.5*r.height),s.rotate(e),s.translate(.5*-r.width,.5*-r.height),s.drawImage(t,(r.height-n)/2,(r.width-n)/2,n,n);const a=i-6,l=o;return this._pdf.doc.setDrawColor(this._style.brcolor),this._pdf.doc.setFillColor(this._style.bkcolor),this._pdf.doc.circle(a,l,6,"FD"),r},s=t=>{const e=r(t),n=i-9-6/4.3,s=o-4.5;this._pdf.doc.addImage(e,"PNG",n,s,9,9)};if(!(t instanceof Image)){let e;if("string"==typeof t)e=t;else{if(!(t instanceof SVGElement))throw this._i18n.errorImage;e=yield this._processSvgImage(t)}return new Promise(((t,i)=>{const o=new Image(n,n);o.onload=()=>{s(o),t()},o.onerror=()=>{i(this._i18n.errorImage)},o.src=e}))}s(undefined)}));const{view:e,form:n,i18n:i,config:o,height:r,width:s,scaleResolution:a}=t;this._view=e,this._form=n,this._i18n=i,this._config=o,this._pdf=this.create(this._form.orientation,this._form.format,r,s),this._scaleDenominator=this._calculateScaleDenominator(this._form.resolution,a)}create(t,e,n,i){var o;return{doc:new((null===(o=window.jspdf)||void 0===o?void 0:o.jsPDF)||r.jsPDF)({orientation:t,format:e}),height:n,width:i}}addMapImage(t){this._pdf.doc.addImage(t,"JPEG",this._config.style.paperMargin,this._config.style.paperMargin,this._pdf.width-2*this._config.style.paperMargin,this._pdf.height-2*this._config.style.paperMargin)}savePdf(){return new Promise(((t,e)=>{var n;if("pdf"===this._form.typeExport)this._pdf.doc.save(this._config.filename+".pdf"),t();else{const i=this._pdf.doc.output("dataurlstring"),o=(null===(n=null===window||void 0===window?void 0:window.pdfjsLib)||void 0===n?void 0:n.version)||s.version;s.GlobalWorkerOptions.workerSrc=`https://cdnjs.cloudflare.com/ajax/libs/pdf.js/${o}/pdf.worker.js`,s.getDocument(i).promise.then((e=>{e.getPage(1).then((e=>{const n=e.getViewport({scale:2}),i=T("canvas",null);i.style.display="none",document.body.appendChild(i);const o=i.getContext("2d");i.height=n.height,i.width=n.width;e.render({canvasContext:o,viewport:n}).promise.then((()=>{((t,e)=>{const n=T("a",{download:e,href:t});document.body.appendChild(n),n.click(),document.body.removeChild(n)})(i.toDataURL(`image/${this._form.typeExport}`),this._config.filename+`.${this._form.typeExport}`),i.remove(),t()}))}))}),(t=>{e(t),console.log(t)}))}}))}_calculateScaleDenominator(t,e){const n=t/25.4;return Math.round(1e3*n*this._getMeterPerPixel(e))}_getMeterPerPixel(e){const n=this._view.getProjection();return t.getPointResolution(n,e,this._view.getCenter())*n.getMetersPerUnit()}}function S(){}function k(){k.init.call(this)}function A(t){return void 0===t._maxListeners?k.defaultMaxListeners:t._maxListeners}function O(t,e,n){if(e)t.call(n);else for(var i=t.length,o=B(t,i),r=0;r<i;++r)o[r].call(n)}function j(t,e,n,i){if(e)t.call(n,i);else for(var o=t.length,r=B(t,o),s=0;s<o;++s)r[s].call(n,i)}function F(t,e,n,i,o){if(e)t.call(n,i,o);else for(var r=t.length,s=B(t,r),a=0;a<r;++a)s[a].call(n,i,o)}function D(t,e,n,i,o,r){if(e)t.call(n,i,o,r);else for(var s=t.length,a=B(t,s),l=0;l<s;++l)a[l].call(n,i,o,r)}function z(t,e,n,i){if(e)t.apply(n,i);else for(var o=t.length,r=B(t,o),s=0;s<o;++s)r[s].apply(n,i)}function R(t,e,n,i){var o,r,s,a;if("function"!=typeof n)throw new TypeError('"listener" argument must be a function');if((r=t._events)?(r.newListener&&(t.emit("newListener",e,n.listener?n.listener:n),r=t._events),s=r[e]):(r=t._events=new S,t._eventsCount=0),s){if("function"==typeof s?s=r[e]=i?[n,s]:[s,n]:i?s.unshift(n):s.push(n),!s.warned&&(o=A(t))&&o>0&&s.length>o){s.warned=!0;var l=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+e+" listeners added. Use emitter.setMaxListeners() to increase limit");l.name="MaxListenersExceededWarning",l.emitter=t,l.type=e,l.count=s.length,a=l,"function"==typeof console.warn?console.warn(a):console.log(a)}}else s=r[e]=n,++t._eventsCount;return t}function I(t,e,n){var i=!1;function o(){t.removeListener(e,o),i||(i=!0,n.apply(t,arguments))}return o.listener=n,o}function H(t){var e=this._events;if(e){var n=e[t];if("function"==typeof n)return 1;if(n)return n.length}return 0}function B(t,e){for(var n=new Array(e);e--;)n[e]=t[e];return n}S.prototype=Object.create(null),k.EventEmitter=k,k.usingDomains=!1,k.prototype.domain=void 0,k.prototype._events=void 0,k.prototype._maxListeners=void 0,k.defaultMaxListeners=10,k.init=function(){this.domain=null,k.usingDomains&&undefined.active,this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=new S,this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},k.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||isNaN(t))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=t,this},k.prototype.getMaxListeners=function(){return A(this)},k.prototype.emit=function(t){var e,n,i,o,r,s,a,l="error"===t;if(s=this._events)l=l&&null==s.error;else if(!l)return!1;if(a=this.domain,l){if(e=arguments[1],!a){if(e instanceof Error)throw e;var c=new Error('Uncaught, unspecified "error" event. ('+e+")");throw c.context=e,c}return e||(e=new Error('Uncaught, unspecified "error" event')),e.domainEmitter=this,e.domain=a,e.domainThrown=!1,a.emit("error",e),!1}if(!(n=s[t]))return!1;var d="function"==typeof n;switch(i=arguments.length){case 1:O(n,d,this);break;case 2:j(n,d,this,arguments[1]);break;case 3:F(n,d,this,arguments[1],arguments[2]);break;case 4:D(n,d,this,arguments[1],arguments[2],arguments[3]);break;default:for(o=new Array(i-1),r=1;r<i;r++)o[r-1]=arguments[r];z(n,d,this,o)}return!0},k.prototype.addListener=function(t,e){return R(this,t,e,!1)},k.prototype.on=k.prototype.addListener,k.prototype.prependListener=function(t,e){return R(this,t,e,!0)},k.prototype.once=function(t,e){if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');return this.on(t,I(this,t,e)),this},k.prototype.prependOnceListener=function(t,e){if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');return this.prependListener(t,I(this,t,e)),this},k.prototype.removeListener=function(t,e){var n,i,o,r,s;if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');if(!(i=this._events))return this;if(!(n=i[t]))return this;if(n===e||n.listener&&n.listener===e)0==--this._eventsCount?this._events=new S:(delete i[t],i.removeListener&&this.emit("removeListener",t,n.listener||e));else if("function"!=typeof n){for(o=-1,r=n.length;r-- >0;)if(n[r]===e||n[r].listener&&n[r].listener===e){s=n[r].listener,o=r;break}if(o<0)return this;if(1===n.length){if(n[0]=void 0,0==--this._eventsCount)return this._events=new S,this;delete i[t]}else!function(t,e){for(var n=e,i=n+1,o=t.length;i<o;n+=1,i+=1)t[n]=t[i];t.pop()}(n,o);i.removeListener&&this.emit("removeListener",t,s||e)}return this},k.prototype.removeAllListeners=function(t){var e,n;if(!(n=this._events))return this;if(!n.removeListener)return 0===arguments.length?(this._events=new S,this._eventsCount=0):n[t]&&(0==--this._eventsCount?this._events=new S:delete n[t]),this;if(0===arguments.length){for(var i,o=Object.keys(n),r=0;r<o.length;++r)"removeListener"!==(i=o[r])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=new S,this._eventsCount=0,this}if("function"==typeof(e=n[t]))this.removeListener(t,e);else if(e)do{this.removeListener(t,e[e.length-1])}while(e[0]);return this},k.prototype.listeners=function(t){var e,n=this._events;return n&&(e=n[t])?"function"==typeof e?[e.listener||e]:function(t){for(var e=new Array(t.length),n=0;n<e.length;++n)e[n]=t[n].listener||t[n];return e}(e):[]},k.listenerCount=function(t,e){return"function"==typeof t.listenerCount?t.listenerCount(e):H.call(t,e)},k.prototype.listenerCount=H,k.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};const N=document.createElement("div"),U=function(){let t,e,n,i=document.createElement("div");return Object.assign(i.style,{visibility:"hidden",width:"100px"}),document.body.appendChild(i),n=i.offsetWidth,i.style.overflow="scroll",t=document.createElement("div"),t.style.width="100%",i.appendChild(t),e=n-t.offsetWidth,document.body.removeChild(i),e}(),q=Object.freeze({el:null,animate:!0,animateClass:"fade",animateInClass:"show",appendTo:"body",backdrop:!0,keyboard:!0,title:!1,header:!0,content:!1,footer:!0,buttons:null,headerClose:!0,construct:!1,transition:300,backdropTransition:150}),W=function t(e){for(let n in e)Array.isArray(e[n])?e[n].forEach((e=>{t(e)})):null!==e[n]&&"object"==typeof e[n]&&Object.freeze(e[n]);return Object.freeze(e)}({dialog:[{text:"Cancel",value:!1,attr:{class:"btn btn-default","data-dismiss":"modal"}},{text:"OK",value:!0,attr:{class:"btn btn-primary","data-dismiss":"modal"}}],alert:[{text:"OK",attr:{class:"btn btn-primary","data-dismiss":"modal"}}],confirm:[{text:"Cancel",value:!1,attr:{class:"btn btn-default","data-dismiss":"modal"}},{text:"OK",value:!0,attr:{class:"btn btn-primary","data-dismiss":"modal"}}]}),$={container:'<div class="modal"></div>',dialog:'<div class="modal-dialog"></div>',content:'<div class="modal-content"></div>',header:'<div class="modal-header"></div>',headerClose:'<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>',body:'<div class="modal-body"></div>',footer:'<div class="modal-footer"></div>',backdrop:'<div class="modal-backdrop"></div>'};function V(t,e,n){let i=t.data||{};if(void 0===n){if(t.data&&t.data[e])return t.data[e];var o=t.getAttribute(`data-${e}`);return void 0!==o?o:null}return i[e]=n,t.data=i,t}function G(t,e){return t.nodeName?t:(t=t.replace(/(\t|\n$)/g,""),N.innerHTML="",N.innerHTML=t,!0===e?N.childNodes:N.childNodes[0])}class K extends k{static set templates(t){this._baseTemplates=t}static get templates(){return Object.assign({},$,K._baseTemplates||{})}static set buttons(t){this._baseButtons=t}static get buttons(){return Object.assign({},W,K._baseButtons||{})}static set options(t){this._baseOptions=t}static get options(){return Object.assign({},q,K._baseOptions||{})}static get version(){return"0.8.0"}static alert(t,e={}){let n=Object.assign({},q,{title:t,content:!1,construct:!0,headerClose:!1,buttons:K.buttons.alert},e);return new K(n)}static confirm(t,e={}){let n=Object.assign({},q,{title:t,content:!1,construct:!0,headerClose:!1,buttons:K.buttons.confirm},e);return new K(n)}constructor(t={}){if(super(),this.id=(65536*(1+Math.random())|0).toString(16)+(65536*(1+Math.random())|0).toString(16),this.el=null,this._html={},this._events={},this._visible=!1,this._options=Object.assign({},K.options,t),this._templates=Object.assign({},K.templates,t.templates||{}),this._html.appendTo=document.querySelector(this._options.appendTo),null===this._options.buttons&&(this._options.buttons=K.buttons.dialog),this._options.el){let t=this._options.el;if("string"==typeof this._options.el&&(t=document.querySelector(this._options.el),!t))throw new Error(`Selector: DOM Element ${this._options.el} not found.`);V(t,"modal",this),this.el=t}else this._options.construct=!0;this._options.construct?this._render():this._mapDom()}_render(){let t=this._html,e=this._options,n=this._templates,i=!!e.animate&&e.animateClass;return t.container=G(n.container),t.dialog=G(n.dialog),t.content=G(n.content),t.header=G(n.header),t.headerClose=G(n.headerClose),t.body=G(n.body),t.footer=G(n.footer),i&&t.container.classList.add(i),this._setHeader(),this._setContent(),this._setFooter(),this.el=t.container,t.dialog.appendChild(t.content),t.container.appendChild(t.dialog),this}_mapDom(){let t=this._html,e=this._options;return this.el.classList.contains(e.animateClass)&&(e.animate=!0),t.container=this.el,t.dialog=this.el.querySelector(".modal-dialog"),t.content=this.el.querySelector(".modal-content"),t.header=this.el.querySelector(".modal-header"),t.headerClose=this.el.querySelector(".modal-header .close"),t.body=this.el.querySelector(".modal-body"),t.footer=this.el.querySelector(".modal-footer"),this._setHeader(),this._setContent(),this._setFooter(),this}_setHeader(){let t=this._html,e=this._options;e.header&&t.header&&(e.title.nodeName?t.header.innerHTML=e.title.outerHTML:"string"==typeof e.title&&(t.header.innerHTML=`<h4 class="modal-title">${e.title}</h4>`),null===this.el&&t.headerClose&&e.headerClose&&t.header.appendChild(t.headerClose),e.construct&&t.content.appendChild(t.header))}_setContent(){let t=this._html,e=this._options;e.content&&t.body&&("string"==typeof e.content?t.body.innerHTML=e.content:t.body.innerHTML=e.content.outerHTML,e.construct&&t.content.appendChild(t.body))}_setFooter(){let t=this._html,e=this._options;e.footer&&t.footer&&(e.footer.nodeName?t.footer.ineerHTML=e.footer.outerHTML:"string"==typeof e.footer?t.footer.innerHTML=e.footer:t.footer.children.length||e.buttons.forEach((e=>{let n=document.createElement("button");V(n,"button",e),n.innerHTML=e.text,n.setAttribute("type","button");for(let t in e.attr)n.setAttribute(t,e.attr[t]);t.footer.appendChild(n)})),e.construct&&t.content.appendChild(t.footer))}_setEvents(){this._options;let t=this._html;this._events.keydownHandler=this._handleKeydownEvent.bind(this),document.body.addEventListener("keydown",this._events.keydownHandler),this._events.clickHandler=this._handleClickEvent.bind(this),t.container.addEventListener("click",this._events.clickHandler),this._events.resizeHandler=this._handleResizeEvent.bind(this),window.addEventListener("resize",this._events.resizeHandler)}_handleClickEvent(t){(function(t){let e=[t];for(;t.parentNode;)t=t.parentNode,e.push(t);return e})(t.target).every((e=>"HTML"!==e.tagName&&((!0===this._options.backdrop||!e.classList.contains("modal"))&&(!e.classList.contains("modal-content")&&("modal"===e.getAttribute("data-dismiss")?(this.emit("dismiss",this,t,V(t.target,"button")),this.hide(),!1):!e.classList.contains("modal")||(this.emit("dismiss",this,t,null),this.hide(),!1))))))}_handleKeydownEvent(t){27===t.which&&this._options.keyboard&&(this.emit("dismiss",this,t,null),this.hide())}_handleResizeEvent(t){this._resize()}show(){let t=this._options,e=this._html;return this.emit("show",this),this._checkScrollbar(),this._setScrollbar(),document.body.classList.add("modal-open"),t.construct&&e.appendTo.appendChild(e.container),e.container.style.display="block",e.container.scrollTop=0,!1!==t.backdrop?(this.once("showBackdrop",(()=>{this._setEvents(),t.animate&&e.container.offsetWidth,e.container.classList.add(t.animateInClass),setTimeout((()=>{this._visible=!0,this.emit("shown",this)}),t.transition)})),this._backdrop()):(this._setEvents(),t.animate&&e.container.offsetWidth,e.container.classList.add(t.animateInClass),setTimeout((()=>{this._visible=!0,this.emit("shown",this)}),t.transition)),this._resize(),this}toggle(){this._visible?this.hide():this.show()}_resize(){var t=this._html.container.scrollHeight>document.documentElement.clientHeight;this._html.container.style.paddingLeft=!this.bodyIsOverflowing&&t?U+"px":"",this._html.container.style.paddingRight=this.bodyIsOverflowing&&!t?U+"px":""}_backdrop(){let t=this._html,e=this._templates,n=this._options,i=!!n.animate&&n.animateClass;t.backdrop=G(e.backdrop),i&&t.backdrop.classList.add(i),t.appendTo.appendChild(t.backdrop),i&&t.backdrop.offsetWidth,t.backdrop.classList.add(n.animateInClass),setTimeout((()=>{this.emit("showBackdrop",this)}),this._options.backdropTransition)}hide(){let t=this._html,e=this._options,n=t.container.classList;if(this.emit("hide",this),n.remove(e.animateInClass),e.backdrop){t.backdrop.classList.remove(e.animateInClass)}return this._removeEvents(),setTimeout((()=>{document.body.classList.remove("modal-open"),document.body.style.paddingRight=this.originalBodyPad}),e.backdropTransition),setTimeout((()=>{e.backdrop&&t.backdrop.parentNode.removeChild(t.backdrop),t.container.style.display="none",e.construct&&t.container.parentNode.removeChild(t.container),this._visible=!1,this.emit("hidden",this)}),e.transition),this}_removeEvents(){this._events.keydownHandler&&document.body.removeEventListener("keydown",this._events.keydownHandler),this._html.container.removeEventListener("click",this._events.clickHandler),window.removeEventListener("resize",this._events.resizeHandler)}_checkScrollbar(){this.bodyIsOverflowing=document.body.clientWidth<window.innerWidth}_setScrollbar(){if(this.originalBodyPad=document.body.style.paddingRight||"",this.bodyIsOverflowing){let t=parseInt(this.originalBodyPad||0,10);document.body.style.paddingRight=t+U+"px"}}}var X=f(Object.freeze({__proto__:null,default:K})).default;class J{constructor(t,e,n,i){this._modal=new X(Object.assign({headerClose:!0,header:!0,animate:!0,title:n.printPdf,content:this.Content(n,e),footer:this.Footer(n,e)},e.modal)),this._modal.on("dismiss",((t,n)=>{if(!n.target.dataset.print)return;const o=document.getElementById("printMap"),r=new FormData(o),s={format:r.get("printFormat"),orientation:r.get("printOrientation"),resolution:r.get("printResolution"),scale:r.get("printScale"),description:r.get("printDescription"),compass:r.get("printCompass"),attributions:r.get("printAttributions"),scalebar:r.get("printScalebar"),typeExport:this._modal.el.querySelector('select[name="printTypeExport"]').value};i(s,!0,e.modal.transition)})),this._modal.on("shown",(()=>{const e=((t,e=!0)=>{const n=t.getView(),i=n.getProjection().getUnits();let o=n.getResolution()*a.METERS_PER_UNIT[i]*39.37*(25.4/.28);return e&&(o=Math.round(o)),o})(t),i=this._modal.el.querySelector(".actualScale");i.value=String(e/1e3),i.innerHTML=`${n.current} (1:${e.toLocaleString("de")})`}))}Content(t,e){const{scales:n,dpi:i,mapElements:o,paperSizes:r}=e;return T("form",{id:"printMap"},T("div",null,T("div",{className:"printFieldHalf"},T("label",{htmlFor:"printFormat"},t.paperSize),T("select",{name:"printFormat",id:"printFormat"},r.map((t=>T("option",Object.assign({value:t.value},t.selected?{selected:"selected"}:{}),t.value))))),T("div",{className:"printFieldHalf"},T("label",{htmlFor:"printOrientation"},t.orientation),T("select",{name:"printOrientation",id:"printOrientation"},T("option",{value:"landscape",selected:!0},t.landscape),T("option",{value:"portrait"},t.portrait)))),T("div",null,T("div",{className:"printFieldHalf"},T("label",{htmlFor:"printResolution"},t.resolution),T("select",{name:"printResolution",id:"printResolution"},i.map((t=>T("option",Object.assign({value:t.value},t.selected?{selected:"selected"}:{}),t.value," dpi"))))),T("div",{className:"printFieldHalf"},T("label",{htmlFor:"printScale"},t.scale),T("select",{name:"printScale",id:"printScale"},T("option",{className:"actualScale",value:"",selected:!0}),n.map((t=>T("option",{value:t},"1:",(1e3*t).toLocaleString("de"))))))),o&&T("div",null,o.description&&T("div",null,T("label",{htmlFor:"printDescription"},t.addNote),T("textarea",{id:"printDescription",name:"printDescription",rows:"4"})),T("div",null,t.mapElements),T("div",{className:"printElements"},o.compass&&T("label",{htmlFor:"printCompass"},T("input",{type:"checkbox",id:"printCompass",name:"printCompass",checked:!0}),t.compass),o.scalebar&&T("label",{htmlFor:"printScalebar"},T("input",{type:"checkbox",id:"printScalebar",name:"printScalebar",checked:!0}),t.scale),o.attributions&&T("label",{htmlFor:"printAttributions"},T("input",{type:"checkbox",id:"printAttributions",name:"printAttributions",checked:!0}),t.layersAttributions))))}Footer(t,e){const{mimeTypeExports:n}=e;return T("div",null,T("button",{type:"button",className:"btn-sm btn btn-secondary","data-dismiss":"modal"},t.cancel),T("div",{class:"typeExportContainer"},T("button",{type:"button",className:"btn-sm btn btn-primary","data-print":"true","data-dismiss":"modal"},t.print),T("select",{className:"typeExport",name:"printTypeExport",id:"printTypeExport"},n.map((t=>T("option",Object.assign({value:t.value},t.selected?{selected:"selected"}:{}),t.value)))))).outerHTML}hide(){this._modal.hide()}show(){this._modal._visible||this._modal.show()}}class Y{constructor(t,e,n){this._i18n=t,this._modal=new X(Object.assign({headerClose:!1,title:this._i18n.printing,backdrop:"static",content:" ",footer:`\n            <button\n                type="button"\n                class="btn-sm btn btn-secondary"\n                data-dismiss="modal"\n            >\n                ${this._i18n.cancel}\n            </button>\n            `},e.modal)),this._modal.on("dismiss",(()=>{n()}))}_setContentModal(t){this._modal._html.body.innerHTML=t}_setFooterModal(t){this._modal._html.footer.innerHTML=t}show(t){this._setContentModal(t),this._modal._visible||this._modal.show()}hide(){this._modal.hide()}}var Z=Object.freeze({__proto__:null,es:{printPdf:"Exportar PDF",pleaseWait:"Por favor espere...",almostThere:"Ya casi...",error:"Error al generar pdf",errorImage:"Ocurrió un error al tratar de cargar una imagen",printing:"Exportando",cancel:"Cancelar",close:"Cerrar",print:"Exportar",mapElements:"Elementos en el mapa",compass:"Brújula",scale:"Escala",layersAttributions:"Atribuciones de capas",addNote:"Agregar nota (opcional)",resolution:"Resolución",orientation:"Orientación",paperSize:"Tamaño de página",landscape:"Paisaje",portrait:"Retrato",current:"Actual",paper:"Hoja"},en:{printPdf:"Print PDF",pleaseWait:"Please wait...",almostThere:"Almost there...",error:"An error occurred while printing",errorImage:"An error ocurred while loading an image",printing:"Exporting",cancel:"Cancel",close:"Close",print:"Export",mapElements:"Map elements",compass:"Compass",scale:"Scale",layersAttributions:"Layer attributions",addNote:"Add note (optional)",resolution:"Resolution",orientation:"Orientation",paperSize:"Paper size",landscape:"Landscape",portrait:"Portrait",current:"Current",paper:"Paper"}});const Q="printMode";function tt(t,...e){return e.forEach((e=>{Object.keys(e).forEach((n=>{const i=e[n],o=t[n];t[n]=o&&i&&"object"==typeof o&&"object"==typeof i&&!Array.isArray(o)?tt(o,i):i}))})),t}class et extends c.default{constructor(t){const e=document.createElement("button");super({target:t.target,element:e}),this._i18n=t.language&&t.language in Z?Z[t.language]:Z.en,t.i18n&&(this._i18n=Object.assign(Object.assign({},this._i18n),t.i18n)),this._options={language:"en",filename:"Ol Pdf Printer",style:{paperMargin:10,brcolor:"#000000",bkcolor:"#273f50",txcolor:"#ffffff"},extraInfo:{date:!0,url:!0,specs:!0},mapElements:{description:!0,attributions:!0,scalebar:!0,compass:(new DOMParser).parseFromString('<?xml version="1.0" encoding="utf-8"?>\n<svg version="1.1" id="compass" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"\n\t viewBox="0 0 300 300" style="enable-background:new 0 0 300 300;" xml:space="preserve">\n<style type="text/css">\n\t.st0{fill:#EA6868;}\n</style>\n<g>\n\t<g>\n\t\t<g>\n\t\t\t<g>\n\t\t\t\t<g>\n\t\t\t\t\t<path class="st0" d="M146.3,9.1L75.5,287.2c-0.5,1.8,0.5,3.7,2.1,4.4c1.8,0.8,3.7,0.2,4.7-1.5l68.4-106.7l66.8,106.7\n\t\t\t\t\t\tc0.6,1.1,1.9,1.8,3.2,1.8c0.5,0,1-0.2,1.5-0.3c1.8-0.8,2.6-2.6,2.3-4.4L153.7,9.1C152.9,5.7,147.2,5.7,146.3,9.1z M154.2,174.2\n\t\t\t\t\t\tc-0.6-1.1-1.9-1.8-3.2-1.8l0,0c-1.3,0-2.6,0.6-3.2,1.8l-59,92L150,25.5l61.1,239.9L154.2,174.2z"/>\n\t\t\t\t</g>\n\t\t\t</g>\n\t\t\t<g>\n\t\t\t\t<g>\n\t\t\t\t\t<path class="st0" d="M220.8,293.1c-1.8,0-3.4-1-4.2-2.3l-65.8-105.1L83.4,290.8c-1.3,1.9-4,2.9-6.1,1.9c-2.3-1-3.4-3.4-2.9-5.8\n\t\t\t\t\t\tL145.1,8.8c0.5-2.1,2.4-3.4,4.9-3.4s4.4,1.3,4.9,3.4l70.8,278.1c0.6,2.4-0.6,4.9-2.9,5.8C222.1,292.9,221.5,293.1,220.8,293.1z\n\t\t\t\t\t\t M150.8,181.2l1,1.6l66.8,106.7c0.6,1,1.9,1.5,3.2,1c1.1-0.5,1.8-1.8,1.5-3.1L152.4,9.3c-0.3-1.1-1.6-1.6-2.6-1.6\n\t\t\t\t\t\ts-2.3,0.5-2.6,1.6L76.4,287.4c-0.3,1.3,0.3,2.6,1.5,3.1c1.1,0.5,2.6,0,3.2-1L150.8,181.2z M85.6,273.2L150,20.6l64.2,251.9\n\t\t\t\t\t\tl-61.1-97.7c-1-1.6-3.4-1.5-4.4,0L85.6,273.2z"/>\n\t\t\t\t</g>\n\t\t\t</g>\n\t\t</g>\n\t</g>\n</g>\n</svg>\n',"image/svg+xml").firstChild},watermark:{title:"Ol Pdf Printer",titleColor:"#d65959",subtitle:"https://github.com/GastonZalba/ol-pdf-printer",subtitleColor:"#444444",logo:!1},paperSizes:[{size:[594,420],value:"A2"},{size:[420,297],value:"A3"},{size:[297,210],value:"A4",selected:!0},{size:[210,148],value:"A5"}],dpi:[{value:72},{value:96},{value:150,selected:!0},{value:200},{value:300}],scales:[1e4,5e3,1e3,500,250,100,50,25,10],mimeTypeExports:[{value:"pdf",selected:!0},{value:"png"},{value:"jpeg"},{value:"webp"}],units:"metric",dateFormat:void 0,ctrlBtnClass:"",modal:{animateClass:"fade",animateInClass:"show",transition:150,backdropTransition:100,templates:{dialog:'<div class="modal-dialog modal-dialog-centered"></div>',headerClose:`<button type="button" class="btn-close" data-dismiss="modal" aria-label="${this._i18n.close}"><span aria-hidden="true">×</span></button>`}}},this._options=tt(this._options,t),e.className=`ol-print-btn-menu ${this._options.ctrlBtnClass}`,e.title=this._i18n.printPdf,e.onclick=()=>this.showPrintSettingsModal(),e.append((new DOMParser).parseFromString('<?xml version="1.0" encoding="utf-8"?>\n<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"\n\t viewBox="0 0 490 490" xml:space="preserve">\n<g>\n\t<path d="M65.4,6v157.1c0,3.3-2.9,6-6.5,6H33.6c-3.6,0-6.5,2.7-6.5,6v189.6h0l36.3,33.8c1.2,1.1,1.9,2.7,1.9,4.3l0,81.2\n\t\tc0,3.3,2.9,6,6.5,6h383.8c3.6,0,6.5-2.7,6.5-6V104.9c0-1.6-0.7-3.1-1.9-4.3l-106-98.9c-1.2-1.1-2.9-1.8-4.6-1.8H71.8\n\t\tC68.2,0,65.4,2.7,65.4,6z M431.3,357.4h-374c-3.8,0-6.9-4-6.9-9V203.2c0-5,3.1-9,6.9-9h374c3.8,0,6.9,4,6.9,9v145.2\n\t\tC438.2,353.4,435.1,357.4,431.3,357.4z M340.2,27.6l70.8,66c7.2,6.7,2.1,18.2-8.1,18.2h-70.8c-6.3,0-11.4-4.8-11.4-10.7v-66\n\t\tC320.7,25.6,333,20.9,340.2,27.6z"/>\n\t<path d="M136.9,207.4h-6.5H87.9c-5.8,0-10.5,4.9-10.5,11v115.5c0,6.1,4.7,11,10.5,11h4c5.8,0,10.5-4.9,10.5-11v-22.4\n\t\tc0-6.1,4.7-11,10.5-11h18.9l5.8-0.1c18,0,29.9-3,35.8-9.1c5.9-6.1,8.9-18.3,8.9-36.7c0-18.5-3.1-31-9.3-37.5\n\t\tC166.6,210.6,154.7,207.4,136.9,207.4z M152.2,274.4c-3.1,2.7-10.2,4.1-21.5,4.1h-17.9c-5.8,0-10.5-4.9-10.5-11v-27.2\n\t\tc0-6.1,4.7-11,10.5-11h20.4c10.6,0,17.2,1.4,19.8,4.2c2.5,2.8,3.8,10,3.8,21.6C156.8,265.2,155.3,271.6,152.2,274.4z"/>\n\t<path d="M262.6,207.4h-54.1c-5.8,0-10.5,4.9-10.5,11v115.5c0,6.1,4.7,11,10.5,11h54.9c20.7,0,34.1-4.9,39.9-14.6\n\t\tc5.9-9.8,8.9-31.8,8.9-66.1c0-21-3.7-35.7-11-44.1C293.8,211.5,281,207.4,262.6,207.4z M281.6,314.2c-3.5,5.8-11.2,8.6-23.1,8.6\n\t\th-25c-5.8,0-10.5-4.9-10.5-11v-71.6c0-6.1,4.7-11,10.5-11H260c11.6,0,19,2.7,22.1,8.2c3.1,5.5,4.7,18.4,4.7,38.7\n\t\tC286.9,295.8,285.1,308.5,281.6,314.2z"/>\n\t<path d="M340.9,344.8h3.9c5.8,0,10.5-4.9,10.5-11v-34.5c0-6.1,4.7-11,10.5-11h37.9c5.8,0,10.5-4.9,10.5-11v0\n\t\tc0-6.1-4.7-11-10.5-11h-37.9c-5.8,0-10.5-4.9-10.5-11v-15.1c0-6.1,4.7-11,10.5-11h41.1c5.8,0,10.5-4.9,10.5-11v0\n\t\tc0-6.1-4.7-11-10.5-11h-66c-5.8,0-10.5,4.9-10.5,11v115.5C330.4,339.9,335.1,344.8,340.9,344.8z"/>\n</g>\n</svg>\n',"image/svg+xml").firstChild)}_init(){this._map=this.getMap(),this._view=this._map.getView(),this._mapTarget=this._map.getTargetElement(),this._settingsModal=new J(this._map,this._options,this._i18n,this._printMap.bind(this)),this._processingModal=new Y(this._i18n,this._options,this._onEndPrint.bind(this)),this._initialized=!0}_setMapSizForPrint(t,e,n){const i=n/25.4;return[Math.round(t*i),Math.round(e*i)]}_onEndPrint(){this._mapTarget.style.width="",this._mapTarget.style.height="",this._map.updateSize(),this._view.setResolution(this._initialViewResolution),this._mapTarget.classList.remove(Q),this._view.setConstrainResolution(!0),clearTimeout(this._timeoutProcessing),this._cancel()}_prepareLoading(){this._processingModal.show(this._i18n.pleaseWait),this._timeoutProcessing=setTimeout((()=>{this._processingModal.show(this._i18n.almostThere)}),4e3)}_disableLoading(){this._processingModal.hide()}_setFormatOptions(t=""){this._map.getLayers().forEach((e=>{if(e instanceof h.default){const n=e.getSource();n instanceof d.default&&n.updateParams({FORMAT_OPTIONS:t})}}))}_printMap(e,n=!0,i=0){n&&this._mapTarget.classList.add(Q),setTimeout((()=>{n&&this._prepareLoading(),this._isCanceled=!1,this._view.setConstrainResolution(!1);let i=this._options.paperSizes.find((t=>t.value===e.format)).size;i="landscape"===e.orientation?i:[...i].reverse();const o=i[0],r=i[1],s=this._setMapSizForPrint(o,r,e.resolution),[a,l]=s;this._initialViewResolution=this._view.getResolution();const c=e.resolution/25.4,d=e.scale/t.getPointResolution(this._view.getProjection(),c,this._view.getCenter());this._renderCompleteKey=this._map.once("rendercomplete",(()=>{g.toJpeg(this._mapTarget.querySelector(".ol-unselectable.ol-layers"),{width:a,height:l}).then((t=>u(this,void 0,void 0,(function*(){this._isCanceled||(this._pdf=new L({view:this._view,i18n:this._i18n,config:this._options,form:e,height:r,width:o,scaleResolution:d}),this._pdf.addMapImage(t),yield this._pdf.addMapHelpers(),this._isCanceled||(yield this._pdf.savePdf(),this._onEndPrint(),n&&this._disableLoading()))})))).catch((t=>{const e="string"==typeof t?t:this._i18n.error;console.error(t),this._onEndPrint(),this._processingModal.show(e)}))})),this._mapTarget.style.width=a+"px",this._mapTarget.style.height=l+"px",this._map.updateSize(),this._map.getView().setResolution(d)}),i)}_cancel(){this._renderCompleteKey&&o.unByKey(this._renderCompleteKey),this._isCanceled=!0}showPrintSettingsModal(){this._initialized||this._init(),this._settingsModal.show()}hidePrintSettingsModal(){this._settingsModal.hide()}createPdf(t,e){t=Object.assign({format:(this._options.paperSizes.find((t=>t.selected))||this._options.paperSizes[0]).value,resolution:(this._options.dpi.find((t=>t.selected))||this._options.dpi[0]).value,orientation:"landscape",compass:!0,attributions:!0,scale:!0},t),this._printMap(t,e)}}return et}));
//# sourceMappingURL=ol-pdf-printer.min.js.map
