!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("ol/control/Control"),require("ol/proj"),require("jspdf"),require("ol/proj/Units")):"function"==typeof define&&define.amd?define(["ol/control/Control","ol/proj","jspdf","ol/proj/Units"],e):(t="undefined"!=typeof globalThis?globalThis:t||self).PdfPrinter=e(t.ol.control.Control,t.ol.proj,t.jsPDF,t.ol.proj.Units)}(this,(function(t,e,n,r){"use strict";function o(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var i=o(t);function a(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function s(t,e){if(t){if("string"==typeof t)return a(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?a(t,e):void 0}}function c(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=t&&("undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"]);if(null!=n){var r,o,i=[],a=!0,s=!1;try{for(n=n.call(t);!(a=(r=n.next()).done)&&(i.push(r.value),!e||i.length!==e);a=!0);}catch(t){s=!0,o=t}finally{try{a||null==n.return||n.return()}finally{if(s)throw o}}return i}}(t,e)||s(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function l(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function u(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function d(t,e,n){return e&&u(t.prototype,e),n&&u(t,n),t}function h(t,e){return(h=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function f(t){return(f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function p(t,e){return!e||"object"!==f(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function m(t){return(m=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function v(t){if(t.__esModule)return t;var e=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(t).forEach((function(n){var r=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(e,n,r.get?r:{enumerable:!0,get:function(){return t[n]}})})),e}function g(t){var e={exports:{}};return t(e,e.exports),e.exports}var y=g((function(t){var e=function(t){var e,n=Object.prototype,r=n.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",s=o.toStringTag||"@@toStringTag";function c(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(t){c=function(t,e,n){return t[e]=n}}function l(t,e,n,r){var o=e&&e.prototype instanceof v?e:v,i=Object.create(o.prototype),a=new T(r||[]);return i._invoke=function(t,e,n){var r=d;return function(o,i){if(r===f)throw new Error("Generator is already running");if(r===p){if("throw"===o)throw i;return O()}for(n.method=o,n.arg=i;;){var a=n.delegate;if(a){var s=E(a,n);if(s){if(s===m)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(r===d)throw r=p,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r=f;var c=u(t,e,n);if("normal"===c.type){if(r=n.done?p:h,c.arg===m)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(r=p,n.method="throw",n.arg=c.arg)}}}(t,n,a),i}function u(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}t.wrap=l;var d="suspendedStart",h="suspendedYield",f="executing",p="completed",m={};function v(){}function g(){}function y(){}var _={};_[i]=function(){return this};var b=Object.getPrototypeOf,w=b&&b(b(S([])));w&&w!==n&&r.call(w,i)&&(_=w);var x=y.prototype=v.prototype=Object.create(_);function C(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function L(t,e){function n(o,i,a,s){var c=u(t[o],t,i);if("throw"!==c.type){var l=c.arg,d=l.value;return d&&"object"==typeof d&&r.call(d,"__await")?e.resolve(d.__await).then((function(t){n("next",t,a,s)}),(function(t){n("throw",t,a,s)})):e.resolve(d).then((function(t){l.value=t,a(l)}),(function(t){return n("throw",t,a,s)}))}s(c.arg)}var o;this._invoke=function(t,r){function i(){return new e((function(e,o){n(t,r,e,o)}))}return o=o?o.then(i,i):i()}}function E(t,n){var r=t.iterator[n.method];if(r===e){if(n.delegate=null,"throw"===n.method){if(t.iterator.return&&(n.method="return",n.arg=e,E(t,n),"throw"===n.method))return m;n.method="throw",n.arg=new TypeError("The iterator does not provide a 'throw' method")}return m}var o=u(r,t.iterator,n.arg);if("throw"===o.type)return n.method="throw",n.arg=o.arg,n.delegate=null,m;var i=o.arg;return i?i.done?(n[t.resultName]=i.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,m):i:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,m)}function P(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function k(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function T(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(P,this),this.reset(!0)}function S(t){if(t){var n=t[i];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function n(){for(;++o<t.length;)if(r.call(t,o))return n.value=t[o],n.done=!1,n;return n.value=e,n.done=!0,n};return a.next=a}}return{next:O}}function O(){return{value:e,done:!0}}return g.prototype=x.constructor=y,y.constructor=g,g.displayName=c(y,s,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===g||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,y):(t.__proto__=y,c(t,s,"GeneratorFunction")),t.prototype=Object.create(x),t},t.awrap=function(t){return{__await:t}},C(L.prototype),L.prototype[a]=function(){return this},t.AsyncIterator=L,t.async=function(e,n,r,o,i){void 0===i&&(i=Promise);var a=new L(l(e,n,r,o),i);return t.isGeneratorFunction(n)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},C(x),c(x,s,"Generator"),x[i]=function(){return this},x.toString=function(){return"[object Generator]"},t.keys=function(t){var e=[];for(var n in t)e.push(n);return e.reverse(),function n(){for(;e.length;){var r=e.pop();if(r in t)return n.value=r,n.done=!1,n}return n.done=!0,n}},t.values=S,T.prototype={constructor:T,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(k),!t)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function o(r,o){return s.type="throw",s.arg=t,n.next=r,o&&(n.method="next",n.arg=e),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],s=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var c=r.call(a,"catchLoc"),l=r.call(a,"finallyLoc");if(c&&l){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,m):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),m},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),k(n),m}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var o=r.arg;k(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,n,r){return this.delegate={iterator:S(t),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=e),m}},t}(t.exports);try{regeneratorRuntime=e}catch(t){Function("r","regeneratorRuntime = r")(e)}})),_=g((function(t,e){!function(e){var n=function(){return{escape:function(t){return t.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1")},parseExtension:e,mimeType:function(t){var n=e(t).toLowerCase();return(r="application/font-woff",o="image/jpeg",{woff:r,woff2:r,ttf:"application/font-truetype",eot:"application/vnd.ms-fontobject",png:"image/png",jpg:o,jpeg:o,gif:"image/gif",tiff:"image/tiff",svg:"image/svg+xml"})[n]||"";var r,o},dataAsUrl:function(t,e){return"data:"+e+";base64,"+t},isDataUrl:function(t){return-1!==t.search(/^(data:)/)},canvasToBlob:function(t){return t.toBlob?new Promise((function(e){t.toBlob(e)})):function(t){return new Promise((function(e){for(var n=window.atob(t.toDataURL().split(",")[1]),r=n.length,o=new Uint8Array(r),i=0;i<r;i++)o[i]=n.charCodeAt(i);e(new Blob([o],{type:"image/png"}))}))}(t)},resolveUrl:function(t,e){var n=document.implementation.createHTMLDocument(),r=n.createElement("base");n.head.appendChild(r);var o=n.createElement("a");return n.body.appendChild(o),r.href=e,o.href=t,o.href},getAndEncode:function(t){var e=3e4;s.impl.options.cacheBust&&(t+=(/\?/.test(t)?"&":"?")+(new Date).getTime());return new Promise((function(n){var r,o=new XMLHttpRequest;if(o.onreadystatechange=a,o.ontimeout=c,o.responseType="blob",o.timeout=e,s.impl.options.useCredentials&&(o.withCredentials=!0),o.open("GET",t,!0),o.send(),s.impl.options.imagePlaceholder){var i=s.impl.options.imagePlaceholder.split(/,/);i&&i[1]&&(r=i[1])}function a(){if(4===o.readyState)if(200===o.status){var e=new FileReader;e.onloadend=function(){var t=e.result.split(/,/)[1];n(t)},e.readAsDataURL(o.response)}else r?n(r):l("cannot fetch resource: "+t+", status: "+o.status)}function c(){r?n(r):l("timeout of "+e+"ms occured while fetching resource: "+t)}function l(t){console.error(t),n("")}}))},uid:(t=0,function(){return"u"+e()+t++;function e(){return("0000"+(Math.random()*Math.pow(36,4)<<0).toString(36)).slice(-4)}}),delay:function(t){return function(e){return new Promise((function(n){setTimeout((function(){n(e)}),t)}))}},asArray:function(t){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e},isChrome:function(){return/chrome/i.test(navigator.userAgent)},escapeXhtml:function(t){return t.replace(/#/g,"%23").replace(/\n/g,"%0A")},makeImage:function(t){return"data:,"===t?Promise.resolve():new Promise((function(e,n){var r=new Image;s.impl.options.useCredentials&&(r.crossOrigin="use-credentials"),r.onload=function(){e(r)},r.onerror=n,r.src=t}))},width:function(t){var e=n(t,"border-left-width"),r=n(t,"border-right-width");return t.scrollWidth+e+r},height:function(t){var e=n(t,"border-top-width"),r=n(t,"border-bottom-width");return t.scrollHeight+e+r}};var t;function e(t){var e=/\.([^\.\/]*?)(\?|$)/g.exec(t);return e?e[1]:""}function n(t,e){var n=window.getComputedStyle(t).getPropertyValue(e);return parseFloat(n.replace("px",""))}}(),r=function(){var t=/url\(['"]?([^'"]+?)['"]?\)/g;return{inlineAll:function(t,n,i){return a()?Promise.resolve(t):Promise.resolve(t).then(r).then((function(e){var r=Promise.resolve(t);return e.forEach((function(t){r=r.then((function(e){return o(e,t,n,i)}))})),r}));function a(){return!e(t)}},shouldProcess:e,impl:{readUrls:r,inline:o}};function e(e){return-1!==e.search(t)}function r(e){for(var r,o=[];null!==(r=t.exec(e));)o.push(r[1]);return o.filter((function(t){return!n.isDataUrl(t)}))}function o(t,e,r,o){return Promise.resolve(e).then((function(t){return r?n.resolveUrl(t,r):t})).then(o||n.getAndEncode).then((function(t){return n.dataAsUrl(t,n.mimeType(e))})).then((function(r){return t.replace(function(t){return new RegExp("(url\\(['\"]?)("+n.escape(t)+")(['\"]?\\))","g")}(e),"$1"+r+"$3")}))}}(),o=function(){return{resolveAll:function(){return t().then((function(t){return Promise.all(t.map((function(t){return t.resolve()})))})).then((function(t){return t.join("\n")}))},impl:{readAll:t}};function t(){return Promise.resolve(n.asArray(document.styleSheets)).then((function(t){var e=[];return t.forEach((function(t){if(t.hasOwnProperty("cssRules"))try{n.asArray(t.cssRules||[]).forEach(e.push.bind(e))}catch(e){console.log("Error while reading CSS rules from "+t.href,e.toString())}})),e})).then((function(t){return t.filter((function(t){return t.type===CSSRule.FONT_FACE_RULE})).filter((function(t){return r.shouldProcess(t.style.getPropertyValue("src"))}))})).then((function(e){return e.map(t)}));function t(t){return{resolve:function(){var e=(t.parentStyleSheet||{}).href;return r.inlineAll(t.cssText,e)},src:function(){return t.style.getPropertyValue("src")}}}}}(),i=function(){return{inlineAll:function e(o){return o instanceof Element?i(o).then((function(){return o instanceof HTMLImageElement?t(o).inline():Promise.all(n.asArray(o.childNodes).map((function(t){return e(t)})))})):Promise.resolve(o);function i(t){var e=t.style.getPropertyValue("background");return e?r.inlineAll(e).then((function(e){t.style.setProperty("background",e,t.style.getPropertyPriority("background"))})).then((function(){return t})):Promise.resolve(t)}},impl:{newImage:t}};function t(t){return{inline:function(e){return n.isDataUrl(t.src)?Promise.resolve():Promise.resolve(t.src).then(e||n.getAndEncode).then((function(e){return n.dataAsUrl(e,n.mimeType(t.src))})).then((function(e){return new Promise((function(n,r){t.onload=n,t.onerror=n,t.src=e}))}))}}}}(),a={imagePlaceholder:void 0,cacheBust:!1,useCredentials:!1},s={toSvg:c,toPng:function(t,e){return l(t,e||{}).then((function(t){return t.toDataURL()}))},toJpeg:function(t,e){return l(t,e=e||{}).then((function(t){return t.toDataURL("image/jpeg",e.quality||1)}))},toBlob:function(t,e){return l(t,e||{}).then(n.canvasToBlob)},toPixelData:function(t,e){return l(t,e||{}).then((function(e){return e.getContext("2d").getImageData(0,0,n.width(t),n.height(t)).data}))},toCanvas:function(t,e){return l(t,e||{})},impl:{fontFaces:o,images:i,util:n,inliner:r,options:{}}};function c(t,e){return function(t){void 0===t.imagePlaceholder?s.impl.options.imagePlaceholder=a.imagePlaceholder:s.impl.options.imagePlaceholder=t.imagePlaceholder;void 0===t.cacheBust?s.impl.options.cacheBust=a.cacheBust:s.impl.options.cacheBust=t.cacheBust;void 0===t.useCredentials?s.impl.options.useCredentials=a.useCredentials:s.impl.options.useCredentials=t.useCredentials}(e=e||{}),Promise.resolve(t).then((function(t){return u(t,e.filter,!0)})).then(d).then(h).then((function(t){e.bgcolor&&(t.style.backgroundColor=e.bgcolor);e.width&&(t.style.width=e.width+"px");e.height&&(t.style.height=e.height+"px");e.style&&Object.keys(e.style).forEach((function(n){t.style[n]=e.style[n]}));return t})).then((function(r){return function(t,e,r){return Promise.resolve(t).then((function(t){return t.setAttribute("xmlns","http://www.w3.org/1999/xhtml"),(new XMLSerializer).serializeToString(t)})).then(n.escapeXhtml).then((function(t){return'<foreignObject x="0" y="0" width="100%" height="100%">'+t+"</foreignObject>"})).then((function(t){return'<svg xmlns="http://www.w3.org/2000/svg" width="'+e+'" height="'+r+'">'+t+"</svg>"})).then((function(t){return"data:image/svg+xml;charset=utf-8,"+t}))}(r,e.width||n.width(t),e.height||n.height(t))}))}function l(t,e){return c(t,e).then(n.makeImage).then(n.delay(100)).then((function(r){var o="number"!=typeof e.scale?1:e.scale;console.log("scale",o);var i=function(t,r){var o=document.createElement("canvas");if(o.width=(e.width||n.width(t))*r,o.height=(e.height||n.height(t))*r,console.log(o.width,o.height),e.bgcolor){var i=o.getContext("2d");i.fillStyle=e.bgcolor,i.fillRect(0,0,o.width,o.height)}return o}(t,o),a=i.getContext("2d");return r&&(a.scale(o,o),e.canvas&&e.canvas.width&&(i.width=e.canvas.width),e.canvas&&e.canvas.height&&(i.height=e.canvas.height),e.canvas?(console.log("canv",e.canvas),a.drawImage(r,e.canvas.sx||0,e.canvas.sy||0,e.canvas.sw||e.width,e.canvas.sh||e.height,e.canvas.dx||0,e.canvas.dy||0,e.canvas.dw||e.width,e.canvas.dh||e.height)):a.drawImage(r,0,0)),i}))}function u(t,e,r){return r||!e||e(t)?Promise.resolve(t).then((function(t){return t instanceof HTMLCanvasElement?n.makeImage(t.toDataURL()):t.cloneNode(!1)})).then((function(r){return function(t,e,r){var o="use"===t.tagName?function(t){return[document.getElementById(t.href.baseVal.replace("#","")).cloneNode(!0)]}(t):t.childNodes;return 0===o.length?Promise.resolve(e):i(e,n.asArray(o),r).then((function(){return e}));function i(t,e,n){var r=Promise.resolve();return e.forEach((function(e){r=r.then((function(){return u(e,n)})).then((function(e){e&&t.appendChild(e)}))})),r}}(t,r,e)})).then((function(e){return function(t,e){return e instanceof Element?Promise.resolve().then(r).then(o).then(i).then(a).then((function(){return e})):e;function r(){function r(t,e){function r(t,e){n.asArray(t).forEach((function(n){e.setProperty(n,t.getPropertyValue(n),t.getPropertyPriority(n))}))}t.cssText?(e.cssText=t.cssText,e.font=t.font):r(t,e)}r(window.getComputedStyle(t),e.style),n.isChrome()&&e.style.marker&&("line"===e.tagName||"path"===e.tagName)&&(e.style.marker="")}function o(){function r(r){var o=window.getComputedStyle(t,r),i=o.getPropertyValue("content");if(""!==i&&"none"!==i){var a=n.uid(),s=e.getAttribute("class");s&&e.setAttribute("class",s+" "+a);var c=document.createElement("style");c.appendChild(l(a,r,o)),e.appendChild(c)}function l(t,e,r){var o="."+t+":"+e,i=r.cssText?a(r):s(r);return document.createTextNode(o+"{"+i+"}");function a(t){var e=t.getPropertyValue("content");return t.cssText+" content: "+e+";"}function s(t){return n.asArray(t).map(e).join("; ")+";";function e(e){return e+": "+t.getPropertyValue(e)+(t.getPropertyPriority(e)?" !important":"")}}}}[":before",":after"].forEach((function(t){r(t)}))}function i(){t instanceof HTMLTextAreaElement&&(e.innerHTML=t.value),t instanceof HTMLInputElement&&e.setAttribute("value",t.value)}function a(){e instanceof SVGElement&&(e.setAttribute("xmlns","http://www.w3.org/2000/svg"),e instanceof SVGRectElement&&["width","height"].forEach((function(t){var n=e.getAttribute(t);n&&e.style.setProperty(t,n)})))}}(t,e)})):Promise.resolve()}function d(t){return o.resolveAll().then((function(e){var n=document.createElement("style");return t.appendChild(n),n.appendChild(document.createTextNode(e)),t}))}function h(t){return i.inlineAll(t).then((function(){return t}))}t.exports=s}()}));function b(){}function w(){w.init.call(this)}function x(t){return void 0===t._maxListeners?w.defaultMaxListeners:t._maxListeners}function C(t,e,n){if(e)t.call(n);else for(var r=t.length,o=M(t,r),i=0;i<r;++i)o[i].call(n)}function L(t,e,n,r){if(e)t.call(n,r);else for(var o=t.length,i=M(t,o),a=0;a<o;++a)i[a].call(n,r)}function E(t,e,n,r,o){if(e)t.call(n,r,o);else for(var i=t.length,a=M(t,i),s=0;s<i;++s)a[s].call(n,r,o)}function P(t,e,n,r,o,i){if(e)t.call(n,r,o,i);else for(var a=t.length,s=M(t,a),c=0;c<a;++c)s[c].call(n,r,o,i)}function k(t,e,n,r){if(e)t.apply(n,r);else for(var o=t.length,i=M(t,o),a=0;a<o;++a)i[a].apply(n,r)}function T(t,e,n,r){var o,i,a,s;if("function"!=typeof n)throw new TypeError('"listener" argument must be a function');if((i=t._events)?(i.newListener&&(t.emit("newListener",e,n.listener?n.listener:n),i=t._events),a=i[e]):(i=t._events=new b,t._eventsCount=0),a){if("function"==typeof a?a=i[e]=r?[n,a]:[a,n]:r?a.unshift(n):a.push(n),!a.warned&&(o=x(t))&&o>0&&a.length>o){a.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+e+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=t,c.type=e,c.count=a.length,s=c,"function"==typeof console.warn?console.warn(s):console.log(s)}}else a=i[e]=n,++t._eventsCount;return t}function S(t,e,n){var r=!1;function o(){t.removeListener(e,o),r||(r=!0,n.apply(t,arguments))}return o.listener=n,o}function O(t){var e=this._events;if(e){var n=e[t];if("function"==typeof n)return 1;if(n)return n.length}return 0}function M(t,e){for(var n=new Array(e);e--;)n[e]=t[e];return n}b.prototype=Object.create(null),w.EventEmitter=w,w.usingDomains=!1,w.prototype.domain=void 0,w.prototype._events=void 0,w.prototype._maxListeners=void 0,w.defaultMaxListeners=10,w.init=function(){this.domain=null,w.usingDomains&&undefined.active,this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=new b,this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},w.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||isNaN(t))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=t,this},w.prototype.getMaxListeners=function(){return x(this)},w.prototype.emit=function(t){var e,n,r,o,i,a,s,c="error"===t;if(a=this._events)c=c&&null==a.error;else if(!c)return!1;if(s=this.domain,c){if(e=arguments[1],!s){if(e instanceof Error)throw e;var l=new Error('Uncaught, unspecified "error" event. ('+e+")");throw l.context=e,l}return e||(e=new Error('Uncaught, unspecified "error" event')),e.domainEmitter=this,e.domain=s,e.domainThrown=!1,s.emit("error",e),!1}if(!(n=a[t]))return!1;var u="function"==typeof n;switch(r=arguments.length){case 1:C(n,u,this);break;case 2:L(n,u,this,arguments[1]);break;case 3:E(n,u,this,arguments[1],arguments[2]);break;case 4:P(n,u,this,arguments[1],arguments[2],arguments[3]);break;default:for(o=new Array(r-1),i=1;i<r;i++)o[i-1]=arguments[i];k(n,u,this,o)}return!0},w.prototype.addListener=function(t,e){return T(this,t,e,!1)},w.prototype.on=w.prototype.addListener,w.prototype.prependListener=function(t,e){return T(this,t,e,!0)},w.prototype.once=function(t,e){if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');return this.on(t,S(this,t,e)),this},w.prototype.prependOnceListener=function(t,e){if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');return this.prependListener(t,S(this,t,e)),this},w.prototype.removeListener=function(t,e){var n,r,o,i,a;if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');if(!(r=this._events))return this;if(!(n=r[t]))return this;if(n===e||n.listener&&n.listener===e)0==--this._eventsCount?this._events=new b:(delete r[t],r.removeListener&&this.emit("removeListener",t,n.listener||e));else if("function"!=typeof n){for(o=-1,i=n.length;i-- >0;)if(n[i]===e||n[i].listener&&n[i].listener===e){a=n[i].listener,o=i;break}if(o<0)return this;if(1===n.length){if(n[0]=void 0,0==--this._eventsCount)return this._events=new b,this;delete r[t]}else!function(t,e){for(var n=e,r=n+1,o=t.length;r<o;n+=1,r+=1)t[n]=t[r];t.pop()}(n,o);r.removeListener&&this.emit("removeListener",t,a||e)}return this},w.prototype.removeAllListeners=function(t){var e,n;if(!(n=this._events))return this;if(!n.removeListener)return 0===arguments.length?(this._events=new b,this._eventsCount=0):n[t]&&(0==--this._eventsCount?this._events=new b:delete n[t]),this;if(0===arguments.length){for(var r,o=Object.keys(n),i=0;i<o.length;++i)"removeListener"!==(r=o[i])&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=new b,this._eventsCount=0,this}if("function"==typeof(e=n[t]))this.removeListener(t,e);else if(e)do{this.removeListener(t,e[e.length-1])}while(e[0]);return this},w.prototype.listeners=function(t){var e,n=this._events;return n&&(e=n[t])?"function"==typeof e?[e.listener||e]:function(t){for(var e=new Array(t.length),n=0;n<e.length;++n)e[n]=t[n].listener||t[n];return e}(e):[]},w.listenerCount=function(t,e){return"function"==typeof t.listenerCount?t.listenerCount(e):O.call(t,e)},w.prototype.listenerCount=O,w.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};const A=document.createElement("div"),j=function(){let t,e,n,r=document.createElement("div");return Object.assign(r.style,{visibility:"hidden",width:"100px"}),document.body.appendChild(r),n=r.offsetWidth,r.style.overflow="scroll",t=document.createElement("div"),t.style.width="100%",r.appendChild(t),e=n-t.offsetWidth,document.body.removeChild(r),e}(),F=Object.freeze({el:null,animate:!0,animateClass:"fade",animateInClass:"show",appendTo:"body",backdrop:!0,keyboard:!0,title:!1,header:!0,content:!1,footer:!0,buttons:null,headerClose:!0,construct:!1,transition:300,backdropTransition:150}),I=function t(e){for(let n in e)Array.isArray(e[n])?e[n].forEach((e=>{t(e)})):null!==e[n]&&"object"==typeof e[n]&&Object.freeze(e[n]);return Object.freeze(e)}({dialog:[{text:"Cancel",value:!1,attr:{class:"btn btn-default","data-dismiss":"modal"}},{text:"OK",value:!0,attr:{class:"btn btn-primary","data-dismiss":"modal"}}],alert:[{text:"OK",attr:{class:"btn btn-primary","data-dismiss":"modal"}}],confirm:[{text:"Cancel",value:!1,attr:{class:"btn btn-default","data-dismiss":"modal"}},{text:"OK",value:!0,attr:{class:"btn btn-primary","data-dismiss":"modal"}}]}),z={container:'<div class="modal"></div>',dialog:'<div class="modal-dialog"></div>',content:'<div class="modal-content"></div>',header:'<div class="modal-header"></div>',headerClose:'<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>',body:'<div class="modal-body"></div>',footer:'<div class="modal-footer"></div>',backdrop:'<div class="modal-backdrop"></div>'};function R(t,e,n){let r=t.data||{};if(void 0===n){if(t.data&&t.data[e])return t.data[e];var o=t.getAttribute(`data-${e}`);return void 0!==o?o:null}return r[e]=n,t.data=r,t}function D(t,e){return t.nodeName?t:(t=t.replace(/(\t|\n$)/g,""),A.innerHTML="",A.innerHTML=t,!0===e?A.childNodes:A.childNodes[0])}class B extends w{static set templates(t){this._baseTemplates=t}static get templates(){return Object.assign({},z,B._baseTemplates||{})}static set buttons(t){this._baseButtons=t}static get buttons(){return Object.assign({},I,B._baseButtons||{})}static set options(t){this._baseOptions=t}static get options(){return Object.assign({},F,B._baseOptions||{})}static get version(){return"0.8.0"}static alert(t,e={}){let n=Object.assign({},F,{title:t,content:!1,construct:!0,headerClose:!1,buttons:B.buttons.alert},e);return new B(n)}static confirm(t,e={}){let n=Object.assign({},F,{title:t,content:!1,construct:!0,headerClose:!1,buttons:B.buttons.confirm},e);return new B(n)}constructor(t={}){if(super(),this.id=(65536*(1+Math.random())|0).toString(16)+(65536*(1+Math.random())|0).toString(16),this.el=null,this._html={},this._events={},this._visible=!1,this._options=Object.assign({},B.options,t),this._templates=Object.assign({},B.templates,t.templates||{}),this._html.appendTo=document.querySelector(this._options.appendTo),null===this._options.buttons&&(this._options.buttons=B.buttons.dialog),this._options.el){let t=this._options.el;if("string"==typeof this._options.el&&(t=document.querySelector(this._options.el),!t))throw new Error(`Selector: DOM Element ${this._options.el} not found.`);R(t,"modal",this),this.el=t}else this._options.construct=!0;this._options.construct?this._render():this._mapDom()}_render(){let t=this._html,e=this._options,n=this._templates,r=!!e.animate&&e.animateClass;return t.container=D(n.container),t.dialog=D(n.dialog),t.content=D(n.content),t.header=D(n.header),t.headerClose=D(n.headerClose),t.body=D(n.body),t.footer=D(n.footer),r&&t.container.classList.add(r),this._setHeader(),this._setContent(),this._setFooter(),this.el=t.container,t.dialog.appendChild(t.content),t.container.appendChild(t.dialog),this}_mapDom(){let t=this._html,e=this._options;return this.el.classList.contains(e.animateClass)&&(e.animate=!0),t.container=this.el,t.dialog=this.el.querySelector(".modal-dialog"),t.content=this.el.querySelector(".modal-content"),t.header=this.el.querySelector(".modal-header"),t.headerClose=this.el.querySelector(".modal-header .close"),t.body=this.el.querySelector(".modal-body"),t.footer=this.el.querySelector(".modal-footer"),this._setHeader(),this._setContent(),this._setFooter(),this}_setHeader(){let t=this._html,e=this._options;e.header&&t.header&&(e.title.nodeName?t.header.innerHTML=e.title.outerHTML:"string"==typeof e.title&&(t.header.innerHTML=`<h4 class="modal-title">${e.title}</h4>`),null===this.el&&t.headerClose&&e.headerClose&&t.header.appendChild(t.headerClose),e.construct&&t.content.appendChild(t.header))}_setContent(){let t=this._html,e=this._options;e.content&&t.body&&("string"==typeof e.content?t.body.innerHTML=e.content:t.body.innerHTML=e.content.outerHTML,e.construct&&t.content.appendChild(t.body))}_setFooter(){let t=this._html,e=this._options;e.footer&&t.footer&&(e.footer.nodeName?t.footer.ineerHTML=e.footer.outerHTML:"string"==typeof e.footer?t.footer.innerHTML=e.footer:t.footer.children.length||e.buttons.forEach((e=>{let n=document.createElement("button");R(n,"button",e),n.innerHTML=e.text,n.setAttribute("type","button");for(let t in e.attr)n.setAttribute(t,e.attr[t]);t.footer.appendChild(n)})),e.construct&&t.content.appendChild(t.footer))}_setEvents(){this._options;let t=this._html;this._events.keydownHandler=this._handleKeydownEvent.bind(this),document.body.addEventListener("keydown",this._events.keydownHandler),this._events.clickHandler=this._handleClickEvent.bind(this),t.container.addEventListener("click",this._events.clickHandler),this._events.resizeHandler=this._handleResizeEvent.bind(this),window.addEventListener("resize",this._events.resizeHandler)}_handleClickEvent(t){(function(t){let e=[t];for(;t.parentNode;)t=t.parentNode,e.push(t);return e})(t.target).every((e=>"HTML"!==e.tagName&&((!0===this._options.backdrop||!e.classList.contains("modal"))&&(!e.classList.contains("modal-content")&&("modal"===e.getAttribute("data-dismiss")?(this.emit("dismiss",this,t,R(t.target,"button")),this.hide(),!1):!e.classList.contains("modal")||(this.emit("dismiss",this,t,null),this.hide(),!1))))))}_handleKeydownEvent(t){27===t.which&&this._options.keyboard&&(this.emit("dismiss",this,t,null),this.hide())}_handleResizeEvent(t){this._resize()}show(){let t=this._options,e=this._html;return this.emit("show",this),this._checkScrollbar(),this._setScrollbar(),document.body.classList.add("modal-open"),t.construct&&e.appendTo.appendChild(e.container),e.container.style.display="block",e.container.scrollTop=0,!1!==t.backdrop?(this.once("showBackdrop",(()=>{this._setEvents(),t.animate&&e.container.offsetWidth,e.container.classList.add(t.animateInClass),setTimeout((()=>{this._visible=!0,this.emit("shown",this)}),t.transition)})),this._backdrop()):(this._setEvents(),t.animate&&e.container.offsetWidth,e.container.classList.add(t.animateInClass),setTimeout((()=>{this._visible=!0,this.emit("shown",this)}),t.transition)),this._resize(),this}toggle(){this._visible?this.hide():this.show()}_resize(){var t=this._html.container.scrollHeight>document.documentElement.clientHeight;this._html.container.style.paddingLeft=!this.bodyIsOverflowing&&t?j+"px":"",this._html.container.style.paddingRight=this.bodyIsOverflowing&&!t?j+"px":""}_backdrop(){let t=this._html,e=this._templates,n=this._options,r=!!n.animate&&n.animateClass;t.backdrop=D(e.backdrop),r&&t.backdrop.classList.add(r),t.appendTo.appendChild(t.backdrop),r&&t.backdrop.offsetWidth,t.backdrop.classList.add(n.animateInClass),setTimeout((()=>{this.emit("showBackdrop",this)}),this._options.backdropTransition)}hide(){let t=this._html,e=this._options,n=t.container.classList;if(this.emit("hide",this),n.remove(e.animateInClass),e.backdrop){t.backdrop.classList.remove(e.animateInClass)}return this._removeEvents(),setTimeout((()=>{document.body.classList.remove("modal-open"),document.body.style.paddingRight=this.originalBodyPad}),e.backdropTransition),setTimeout((()=>{e.backdrop&&t.backdrop.parentNode.removeChild(t.backdrop),t.container.style.display="none",e.construct&&t.container.parentNode.removeChild(t.container),this._visible=!1,this.emit("hidden",this)}),e.transition),this}_removeEvents(){this._events.keydownHandler&&document.body.removeEventListener("keydown",this._events.keydownHandler),this._html.container.removeEventListener("click",this._events.clickHandler),window.removeEventListener("resize",this._events.resizeHandler)}_checkScrollbar(){this.bodyIsOverflowing=document.body.clientWidth<window.innerWidth}_setScrollbar(){if(this.originalBodyPad=document.body.style.paddingRight||"",this.bodyIsOverflowing){let t=parseInt(this.originalBodyPad||0,10);document.body.style.paddingRight=t+j+"px"}}}var H=v(Object.freeze({__proto__:null,default:B})).default;function N(t){return function(t){if(Array.isArray(t))return a(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||s(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function U(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length,r=new Array(n>2?n-2:0),o=2;o<n;o++)r[o-2]=arguments[o];if("fragment"===t)return r;if("function"==typeof t)return t(e,r);var i=document.createElement(t);Object.entries(e||{}).forEach((function(t){var e=c(t,2),n=e[0],r=e[1];n.startsWith("on")&&n.toLowerCase()in window?i.addEventListener(n.toLowerCase().substr(2),r):"className"===n?i.setAttribute("class",r.toString()):"htmlFor"===n?i.setAttribute("for",r.toString()):i.setAttribute(n,r.toString())}));for(var a=0,s=r;a<s.length;a++){var l=s[a];Array.isArray(l)?i.append.apply(i,N(l)):i.appendChild(void 0===l.nodeType?document.createTextNode(l.toString()):l)}return i}var V,W=function(t,e){var n=e.scales,r=e.dpi,o=e.mapElements,i=e.paperSizes;return U("form",{id:"printMap"},U("div",null,U("div",{className:"printFieldHalf"},U("label",{htmlFor:"printFormat"},t.paperSize),U("select",{id:"printFormat"},i.map((function(t){return U("option",Object.assign({value:t.value},t.selected?{selected:"selected"}:{}),t.value)})))),U("div",{className:"printFieldHalf"},U("label",{htmlFor:"printOrientation"},t.orientation),U("select",{id:"printOrientation"},U("option",{value:"landscape",selected:!0},t.landscape),U("option",{value:"portrait"},t.portrait)))),U("div",null,U("div",{className:"printFieldHalf"},U("label",{htmlFor:"printResolution"},t.resolution),U("select",{id:"printResolution"},r.map((function(t){return U("option",Object.assign({value:t.value},t.selected?{selected:"selected"}:{}),t.value," dpi")})))),U("div",{className:"printFieldHalf"},U("label",{htmlFor:"printScale"},t.scale),U("select",{id:"printScale"},U("option",{className:"actualScale",value:"",selected:!0}),n.map((function(t){return U("option",{value:t},"1:",(1e3*t).toLocaleString("de"))}))))),o.description&&U("div",null,U("label",{htmlFor:"printDescription"},t.addNote),U("textarea",{id:"printDescription",rows:"4"})),o&&U("div",null,U("div",null,t.mapElements),U("div",{className:"printElements"},o.compass&&U("label",{htmlFor:"printCompass"},U("input",{type:"checkbox",id:"printCompass",checked:!0}),t.compass),o.scalebar&&U("label",{htmlFor:"printScalebar"},U("input",{type:"checkbox",id:"printScalebar",checked:!0}),t.scale),o.attributions&&U("label",{htmlFor:"printAttributions"},U("input",{type:"checkbox",id:"printAttributions",checked:!0}),t.layersAttributions))))},G=function(t){return'\n        <div>\n            <button\n                type="button"\n                class="btn-sm btn btn-secondary"\n                data-dismiss="modal"\n            >\n                '.concat(t.cancel,'\n            </button>\n            <button\n                type="button"\n                class="btn-sm btn btn-primary"\n                data-print="true"\n                data-dismiss="modal"\n            >\n                ').concat(t.print,"\n            </button>\n        </div>\n    ")},q=function(t,e,n,o){(V=new H(Object.assign({headerClose:!0,header:!0,animate:!0,title:n.printPdf,content:W(n,e),footer:G(n)},e.modal))).on("dismiss",(function(t,e){if(e.target.dataset.print){var n=document.getElementById("printMap").elements,r={format:n.namedItem("printFormat").value,orientation:n.namedItem("printOrientation").value,resolution:n.namedItem("printResolution").value,scale:n.namedItem("printScale").value,description:n.namedItem("printDescription").value.trim(),compass:n.namedItem("printCompass").checked,attributions:n.namedItem("printAttributions").checked,scalebar:n.namedItem("printScalebar").checked};o(r)}})),V.on("shown",(function(){var e=function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=25.4/.28,o=t.getView(),i=o.getProjection().getUnits(),a=o.getResolution(),s=39.37,c=a*r.METERS_PER_UNIT[i]*s*n;return e&&(c=Math.round(c)),c}(t),o=document.querySelector(".actualScale");o.value=e/1e3,o.innerHTML="".concat(n.current," (1:").concat(e.toLocaleString("de"),")")}))},$=function(){V._visible||V.show()},K=function(){function t(e,n,r){l(this,t),this._i18n=e,this._footer='\n            <button\n                type="button"\n                class="btn-sm btn btn-secondary"\n                data-dismiss="modal"\n            >\n                '.concat(this._i18n.cancel,"\n            </button>\n        "),this._modal=new H(Object.assign({headerClose:!1,animate:!1,title:this._i18n.printing,backdrop:"static",content:" ",footer:" "},n.modal)),this._modal.on("dismiss",(function(){r()}))}return d(t,[{key:"_setContentModal",value:function(t){this._modal._html.body.innerHTML=t}},{key:"_setFooterModal",value:function(t){this._modal._html.footer.innerHTML=t}},{key:"show",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._setContentModal(t),e?this._setFooterModal(this._footer):this._setFooterModal(" "),this._modal._visible||this._modal.show()}},{key:"hide",value:function(){this._modal.hide()}}]),t}(),X=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function a(t){try{c(r.next(t))}catch(t){i(t)}}function s(t){try{c(r.throw(t))}catch(t){i(t)}}function c(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}c((r=r.apply(t,e||[])).next())}))},J=(new function t(){var e=this;l(this,t),this.addElementsToPDF=function(t,n,r,o,i,a){return X(e,void 0,void 0,y.mark((function e(){var s,c,l,u,d,h;return y.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._view=t,this._pdf=n,this._form=r,this._scaleDenominator=o,this._i18n=a,s=i.mapElements,c=i.extraInfo,l=i.style,u=i.watermark,this._style=l,d={x:2,y:2},h=this._pdf.width/2,!s.compass||!this._form.compass){e.next=12;break}return e.next=12,this.addCompass(s.compass,"bottomright",{x:2,y:6},6,this._view.getRotation());case 12:if(s.description&&this._form.description&&this.addTextWithBack(this._form.description,"topleft",d,8,50),!u){e.next=16;break}return e.next=16,this.addWatermark(u,"topright",{x:0,y:0},14);case 16:s.scalebar&&this._form.scalebar&&this.addScaleBar("bottomleft",d),s.attributions&&this._form.attributions&&this.addAttributions("bottomright",250,{x:2,y:2},7,"#ffffff","right"),c.url&&this.addUrl("bottomleft",250,{x:0,y:-5},7,"#000000"),c.date&&this.addDate("bottomright",250,{x:0,y:-5},7,"#000000","right"),c.scale&&this.addScale("bottomleft",250,{x:h,y:-5},7,"#000000","center");case 21:case"end":return e.stop()}}),e,this)})))},this.calculateOffsetByPosition=function(t,n){var r,o,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;switch(t){case"topleft":r=n.x+e._style.margin,o=n.y+e._style.margin+i;break;case"topright":r=e._pdf.width-n.x-e._style.margin,o=n.y+e._style.margin+i;break;case"bottomright":r=e._pdf.width-n.x-e._style.margin,o=e._pdf.height-n.y-e._style.margin-i;break;case"bottomleft":o=e._pdf.height-n.y-e._style.margin-i,r=n.x+e._style.margin}return{x:r,y:o}},this.addRoundedBox=function(t,n,r,o,i,a){e._pdf.doc.setDrawColor(a),e._pdf.doc.setFillColor(i),e._pdf.doc.roundedRect(t,n,r,o,1,1,"FD")},this.addText=function(t,n,r,o,i){var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"left",s=arguments.length>6?arguments[6]:void 0;e._pdf.doc.setTextColor(i),e._pdf.doc.setFontSize(o),e._pdf.doc.text(s,t,n,{align:a,maxWidth:r})},this.addTextByOffset=function(t,n,r,o,i,a,s){var c=e.calculateOffsetByPosition(t,n),l=c.x,u=c.y;e.addText(l,u,r,o,i,a,s)},this.addTextWithBack=function(t,n,r,o,i){var a=e.calculateOffsetByPosition(n,r),s=a.x,c=a.y;e._pdf.doc.setTextColor(e._style.txcolor),e._pdf.doc.setFontSize(o);var l=e._pdf.doc.getTextDimensions(t,{maxWidth:i}),u=l.w,d=l.h;e.addRoundedBox(s,c,u+8,d+4,e._style.bkcolor,e._style.brcolor),e._pdf.doc.text(t,s+4,c+4+1,{align:"left",maxWidth:i})},this.addWatermark=function(t,n,r,o){return new Promise((function(i){var a=o/1.8,s=!1,c=e.calculateOffsetByPosition(n,r),l=c.x,u=c.y,d=t.logo?12.5:0;if(t.title){e._pdf.doc.setTextColor(t.titleColor),e._pdf.doc.setFontSize(o),e._pdf.doc.setFont("helvetica","bold");var h=e._pdf.doc.getTextDimensions(t.title).w;if(t.subtitle){e._pdf.doc.setFontSize(a);var f=e._pdf.doc.getTextDimensions(t.subtitle).w;h=f-4>h?f:h+4,e._pdf.doc.setFontSize(o)}else h+=4;var p=h+2;e.addRoundedBox(l-p+4-d,u-4,p+d,16,"#ffffff","#ffffff"),s=!0,e._pdf.doc.text(t.title,l,u+2+3+(t.subtitle?0:2),{align:"right"}),d+=h}if(t.subtitle){if(e._pdf.doc.setTextColor(t.subtitleColor),e._pdf.doc.setFontSize(a),e._pdf.doc.setFont("helvetica","normal"),!s){var m=4+e._pdf.doc.getTextDimensions(t.subtitle).w;e.addRoundedBox(l-m+3-d,u-4,m+d,16,"#ffffff","#ffffff"),d+=m,s=!0}var v=t.title?o/2:4;e._pdf.doc.text(t.subtitle,l,u+2+v,{align:"right"})}if(t.logo){var g=function(t){e._pdf.doc.addImage(t,"PNG",l-d+4-1,u-1,12,12)};if(!s){var y=d+2;e.addRoundedBox(l-y+4,u-4,y,16,"#ffffff","#ffffff")}if(t.logo instanceof Image)g(t.logo),i();else{var _=new Image(12,12);_.onload=function(){g(_),i()},_.src=t.logo}}else i()}))},this.addDate=function(t,n,r,o,i,a){e._pdf.doc.setFont("helvetica","normal");var s=new Date(Date.now()).toLocaleDateString();e.addTextByOffset(t,r,n,o,i,a,s)},this.addUrl=function(t,n,r,o,i,a){e._pdf.doc.setFont("helvetica","italic");var s=window.location.href;e.addTextByOffset(t,r,n,o,i,a,s)},this.addScale=function(t,n,r,o,i,a){e._pdf.doc.setFont("helvetica","bold");var s="".concat(e._i18n.scale," 1:").concat(e._scaleDenominator.toLocaleString("de")," - ").concat(e._i18n.paper," ").concat(e._form.format.toUpperCase());e.addTextByOffset(t,r,n,o,i,a,s)},this.addAttributions=function(t,n,r,o,i,a){e._pdf.doc.setFont("helvetica","normal");var s=[];document.querySelectorAll(".ol-attribution li").forEach((function(t){s.push(t.textContent)}));var c=s.join(" | ");e.addTextByOffset(t,r,n,o,i,a,c)},this.addScaleBar=function(t,n){var r=100+2*e._style.margin,o=Math.log10||function(t){return Math.log(t)*Math.LOG10E},i=r*e._scaleDenominator,a="mm",s=1;i>=1e5?(a="km",s=1e6):i>=1e4&&(a="m",s=1e3),i/=s;var c=e._pdf.width/e._style.margin,l=i,u=Math.floor(o(l)),d=Math.pow(10,u),h=l/d/c,f=Math.floor(i),p=(f=h>8?8*d:h>4?4*d:h>2?2*d:d)*s/e._scaleDenominator/4,m=4*p,v=n.x+e._style.margin,g=n.y+e._style.margin;-1!==["topright","bottomright"].indexOf(t)&&(v=e._pdf.width-n.x-m-8-2*e._style.margin),-1!==["bottomright","bottomleft"].indexOf(t)&&(g=e._pdf.height-n.y-10-e._style.margin);var y=v+4,_=g+5;e.addRoundedBox(v,g,m+8,10,e._style.bkcolor,e._style.brcolor),e._pdf.doc.setDrawColor(e._style.brcolor),e._pdf.doc.setFillColor(0,0,0),e._pdf.doc.rect(y,_,p,1,"FD"),e._pdf.doc.setDrawColor(e._style.brcolor),e._pdf.doc.setFillColor(255,255,255),e._pdf.doc.rect(y+p,_,p,1,"FD"),e._pdf.doc.setDrawColor(e._style.brcolor),e._pdf.doc.setFillColor(0,0,0),e._pdf.doc.rect(y+2*p,_,2*p,1,"FD"),e._pdf.doc.setTextColor(e._style.txcolor),e._pdf.doc.setFontSize(6),e._pdf.doc.text(y,_-1,"0"),e._pdf.doc.text(y+p-1,_-1,(Math.round(10*f/4)/10).toString()),e._pdf.doc.text(y+2*p-2,_-1,Math.round(f/2).toString()),e._pdf.doc.text(y+4*p-4,_-1,Math.round(f).toString()+" "+a)},this.addCompass=function(t,n,r,o,i){return new Promise((function(a){var s=100,c=e.calculateOffsetByPosition(n,r,o),l=c.x,u=c.y,d=function(t){var n=function(t){var n=document.createElement("canvas");n.height=120,n.width=120;var r=n.getContext("2d");r.translate(.5*n.width,.5*n.height),r.rotate(i),r.translate(.5*-n.width,.5*-n.height),r.drawImage(t,(n.height-s)/2,(n.width-s)/2,s,s);var a=l-o,c=u;return e._pdf.doc.setDrawColor(e._style.brcolor),e._pdf.doc.setFillColor(e._style.bkcolor),e._pdf.doc.circle(a,c,o,"FD"),n}(t),r=1.5*o,a=l-r-o/4.3,c=u-r/2;e._pdf.doc.addImage(n,"PNG",a,c,r,r)};if(t instanceof Image)d(t),a();else{var h=new Image(s,s);h.onload=function(){d(h),a()},h.src=t}}))}}).addElementsToPDF,Y=Object.freeze({__proto__:null,es:{printPdf:"Imprimir PDF",pleaseWait:"Por favor espere...",almostThere:"Ya casi...",error:"Error al generar pdf",printing:"Imprimiendo",cancel:"Cancelar",close:"Cerrar",print:"Imprimir",mapElements:"Elementos en el mapa",compass:"Brújula",scale:"Escala",layersAttributions:"Atribuciones de capas",addNote:"Agregar nota (opcional)",resolution:"Resolución",orientation:"Orientación",paperSize:"Tamaño de página",landscape:"Paisaje",portrait:"Retrato",current:"Actual",paper:"Hoja"},en:{printPdf:"Print PDF",pleaseWait:"Please wait...",almostThere:"Almost there...",error:"An error occurred while printing",printing:"Printing",cancel:"Cancel",close:"Close",print:"Print",mapElements:"Map elements",compass:"Compass",scale:"Scale",layersAttributions:"Layer attributions",addNote:"Add note (optional)",resolution:"Resolution",orientation:"Orientation",paperSize:"Paper size",landscape:"Landscape",portrait:"Portrait",current:"Current",paper:"Paper"}});function Z(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=m(t);if(e){var o=m(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return p(this,n)}}var Q=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function a(t){try{c(r.next(t))}catch(t){i(t)}}function s(t){try{c(r.throw(t))}catch(t){i(t)}}function c(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}c((r=r.apply(t,e||[])).next())}))},tt="printMode";function et(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return n.forEach((function(e){Object.keys(e).forEach((function(n){var r=e[n],o=t[n];t[n]=o&&r&&"object"===f(o)&&"object"===f(r)?et(o,r):r}))})),t}return function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&h(t,e)}(o,t);var r=Z(o);function o(t){var e;l(this,o);var n=document.createElement("button");return(e=r.call(this,{target:t.target,element:n}))._i18n=t.language&&t.language in Y?Y[t.language]:Y.en,t.i18n&&(e._i18n=Object.assign(Object.assign({},e._i18n),t.i18n)),e._options={language:"en",filename:"Export",style:{margin:10,brcolor:"#000000",bkcolor:"#273f50",txcolor:"#ffffff"},extraInfo:{date:!0,url:!0,scale:!0},mapElements:{description:!0,attributions:!0,scalebar:!0,compass:"data:image/svg+xml,%3c%3fxml version='1.0' encoding='utf-8'%3f%3e%3c!-- Generator: Adobe Illustrator 24.1.0%2c SVG Export Plug-In . SVG Version: 6.00 Build 0) --%3e%3csvg version='1.1' id='Capa_1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 300 300' style='enable-background:new 0 0 300 300%3b' xml:space='preserve'%3e%3cstyle type='text/css'%3e .st0%7bfill:%23EA6868%3b%7d%3c/style%3e%3cg%3e %3cg%3e %3cg%3e %3cg%3e %3cg%3e %3cpath class='st0' d='M146.3%2c9.1L75.5%2c287.2c-0.5%2c1.8%2c0.5%2c3.7%2c2.1%2c4.4c1.8%2c0.8%2c3.7%2c0.2%2c4.7-1.5l68.4-106.7l66.8%2c106.7 c0.6%2c1.1%2c1.9%2c1.8%2c3.2%2c1.8c0.5%2c0%2c1-0.2%2c1.5-0.3c1.8-0.8%2c2.6-2.6%2c2.3-4.4L153.7%2c9.1C152.9%2c5.7%2c147.2%2c5.7%2c146.3%2c9.1z M154.2%2c174.2 c-0.6-1.1-1.9-1.8-3.2-1.8l0%2c0c-1.3%2c0-2.6%2c0.6-3.2%2c1.8l-59%2c92L150%2c25.5l61.1%2c239.9L154.2%2c174.2z'/%3e %3c/g%3e %3c/g%3e %3cg%3e %3cg%3e %3cpath class='st0' d='M220.8%2c293.1c-1.8%2c0-3.4-1-4.2-2.3l-65.8-105.1L83.4%2c290.8c-1.3%2c1.9-4%2c2.9-6.1%2c1.9c-2.3-1-3.4-3.4-2.9-5.8 L145.1%2c8.8c0.5-2.1%2c2.4-3.4%2c4.9-3.4s4.4%2c1.3%2c4.9%2c3.4l70.8%2c278.1c0.6%2c2.4-0.6%2c4.9-2.9%2c5.8C222.1%2c292.9%2c221.5%2c293.1%2c220.8%2c293.1z M150.8%2c181.2l1%2c1.6l66.8%2c106.7c0.6%2c1%2c1.9%2c1.5%2c3.2%2c1c1.1-0.5%2c1.8-1.8%2c1.5-3.1L152.4%2c9.3c-0.3-1.1-1.6-1.6-2.6-1.6 s-2.3%2c0.5-2.6%2c1.6L76.4%2c287.4c-0.3%2c1.3%2c0.3%2c2.6%2c1.5%2c3.1c1.1%2c0.5%2c2.6%2c0%2c3.2-1L150.8%2c181.2z M85.6%2c273.2L150%2c20.6l64.2%2c251.9 l-61.1-97.7c-1-1.6-3.4-1.5-4.4%2c0L85.6%2c273.2z'/%3e %3c/g%3e %3c/g%3e %3c/g%3e %3c/g%3e%3c/g%3e%3c/svg%3e"},watermark:{title:"Ol Pdf Printer",titleColor:"#d65959",subtitle:"https://github.com/GastonZalba/ol-pdf-printer",subtitleColor:"#444444",logo:!1},paperSizes:[{size:[594,420],value:"A2"},{size:[420,297],value:"A3"},{size:[297,210],value:"A4",selected:!0},{size:[210,148],value:"A5"}],dpi:[{value:72},{value:96},{value:150,selected:!0},{value:200},{value:300}],scales:[1e4,5e3,1e3,500,250,100,50,25,10],ctrlBtnClass:"",modal:{animateClass:"fade",animateInClass:"show",transition:300,backdropTransition:150,templates:{dialog:'<div class="modal-dialog modal-dialog-centered"></div>',headerClose:'<button type="button" class="btn-close" data-dismiss="modal" aria-label="'.concat(e._i18n.close,'"><span aria-hidden="true">×</span></button>')}}},e._pdf={doc:null,width:null,height:null},e._options=et(e._options,t),n.className="ol-print-btn-menu ".concat(e._options.ctrlBtnClass),n.innerHTML='<img src="'.concat("data:image/svg+xml,%3c%3fxml version='1.0' encoding='utf-8'%3f%3e%3csvg version='1.1' id='Capa_1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' viewBox='0 0 490 490' style='enable-background:new 0 0 490 490%3b' xml:space='preserve'%3e%3cstyle type='text/css'%3e .st0%7bfill:white%3b%7d%3c/style%3e%3cg%3e %3cpath class='st0' d='M65.4%2c6v157.1c0%2c3.3-2.9%2c6-6.5%2c6H33.6c-3.6%2c0-6.5%2c2.7-6.5%2c6v189.6h0l36.3%2c33.8c1.2%2c1.1%2c1.9%2c2.7%2c1.9%2c4.3l0%2c81.2 c0%2c3.3%2c2.9%2c6%2c6.5%2c6h383.8c3.6%2c0%2c6.5-2.7%2c6.5-6V104.9c0-1.6-0.7-3.1-1.9-4.3l-106-98.9c-1.2-1.1-2.9-1.8-4.6-1.8H71.8 C68.2%2c0%2c65.4%2c2.7%2c65.4%2c6z M431.3%2c357.4h-374c-3.8%2c0-6.9-4-6.9-9V203.2c0-5%2c3.1-9%2c6.9-9h374c3.8%2c0%2c6.9%2c4%2c6.9%2c9v145.2 C438.2%2c353.4%2c435.1%2c357.4%2c431.3%2c357.4z M340.2%2c27.6l70.8%2c66c7.2%2c6.7%2c2.1%2c18.2-8.1%2c18.2h-70.8c-6.3%2c0-11.4-4.8-11.4-10.7v-66 C320.7%2c25.6%2c333%2c20.9%2c340.2%2c27.6z'/%3e %3cpath class='st0' d='M136.9%2c207.4h-6.5H87.9c-5.8%2c0-10.5%2c4.9-10.5%2c11v115.5c0%2c6.1%2c4.7%2c11%2c10.5%2c11h4c5.8%2c0%2c10.5-4.9%2c10.5-11v-22.4 c0-6.1%2c4.7-11%2c10.5-11h18.9l5.8-0.1c18%2c0%2c29.9-3%2c35.8-9.1c5.9-6.1%2c8.9-18.3%2c8.9-36.7c0-18.5-3.1-31-9.3-37.5 C166.6%2c210.6%2c154.7%2c207.4%2c136.9%2c207.4z M152.2%2c274.4c-3.1%2c2.7-10.2%2c4.1-21.5%2c4.1h-17.9c-5.8%2c0-10.5-4.9-10.5-11v-27.2 c0-6.1%2c4.7-11%2c10.5-11h20.4c10.6%2c0%2c17.2%2c1.4%2c19.8%2c4.2c2.5%2c2.8%2c3.8%2c10%2c3.8%2c21.6C156.8%2c265.2%2c155.3%2c271.6%2c152.2%2c274.4z'/%3e %3cpath class='st0' d='M262.6%2c207.4h-54.1c-5.8%2c0-10.5%2c4.9-10.5%2c11v115.5c0%2c6.1%2c4.7%2c11%2c10.5%2c11h54.9c20.7%2c0%2c34.1-4.9%2c39.9-14.6 c5.9-9.8%2c8.9-31.8%2c8.9-66.1c0-21-3.7-35.7-11-44.1C293.8%2c211.5%2c281%2c207.4%2c262.6%2c207.4z M281.6%2c314.2c-3.5%2c5.8-11.2%2c8.6-23.1%2c8.6 h-25c-5.8%2c0-10.5-4.9-10.5-11v-71.6c0-6.1%2c4.7-11%2c10.5-11H260c11.6%2c0%2c19%2c2.7%2c22.1%2c8.2c3.1%2c5.5%2c4.7%2c18.4%2c4.7%2c38.7 C286.9%2c295.8%2c285.1%2c308.5%2c281.6%2c314.2z'/%3e %3cpath class='st0' d='M340.9%2c344.8h3.9c5.8%2c0%2c10.5-4.9%2c10.5-11v-34.5c0-6.1%2c4.7-11%2c10.5-11h37.9c5.8%2c0%2c10.5-4.9%2c10.5-11v0 c0-6.1-4.7-11-10.5-11h-37.9c-5.8%2c0-10.5-4.9-10.5-11v-15.1c0-6.1%2c4.7-11%2c10.5-11h41.1c5.8%2c0%2c10.5-4.9%2c10.5-11v0 c0-6.1-4.7-11-10.5-11h-66c-5.8%2c0-10.5%2c4.9-10.5%2c11v115.5C330.4%2c339.9%2c335.1%2c344.8%2c340.9%2c344.8z'/%3e%3c/g%3e%3c/svg%3e",'"/>'),n.title=e._i18n.printPdf,n.onclick=function(){return e._show()},e}return d(o,[{key:"_show",value:function(){this._initialized||this._init(),$()}},{key:"_init",value:function(){this._map=this.getMap(),this._view=this._map.getView(),this._mapTarget=this._map.getTargetElement(),q(this._map,this._options,this._i18n,this._printMap.bind(this)),this._processingModal=new K(this._i18n,this._options,this._onEndPrint.bind(this)),this._initialized=!0}},{key:"_calculateScaleDenominator",value:function(t,e){var n=t/25.4;return Math.round(1e3*n*this._getMeterPerPixel(e))}},{key:"_getMeterPerPixel",value:function(t){var n=this._view.getProjection();return e.getPointResolution(n,t,this._view.getCenter())*n.getMetersPerUnit()}},{key:"_setMapSizForPrint",value:function(t){var e=t/25.4;return[Math.round(this._pdf.width*e),Math.round(this._pdf.height*e)]}},{key:"_onEndPrint",value:function(){this._mapTarget.style.width="",this._mapTarget.style.height="",this._map.updateSize(),this._view.setResolution(this._initialViewResolution),this._mapTarget.classList.remove(tt),this._view.setConstrainResolution(!0),clearTimeout(this._timeoutProcessing)}},{key:"_prepareLoading",value:function(){var t=this;this._processingModal.show(this._i18n.pleaseWait),this._timeoutProcessing=setTimeout((function(){t._processingModal.show(t._i18n.almostThere)}),3500)}},{key:"_disableLoading",value:function(){this._processingModal.hide()}},{key:"_printMap",value:function(t){var r,o=this;this._prepareLoading(),this._form=t,this._view.setConstrainResolution(!1),this._mapTarget.classList.add(tt);var i=this._options.paperSizes.find((function(t){return t.value===o._form.format})).size;i="landscape"===this._form.orientation?i:i.reverse(),this._pdf.width=i[0],this._pdf.height=i[1];var a=c(this._setMapSizForPrint(this._form.resolution),2),s=a[0],l=a[1],u=(null===(r=window.jspdf)||void 0===r?void 0:r.jsPDF)||n.jsPDF;this._pdf.doc=new u({orientation:this._form.orientation,format:this._form.format}),this._initialViewResolution=this._view.getResolution();var d=this._form.resolution/25.4,h=this._form.scale/e.getPointResolution(this._view.getProjection(),d,this._view.getCenter());this._map.once("rendercomplete",(function(){_.toJpeg(o._mapTarget.querySelector(".ol-unselectable.ol-layers"),{width:s,height:l}).then((function(t){return Q(o,void 0,void 0,y.mark((function e(){var n;return y.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._pdf.doc.addImage(t,"JPEG",this._options.style.margin,this._options.style.margin,this._pdf.width-2*this._options.style.margin,this._pdf.height-2*this._options.style.margin),n=this._calculateScaleDenominator(this._form.resolution,h),e.next=4,J(this._view,this._pdf,this._form,n,this._options,this._i18n);case 4:this._pdf.doc.save(this._options.filename+".pdf"),this._onEndPrint(),this._disableLoading();case 7:case"end":return e.stop()}}),e,this)})))})).catch((function(t){console.error(t),o._onEndPrint(),o._processingModal.show(o._i18n.error,!0)}))})),this._mapTarget.style.width=s+"px",this._mapTarget.style.height=l+"px",this._map.updateSize(),this._map.getView().setResolution(h)}},{key:"showPrintModal",value:function(){$()}},{key:"hidePrintModal",value:function(){V.hide()}}]),o}(i.default)}));
