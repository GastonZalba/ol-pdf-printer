!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("ol/proj"),require("ol/control/Control"),require("ol/source/TileWMS"),require("ol/layer/Tile"),require("ol/Observable"),require("jspdf"),require("pdfjs-dist"),require("ol/proj/Units")):"function"==typeof define&&define.amd?define(["ol/proj","ol/control/Control","ol/source/TileWMS","ol/layer/Tile","ol/Observable","jspdf","pdfjs-dist","ol/proj/Units"],e):(t="undefined"!=typeof globalThis?globalThis:t||self).PdfPrinter=e(t.ol.proj,t.ol.control.Control,t.ol.source.TileWMS,t.ol.layer.Tile,t.ol.Observable,t.jsPDF,t.pdfjsLib,t.ol.proj.Units)}(this,(function(t,e,n,o,i,r,s,a){"use strict";window;function l(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var c=l(e),d=l(n),h=l(o);
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */
function u(t,e,n,o){return new(n||(n=Promise))((function(i,r){function s(t){try{l(o.next(t))}catch(t){r(t)}}function a(t){try{l(o.throw(t))}catch(t){r(t)}}function l(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}l((o=o.apply(t,e||[])).next())}))}function p(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function f(t){var e={exports:{}};return t(e,e.exports),e.exports}var m=f((function(t,e){!function(e){var n=function(){return{escape:function(t){return t.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1")},parseExtension:e,mimeType:function(t){var n=e(t).toLowerCase();return(o="application/font-woff",i="image/jpeg",{woff:o,woff2:o,ttf:"application/font-truetype",eot:"application/vnd.ms-fontobject",png:"image/png",jpg:i,jpeg:i,gif:"image/gif",tiff:"image/tiff",svg:"image/svg+xml"})[n]||"";var o,i},dataAsUrl:function(t,e){return"data:"+e+";base64,"+t},isDataUrl:function(t){return-1!==t.search(/^(data:)/)},canvasToBlob:function(t){return t.toBlob?new Promise((function(e){t.toBlob(e)})):function(t){return new Promise((function(e){for(var n=window.atob(t.toDataURL().split(",")[1]),o=n.length,i=new Uint8Array(o),r=0;r<o;r++)i[r]=n.charCodeAt(r);e(new Blob([i],{type:"image/png"}))}))}(t)},resolveUrl:function(t,e){var n=document.implementation.createHTMLDocument(),o=n.createElement("base");n.head.appendChild(o);var i=n.createElement("a");return n.body.appendChild(i),o.href=e,i.href=t,i.href},getAndEncode:function(t){var e=3e4;a.impl.options.cacheBust&&(t+=(/\?/.test(t)?"&":"?")+(new Date).getTime());return new Promise((function(n){var o,i=new XMLHttpRequest;if(i.onreadystatechange=s,i.ontimeout=l,i.responseType="blob",i.timeout=e,a.impl.options.useCredentials&&(i.withCredentials=!0),i.open("GET",t,!0),i.send(),a.impl.options.imagePlaceholder){var r=a.impl.options.imagePlaceholder.split(/,/);r&&r[1]&&(o=r[1])}function s(){if(4===i.readyState)if(200===i.status){var e=new FileReader;e.onloadend=function(){var t=e.result.split(/,/)[1];n(t)},e.readAsDataURL(i.response)}else o?n(o):c("cannot fetch resource: "+t+", status: "+i.status)}function l(){o?n(o):c("timeout of "+e+"ms occured while fetching resource: "+t)}function c(t){console.error(t),n("")}}))},uid:(t=0,function(){return"u"+e()+t++;function e(){return("0000"+(Math.random()*Math.pow(36,4)<<0).toString(36)).slice(-4)}}),delay:function(t){return function(e){return new Promise((function(n){setTimeout((function(){n(e)}),t)}))}},asArray:function(t){for(var e=[],n=t.length,o=0;o<n;o++)e.push(t[o]);return e},isChrome:function(){return/chrome/i.test(navigator.userAgent)},escapeXhtml:function(t){return t.replace(/#/g,"%23").replace(/\n/g,"%0A")},makeImage:function(t){return"data:,"===t?Promise.resolve():new Promise((function(e,n){var o=new Image;a.impl.options.useCredentials&&(o.crossOrigin="use-credentials"),o.onload=function(){e(o)},o.onerror=n,o.src=t}))},width:function(t){var e=n(t,"border-left-width"),o=n(t,"border-right-width");return t.scrollWidth+e+o},height:function(t){var e=n(t,"border-top-width"),o=n(t,"border-bottom-width");return t.scrollHeight+e+o}};var t;function e(t){var e=/\.([^\.\/]*?)(\?|$)/g.exec(t);return e?e[1]:""}function n(t,e){var n=window.getComputedStyle(t).getPropertyValue(e);return parseFloat(n.replace("px",""))}}(),o=function(){var t=/url\(['"]?([^'"]+?)['"]?\)/g;return{inlineAll:function(t,n,r){return s()?Promise.resolve(t):Promise.resolve(t).then(o).then((function(e){var o=Promise.resolve(t);return e.forEach((function(t){o=o.then((function(e){return i(e,t,n,r)}))})),o}));function s(){return!e(t)}},shouldProcess:e,impl:{readUrls:o,inline:i}};function e(e){return-1!==e.search(t)}function o(e){for(var o,i=[];null!==(o=t.exec(e));)i.push(o[1]);return i.filter((function(t){return!n.isDataUrl(t)}))}function i(t,e,o,i){return Promise.resolve(e).then((function(t){return o?n.resolveUrl(t,o):t})).then(i||n.getAndEncode).then((function(t){return n.dataAsUrl(t,n.mimeType(e))})).then((function(o){return t.replace(function(t){return new RegExp("(url\\(['\"]?)("+n.escape(t)+")(['\"]?\\))","g")}(e),"$1"+o+"$3")}))}}(),i=function(){return{resolveAll:function(){return t().then((function(t){return Promise.all(t.map((function(t){return t.resolve()})))})).then((function(t){return t.join("\n")}))},impl:{readAll:t}};function t(){return Promise.resolve(n.asArray(document.styleSheets)).then((function(t){var e=[];return t.forEach((function(t){if(t.hasOwnProperty("cssRules"))try{n.asArray(t.cssRules||[]).forEach(e.push.bind(e))}catch(e){console.log("Error while reading CSS rules from "+t.href,e.toString())}})),e})).then((function(t){return t.filter((function(t){return t.type===CSSRule.FONT_FACE_RULE})).filter((function(t){return o.shouldProcess(t.style.getPropertyValue("src"))}))})).then((function(e){return e.map(t)}));function t(t){return{resolve:function(){var e=(t.parentStyleSheet||{}).href;return o.inlineAll(t.cssText,e)},src:function(){return t.style.getPropertyValue("src")}}}}}(),r=function(){return{inlineAll:function e(i){return i instanceof Element?r(i).then((function(){return i instanceof HTMLImageElement?t(i).inline():Promise.all(n.asArray(i.childNodes).map((function(t){return e(t)})))})):Promise.resolve(i);function r(t){var e=t.style.getPropertyValue("background");return e?o.inlineAll(e).then((function(e){t.style.setProperty("background",e,t.style.getPropertyPriority("background"))})).then((function(){return t})):Promise.resolve(t)}},impl:{newImage:t}};function t(t){return{inline:function(e){return n.isDataUrl(t.src)?Promise.resolve():Promise.resolve(t.src).then(e||n.getAndEncode).then((function(e){return n.dataAsUrl(e,n.mimeType(t.src))})).then((function(e){return new Promise((function(n,o){t.onload=n,t.onerror=n,t.src=e}))}))}}}}(),s={imagePlaceholder:void 0,cacheBust:!1,useCredentials:!1},a={toSvg:l,toPng:function(t,e){return c(t,e||{}).then((function(t){return t.toDataURL()}))},toJpeg:function(t,e){return c(t,e=e||{}).then((function(t){return t.toDataURL("image/jpeg",e.quality||1)}))},toBlob:function(t,e){return c(t,e||{}).then(n.canvasToBlob)},toPixelData:function(t,e){return c(t,e||{}).then((function(e){return e.getContext("2d").getImageData(0,0,n.width(t),n.height(t)).data}))},toCanvas:function(t,e){return c(t,e||{})},impl:{fontFaces:i,images:r,util:n,inliner:o,options:{}}};function l(t,e){return function(t){void 0===t.imagePlaceholder?a.impl.options.imagePlaceholder=s.imagePlaceholder:a.impl.options.imagePlaceholder=t.imagePlaceholder;void 0===t.cacheBust?a.impl.options.cacheBust=s.cacheBust:a.impl.options.cacheBust=t.cacheBust;void 0===t.useCredentials?a.impl.options.useCredentials=s.useCredentials:a.impl.options.useCredentials=t.useCredentials}(e=e||{}),Promise.resolve(t).then((function(t){return d(t,e.filter,!0)})).then(h).then(u).then((function(t){e.bgcolor&&(t.style.backgroundColor=e.bgcolor);e.width&&(t.style.width=e.width+"px");e.height&&(t.style.height=e.height+"px");e.style&&Object.keys(e.style).forEach((function(n){t.style[n]=e.style[n]}));return t})).then((function(o){return function(t,e,o){return Promise.resolve(t).then((function(t){return t.setAttribute("xmlns","http://www.w3.org/1999/xhtml"),(new XMLSerializer).serializeToString(t)})).then(n.escapeXhtml).then((function(t){return'<foreignObject x="0" y="0" width="100%" height="100%">'+t+"</foreignObject>"})).then((function(t){return'<svg xmlns="http://www.w3.org/2000/svg" width="'+e+'" height="'+o+'">'+t+"</svg>"})).then((function(t){return"data:image/svg+xml;charset=utf-8,"+t}))}(o,e.width||n.width(t),e.height||n.height(t))}))}function c(t,e){return l(t,e).then(n.makeImage).then(n.delay(100)).then((function(o){var i="number"!=typeof e.scale?1:e.scale;console.log("scale",i);var r=function(t,o){var i=document.createElement("canvas");if(i.width=(e.width||n.width(t))*o,i.height=(e.height||n.height(t))*o,console.log(i.width,i.height),e.bgcolor){var r=i.getContext("2d");r.fillStyle=e.bgcolor,r.fillRect(0,0,i.width,i.height)}return i}(t,i),s=r.getContext("2d");return o&&(s.scale(i,i),e.canvas&&e.canvas.width&&(r.width=e.canvas.width),e.canvas&&e.canvas.height&&(r.height=e.canvas.height),e.canvas?(console.log("canv",e.canvas),s.drawImage(o,e.canvas.sx||0,e.canvas.sy||0,e.canvas.sw||e.width,e.canvas.sh||e.height,e.canvas.dx||0,e.canvas.dy||0,e.canvas.dw||e.width,e.canvas.dh||e.height)):s.drawImage(o,0,0)),r}))}function d(t,e,o){return o||!e||e(t)?Promise.resolve(t).then((function(t){return t instanceof HTMLCanvasElement?n.makeImage(t.toDataURL()):t.cloneNode(!1)})).then((function(o){return function(t,e,o){var i="use"===t.tagName?function(t){return[document.getElementById(t.href.baseVal.replace("#","")).cloneNode(!0)]}(t):t.childNodes;return 0===i.length?Promise.resolve(e):r(e,n.asArray(i),o).then((function(){return e}));function r(t,e,n){var o=Promise.resolve();return e.forEach((function(e){o=o.then((function(){return d(e,n)})).then((function(e){e&&t.appendChild(e)}))})),o}}(t,o,e)})).then((function(e){return function(t,e){return e instanceof Element?Promise.resolve().then(o).then(i).then(r).then(s).then((function(){return e})):e;function o(){function o(t,e){function o(t,e){n.asArray(t).forEach((function(n){e.setProperty(n,t.getPropertyValue(n),t.getPropertyPriority(n))}))}t.cssText?(e.cssText=t.cssText,e.font=t.font):o(t,e)}o(window.getComputedStyle(t),e.style),n.isChrome()&&e.style.marker&&("line"===e.tagName||"path"===e.tagName)&&(e.style.marker="")}function i(){function o(o){var i=window.getComputedStyle(t,o),r=i.getPropertyValue("content");if(""!==r&&"none"!==r){var s=n.uid(),a=e.getAttribute("class");a&&e.setAttribute("class",a+" "+s);var l=document.createElement("style");l.appendChild(c(s,o,i)),e.appendChild(l)}function c(t,e,o){var i="."+t+":"+e,r=o.cssText?s(o):a(o);return document.createTextNode(i+"{"+r+"}");function s(t){var e=t.getPropertyValue("content");return t.cssText+" content: "+e+";"}function a(t){return n.asArray(t).map(e).join("; ")+";";function e(e){return e+": "+t.getPropertyValue(e)+(t.getPropertyPriority(e)?" !important":"")}}}}[":before",":after"].forEach((function(t){o(t)}))}function r(){t instanceof HTMLTextAreaElement&&(e.innerHTML=t.value),t instanceof HTMLInputElement&&e.setAttribute("value",t.value)}function s(){e instanceof SVGElement&&(e.setAttribute("xmlns","http://www.w3.org/2000/svg"),e instanceof SVGRectElement&&["width","height"].forEach((function(t){var n=e.getAttribute(t);n&&e.style.setProperty(t,n)})))}}(t,e)})):Promise.resolve()}function h(t){return i.resolveAll().then((function(e){var n=document.createElement("style");return t.appendChild(n),n.appendChild(document.createTextNode(e)),t}))}function u(t){return r.inlineAll(t).then((function(){return t}))}t.exports=a}()})),g=f((function(t){t.exports=function(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,o=new Array(e);n<e;n++)o[n]=t[n];return o},t.exports.__esModule=!0,t.exports.default=t.exports})),v=f((function(t){t.exports=function(t){if(Array.isArray(t))return g(t)},t.exports.__esModule=!0,t.exports.default=t.exports})),_=f((function(t){t.exports=function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)},t.exports.__esModule=!0,t.exports.default=t.exports})),y=f((function(t){t.exports=function(t,e){if(t){if("string"==typeof t)return g(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?g(t,e):void 0}},t.exports.__esModule=!0,t.exports.default=t.exports})),b=f((function(t){t.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},t.exports.__esModule=!0,t.exports.default=t.exports})),w=p(f((function(t){t.exports=function(t){return v(t)||_(t)||y(t)||b()},t.exports.__esModule=!0,t.exports.default=t.exports}))),x=f((function(t){t.exports=function(t){if(Array.isArray(t))return t},t.exports.__esModule=!0,t.exports.default=t.exports})),C=f((function(t){t.exports=function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var o,i,r=[],s=!0,a=!1;try{for(n=n.call(t);!(s=(o=n.next()).done)&&(r.push(o.value),!e||r.length!==e);s=!0);}catch(t){a=!0,i=t}finally{try{s||null==n.return||n.return()}finally{if(a)throw i}}return r}},t.exports.__esModule=!0,t.exports.default=t.exports})),M=f((function(t){t.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},t.exports.__esModule=!0,t.exports.default=t.exports})),P=p(f((function(t){t.exports=function(t,e){return x(t)||C(t,e)||y(t,e)||M()},t.exports.__esModule=!0,t.exports.default=t.exports})));function E(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length,o=new Array(n>2?n-2:0),i=2;i<n;i++)o[i-2]=arguments[i];if("null"===t)return o;if("function"==typeof t)return t(e,o);var r=document.createElement(t);Object.entries(e||{}).forEach((function(t){var e=P(t,2),n=e[0],o=e[1];n.startsWith("on")&&n.toLowerCase()in window?r.addEventListener(n.toLowerCase().substr(2),o):"className"===n?r.setAttribute("class",o.toString()):"htmlFor"===n?r.setAttribute("for",o.toString()):r.setAttribute(n,o.toString())}));for(var s=0,a=o;s<a.length;s++){var l=a[s];l&&(Array.isArray(l)?r.append.apply(r,w(l)):r.appendChild(void 0===l.nodeType?document.createTextNode(l.toString()):l))}return r}class L{constructor(t){this.addMapHelpers=()=>u(this,void 0,void 0,(function*(){const{mapElements:t,extraInfo:e,style:n,watermark:o}=this._config;this._style=n,o&&(yield this._addWatermark(o)),t&&(t.compass&&this._form.compass&&(yield this._addCompass(t.compass)),t.description&&this._form.description&&this._addDescription(),t.scalebar&&this._form.scalebar&&this._addScaleBar(),t.attributions&&this._form.attributions&&this._addAttributions()),e&&(e.url&&this._addUrl(),e.date&&this._addDate(),e.specs&&this._addSpecs())})),this._processSvgImage=t=>new Promise(((e,n)=>{const o=t=>URL.createObjectURL(new Blob([t.outerHTML],{type:"image/svg+xml"})),i=(t,e)=>{const o=document.createElement("img");document.body.appendChild(o),o.onerror=t=>(console.error(t),n(this._i18n.errorImage)),o.onload=()=>{try{const t=document.createElement("canvas");t.width=o.clientWidth,t.height=o.clientHeight;t.getContext("2d").drawImage(o,0,0);const n=t.toDataURL("image/png");e(n),document.body.removeChild(o)}catch(t){return n(t)}},o.src=t};((t,e)=>{const n=o(t);i(n,(t=>{e(t),URL.revokeObjectURL(n)}))})(t,(t=>{e(t)}))})),this._calculateOffsetByPosition=(t,e,n=0)=>{let o,i;switch(t){case"topleft":o=e.x+this._style.paperMargin,i=e.y+this._style.paperMargin+n;break;case"topright":o=this._pdf.width-e.x-this._style.paperMargin,i=e.y+this._style.paperMargin+n;break;case"bottomright":o=this._pdf.width-e.x-this._style.paperMargin,i=this._pdf.height-e.y-this._style.paperMargin-n;break;case"bottomleft":i=this._pdf.height-e.y-this._style.paperMargin-n,o=e.x+this._style.paperMargin}return{x:o,y:i}},this._addRoundedBox=(t,e,n,o,i,r)=>{this._pdf.doc.setDrawColor(r),this._pdf.doc.setFillColor(i),this._pdf.doc.roundedRect(t,e,n,o,1,1,"FD")},this._addText=(t,e,n,o,i,r="left",s)=>{this._pdf.doc.setTextColor(i),this._pdf.doc.setFontSize(o),this._pdf.doc.text(s,t,e,{align:r})},this._addTextByOffset=(t,e,n,o,i,r,s)=>{const{x:a,y:l}=this._calculateOffsetByPosition(t,e),c="center"===r?a-n/2:a;this._addText(c,l,n,o,i,r,s)},this._addDescription=()=>{const t=this._form.description.trim(),{x:e,y:n}=this._calculateOffsetByPosition("topleft",{x:2,y:2});this._pdf.doc.setTextColor(this._style.txcolor),this._pdf.doc.setFontSize(8);const{w:o,h:i}=this._pdf.doc.getTextDimensions(t,{maxWidth:50});this._addRoundedBox(e,n,o+8,i+4,this._style.bkcolor,this._style.brcolor),this._pdf.doc.text(t,e+4,n+4,{align:"left",maxWidth:50})},this._addWatermark=t=>u(this,void 0,void 0,(function*(){const e=14/1.8;let n=!1;const{x:o,y:i}=this._calculateOffsetByPosition("topright",{x:0,y:0});let r=t.logo?12.5:0;if(t.title){this._pdf.doc.setTextColor(t.titleColor),this._pdf.doc.setFontSize(14),this._pdf.doc.setFont("helvetica","bold");let{w:s}=this._pdf.doc.getTextDimensions(t.title);if(t.subtitle){this._pdf.doc.setFontSize(e);const n=this._pdf.doc.getTextDimensions(t.subtitle).w;s=n-4>s?n:s+4,this._pdf.doc.setFontSize(14)}else s+=4;const a=16,l=s+2;this._addRoundedBox(o-l+4-r,i-4,l+r,a,"#ffffff","#ffffff"),n=!0,this._pdf.doc.text(t.title,o,i+2+3+(t.subtitle?0:2),{align:"right"}),r+=s}if(t.subtitle){if(this._pdf.doc.setTextColor(t.subtitleColor),this._pdf.doc.setFontSize(e),this._pdf.doc.setFont("helvetica","normal"),!n){const{w:e}=this._pdf.doc.getTextDimensions(t.subtitle),s=4+e;this._addRoundedBox(o-s+3-r,i-4,s+r,16,"#ffffff","#ffffff"),r+=s,n=!0}const s=t.title?7:4;this._pdf.doc.text(t.subtitle,o,i+2+s,{align:"right"})}if(!t.logo)return;const s=t=>{this._pdf.doc.addImage(t,"PNG",o-r+4-1,i-1,12,12)};if(!n){const t=r+2;this._addRoundedBox(o-t+4,i-4,t,16,"#ffffff","#ffffff")}if(!(t.logo instanceof Image)){let e;if("string"==typeof t.logo)e=t.logo;else{if(!(t.logo instanceof SVGElement))throw this._i18n.errorImage;e=yield this._processSvgImage(t.logo)}return new Promise(((t,n)=>{const o=new Image(12,12);o.onload=()=>{try{s(o),t()}catch(t){return n(t)}},o.onerror=()=>n(this._i18n.errorImage),o.src=e}))}s(t.logo)})),this._addDate=()=>{this._pdf.doc.setFont("helvetica","normal");const t=new Date(Date.now()).toLocaleDateString(this._config.dateFormat);this._addTextByOffset("bottomright",{x:0,y:-5},250,7,"#000000","right",t)},this._addUrl=()=>{this._pdf.doc.setFont("helvetica","italic");const t=window.location.href;this._addTextByOffset("bottomleft",{x:0,y:-6.5},250,6,"#000000","left",t)},this._addSpecs=()=>{this._pdf.doc.setFont("helvetica","bold"),this._pdf.doc.setFontSize(6);const t=`${this._i18n.scale} 1:${this._scaleDenominator.toLocaleString("de")}`,e=`${this._i18n.paper} ${this._form.format.toUpperCase()}`,n=[t,`${this._form.resolution} DPI`,e].join(" - "),{w:o}=this._pdf.doc.getTextDimensions(n);this._addTextByOffset("bottomleft",{x:0,y:-3.5},o,6,"#000000","left",n)},this._addAttributions=()=>{const t=document.querySelector(".ol-attribution ul");if(!t)return;this._pdf.doc.setFont("helvetica","normal"),this._pdf.doc.setFontSize(7);const{x:e,y:n}=this._calculateOffsetByPosition("bottomright",{x:1,y:1});let o=e;const{w:i,h:r}=this._pdf.doc.getTextDimensions(t.textContent),s=this._pdf.doc.getTextDimensions(" · ").w,a=document.querySelectorAll(".ol-attribution li"),l=s*(a.length-1);this._addRoundedBox(e-i-l-2,n-r,i+4+l+2,r+4,"#ffffff","#ffffff"),Array.from(a).reverse().forEach(((t,e)=>{Array.from(t.childNodes).reverse().forEach((t=>{const e=t.textContent;"href"in t?(this._pdf.doc.setTextColor("#0077cc"),this._pdf.doc.textWithLink(e,o,n,{align:"right",url:t.href})):(this._pdf.doc.setTextColor("#666666"),this._pdf.doc.text(e,o,n,{align:"right"}));const{w:i}=this._pdf.doc.getTextDimensions(e);o-=i})),e!==a.length-1&&(this._pdf.doc.text(" · ",o,n,{align:"right"}),o-=s)}))},this._addScaleBar=()=>{const t=2,e=2,n=Math.log10||function(t){return Math.log(t)*Math.LOG10E};let o,i,r=90*this._scaleDenominator;if("metric"===this._config.units){o="mm";const t=1e3;i=1,r>=10*(1e3*t)?(o="km",i=1e6):r>=10*t&&(o="m",i=t)}else if("imperial"===this._config.units){const t=25.4,e=63360*t,n=36*t;o="in",i=t,r>=10*e?(o="mi",i=e):r>=10*n&&(o="yd",i=n)}r/=i;const s=r,a=Math.floor(n(s)),l=Math.pow(10,a),c=s/l;let d=Math.floor(r);d=c>8?8*l:c>4?4*l:c>2?2*l:l;let h=d*i/this._scaleDenominator/4;const u=this._style.paperMargin?2*this._style.paperMargin/this._pdf.width*100:null;h=u?h/100*(100-u):h;const p=4*h,f=t+this._style.paperMargin;let m=e+this._style.paperMargin;m=this._pdf.height-e-10-this._style.paperMargin;const g=f+4,v=m+5;this._addRoundedBox(f,m,p+8,10,this._style.bkcolor,this._style.brcolor),this._pdf.doc.setDrawColor(this._style.brcolor),this._pdf.doc.setFillColor(0,0,0),this._pdf.doc.rect(g,v,h,1,"FD"),this._pdf.doc.setDrawColor(this._style.brcolor),this._pdf.doc.setFillColor(255,255,255),this._pdf.doc.rect(g+h,v,h,1,"FD"),this._pdf.doc.setDrawColor(this._style.brcolor),this._pdf.doc.setFillColor(0,0,0),this._pdf.doc.rect(g+2*h,v,2*h,1,"FD"),this._pdf.doc.setTextColor(this._style.txcolor),this._pdf.doc.setFontSize(6),this._pdf.doc.text("0",g,v-1),this._pdf.doc.text(String(Math.round(10*d/4)/10),g+h-1,v-1),this._pdf.doc.text(String(Math.round(d/2)),g+2*h-2,v-1),this._pdf.doc.text(Math.round(d).toString()+" "+o,g+4*h-4,v-1)},this._addCompass=t=>u(this,void 0,void 0,(function*(){const e=this._view.getRotation(),n=100,{x:o,y:i}=this._calculateOffsetByPosition("bottomright",{x:2,y:6},6),r=t=>{const r=document.createElement("canvas");r.height=120,r.width=120;const s=r.getContext("2d");s.translate(.5*r.width,.5*r.height),s.rotate(e),s.translate(.5*-r.width,.5*-r.height),s.drawImage(t,(r.height-n)/2,(r.width-n)/2,n,n);const a=o-6,l=i;return this._pdf.doc.setDrawColor(this._style.brcolor),this._pdf.doc.setFillColor(this._style.bkcolor),this._pdf.doc.circle(a,l,6,"FD"),r},s=t=>{const e=r(t),n=o-9-6/4.3,s=i-4.5;this._pdf.doc.addImage(e,"PNG",n,s,9,9)};if(!(t instanceof Image)){let e;if("string"==typeof t)e=t;else{if(!(t instanceof SVGElement))throw this._i18n.errorImage;e=yield this._processSvgImage(t)}return new Promise(((t,o)=>{const i=new Image(n,n);i.onload=()=>{s(i),t()},i.onerror=()=>{o(this._i18n.errorImage)},i.src=e}))}s(undefined)}));const{view:e,form:n,i18n:o,config:i,height:r,width:s,scaleResolution:a}=t;this._view=e,this._form=n,this._i18n=o,this._config=i,this._pdf=this.create(this._form.orientation,this._form.format,r,s),this._scaleDenominator=this._calculateScaleDenominator(this._form.resolution,a)}create(t,e,n,o){var i;return{doc:new((null===(i=window.jspdf)||void 0===i?void 0:i.jsPDF)||r.jsPDF)({orientation:t,format:e}),height:n,width:o}}addMapImage(t){this._pdf.doc.addImage(t,"JPEG",this._config.style.paperMargin,this._config.style.paperMargin,this._pdf.width-2*this._config.style.paperMargin,this._pdf.height-2*this._config.style.paperMargin)}savePdf(){return new Promise(((t,e)=>{var n;if("pdf"===this._form.typeExport)this._pdf.doc.save(this._config.filename+".pdf"),t();else{const o=this._pdf.doc.output("dataurlstring"),i=(null===(n=null===window||void 0===window?void 0:window.pdfjsLib)||void 0===n?void 0:n.version)||s.version;s.GlobalWorkerOptions.workerSrc=`https://cdnjs.cloudflare.com/ajax/libs/pdf.js/${i}/pdf.worker.js`,s.getDocument(o).promise.then((e=>{e.getPage(1).then((e=>{const n=e.getViewport({scale:2}),o=E("canvas",null);o.style.display="none",document.body.appendChild(o);const i=o.getContext("2d");o.height=n.height,o.width=n.width;e.render({canvasContext:i,viewport:n}).promise.then((()=>{((t,e)=>{const n=E("a",{download:e,href:t});document.body.appendChild(n),n.click(),document.body.removeChild(n)})(o.toDataURL(`image/${this._form.typeExport}`),this._config.filename+`.${this._form.typeExport}`),o.remove(),t()}))}))}),(t=>{e(t),console.log(t)}))}}))}_calculateScaleDenominator(t,e){const n=t/25.4;return Math.round(1e3*n*this._getMeterPerPixel(e))}_getMeterPerPixel(e){const n=this._view.getProjection();return t.getPointResolution(n,e,this._view.getCenter())*n.getMetersPerUnit()}}function T(){}function S(){S.init.call(this)}function k(t){return void 0===t._maxListeners?S.defaultMaxListeners:t._maxListeners}function A(t,e,n){if(e)t.call(n);else for(var o=t.length,i=H(t,o),r=0;r<o;++r)i[r].call(n)}function O(t,e,n,o){if(e)t.call(n,o);else for(var i=t.length,r=H(t,i),s=0;s<i;++s)r[s].call(n,o)}function j(t,e,n,o,i){if(e)t.call(n,o,i);else for(var r=t.length,s=H(t,r),a=0;a<r;++a)s[a].call(n,o,i)}function F(t,e,n,o,i,r){if(e)t.call(n,o,i,r);else for(var s=t.length,a=H(t,s),l=0;l<s;++l)a[l].call(n,o,i,r)}function D(t,e,n,o){if(e)t.apply(n,o);else for(var i=t.length,r=H(t,i),s=0;s<i;++s)r[s].apply(n,o)}function I(t,e,n,o){var i,r,s,a;if("function"!=typeof n)throw new TypeError('"listener" argument must be a function');if((r=t._events)?(r.newListener&&(t.emit("newListener",e,n.listener?n.listener:n),r=t._events),s=r[e]):(r=t._events=new T,t._eventsCount=0),s){if("function"==typeof s?s=r[e]=o?[n,s]:[s,n]:o?s.unshift(n):s.push(n),!s.warned&&(i=k(t))&&i>0&&s.length>i){s.warned=!0;var l=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+e+" listeners added. Use emitter.setMaxListeners() to increase limit");l.name="MaxListenersExceededWarning",l.emitter=t,l.type=e,l.count=s.length,a=l,"function"==typeof console.warn?console.warn(a):console.log(a)}}else s=r[e]=n,++t._eventsCount;return t}function R(t,e,n){var o=!1;function i(){t.removeListener(e,i),o||(o=!0,n.apply(t,arguments))}return i.listener=n,i}function z(t){var e=this._events;if(e){var n=e[t];if("function"==typeof n)return 1;if(n)return n.length}return 0}function H(t,e){for(var n=new Array(e);e--;)n[e]=t[e];return n}T.prototype=Object.create(null),S.EventEmitter=S,S.usingDomains=!1,S.prototype.domain=void 0,S.prototype._events=void 0,S.prototype._maxListeners=void 0,S.defaultMaxListeners=10,S.init=function(){this.domain=null,S.usingDomains&&undefined.active,this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=new T,this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},S.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||isNaN(t))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=t,this},S.prototype.getMaxListeners=function(){return k(this)},S.prototype.emit=function(t){var e,n,o,i,r,s,a,l="error"===t;if(s=this._events)l=l&&null==s.error;else if(!l)return!1;if(a=this.domain,l){if(e=arguments[1],!a){if(e instanceof Error)throw e;var c=new Error('Uncaught, unspecified "error" event. ('+e+")");throw c.context=e,c}return e||(e=new Error('Uncaught, unspecified "error" event')),e.domainEmitter=this,e.domain=a,e.domainThrown=!1,a.emit("error",e),!1}if(!(n=s[t]))return!1;var d="function"==typeof n;switch(o=arguments.length){case 1:A(n,d,this);break;case 2:O(n,d,this,arguments[1]);break;case 3:j(n,d,this,arguments[1],arguments[2]);break;case 4:F(n,d,this,arguments[1],arguments[2],arguments[3]);break;default:for(i=new Array(o-1),r=1;r<o;r++)i[r-1]=arguments[r];D(n,d,this,i)}return!0},S.prototype.addListener=function(t,e){return I(this,t,e,!1)},S.prototype.on=S.prototype.addListener,S.prototype.prependListener=function(t,e){return I(this,t,e,!0)},S.prototype.once=function(t,e){if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');return this.on(t,R(this,t,e)),this},S.prototype.prependOnceListener=function(t,e){if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');return this.prependListener(t,R(this,t,e)),this},S.prototype.removeListener=function(t,e){var n,o,i,r,s;if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');if(!(o=this._events))return this;if(!(n=o[t]))return this;if(n===e||n.listener&&n.listener===e)0==--this._eventsCount?this._events=new T:(delete o[t],o.removeListener&&this.emit("removeListener",t,n.listener||e));else if("function"!=typeof n){for(i=-1,r=n.length;r-- >0;)if(n[r]===e||n[r].listener&&n[r].listener===e){s=n[r].listener,i=r;break}if(i<0)return this;if(1===n.length){if(n[0]=void 0,0==--this._eventsCount)return this._events=new T,this;delete o[t]}else!function(t,e){for(var n=e,o=n+1,i=t.length;o<i;n+=1,o+=1)t[n]=t[o];t.pop()}(n,i);o.removeListener&&this.emit("removeListener",t,s||e)}return this},S.prototype.off=function(t,e){return this.removeListener(t,e)},S.prototype.removeAllListeners=function(t){var e,n;if(!(n=this._events))return this;if(!n.removeListener)return 0===arguments.length?(this._events=new T,this._eventsCount=0):n[t]&&(0==--this._eventsCount?this._events=new T:delete n[t]),this;if(0===arguments.length){for(var o,i=Object.keys(n),r=0;r<i.length;++r)"removeListener"!==(o=i[r])&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=new T,this._eventsCount=0,this}if("function"==typeof(e=n[t]))this.removeListener(t,e);else if(e)do{this.removeListener(t,e[e.length-1])}while(e[0]);return this},S.prototype.listeners=function(t){var e,n=this._events;return n&&(e=n[t])?"function"==typeof e?[e.listener||e]:function(t){for(var e=new Array(t.length),n=0;n<e.length;++n)e[n]=t[n].listener||t[n];return e}(e):[]},S.listenerCount=function(t,e){return"function"==typeof t.listenerCount?t.listenerCount(e):z.call(t,e)},S.prototype.listenerCount=z,S.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};var B=f((function(t){t.exports=function(t){var e={};function n(o){if(e[o])return e[o].exports;var i=e[o]={i:o,l:!1,exports:{}};return t[o].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=t,n.c=e,n.d=function(t,e,o){n.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:o})},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=0)}([function(t,e,n){t.exports=n(1).default},function(t,e,n){Object.defineProperty(e,"__esModule",{value:!0});var o,i=function(){function t(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,n,o){return n&&t(e.prototype,n),o&&t(e,o),e}}(),r=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o])}return t},s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},a=n(2),l=(o=a)&&o.__esModule?o:{default:o};function c(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function d(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}var h=null,u=Object.freeze({el:null,animate:!0,animateClass:"fade",animateInClass:"show",appendTo:"body",backdrop:!0,keyboard:!0,title:!1,header:!0,content:!1,footer:!0,buttons:null,headerClose:!0,construct:!1,transition:300,backdropTransition:150}),p=function t(e){for(var n in e)Array.isArray(e[n])?e[n].forEach((function(e){t(e)})):null!==e[n]&&"object"===s(e[n])&&Object.freeze(e[n]);return Object.freeze(e)}({dialog:[{text:"Cancel",value:!1,attr:{class:"btn btn-default","data-dismiss":"modal"}},{text:"OK",value:!0,attr:{class:"btn btn-primary","data-dismiss":"modal"}}],alert:[{text:"OK",attr:{class:"btn btn-primary","data-dismiss":"modal"}}],confirm:[{text:"Cancel",value:!1,attr:{class:"btn btn-default","data-dismiss":"modal"}},{text:"OK",value:!0,attr:{class:"btn btn-primary","data-dismiss":"modal"}}]}),f={container:'<div class="modal"></div>',dialog:'<div class="modal-dialog"></div>',content:'<div class="modal-content"></div>',header:'<div class="modal-header"></div>',headerClose:'<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>',body:'<div class="modal-body"></div>',footer:'<div class="modal-footer"></div>',backdrop:'<div class="modal-backdrop"></div>'};function m(){return(65536*(1+Math.random())|0).toString(16)+(65536*(1+Math.random())|0).toString(16)}function g(t,e,n){var o=t.data||{};if(void 0===n){if(t.data&&t.data[e])return t.data[e];var i=t.getAttribute("data-"+e);return void 0!==i?i:null}return o[e]=n,t.data=o,t}function v(t,e){return t.nodeName?t:(t=t.replace(/(\t|\n$)/g,""),h||(h=document.createElement("div")),h.innerHTML="",h.innerHTML=t,!0===e?h.childNodes:h.childNodes[0])}function _(){var t,e,n=void 0,o=document.createElement("div");return r(o.style,{visibility:"hidden",width:"100px"}),document.body.appendChild(o),e=o.offsetWidth,o.style.overflow="scroll",(n=document.createElement("div")).style.width="100%",o.appendChild(n),t=e-n.offsetWidth,document.body.removeChild(o),t}function y(t){for(var e=[t];t.parentNode;)t=t.parentNode,e.push(t);return e}var b=function(t){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};c(this,e);var n=d(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));if(n.id=m(),n.el=null,n._html={},n._events={},n._visible=!1,n._pointerInContent=!1,n._options=r({},e.options,t),n._templates=r({},e.templates,t.templates||{}),n._html.appendTo=document.querySelector(n._options.appendTo),n._scrollbarWidth=_(),null===n._options.buttons&&(n._options.buttons=e.buttons.dialog),n._options.el){var o=n._options.el;if("string"==typeof n._options.el&&!(o=document.querySelector(n._options.el)))throw new Error("Selector: DOM Element "+n._options.el+" not found.");g(o,"modal",n),n.el=o}else n._options.construct=!0;return n._options.construct?n._render():n._mapDom(),n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),i(e,null,[{key:"alert",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=r({},u,{title:t,content:!1,construct:!0,headerClose:!1,buttons:e.buttons.alert},n);return new e(o)}},{key:"confirm",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=r({},u,{title:t,content:!1,construct:!0,headerClose:!1,buttons:e.buttons.confirm},n);return new e(o)}},{key:"templates",set:function(t){this._baseTemplates=t},get:function(){return r({},f,e._baseTemplates||{})}},{key:"buttons",set:function(t){this._baseButtons=t},get:function(){return r({},p,e._baseButtons||{})}},{key:"options",set:function(t){this._baseOptions=t},get:function(){return r({},u,e._baseOptions||{})}},{key:"version",get:function(){return"0.12.0"}}]),i(e,[{key:"_render",value:function(){var t=this._html,e=this._options,n=this._templates,o=!!e.animate&&e.animateClass;return t.container=v(n.container),t.dialog=v(n.dialog),t.content=v(n.content),t.header=v(n.header),t.headerClose=v(n.headerClose),t.body=v(n.body),t.footer=v(n.footer),o&&t.container.classList.add(o),this._setHeader(),this._setContent(),this._setFooter(),this.el=t.container,t.dialog.appendChild(t.content),t.container.appendChild(t.dialog),this}},{key:"_mapDom",value:function(){var t=this._html,e=this._options;return this.el.classList.contains(e.animateClass)&&(e.animate=!0),t.container=this.el,t.dialog=this.el.querySelector(".modal-dialog"),t.content=this.el.querySelector(".modal-content"),t.header=this.el.querySelector(".modal-header"),t.headerClose=this.el.querySelector(".modal-header .close"),t.body=this.el.querySelector(".modal-body"),t.footer=this.el.querySelector(".modal-footer"),this._setHeader(),this._setContent(),this._setFooter(),this}},{key:"_setHeader",value:function(){var t=this._html,e=this._options;e.header&&t.header&&(e.title.nodeName?t.header.innerHTML=e.title.outerHTML:"string"==typeof e.title&&(t.header.innerHTML='<h4 class="modal-title">'+e.title+"</h4>"),null===this.el&&t.headerClose&&e.headerClose&&t.header.appendChild(t.headerClose),e.construct&&t.content.appendChild(t.header))}},{key:"_setContent",value:function(){var t=this._html,e=this._options;e.content&&t.body&&("string"==typeof e.content?t.body.innerHTML=e.content:t.body.innerHTML=e.content.outerHTML,e.construct&&t.content.appendChild(t.body))}},{key:"_setFooter",value:function(){var t=this._html,e=this._options;e.footer&&t.footer&&(e.footer.nodeName?t.footer.ineerHTML=e.footer.outerHTML:"string"==typeof e.footer?t.footer.innerHTML=e.footer:t.footer.children.length||e.buttons.forEach((function(e){var n=document.createElement("button");for(var o in g(n,"button",e),n.innerHTML=e.text,n.setAttribute("type","button"),e.attr)n.setAttribute(o,e.attr[o]);t.footer.appendChild(n)})),e.construct&&t.content.appendChild(t.footer))}},{key:"_setEvents",value:function(){this._options;var t=this._html;this._events.keydownHandler=this._handleKeydownEvent.bind(this),document.body.addEventListener("keydown",this._events.keydownHandler),this._events.mousedownHandler=this._handleMousedownEvent.bind(this),t.container.addEventListener("mousedown",this._events.mousedownHandler),this._events.clickHandler=this._handleClickEvent.bind(this),t.container.addEventListener("click",this._events.clickHandler),this._events.resizeHandler=this._handleResizeEvent.bind(this),window.addEventListener("resize",this._events.resizeHandler)}},{key:"_handleMousedownEvent",value:function(t){var e=this;this._pointerInContent=!1,y(t.target).every((function(t){return!t.classList||!t.classList.contains("modal-content")||(e._pointerInContent=!0,!1)}))}},{key:"_handleClickEvent",value:function(t){var e=this;y(t.target).every((function(n){return"HTML"!==n.tagName&&((!0===e._options.backdrop||!n.classList.contains("modal"))&&(!n.classList.contains("modal-content")&&("modal"===n.getAttribute("data-dismiss")?(e.emit("dismiss",e,t,g(t.target,"button")),e.hide(),!1):!(!e._pointerInContent&&n.classList.contains("modal"))||(e.emit("dismiss",e,t,null),e.hide(),!1))))})),this._pointerInContent=!1}},{key:"_handleKeydownEvent",value:function(t){27===t.which&&this._options.keyboard&&(this.emit("dismiss",this,t,null),this.hide())}},{key:"_handleResizeEvent",value:function(t){this._resize()}},{key:"show",value:function(){var t=this,e=this._options,n=this._html;return this.emit("show",this),this._checkScrollbar(),this._setScrollbar(),document.body.classList.add("modal-open"),e.construct&&n.appendTo.appendChild(n.container),n.container.style.display="block",n.container.scrollTop=0,!1!==e.backdrop?(this.once("showBackdrop",(function(){t._setEvents(),e.animate&&n.container.offsetWidth,n.container.classList.add(e.animateInClass),setTimeout((function(){t._visible=!0,t.emit("shown",t)}),e.transition)})),this._backdrop()):(this._setEvents(),e.animate&&n.container.offsetWidth,n.container.classList.add(e.animateInClass),setTimeout((function(){t._visible=!0,t.emit("shown",t)}),e.transition)),this._resize(),this}},{key:"toggle",value:function(){this._visible?this.hide():this.show()}},{key:"_resize",value:function(){var t=this._html.container.scrollHeight>document.documentElement.clientHeight;this._html.container.style.paddingLeft=!this.bodyIsOverflowing&&t?this._scrollbarWidth+"px":"",this._html.container.style.paddingRight=this.bodyIsOverflowing&&!t?this._scrollbarWidth+"px":""}},{key:"_backdrop",value:function(){var t=this,e=this._html,n=this._templates,o=this._options,i=!!o.animate&&o.animateClass;e.backdrop=v(n.backdrop),i&&e.backdrop.classList.add(i),e.appendTo.appendChild(e.backdrop),i&&e.backdrop.offsetWidth,e.backdrop.classList.add(o.animateInClass),setTimeout((function(){t.emit("showBackdrop",t)}),this._options.backdropTransition)}},{key:"hide",value:function(){var t=this,e=this._html,n=this._options,o=e.container.classList;(this.emit("hide",this),o.remove(n.animateInClass),n.backdrop)&&e.backdrop.classList.remove(n.animateInClass);return this._removeEvents(),setTimeout((function(){document.body.classList.remove("modal-open"),document.body.style.paddingRight=t.originalBodyPad}),n.backdropTransition),setTimeout((function(){n.backdrop&&e.backdrop.parentNode.removeChild(e.backdrop),e.container.style.display="none",n.construct&&e.container.parentNode.removeChild(e.container),t._visible=!1,t.emit("hidden",t)}),n.transition),this}},{key:"_removeEvents",value:function(){this._events.keydownHandler&&document.body.removeEventListener("keydown",this._events.keydownHandler),this._html.container.removeEventListener("mousedown",this._events.mousedownHandler),this._html.container.removeEventListener("click",this._events.clickHandler),window.removeEventListener("resize",this._events.resizeHandler)}},{key:"_checkScrollbar",value:function(){this.bodyIsOverflowing=document.body.clientWidth<window.innerWidth}},{key:"_setScrollbar",value:function(){if(this.originalBodyPad=document.body.style.paddingRight||"",this.bodyIsOverflowing){var t=parseInt(this.originalBodyPad||0,10);document.body.style.paddingRight=t+this._scrollbarWidth+"px"}}}]),e}(l.default);e.default=b},function(t,e){t.exports=S}])})),N=p(B);class U{constructor(t,e,n,o){this._modal=new N(Object.assign({headerClose:!0,header:!0,animate:!0,title:n.printPdf,content:this.Content(n,e),footer:this.Footer(n,e)},e.modal)),this._modal.on("dismiss",((t,n)=>{if(!n.target.dataset.print)return;const i=document.getElementById("printMap"),r=new FormData(i),s={format:r.get("printFormat"),orientation:r.get("printOrientation"),resolution:r.get("printResolution"),scale:r.get("printScale"),description:r.get("printDescription"),compass:r.get("printCompass"),attributions:r.get("printAttributions"),scalebar:r.get("printScalebar"),typeExport:this._modal.el.querySelector('select[name="printTypeExport"]').value};o(s,!0,e.modal.transition)})),this._modal.on("shown",(()=>{const e=((t,e=!0)=>{const n=t.getView(),o=n.getProjection().getUnits();let i=n.getResolution()*a.METERS_PER_UNIT[o]*39.37*(25.4/.28);return e&&(i=Math.round(i)),i})(t),o=this._modal.el.querySelector(".actualScale");o.value=String(e/1e3),o.innerHTML=`${n.current} (1:${e.toLocaleString("de")})`}))}Content(t,e){const{scales:n,dpi:o,mapElements:i,paperSizes:r}=e;return E("form",{id:"printMap"},E("div",null,E("div",{className:"printFieldHalf"},E("label",{htmlFor:"printFormat"},t.paperSize),E("select",{name:"printFormat",id:"printFormat"},r.map((t=>E("option",Object.assign({value:t.value},t.selected?{selected:"selected"}:{}),t.value))))),E("div",{className:"printFieldHalf"},E("label",{htmlFor:"printOrientation"},t.orientation),E("select",{name:"printOrientation",id:"printOrientation"},E("option",{value:"landscape",selected:!0},t.landscape),E("option",{value:"portrait"},t.portrait)))),E("div",null,E("div",{className:"printFieldHalf"},E("label",{htmlFor:"printResolution"},t.resolution),E("select",{name:"printResolution",id:"printResolution"},o.map((t=>E("option",Object.assign({value:t.value},t.selected?{selected:"selected"}:{}),t.value," dpi"))))),E("div",{className:"printFieldHalf"},E("label",{htmlFor:"printScale"},t.scale),E("select",{name:"printScale",id:"printScale"},E("option",{className:"actualScale",value:"",selected:!0}),n.map((t=>E("option",{value:t},"1:",(1e3*t).toLocaleString("de"))))))),i&&E("div",null,i.description&&E("div",null,E("label",{htmlFor:"printDescription"},t.addNote),E("textarea",{id:"printDescription",name:"printDescription",rows:"4"})),E("div",null,t.mapElements),E("div",{className:"printElements"},i.compass&&E("label",{htmlFor:"printCompass"},E("input",{type:"checkbox",id:"printCompass",name:"printCompass",checked:!0}),t.compass),i.scalebar&&E("label",{htmlFor:"printScalebar"},E("input",{type:"checkbox",id:"printScalebar",name:"printScalebar",checked:!0}),t.scale),i.attributions&&E("label",{htmlFor:"printAttributions"},E("input",{type:"checkbox",id:"printAttributions",name:"printAttributions",checked:!0}),t.layersAttributions))))}Footer(t,e){const{mimeTypeExports:n}=e;return E("div",null,E("button",{type:"button",className:"btn-sm btn btn-secondary","data-dismiss":"modal"},t.cancel),E("div",{class:"typeExportContainer"},E("button",{type:"button",className:"btn-sm btn btn-primary","data-print":"true","data-dismiss":"modal"},t.print),E("select",{className:"typeExport",name:"printTypeExport",id:"printTypeExport"},n.map((t=>E("option",Object.assign({value:t.value},t.selected?{selected:"selected"}:{}),t.value)))))).outerHTML}hide(){this._modal.hide()}show(){this._modal._visible||this._modal.show()}}class W{constructor(t,e,n){this._i18n=t,this._modal=new N(Object.assign({headerClose:!1,title:this._i18n.printing,backdrop:"static",content:" ",footer:`\n            <button\n                type="button"\n                class="btn-sm btn btn-secondary"\n                data-dismiss="modal"\n            >\n                ${this._i18n.cancel}\n            </button>\n            `},e.modal)),this._modal.on("dismiss",(()=>{n()}))}_setContentModal(t){this._modal._html.body.innerHTML=t}_setFooterModal(t){this._modal._html.footer.innerHTML=t}show(t){this._setContentModal(t),this._modal._visible||this._modal.show()}hide(){this._modal.hide()}}var q=Object.freeze({__proto__:null,es:{printPdf:"Exportar PDF",pleaseWait:"Por favor espere...",almostThere:"Ya casi...",error:"Error al generar pdf",errorImage:"Ocurrió un error al tratar de cargar una imagen",printing:"Exportando",cancel:"Cancelar",close:"Cerrar",print:"Exportar",mapElements:"Elementos en el mapa",compass:"Brújula",scale:"Escala",layersAttributions:"Atribuciones de capas",addNote:"Agregar nota (opcional)",resolution:"Resolución",orientation:"Orientación",paperSize:"Tamaño de página",landscape:"Paisaje",portrait:"Retrato",current:"Actual",paper:"Hoja"},en:{printPdf:"Print PDF",pleaseWait:"Please wait...",almostThere:"Almost there...",error:"An error occurred while printing",errorImage:"An error ocurred while loading an image",printing:"Exporting",cancel:"Cancel",close:"Close",print:"Export",mapElements:"Map elements",compass:"Compass",scale:"Scale",layersAttributions:"Layer attributions",addNote:"Add note (optional)",resolution:"Resolution",orientation:"Orientation",paperSize:"Paper size",landscape:"Landscape",portrait:"Portrait",current:"Current",paper:"Paper"}});const V="printMode";function $(t,...e){return e.forEach((e=>{Object.keys(e).forEach((n=>{const o=e[n],i=t[n];t[n]=i&&o&&"object"==typeof i&&"object"==typeof o&&!Array.isArray(i)?$(i,o):o}))})),t}class G extends c.default{constructor(t){const e=document.createElement("button");super({target:t.target,element:e}),this._i18n=t.language&&t.language in q?q[t.language]:q.en,t.i18n&&(this._i18n=Object.assign(Object.assign({},this._i18n),t.i18n)),this._options={language:"en",filename:"Ol Pdf Printer",style:{paperMargin:10,brcolor:"#000000",bkcolor:"#273f50",txcolor:"#ffffff"},extraInfo:{date:!0,url:!0,specs:!0},mapElements:{description:!0,attributions:!0,scalebar:!0,compass:(new DOMParser).parseFromString('<?xml version="1.0" encoding="utf-8"?>\n<svg version="1.1" id="compass" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"\n\t viewBox="0 0 300 300" style="enable-background:new 0 0 300 300;" xml:space="preserve">\n<style type="text/css">\n\t.st0{fill:#EA6868;}\n</style>\n<g>\n\t<g>\n\t\t<g>\n\t\t\t<g>\n\t\t\t\t<g>\n\t\t\t\t\t<path class="st0" d="M146.3,9.1L75.5,287.2c-0.5,1.8,0.5,3.7,2.1,4.4c1.8,0.8,3.7,0.2,4.7-1.5l68.4-106.7l66.8,106.7\n\t\t\t\t\t\tc0.6,1.1,1.9,1.8,3.2,1.8c0.5,0,1-0.2,1.5-0.3c1.8-0.8,2.6-2.6,2.3-4.4L153.7,9.1C152.9,5.7,147.2,5.7,146.3,9.1z M154.2,174.2\n\t\t\t\t\t\tc-0.6-1.1-1.9-1.8-3.2-1.8l0,0c-1.3,0-2.6,0.6-3.2,1.8l-59,92L150,25.5l61.1,239.9L154.2,174.2z"/>\n\t\t\t\t</g>\n\t\t\t</g>\n\t\t\t<g>\n\t\t\t\t<g>\n\t\t\t\t\t<path class="st0" d="M220.8,293.1c-1.8,0-3.4-1-4.2-2.3l-65.8-105.1L83.4,290.8c-1.3,1.9-4,2.9-6.1,1.9c-2.3-1-3.4-3.4-2.9-5.8\n\t\t\t\t\t\tL145.1,8.8c0.5-2.1,2.4-3.4,4.9-3.4s4.4,1.3,4.9,3.4l70.8,278.1c0.6,2.4-0.6,4.9-2.9,5.8C222.1,292.9,221.5,293.1,220.8,293.1z\n\t\t\t\t\t\t M150.8,181.2l1,1.6l66.8,106.7c0.6,1,1.9,1.5,3.2,1c1.1-0.5,1.8-1.8,1.5-3.1L152.4,9.3c-0.3-1.1-1.6-1.6-2.6-1.6\n\t\t\t\t\t\ts-2.3,0.5-2.6,1.6L76.4,287.4c-0.3,1.3,0.3,2.6,1.5,3.1c1.1,0.5,2.6,0,3.2-1L150.8,181.2z M85.6,273.2L150,20.6l64.2,251.9\n\t\t\t\t\t\tl-61.1-97.7c-1-1.6-3.4-1.5-4.4,0L85.6,273.2z"/>\n\t\t\t\t</g>\n\t\t\t</g>\n\t\t</g>\n\t</g>\n</g>\n</svg>\n',"image/svg+xml").firstChild},watermark:{title:"Ol Pdf Printer",titleColor:"#d65959",subtitle:"https://github.com/GastonZalba/ol-pdf-printer",subtitleColor:"#444444",logo:!1},paperSizes:[{size:[594,420],value:"A2"},{size:[420,297],value:"A3"},{size:[297,210],value:"A4",selected:!0},{size:[210,148],value:"A5"}],dpi:[{value:72},{value:96},{value:150,selected:!0},{value:200},{value:300}],scales:[1e4,5e3,1e3,500,250,100,50,25,10],mimeTypeExports:[{value:"pdf",selected:!0},{value:"png"},{value:"jpeg"},{value:"webp"}],units:"metric",dateFormat:void 0,ctrlBtnClass:"",modal:{animateClass:"fade",animateInClass:"show",transition:150,backdropTransition:100,templates:{dialog:'<div class="modal-dialog modal-dialog-centered"></div>',headerClose:`<button type="button" class="btn-close" data-dismiss="modal" aria-label="${this._i18n.close}"><span aria-hidden="true">×</span></button>`}}},this._options=$(this._options,t),e.className=`ol-print-btn-menu ${this._options.ctrlBtnClass}`,e.title=this._i18n.printPdf,e.onclick=()=>this.showPrintSettingsModal(),e.append((new DOMParser).parseFromString('<?xml version="1.0" encoding="utf-8"?>\n<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"\n\t viewBox="0 0 490 490" xml:space="preserve">\n<g>\n\t<path d="M65.4,6v157.1c0,3.3-2.9,6-6.5,6H33.6c-3.6,0-6.5,2.7-6.5,6v189.6h0l36.3,33.8c1.2,1.1,1.9,2.7,1.9,4.3l0,81.2\n\t\tc0,3.3,2.9,6,6.5,6h383.8c3.6,0,6.5-2.7,6.5-6V104.9c0-1.6-0.7-3.1-1.9-4.3l-106-98.9c-1.2-1.1-2.9-1.8-4.6-1.8H71.8\n\t\tC68.2,0,65.4,2.7,65.4,6z M431.3,357.4h-374c-3.8,0-6.9-4-6.9-9V203.2c0-5,3.1-9,6.9-9h374c3.8,0,6.9,4,6.9,9v145.2\n\t\tC438.2,353.4,435.1,357.4,431.3,357.4z M340.2,27.6l70.8,66c7.2,6.7,2.1,18.2-8.1,18.2h-70.8c-6.3,0-11.4-4.8-11.4-10.7v-66\n\t\tC320.7,25.6,333,20.9,340.2,27.6z"/>\n\t<path d="M136.9,207.4h-6.5H87.9c-5.8,0-10.5,4.9-10.5,11v115.5c0,6.1,4.7,11,10.5,11h4c5.8,0,10.5-4.9,10.5-11v-22.4\n\t\tc0-6.1,4.7-11,10.5-11h18.9l5.8-0.1c18,0,29.9-3,35.8-9.1c5.9-6.1,8.9-18.3,8.9-36.7c0-18.5-3.1-31-9.3-37.5\n\t\tC166.6,210.6,154.7,207.4,136.9,207.4z M152.2,274.4c-3.1,2.7-10.2,4.1-21.5,4.1h-17.9c-5.8,0-10.5-4.9-10.5-11v-27.2\n\t\tc0-6.1,4.7-11,10.5-11h20.4c10.6,0,17.2,1.4,19.8,4.2c2.5,2.8,3.8,10,3.8,21.6C156.8,265.2,155.3,271.6,152.2,274.4z"/>\n\t<path d="M262.6,207.4h-54.1c-5.8,0-10.5,4.9-10.5,11v115.5c0,6.1,4.7,11,10.5,11h54.9c20.7,0,34.1-4.9,39.9-14.6\n\t\tc5.9-9.8,8.9-31.8,8.9-66.1c0-21-3.7-35.7-11-44.1C293.8,211.5,281,207.4,262.6,207.4z M281.6,314.2c-3.5,5.8-11.2,8.6-23.1,8.6\n\t\th-25c-5.8,0-10.5-4.9-10.5-11v-71.6c0-6.1,4.7-11,10.5-11H260c11.6,0,19,2.7,22.1,8.2c3.1,5.5,4.7,18.4,4.7,38.7\n\t\tC286.9,295.8,285.1,308.5,281.6,314.2z"/>\n\t<path d="M340.9,344.8h3.9c5.8,0,10.5-4.9,10.5-11v-34.5c0-6.1,4.7-11,10.5-11h37.9c5.8,0,10.5-4.9,10.5-11v0\n\t\tc0-6.1-4.7-11-10.5-11h-37.9c-5.8,0-10.5-4.9-10.5-11v-15.1c0-6.1,4.7-11,10.5-11h41.1c5.8,0,10.5-4.9,10.5-11v0\n\t\tc0-6.1-4.7-11-10.5-11h-66c-5.8,0-10.5,4.9-10.5,11v115.5C330.4,339.9,335.1,344.8,340.9,344.8z"/>\n</g>\n</svg>\n',"image/svg+xml").firstChild)}_init(){this._map=this.getMap(),this._view=this._map.getView(),this._mapTarget=this._map.getTargetElement(),this._settingsModal=new U(this._map,this._options,this._i18n,this._printMap.bind(this)),this._processingModal=new W(this._i18n,this._options,this._onEndPrint.bind(this)),this._initialized=!0}_setMapSizForPrint(t,e,n){const o=n/25.4;return[Math.round(t*o),Math.round(e*o)]}_onEndPrint(){this._mapTarget.style.width="",this._mapTarget.style.height="",this._map.updateSize(),this._view.setResolution(this._initialViewResolution),this._mapTarget.classList.remove(V),this._view.setConstrainResolution(!0),clearTimeout(this._timeoutProcessing),this._cancel()}_prepareLoading(){this._processingModal.show(this._i18n.pleaseWait),this._timeoutProcessing=setTimeout((()=>{this._processingModal.show(this._i18n.almostThere)}),4e3)}_disableLoading(){this._processingModal.hide()}_setFormatOptions(t=""){this._map.getLayers().forEach((e=>{if(e instanceof h.default){const n=e.getSource();n instanceof d.default&&n.updateParams({FORMAT_OPTIONS:t})}}))}_printMap(e,n=!0,o=0){n&&this._mapTarget.classList.add(V),setTimeout((()=>{n&&this._prepareLoading(),this._isCanceled=!1,this._view.setConstrainResolution(!1);let o=this._options.paperSizes.find((t=>t.value===e.format)).size;o="landscape"===e.orientation?o:[...o].reverse();const i=o[0],r=o[1],s=this._setMapSizForPrint(i,r,e.resolution),[a,l]=s;this._initialViewResolution=this._view.getResolution();const c=e.resolution/25.4,d=e.scale/t.getPointResolution(this._view.getProjection(),c,this._view.getCenter());this._renderCompleteKey=this._map.once("rendercomplete",(()=>{m.toJpeg(this._mapTarget.querySelector(".ol-unselectable.ol-layers"),{width:a,height:l}).then((t=>u(this,void 0,void 0,(function*(){this._isCanceled||(this._pdf=new L({view:this._view,i18n:this._i18n,config:this._options,form:e,height:r,width:i,scaleResolution:d}),this._pdf.addMapImage(t),yield this._pdf.addMapHelpers(),this._isCanceled||(yield this._pdf.savePdf(),this._onEndPrint(),n&&this._disableLoading()))})))).catch((t=>{const e="string"==typeof t?t:this._i18n.error;console.error(t),this._onEndPrint(),this._processingModal.show(e)}))})),this._mapTarget.style.width=a+"px",this._mapTarget.style.height=l+"px",this._map.updateSize(),this._map.getView().setResolution(d)}),o)}_cancel(){this._renderCompleteKey&&i.unByKey(this._renderCompleteKey),this._isCanceled=!0}showPrintSettingsModal(){this._initialized||this._init(),this._settingsModal.show()}hidePrintSettingsModal(){this._settingsModal.hide()}createPdf(t,e){t={},this._printMap(Object.assign({format:(this._options.paperSizes.find((t=>t.selected))||this._options.paperSizes[0]).value,resolution:(this._options.dpi.find((t=>t.selected))||this._options.dpi[0]).value,orientation:"landscape",compass:!0,attributions:!0,scalebar:!0,scale:1e3,typeExport:"pdf"},t),e)}}return G}));
//# sourceMappingURL=ol-pdf-printer.min.js.map
