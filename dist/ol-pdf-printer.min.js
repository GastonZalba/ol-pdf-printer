/*!
 * ol-pdf-printer - v2.0.2
 * https://github.com/GastonZalba/ol-pdf-printer#readme
 * Built: Tue Oct 10 2023 10:44:16 GMT-0300 (hora estándar de Argentina)
*/
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("ol/control/Control.js"),require("ol/proj.js"),require("ol/Observable.js"),require("ol/source/Cluster.js"),require("ol/layer/Vector.js"),require("jspdf"),require("pdfjs-dist"),require("ol/uri.js"),require("ol/proj/Units.js"),require("ol/source/ImageWMS.js"),require("ol/layer/Tile.js"),require("ol/layer/Image.js"),require("ol/source/TileWMS.js"),require("ol/geom/Polygon"),require("ol/Overlay")):"function"==typeof define&&define.amd?define(["ol/control/Control.js","ol/proj.js","ol/Observable.js","ol/source/Cluster.js","ol/layer/Vector.js","jspdf","pdfjs-dist","ol/uri.js","ol/proj/Units.js","ol/source/ImageWMS.js","ol/layer/Tile.js","ol/layer/Image.js","ol/source/TileWMS.js","ol/geom/Polygon","ol/Overlay"],e):(t="undefined"!=typeof globalThis?globalThis:t||self).PdfPrinter=e(t.ol.control.Control,t.ol.proj,t.ol.Observable,t.ol.source.Cluster,t.ol.layer.Vector,t.jsPDF,t.pdfjsLib,t.ol.uri,t.ol.proj.Units,t.ol.source.ImageWMS,t.ol.layer.Tile,t.ol.layer.Image,t.ol.source.TileWMS,t.ol.geom.Polygon,t.ol.Overlay)}(this,(function(t,e,n,i,o,s,r,a,l,c,d,h,p,u,m){"use strict";var f=window,g="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==f?f:"undefined"!=typeof self?self:{};function _(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var v={exports:{}};
/*! dom-to-image-more 03-10-2023 */!function(t,e){!function(e){const n=function(){let t=0;return{escape:function(t){return t.replace(/([.*+?^${}()|[]\/\\])/g,"\\$1")},isDataUrl:function(t){return-1!==t.search(/^(data:)/)},canvasToBlob:function(t){return t.toBlob?new Promise((function(e){t.toBlob(e)})):function(t){return new Promise((function(e){var n=p(t.toDataURL().split(",")[1]),i=n.length,o=new Uint8Array(i);for(let t=0;t<i;t++)o[t]=n.charCodeAt(t);e(new Blob([o],{type:"image/png"}))}))}(t)},resolveUrl:function(t,e){var n=document.implementation.createHTMLDocument(),i=n.createElement("base"),o=(n.head.appendChild(i),n.createElement("a"));return n.body.appendChild(o),i.href=e,o.href=t,o.href},getAndEncode:function(t){let e=c.impl.urlCache.find((function(e){return e.url===t}));return e||(e={url:t,promise:null},c.impl.urlCache.push(e)),null===e.promise&&(c.impl.options.cacheBust&&(t+=(/\?/.test(t)?"&":"?")+(new Date).getTime()),e.promise=new Promise((function(e){const n=c.impl.options.httpTimeout,i=new XMLHttpRequest;if(i.onreadystatechange=function(){if(4===i.readyState)if(300<=i.status)s?e(s):r(`cannot fetch resource: ${t}, status: `+i.status);else{const t=new FileReader;t.onloadend=function(){e(t.result)},t.readAsDataURL(i.response)}},i.ontimeout=function(){s?e(s):r(`timeout of ${n}ms occured while fetching resource: `+t)},i.responseType="blob",i.timeout=n,c.impl.options.useCredentials&&(i.withCredentials=!0),c.impl.options.corsImg&&0===t.indexOf("http")&&-1===t.indexOf(window.location.origin)){var o="POST"===(c.impl.options.corsImg.method||"GET").toUpperCase()?"POST":"GET";i.open(o,(c.impl.options.corsImg.url||"").replace("#{cors}",t),!0);let e=!1;const n=c.impl.options.corsImg.headers||{},s=(Object.keys(n).forEach((function(t){-1!==n[t].indexOf("application/json")&&(e=!0),i.setRequestHeader(t,n[t])})),function(t){try{return JSON.parse(JSON.stringify(t))}catch(t){r("corsImg.data is missing or invalid")}}(c.impl.options.corsImg.data||""));Object.keys(s).forEach((function(e){"string"==typeof s[e]&&(s[e]=s[e].replace("#{cors}",t))})),i.send(e?JSON.stringify(s):s)}else i.open("GET",t,!0),i.send();let s;function r(t){console.error(t),e("")}c.impl.options.imagePlaceholder&&(o=c.impl.options.imagePlaceholder.split(/,/))&&o[1]&&(s=o[1])}))),e.promise},uid:function(){return"u"+("0000"+(Math.random()*Math.pow(36,4)<<0).toString(36)).slice(-4)+t++},delay:function(t){return function(e){return new Promise((function(n){setTimeout((function(){n(e)}),t)}))}},asArray:function(t){var e=[],n=t.length;for(let i=0;i<n;i++)e.push(t[i]);return e},escapeXhtml:function(t){return t.replace(/%/g,"%25").replace(/#/g,"%23").replace(/\n/g,"%0A")},makeImage:function(t){return"data:,"!==t?new Promise((function(e,n){const i=new Image;c.impl.options.useCredentials&&(i.crossOrigin="use-credentials"),i.onload=function(){window&&window.requestAnimationFrame?window.requestAnimationFrame((function(){e(i)})):e(i)},i.onerror=n,i.src=t})):Promise.resolve()},width:function(t){var e=r(t,"width");if(!isNaN(e))return e;e=r(t,"border-left-width");var n=r(t,"border-right-width");return t.scrollWidth+e+n},height:function(t){var e=r(t,"height");if(!isNaN(e))return e;e=r(t,"border-top-width");var n=r(t,"border-bottom-width");return t.scrollHeight+e+n},getWindow:n,isElement:s,isElementHostForOpenShadowRoot:function(t){return s(t)&&null!==t.shadowRoot},isShadowRoot:i,isInShadowRoot:o,isHTMLElement:function(t){return t instanceof n(t).HTMLElement},isHTMLCanvasElement:function(t){return t instanceof n(t).HTMLCanvasElement},isHTMLInputElement:function(t){return t instanceof n(t).HTMLInputElement},isHTMLImageElement:function(t){return t instanceof n(t).HTMLImageElement},isHTMLLinkElement:function(t){return t instanceof n(t).HTMLLinkElement},isHTMLScriptElement:function(t){return t instanceof n(t).HTMLScriptElement},isHTMLStyleElement:function(t){return t instanceof n(t).HTMLStyleElement},isHTMLTextAreaElement:function(t){return t instanceof n(t).HTMLTextAreaElement},isShadowSlotElement:function(t){return o(t)&&t instanceof n(t).HTMLSlotElement},isSVGElement:function(t){return t instanceof n(t).SVGElement},isSVGRectElement:function(t){return t instanceof n(t).SVGRectElement},isDimensionMissing:function(t){return isNaN(t)||t<=0}};function n(t){return((t=t?t.ownerDocument:void 0)?t.defaultView:void 0)||e||window}function i(t){return t instanceof n(t).ShadowRoot}function o(t){return null!==t&&Object.prototype.hasOwnProperty.call(t,"getRootNode")&&i(t.getRootNode())}function s(t){return t instanceof n(t).Element}function r(t,e){if(t.nodeType===d){let n=h(t).getPropertyValue(e);if("px"===n.slice(-2))return n=n.slice(0,-2),parseFloat(n)}return NaN}}(),i=function(){const t=/url\(['"]?([^'"]+?)['"]?\)/g;return{inlineAll:function(t,n,s){return e(t)?Promise.resolve(t).then(i).then((function(e){let i=Promise.resolve(t);return e.forEach((function(t){i=i.then((function(e){return o(e,t,n,s)}))})),i})):Promise.resolve(t)},shouldProcess:e,impl:{readUrls:i,inline:o}};function e(e){return-1!==e.search(t)}function i(e){for(var i,o=[];null!==(i=t.exec(e));)o.push(i[1]);return o.filter((function(t){return!n.isDataUrl(t)}))}function o(t,e,i,o){return Promise.resolve(e).then((function(t){return i?n.resolveUrl(t,i):t})).then(o||n.getAndEncode).then((function(i){return t.replace((o=e,new RegExp(`(url\\(['"]?)(${n.escape(o)})(['"]?\\))`,"g")),`$1${i}$3`);var o}))}}(),o={resolveAll:function(){return s().then((function(t){return Promise.all(t.map((function(t){return t.resolve()})))})).then((function(t){return t.join("\n")}))},impl:{readAll:s}};function s(){return Promise.resolve(n.asArray(document.styleSheets)).then((function(t){const e=[];return t.forEach((function(t){if(Object.prototype.hasOwnProperty.call(Object.getPrototypeOf(t),"cssRules"))try{n.asArray(t.cssRules||[]).forEach(e.push.bind(e))}catch(e){console.error("domtoimage: Error while reading CSS rules from "+t.href,e.toString())}})),e})).then((function(t){return t.filter((function(t){return t.type===CSSRule.FONT_FACE_RULE})).filter((function(t){return i.shouldProcess(t.style.getPropertyValue("src"))}))})).then((function(e){return e.map(t)}));function t(t){return{resolve:function(){var e=(t.parentStyleSheet||{}).href;return i.inlineAll(t.cssText,e)},src:function(){return t.style.getPropertyValue("src")}}}}const r={inlineAll:function t(e){return n.isElement(e)?function(t){const e=["background","background-image"].map((function(e){const n=t.style.getPropertyValue(e),o=t.style.getPropertyPriority(e);return n?i.inlineAll(n).then((function(n){t.style.setProperty(e,n,o)})):Promise.resolve()}));return Promise.all(e).then((function(){return t}))}(e).then((function(){return n.isHTMLImageElement(e)?a(e).inline():Promise.all(n.asArray(e.childNodes).map((function(e){return t(e)})))})):Promise.resolve(e)},impl:{newImage:a}};function a(t){return{inline:function(e){return n.isDataUrl(t.src)?Promise.resolve():Promise.resolve(t.src).then(e||n.getAndEncode).then((function(e){return new Promise((function(n){t.onload=n,t.onerror=n,t.src=e}))}))}}}const l={copyDefaultStyles:!0,imagePlaceholder:void 0,cacheBust:!1,useCredentials:!1,httpTimeout:3e4,styleCaching:"strict",corsImg:void 0},c={toSvg:u,toPng:function(t,e){return m(t,e).then((function(t){return t.toDataURL()}))},toJpeg:function(t,e){return m(t,e).then((function(t){return t.toDataURL("image/jpeg",(e?e.quality:void 0)||1)}))},toBlob:function(t,e){return m(t,e).then(n.canvasToBlob)},toPixelData:function(t,e){return m(t,e).then((function(e){return e.getContext("2d").getImageData(0,0,n.width(t),n.height(t)).data}))},toCanvas:m,impl:{fontFaces:o,images:r,util:n,inliner:i,urlCache:[],options:{}}},d=(t.exports=c,("undefined"!=typeof Node?Node.ELEMENT_NODE:void 0)||1),h=(void 0!==e?e.getComputedStyle:void 0)||("undefined"!=typeof window?window.getComputedStyle:void 0)||globalThis.getComputedStyle,p=(void 0!==e?e.atob:void 0)||("undefined"!=typeof window?window.atob:void 0)||globalThis.atob;function u(t,e){c.impl.util.getWindow(t);var i=e=e||{};void 0===i.copyDefaultStyles?c.impl.options.copyDefaultStyles=l.copyDefaultStyles:c.impl.options.copyDefaultStyles=i.copyDefaultStyles,void 0===i.imagePlaceholder?c.impl.options.imagePlaceholder=l.imagePlaceholder:c.impl.options.imagePlaceholder=i.imagePlaceholder,void 0===i.cacheBust?c.impl.options.cacheBust=l.cacheBust:c.impl.options.cacheBust=i.cacheBust,void 0===i.corsImg?c.impl.options.corsImg=l.corsImg:c.impl.options.corsImg=i.corsImg,void 0===i.useCredentials?c.impl.options.useCredentials=l.useCredentials:c.impl.options.useCredentials=i.useCredentials,void 0===i.httpTimeout?c.impl.options.httpTimeout=l.httpTimeout:c.impl.options.httpTimeout=i.httpTimeout,void 0===i.styleCaching?c.impl.options.styleCaching=l.styleCaching:c.impl.options.styleCaching=i.styleCaching;let o=[];return Promise.resolve(t).then((function(t){if(t.nodeType===d)return t;var e=t,n=t.parentNode,i=document.createElement("span");return n.replaceChild(i,e),i.append(t),o.push({parent:n,child:e,wrapper:i}),i})).then((function(t){return function t(e,i,o,s){const r=i.filter;return e===f||n.isHTMLScriptElement(e)||n.isHTMLStyleElement(e)||n.isHTMLLinkElement(e)||null!==o&&r&&!r(e)?Promise.resolve():Promise.resolve(e).then((function(t){return n.isHTMLCanvasElement(t)?n.makeImage(t.toDataURL()):t.cloneNode(!1)})).then((function(o){return function(e,o){const s=l(o);let r=Promise.resolve();if(0!==s.length){const l=h(a(o));n.asArray(s).forEach((function(n){r=r.then((function(){return t(n,i,l).then((function(t){t&&e.appendChild(t)}))}))}))}return r.then((function(){return e}));function a(t){return n.isShadowRoot(t)?t.host:t}function l(t){return n.isShadowSlotElement(t)?t.assignedNodes():t.childNodes}}(o,function(t){return n.isElementHostForOpenShadowRoot(t)?t.shadowRoot:t}(e))})).then((function(t){return function(t,e){return!n.isElement(t)||n.isShadowSlotElement(e)?Promise.resolve(t):Promise.resolve().then(s).then(r).then(a).then(l).then((function(){return t}));function s(){function n(t,e){e.font=t.font,e.fontFamily=t.fontFamily,e.fontFeatureSettings=t.fontFeatureSettings,e.fontKerning=t.fontKerning,e.fontSize=t.fontSize,e.fontStretch=t.fontStretch,e.fontStyle=t.fontStyle,e.fontVariant=t.fontVariant,e.fontVariantCaps=t.fontVariantCaps,e.fontVariantEastAsian=t.fontVariantEastAsian,e.fontVariantLigatures=t.fontVariantLigatures,e.fontVariantNumeric=t.fontVariantNumeric,e.fontVariationSettings=t.fontVariationSettings,e.fontWeight=t.fontWeight}function s(t,e){const s=h(t);s.cssText?(e.style.cssText=s.cssText,n(s,e.style)):(v(i,t,s,o,e),null===o&&(["inset-block","inset-block-start","inset-block-end"].forEach((t=>e.style.removeProperty(t))),["left","right","top","bottom"].forEach((t=>{e.style.getPropertyValue(t)&&e.style.setProperty(t,"0px")}))))}s(e,t)}function r(){const i=n.uid();function o(o){const s=h(e,o),r=s.getPropertyValue("content");if(""!==r&&"none"!==r){const a=t.getAttribute("class")||"",l=(t.setAttribute("class",a+" "+i),document.createElement("style"));function c(){const t=`.${i}:`+o,e=(s.cssText?a:l)();return document.createTextNode(t+`{${e}}`);function a(){return`${s.cssText} content: ${r};`}function l(){return n.asArray(s).map(t).join("; ")+";";function t(t){return t+": "+s.getPropertyValue(t)+(s.getPropertyPriority(t)?" !important":"")}}}l.appendChild(c()),t.appendChild(l)}}[":before",":after"].forEach((function(t){o(t)}))}function a(){n.isHTMLTextAreaElement(e)&&(t.innerHTML=e.value),n.isHTMLInputElement(e)&&t.setAttribute("value",e.value)}function l(){n.isSVGElement(t)&&(t.setAttribute("xmlns","http://www.w3.org/2000/svg"),n.isSVGRectElement(t))&&["width","height"].forEach((function(e){const n=t.getAttribute(e);n&&t.style.setProperty(e,n)}))}}(t,e)}))}(t,e,null)})).then(g).then(_).then((function(t){e.bgcolor&&(t.style.backgroundColor=e.bgcolor),e.width&&(t.style.width=e.width+"px"),e.height&&(t.style.height=e.height+"px"),e.style&&Object.keys(e.style).forEach((function(n){t.style[n]=e.style[n]}));let n=null;return"function"==typeof e.onclone&&(n=e.onclone(t)),Promise.resolve(n).then((function(){return t}))})).then((function(t){let i=e.width||n.width(t),o=e.height||n.height(t);return Promise.resolve(t).then((function(t){return t.setAttribute("xmlns","http://www.w3.org/1999/xhtml"),(new XMLSerializer).serializeToString(t)})).then(n.escapeXhtml).then((function(t){var e=(n.isDimensionMissing(i)?' width="100%"':` width="${i}"`)+(n.isDimensionMissing(o)?' height="100%"':` height="${o}"`);return`<svg xmlns="http://www.w3.org/2000/svg"${(n.isDimensionMissing(i)?"":` width="${i}"`)+(n.isDimensionMissing(o)?"":` height="${o}"`)}><foreignObject${e}>${t}</foreignObject></svg>`})).then((function(t){return"data:image/svg+xml;charset=utf-8,"+t}))})).then((function(t){for(;0<o.length;){var e=o.pop();e.parent.replaceChild(e.child,e.wrapper)}return t})).then((function(t){return c.impl.urlCache=[],f&&(document.body.removeChild(f),f=null),y&&clearTimeout(y),y=setTimeout((()=>{y=null,b={}}),2e4),t}))}function m(t,e){return u(t,e=e||{}).then(n.makeImage).then((function(i){var o="number"!=typeof e.scale?1:e.scale,s=function(t,i){let o=e.width||n.width(t),s=e.height||n.height(t);return n.isDimensionMissing(o)&&(o=n.isDimensionMissing(s)?300:2*s),n.isDimensionMissing(s)&&(s=o/2),(t=document.createElement("canvas")).width=o*i,t.height=s*i,e.bgcolor&&((i=t.getContext("2d")).fillStyle=e.bgcolor,i.fillRect(0,0,t.width,t.height)),t}(t,o),r=s.getContext("2d");return r.msImageSmoothingEnabled=!1,r.imageSmoothingEnabled=!1,i&&(r.scale(o,o),r.drawImage(i,0,0)),s}))}let f=null;function g(t){return o.resolveAll().then((function(e){var n;return""!==e&&(n=document.createElement("style"),t.appendChild(n),n.appendChild(document.createTextNode(e))),t}))}function _(t){return r.inlineAll(t).then((function(){return t}))}function v(t,e,i,o,s){const r=c.impl.options.copyDefaultStyles?function(t,e){e=function(t){var e=[];do{if(t.nodeType===d){var n=t.tagName;if(e.push(n),w.includes(n))break}}while(t=t.parentNode);return e}(e);var i=function(e){return("relaxed"!==t.styleCaching?e:e.filter(((t,e,n)=>0===e||e===n.length-1))).join(">")}(e);if(b[i])return b[i];var o=function(){if(f)return f.contentWindow;var t=document.characterSet||"UTF-8",e=(e=document.doctype)?(`<!DOCTYPE ${i(e.name)} ${i(e.publicId)} `+i(e.systemId)).trim()+">":"";return(f=document.createElement("iframe")).id="domtoimage-sandbox-"+n.uid(),f.style.visibility="hidden",f.style.position="fixed",document.body.appendChild(f),function(t,e,n,i){try{return t.contentWindow.document.write(e+`<html><head><meta charset='${n}'><title>${i}</title></head><body></body></html>`),t.contentWindow}catch(t){}var o=document.createElement("meta");o.setAttribute("charset",n);try{var s=document.implementation.createHTMLDocument(i),r=(s.head.appendChild(o),e+s.documentElement.outerHTML);return t.setAttribute("srcdoc",r),t.contentWindow}catch(t){}return t.contentDocument.head.appendChild(o),t.contentDocument.title=i,t.contentWindow}(f,e,t,"domtoimage-sandbox");function i(t){var e;return t?((e=document.createElement("div")).innerText=t,e.innerHTML):""}}();e=function(t,e){let n=t.body;do{var i=e.pop();i=t.createElement(i);n.appendChild(i),n=i}while(0<e.length);return n.textContent="​",n}(o.document,e),o=function(t,e){const i={},o=t.getComputedStyle(e);return n.asArray(o).forEach((function(t){i[t]="width"===t||"height"===t?"auto":o.getPropertyValue(t)})),i}(o,e);return function(t){do{var e=t.parentElement;null!==e&&e.removeChild(t),t=e}while(t&&"BODY"!==t.tagName)}(e),b[i]=o}(t,e):{},a=s.style;n.asArray(i).forEach((function(t){var e,n=i.getPropertyValue(t),s=r[t],l=o?o.getPropertyValue(t):void 0;(n!==s||o&&n!==l)&&(s=i.getPropertyPriority(t),l=a,e=0<=["background-clip"].indexOf(t),s?(l.setProperty(t,n,s),e&&l.setProperty("-webkit-"+t,n,s)):(l.setProperty(t,n),e&&l.setProperty("-webkit-"+t,n)))}))}let y=null,b={};const w=["ADDRESS","ARTICLE","ASIDE","BLOCKQUOTE","DETAILS","DIALOG","DD","DIV","DL","DT","FIELDSET","FIGCAPTION","FIGURE","FOOTER","FORM","H1","H2","H3","H4","H5","H6","HEADER","HGROUP","HR","LI","MAIN","NAV","OL","P","PRE","SECTION","SVG","TABLE","UL","math","svg","BODY","HEAD","HTML"]}(g)}(v);var y=_(v.exports);const b={fontAntiAliasing:"true",fontColor:"0x333333",bgColor:"0xffffff",forceLabels:"on",forceTitles:"on"},w={},x=!0;class C{constructor(t,e){if(this._legendOptions={},this._requestParams={},this._map=e,this._view=e.getView(),this._legendOptions=b,this._requestParams=w,this._order=x,"object"==typeof t){const{legendOptions:e,requestParams:n,order:i}=t;this._legendOptions=Object.assign(Object.assign({},this._legendOptions),e||{}),this._requestParams=Object.assign(Object.assign({},this._requestParams),n||{}),this._order=void 0!==i?i:this._order}}async getImages(t,e,n){const i=[],o=this.getWmsLegendLayers();this._legendOptions=Object.assign(Object.assign({},this._legendOptions),{dpi:t,fontColor:"0x"+e.replace("#",""),bgColor:"0x"+n.replace("#","")});for(const t of o){const e=await this._getLegends(t);e&&i.push(e)}return this._order?this._orderImagesByIndex(i):i}getWmsLegendLayers(){return this._map.getLayers().getArray().filter((t=>(t=>(t instanceof h||t instanceof d)&&(t.getSource()instanceof p||t.getSource()instanceof c))(t)&&t.getVisible()))}getMapProjection(){return this._view.getProjection()}getViewExtent(){return this._view.calculateExtent(this._map.getSize())}async _getLegends(t){return new Promise((e=>{const n=this._getSrcFromParams(t);if(!n)return e(null);n.forEach((n=>{const i=new Image;i.dataset.index=String(t.getZIndex()),i.onerror=()=>{e(null)},i.onload=()=>{i.naturalHeight<=1?e(null):e(i)},i.src=n}))}))}_getSrcFromParams(t){const e=t.getSource().getParams(),n=this.getMapProjection().getCode(),i=Object.assign({fontColor:"0x000000",fontAntiAliasing:!0,bgColor:"0xffffff",forceLabels:"on",forceTitles:"on",fontSize:8},this._legendOptions),o=Object.assign({SERVICE:"WMS",VERSION:"1.1.0",REQUEST:"GetLegendGraphic",FORMAT:"image/png",LEGEND_OPTIONS:Object.entries(i).map((t=>`${t[0]}:${t[1]}`)).join(";"),STYLE:e.STYLES,CQL_FILTER:e.CQL_FILTER,SLD_BODY:e.SLD_BODY,SLD:e.SLD,ENV:e.ENV,SRS:n,SRCWIDTH:this._map.getSize()[0],SRCHEIGHT:this._map.getSize()[1],SCALE:this._getScale()},this._requestParams),s=e.LAYERS,r=Array.isArray(s)?s:s.split(",");return[this._getLegendUrl(t.getSource(),Object.assign(Object.assign({},o),{LAYER:r[0]}))]}_getLegendUrl(t,e){const n="getUrls"in t?t.getUrls()[0]:"getUrl"in t?t.getUrl():void 0;if(n)return a.appendParams(n,e)}_orderImagesByIndex(t){return Array.from(t).sort(((t,e)=>{const n=Number(t.dataset.index),i=Number(e.dataset.index);return n>i?-1:n<i?1:0})).reverse()}_getScale(){return this._view.getResolution()*(this.getMapProjection()?this.getMapProjection().getMetersPerUnit():1)/28e-5}}function L(t,e={},...n){if("function"==typeof t)return t(e,n);const i=null===t?new DocumentFragment:document.createElement(t);Object.entries(e||{}).forEach((([t,e])=>{null!=e&&void 0!==e&&(t.startsWith("on")&&t.toLowerCase()in window?i.addEventListener(t.toLowerCase().substr(2),e):"className"===t?i.setAttribute("class",e.toString()):"htmlFor"===t?i.setAttribute("for",e.toString()):i.setAttribute(t,e.toString()))}));for(const t of n)t&&(Array.isArray(t)?i.append(...t):void 0===t.nodeType?i.innerHTML+=t:i.appendChild(t));return i}class E{constructor(t){this._accumulativeOffsetBottomLeft=0,this.addMapHelpers=async()=>{const{mapElements:t,extraInfo:e,description:n,watermark:i}=this._config;i&&await this._addWatermark(i),n&&this._form.description&&this._addDescription(),e&&this._addExtraInfo(e),t&&(t.compass&&this._form.compass&&await this._addCompass(t.compass),t.scalebar&&this._form.scalebar&&this._addScaleBar(),t.attributions&&this._form.attributions&&this._addAttributions(),t.legends&&this._form.legends&&await this._addLegends()),this._form.safeMargins&&this._fllWhite()},this._processSvgImage=t=>new Promise(((e,n)=>{const i=t=>{const e=(new XMLSerializer).serializeToString(t);return URL.createObjectURL(new Blob([e],{type:"image/svg+xml"}))},o=(t,e)=>{const i=document.createElement("img");document.body.appendChild(i),i.onerror=t=>(console.error(t),n(this._i18n.errorImage)),i.onload=()=>{try{const t=document.createElement("canvas");t.width=i.clientWidth,t.height=i.clientHeight;t.getContext("2d").drawImage(i,0,0);const n=t.toDataURL("image/png").replace("image/png","octet/stream");e(n),document.body.removeChild(i)}catch(t){return n(t)}},i.src=t};((t,e)=>{const n=i(t);o(n,(t=>{e(t),URL.revokeObjectURL(n)}))})(t,(t=>{e(t)}))})),this._calculateOffsetByPosition=(t,e,n=0)=>{let i,o;switch(t){case"topleft":i=e.x+this._printingMargins.left,o=e.y+this._printingMargins.top+n;break;case"topright":i=this._pdf.width-e.x-this._printingMargins.left,o=e.y+this._printingMargins.top+n;break;case"bottomright":i=this._pdf.width-e.x-this._printingMargins.left,o=this._pdf.height-e.y-this._printingMargins.bottom-n;break;case"bottomleft":o=this._pdf.height-e.y-this._printingMargins.bottom-n,i=e.x+this._printingMargins.left}return{x:i,y:o}},this._addRoundedBox=(t,e,n,i,o,s)=>{this._pdf.doc.setDrawColor(s),this._pdf.doc.setFillColor(o),this._pdf.doc.roundedRect(t,e,n,i,1,1,"FD")},this._addText=(t,e,n,i,o="left",s)=>{this._pdf.doc.setTextColor(i),this._pdf.doc.setFontSize(n),this._pdf.doc.text(s,t,e,{align:o})},this._addTextByOffset=(t,e,n,i,o,s,r)=>{const{x:a,y:l}=this._calculateOffsetByPosition(t,e),c="center"===s?a-n/2:a;this._addText(c,l,i,o,s,r)},this._addDescription=()=>{const t=this._form.description.trim(),e={x:-.7,y:this._config.extraInfo&&(this._config.extraInfo.date&&this._form.date||this._config.extraInfo.specs&&this._form.specs)?10:2},{x:n,y:i}=this._calculateOffsetByPosition("topleft",e);this._pdf.doc.setTextColor(this._style.description.txcolor),this._pdf.doc.setFontSize(8);const{w:o,h:s}=this._pdf.doc.getTextDimensions(t,{maxWidth:50,fontSize:8});this._addRoundedBox(n,i,o+4,s+4,this._style.description.bkcolor,this._style.description.brcolor),this._pdf.doc.text(t,n+2,i+4,{align:"left",maxWidth:50})},this._addWatermark=async t=>{const e=async t=>{let e;if("string"==typeof t)e=t;else{if(!(t instanceof SVGElement))throw this._i18n.errorImage;e=await this._processSvgImage(t)}return new Promise(((t,n)=>{const i=new Image;i.onload=()=>{try{t(i)}catch(t){return n(t)}},i.onerror=()=>n(this._i18n.errorImage),i.src=e}))};let n;let i;const o=14/1.8;let s=!1;const{x:r,y:a}=this._calculateOffsetByPosition("topright",{x:2,y:2});let l=0,c=4,d=a+2+1.5,h=a+2,p=0;if(t.logo){n=t.logo instanceof Image?t.logo:await e(t.logo);i=12*(n.width/n.height),p=3,l=i+p,c+=14,t.title&&(d+=4,h+=2),t.subtitle&&(h+=5,d-=2.5)}else t.title&&(c+=5,h+=5),t.subtitle&&(c+=3),t.title&&t.subtitle&&(c+=1);if(t.title){this._pdf.doc.setTextColor(this._style.watermark.txcolortitle),this._pdf.doc.setFontSize(14),this._pdf.doc.setFont("helvetica","bold");let{w:e}=this._pdf.doc.getTextDimensions(t.title);if(t.subtitle){this._pdf.doc.setFontSize(o),this._pdf.doc.setFont("helvetica","normal");const n=this._pdf.doc.getTextDimensions(t.subtitle).w;e=n>e?n:e,this._pdf.doc.setFontSize(14)}const n=e+4;this._addRoundedBox(r-n+2-l,a-4,n+2+l+p,c,this._style.watermark.bkcolor,this._style.watermark.brcolor),s=!0,this._pdf.doc.setFont("helvetica","bold"),this._pdf.doc.text(t.title,r-l,d,{align:"right"})}if(t.subtitle){if(this._pdf.doc.setTextColor(this._style.watermark.txcolorsubtitle),this._pdf.doc.setFontSize(o),this._pdf.doc.setFont("helvetica","normal"),!s){const{w:e}=this._pdf.doc.getTextDimensions(t.subtitle),n=4+e;this._addRoundedBox(r-n+2-l,a-4,n+2+l,c,this._style.watermark.bkcolor,this._style.watermark.brcolor),s=!0}this._pdf.doc.text(t.subtitle,r-l,h,{align:"right"})}if(t.logo){if(!s){const t=l+2;this._addRoundedBox(r,a-4,t,16,this._style.watermark.bkcolor,this._style.watermark.brcolor)}this._pdf.doc.addImage(n,"PNG",r-i,a,i,12)}},this._addExtraInfo=t=>{t.url&&this._form.url&&this._addUrl(),(t.specs&&this._form.specs||t.date&&this._form.date)&&this._addSpecsAndDate()},this._addSpecsAndDate=()=>{const t="topleft",e={x:1,y:2.5},n=this._style.specs.txcolor,{x:i,y:o}=this._calculateOffsetByPosition(t,e);this._pdf.doc.setFont("helvetica","bold"),this._pdf.doc.setFontSize(6);let s="";if(this._form.specs&&this._config.extraInfo&&this._config.extraInfo.specs){const t=`${this._i18n.scale} 1:${this._scaleDenominator.toLocaleString("de")}`,e=`${this._i18n.paper} ${this._form.format.toUpperCase()}`;s=[t,`${this._form.resolution} DPI`,e].join(" - ")}if(this._form.date&&this._config.extraInfo&&this._config.extraInfo.date){const t=this._getDate();s?s+=` (${t})`:s=t}const{w:r,h:a}=this._pdf.doc.getTextDimensions(s,{fontSize:6});this._addRoundedBox(i-4,o-a-4,r+6,a+6,this._style.specs.bkcolor,this._style.specs.brcolor),this._addTextByOffset(t,e,r,6,n,"left",s)},this._addUrl=()=>{const t="bottomleft",e={x:1,y:1},n=this._style.url.txcolor;this._pdf.doc.setFont("helvetica","italic");const i=window.location.href,{x:o,y:s}=this._calculateOffsetByPosition(t,e),{w:r,h:a}=this._pdf.doc.getTextDimensions(i,{fontSize:6});this._addRoundedBox(o-4,s-a-1,r+6,a+6,this._style.url.bkcolor,this._style.url.brcolor),this._addTextByOffset(t,e,250,6,n,"left",i),this._accumulativeOffsetBottomLeft=e.y+a+1},this._getDate=()=>String(new Date(Date.now()).toLocaleDateString(this._config.dateFormat)),this._addAttributions=()=>{const t=this._map.getLayers().getArray().flatMap((t=>{if("getSource"in t&&"function"==typeof t.getSource){const e=t.getSource().getAttributions();if(e){if("function"==typeof e)try{return e(null)}catch(t){console.error(t)}return e}}return[]}));if(!t.length)return;const e=[...new Set(t)].map((t=>L("span",null,t))),n=" · ";this._pdf.doc.setFont("helvetica","normal"),this._pdf.doc.setFontSize(7);const{x:i,y:o}=this._calculateOffsetByPosition("bottomright",{x:1,y:1});let s=i;const r=e.map((t=>t.textContent)).join(n),{w:a,h:l}=this._pdf.doc.getTextDimensions(r,{fontSize:7}),c=this._pdf.doc.getTextDimensions(n,{fontSize:7}).w;this._addRoundedBox(i-a-2,o-l,a+4+2,l+4,this._style.attributions.bkcolor,this._style.attributions.brcolor),Array.from(e).reverse().forEach(((t,i)=>{Array.from(t.childNodes).reverse().forEach((t=>{const e=t.textContent;"href"in t?(this._pdf.doc.setTextColor(this._style.attributions.txcolorlink),this._pdf.doc.textWithLink(e,s,o,{align:"right",url:t.href})):(this._pdf.doc.setTextColor(this._style.attributions.txcolor),this._pdf.doc.text(e,s,o,{align:"right"}));const{w:n}=this._pdf.doc.getTextDimensions(e);s-=n})),i!==e.length-1&&(this._pdf.doc.text(n,s,o,{align:"right"}),s-=c)}))},this._addScaleBar=()=>{const t=-.7,e=this._config.extraInfo&&(this._form.url&&this._config.extraInfo.url||this._form.specs&&this._config.extraInfo.specs)?this._accumulativeOffsetBottomLeft+2:2,n=Math.log10||function(t){return Math.log(t)*Math.LOG10E};let i,o,s=90*this._scaleDenominator;if("metric"===this._config.units){i="mm";const t=1e3;o=1,s>=10*(1e3*t)?(i="km",o=1e6):s>=10*t&&(i="m",o=t)}else if("imperial"===this._config.units){const t=25.4,e=63360*t,n=36*t;i="in",o=t,s>=10*e?(i="mi",o=e):s>=10*n&&(i="yd",o=n)}s/=o;const r=s,a=Math.floor(n(r)),l=Math.pow(10,a),c=r/l;let d=Math.floor(s);d=c>8?8*l:c>4?4*l:c>2?2*l:l;let h=d*o/this._scaleDenominator/4;const p=this._style.paperMargin?(this._printingMargins.left+this._printingMargins.right)/this._pdf.width*100:null;h=p?h/100*(100-p):h;const u=4*h,m=t+this._printingMargins.left;let f=e+this._printingMargins.top;f=this._pdf.height-e-10-this._printingMargins.bottom;const g=m+4,_=f+5,v=u+8;this._addRoundedBox(m,f,v,10,this._style.scalebar.bkcolor,this._style.scalebar.brcolor),this._pdf.doc.setDrawColor(this._style.scalebar.txcolor),this._pdf.doc.setFillColor(this._style.scalebar.txcolor),this._pdf.doc.rect(g,_,h,1,"FD"),this._pdf.doc.setDrawColor(this._style.scalebar.txcolor),this._pdf.doc.setFillColor(this._style.scalebar.bkcolor),this._pdf.doc.rect(g+h,_,h,1,"FD"),this._pdf.doc.setDrawColor(this._style.scalebar.txcolor),this._pdf.doc.setFillColor(this._style.scalebar.txcolor),this._pdf.doc.rect(g+2*h,_,2*h,1,"FD"),this._pdf.doc.setTextColor(this._style.scalebar.txcolor),this._pdf.doc.setFontSize(6),this._pdf.doc.text("0",g,_-1),this._pdf.doc.text(String(Math.round(10*d/4)/10),g+h-1,_-1),this._pdf.doc.text(String(Math.round(d/2)),g+2*h-2,_-1),this._pdf.doc.text(Math.round(d).toString()+" "+i,g+4*h-4,_-1),this._accumulativeOffsetBottomLeft=e+10},this._addCompass=async t=>{const e=this._view.getRotation(),n=100,{x:i,y:o}=this._calculateOffsetByPosition("bottomright",{x:2,y:6},6),s=t=>{const s=document.createElement("canvas");s.height=120,s.width=120;const r=s.getContext("2d");r.translate(.5*s.width,.5*s.height),r.rotate(e),r.translate(.5*-s.width,.5*-s.height),r.drawImage(t,(s.height-n)/2,(s.width-n)/2,n,n);const a=i-6,l=o;return this._pdf.doc.setDrawColor(this._style.compass.brcolor),this._pdf.doc.setFillColor(this._style.compass.bkcolor),this._pdf.doc.circle(a,l,6,"FD"),s},r=t=>{const e=s(t),n=i-9-6/4.3,r=o-4.5;this._pdf.doc.addImage(e,"PNG",n,r,9,9)};if(!(t instanceof Image)){let e;if("string"==typeof t)e=t;else{if(!(t instanceof SVGElement))throw this._i18n.errorImage;e=await this._processSvgImage(t)}return new Promise(((t,i)=>{const o=new Image(n,n);o.onload=()=>{r(o),t()},o.onerror=()=>{i(this._i18n.errorImage)},o.src=e}))}r(undefined)};const{map:e,form:n,i18n:i,config:o,height:s,width:r,scaleResolution:a}=t;this._map=e,this._view=e.getView(),this._form=n,this._i18n=i,this._config=o,this._style=o.style,this._form.safeMargins?this._printingMargins="number"==typeof o.style.paperMargin?{top:o.style.paperMargin,left:o.style.paperMargin,right:o.style.paperMargin,bottom:o.style.paperMargin}:o.style.paperMargin:this._printingMargins={top:0,left:0,right:0,bottom:0},this._pdf=this.create(this._form.orientation,this._form.format,s,r),this._scaleDenominator=this._calculateScaleDenominator(this._form.resolution,a),o.mapElements&&o.mapElements.legends&&(this._legends=new C(o.mapElements.legends,e))}create(t,e,n,i){var o;return{doc:new((null===(o=window.jspdf)||void 0===o?void 0:o.jsPDF)||s.jsPDF)({orientation:t,format:e}),height:n,width:i}}addMapImage(t){this._pdf.doc.addImage(t,"JPEG",this._printingMargins.left,this._printingMargins.top,this._pdf.width-(this._printingMargins.left+this._printingMargins.right),this._pdf.height-(this._printingMargins.top+this._printingMargins.bottom))}savePdf(){return new Promise(((t,e)=>{var n;if("pdf"===this._form.typeExport)this._pdf.doc.save(this._config.filename+".pdf"),t();else{const i=this._pdf.doc.output("dataurlstring"),o=(null===(n=null===window||void 0===window?void 0:window.pdfjsLib)||void 0===n?void 0:n.version)||r.version;r.GlobalWorkerOptions.workerSrc=`https://cdnjs.cloudflare.com/ajax/libs/pdf.js/${o}/pdf.worker.js`,r.getDocument(i).promise.then((e=>{e.getPage(1).then((e=>{const n=this._form.resolution/100*1.39,i=e.getViewport({scale:n}),o=L("canvas",null);o.style.display="none",document.body.appendChild(o);const s=o.getContext("2d");o.height=i.height,o.width=i.width;e.render({canvasContext:s,viewport:i}).promise.then((()=>{((t,e)=>{const n=L("a",{download:e,href:t});document.body.appendChild(n),n.click(),document.body.removeChild(n)})(o.toDataURL(`image/${this._form.typeExport}`),this._config.filename+`.${this._form.typeExport}`),o.remove(),t()}))}))}),(t=>{e(t),console.log(t)}))}}))}_fllWhite(){this._pdf.doc.setFillColor("#ffffff"),this._pdf.doc.rect(0,0,this._printingMargins.left,this._pdf.height,"F"),this._pdf.doc.rect(this._pdf.width-this._printingMargins.right,0,this._printingMargins.right,this._pdf.height,"F"),this._pdf.doc.rect(0,0,this._pdf.width,this._printingMargins.top,"F"),this._pdf.doc.rect(0,this._pdf.height-this._printingMargins.bottom,this._pdf.width,this._printingMargins.bottom,"F")}_calculateScaleDenominator(t,e){const n=t/25.4;return Math.round(1e3*n*this._getMeterPerPixel(e))}_getMeterPerPixel(t){const n=this._view.getProjection();return e.getPointResolution(n,t,this._view.getCenter())*n.getMetersPerUnit()}async _addLegends(){const t={x:1,y:this._accumulativeOffsetBottomLeft+3},{x:e,y:n}=this._calculateOffsetByPosition("bottomleft",t);let i=n;const o=await this._legends.getImages(1.5*this._form.resolution,this._style.legends.txcolor,this._style.legends.bkcolor);if(!o.length)return;const s=1/(this._form.resolution/15),r=Math.max(...o.map((t=>t.naturalWidth)))*s,a=o.reduce(((t,e)=>t+e.naturalHeight*s),0);this._addRoundedBox(e-3,n-a-1,r+6,a+2,this._style.legends.bkcolor,this._style.legends.brcolor),o.forEach((t=>{const{naturalWidth:n,naturalHeight:o}=t,r=n*s,a=o*s;this._pdf.doc.addImage(t,e,i-a,r,a),i-=a}))}}function M(){}function S(){S.init.call(this)}function T(t){return void 0===t._maxListeners?S.defaultMaxListeners:t._maxListeners}function P(t,e,n,i){var o,s,r,a;if("function"!=typeof n)throw new TypeError('"listener" argument must be a function');if((s=t._events)?(s.newListener&&(t.emit("newListener",e,n.listener?n.listener:n),s=t._events),r=s[e]):(s=t._events=new M,t._eventsCount=0),r){if("function"==typeof r?r=s[e]=i?[n,r]:[r,n]:i?r.unshift(n):r.push(n),!r.warned&&(o=T(t))&&o>0&&r.length>o){r.warned=!0;var l=new Error("Possible EventEmitter memory leak detected. "+r.length+" "+e+" listeners added. Use emitter.setMaxListeners() to increase limit");l.name="MaxListenersExceededWarning",l.emitter=t,l.type=e,l.count=r.length,a=l,"function"==typeof console.warn?console.warn(a):console.log(a)}}else r=s[e]=n,++t._eventsCount;return t}function O(t,e,n){var i=!1;function o(){t.removeListener(e,o),i||(i=!0,n.apply(t,arguments))}return o.listener=n,o}function k(t){var e=this._events;if(e){var n=e[t];if("function"==typeof n)return 1;if(n)return n.length}return 0}function I(t,e){for(var n=new Array(e);e--;)n[e]=t[e];return n}M.prototype=Object.create(null),S.EventEmitter=S,S.usingDomains=!1,S.prototype.domain=void 0,S.prototype._events=void 0,S.prototype._maxListeners=void 0,S.defaultMaxListeners=10,S.init=function(){this.domain=null,S.usingDomains&&undefined.active,this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=new M,this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},S.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||isNaN(t))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=t,this},S.prototype.getMaxListeners=function(){return T(this)},S.prototype.emit=function(t){var e,n,i,o,s,r,a,l="error"===t;if(r=this._events)l=l&&null==r.error;else if(!l)return!1;if(a=this.domain,l){if(e=arguments[1],!a){if(e instanceof Error)throw e;var c=new Error('Uncaught, unspecified "error" event. ('+e+")");throw c.context=e,c}return e||(e=new Error('Uncaught, unspecified "error" event')),e.domainEmitter=this,e.domain=a,e.domainThrown=!1,a.emit("error",e),!1}if(!(n=r[t]))return!1;var d="function"==typeof n;switch(i=arguments.length){case 1:!function(t,e,n){if(e)t.call(n);else for(var i=t.length,o=I(t,i),s=0;s<i;++s)o[s].call(n)}(n,d,this);break;case 2:!function(t,e,n,i){if(e)t.call(n,i);else for(var o=t.length,s=I(t,o),r=0;r<o;++r)s[r].call(n,i)}(n,d,this,arguments[1]);break;case 3:!function(t,e,n,i,o){if(e)t.call(n,i,o);else for(var s=t.length,r=I(t,s),a=0;a<s;++a)r[a].call(n,i,o)}(n,d,this,arguments[1],arguments[2]);break;case 4:!function(t,e,n,i,o,s){if(e)t.call(n,i,o,s);else for(var r=t.length,a=I(t,r),l=0;l<r;++l)a[l].call(n,i,o,s)}(n,d,this,arguments[1],arguments[2],arguments[3]);break;default:for(o=new Array(i-1),s=1;s<i;s++)o[s-1]=arguments[s];!function(t,e,n,i){if(e)t.apply(n,i);else for(var o=t.length,s=I(t,o),r=0;r<o;++r)s[r].apply(n,i)}(n,d,this,o)}return!0},S.prototype.addListener=function(t,e){return P(this,t,e,!1)},S.prototype.on=S.prototype.addListener,S.prototype.prependListener=function(t,e){return P(this,t,e,!0)},S.prototype.once=function(t,e){if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');return this.on(t,O(this,t,e)),this},S.prototype.prependOnceListener=function(t,e){if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');return this.prependListener(t,O(this,t,e)),this},S.prototype.removeListener=function(t,e){var n,i,o,s,r;if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');if(!(i=this._events))return this;if(!(n=i[t]))return this;if(n===e||n.listener&&n.listener===e)0==--this._eventsCount?this._events=new M:(delete i[t],i.removeListener&&this.emit("removeListener",t,n.listener||e));else if("function"!=typeof n){for(o=-1,s=n.length;s-- >0;)if(n[s]===e||n[s].listener&&n[s].listener===e){r=n[s].listener,o=s;break}if(o<0)return this;if(1===n.length){if(n[0]=void 0,0==--this._eventsCount)return this._events=new M,this;delete i[t]}else!function(t,e){for(var n=e,i=n+1,o=t.length;i<o;n+=1,i+=1)t[n]=t[i];t.pop()}(n,o);i.removeListener&&this.emit("removeListener",t,r||e)}return this},S.prototype.off=function(t,e){return this.removeListener(t,e)},S.prototype.removeAllListeners=function(t){var e,n;if(!(n=this._events))return this;if(!n.removeListener)return 0===arguments.length?(this._events=new M,this._eventsCount=0):n[t]&&(0==--this._eventsCount?this._events=new M:delete n[t]),this;if(0===arguments.length){for(var i,o=Object.keys(n),s=0;s<o.length;++s)"removeListener"!==(i=o[s])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=new M,this._eventsCount=0,this}if("function"==typeof(e=n[t]))this.removeListener(t,e);else if(e)do{this.removeListener(t,e[e.length-1])}while(e[0]);return this},S.prototype.listeners=function(t){var e,n=this._events;return n&&(e=n[t])?"function"==typeof e?[e.listener||e]:function(t){for(var e=new Array(t.length),n=0;n<e.length;++n)e[n]=t[n].listener||t[n];return e}(e):[]},S.listenerCount=function(t,e){return"function"==typeof t.listenerCount?t.listenerCount(e):k.call(t,e)},S.prototype.listenerCount=k,S.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};let D=null;const R=Object.freeze({el:null,animate:!0,animateClass:"fade",animateInClass:"show",appendTo:"body",backdrop:!0,keyboard:!0,title:!1,header:!0,content:!1,footer:!0,buttons:null,headerClose:!0,construct:!1,transition:300,backdropTransition:150}),j=function t(e){for(let n in e)Array.isArray(e[n])?e[n].forEach((e=>{t(e)})):null!==e[n]&&"object"==typeof e[n]&&Object.freeze(e[n]);return Object.freeze(e)}({dialog:[{text:"Cancel",value:!1,attr:{class:"btn btn-default","data-dismiss":"modal"}},{text:"OK",value:!0,attr:{class:"btn btn-primary","data-dismiss":"modal"}}],alert:[{text:"OK",attr:{class:"btn btn-primary","data-dismiss":"modal"}}],confirm:[{text:"Cancel",value:!1,attr:{class:"btn btn-default","data-dismiss":"modal"}},{text:"OK",value:!0,attr:{class:"btn btn-primary","data-dismiss":"modal"}}]}),A={container:'<div class="modal"></div>',dialog:'<div class="modal-dialog"></div>',content:'<div class="modal-content"></div>',header:'<div class="modal-header"></div>',headerClose:'<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>',body:'<div class="modal-body"></div>',footer:'<div class="modal-footer"></div>',backdrop:'<div class="modal-backdrop"></div>'};function F(t,e,n){let i="data",o=t[i]||{};if(void 0===n){if(t[i]&&t[i][e])return t[i][e];var s=t.getAttribute(`${i}-${e}`);return void 0!==s?s:null}return o[e]=n,t[i]=o,t}function H(t,e){return t.nodeName?t:(t=t.replace(/(\t|\n$)/g,""),D||(D=document.createElement("div")),D.innerHTML="",D.innerHTML=t,!0===e?D.childNodes:D.childNodes[0])}function z(t){let e=[t];for(;t.parentNode;)t=t.parentNode,e.push(t);return e}class N extends S{static set templates(t){this._baseTemplates=t}static get templates(){return Object.assign({},A,N._baseTemplates||{})}static set buttons(t){this._baseButtons=t}static get buttons(){return Object.assign({},j,N._baseButtons||{})}static set options(t){this._baseOptions=t}static get options(){return Object.assign({},R,N._baseOptions||{})}static get version(){return"0.12.0"}static alert(t,e={}){let n=Object.assign({},R,{title:t,content:!1,construct:!0,headerClose:!1,buttons:N.buttons.alert},e);return new N(n)}static confirm(t,e={}){let n=Object.assign({},R,{title:t,content:!1,construct:!0,headerClose:!1,buttons:N.buttons.confirm},e);return new N(n)}constructor(t={}){if(super(),this.id=(65536*(1+Math.random())|0).toString(16)+(65536*(1+Math.random())|0).toString(16),this.el=null,this._html={},this._events={},this._visible=!1,this._pointerInContent=!1,this._options=Object.assign({},N.options,t),this._templates=Object.assign({},N.templates,t.templates||{}),this._html.appendTo=document.querySelector(this._options.appendTo),this._scrollbarWidth=function(){let t,e,n,i=document.createElement("div");return Object.assign(i.style,{visibility:"hidden",width:"100px"}),document.body.appendChild(i),n=i.offsetWidth,i.style.overflow="scroll",t=document.createElement("div"),t.style.width="100%",i.appendChild(t),e=n-t.offsetWidth,document.body.removeChild(i),e}(),null===this._options.buttons&&(this._options.buttons=N.buttons.dialog),this._options.el){let t=this._options.el;if("string"==typeof this._options.el&&(t=document.querySelector(this._options.el),!t))throw new Error(`Selector: DOM Element ${this._options.el} not found.`);F(t,"modal",this),this.el=t}else this._options.construct=!0;this._options.construct?this._render():this._mapDom()}_render(){let t=this._html,e=this._options,n=this._templates,i=!!e.animate&&e.animateClass;return t.container=H(n.container),t.dialog=H(n.dialog),t.content=H(n.content),t.header=H(n.header),t.headerClose=H(n.headerClose),t.body=H(n.body),t.footer=H(n.footer),i&&t.container.classList.add(i),this._setHeader(),this._setContent(),this._setFooter(),this.el=t.container,t.dialog.appendChild(t.content),t.container.appendChild(t.dialog),this}_mapDom(){let t=this._html,e=this._options;return this.el.classList.contains(e.animateClass)&&(e.animate=!0),t.container=this.el,t.dialog=this.el.querySelector(".modal-dialog"),t.content=this.el.querySelector(".modal-content"),t.header=this.el.querySelector(".modal-header"),t.headerClose=this.el.querySelector(".modal-header .close"),t.body=this.el.querySelector(".modal-body"),t.footer=this.el.querySelector(".modal-footer"),this._setHeader(),this._setContent(),this._setFooter(),this}_setHeader(){let t=this._html,e=this._options;e.header&&t.header&&(e.title.nodeName?t.header.innerHTML=e.title.outerHTML:"string"==typeof e.title&&(t.header.innerHTML=`<h4 class="modal-title">${e.title}</h4>`),null===this.el&&t.headerClose&&e.headerClose&&t.header.appendChild(t.headerClose),e.construct&&t.content.appendChild(t.header))}_setContent(){let t=this._html,e=this._options;e.content&&t.body&&("string"==typeof e.content?t.body.innerHTML=e.content:t.body.innerHTML=e.content.outerHTML,e.construct&&t.content.appendChild(t.body))}_setFooter(){let t=this._html,e=this._options;e.footer&&t.footer&&(e.footer.nodeName?t.footer.ineerHTML=e.footer.outerHTML:"string"==typeof e.footer?t.footer.innerHTML=e.footer:t.footer.children.length||e.buttons.forEach((e=>{let n=document.createElement("button");F(n,"button",e),n.innerHTML=e.text,n.setAttribute("type","button");for(let t in e.attr)n.setAttribute(t,e.attr[t]);t.footer.appendChild(n)})),e.construct&&t.content.appendChild(t.footer))}_setEvents(){this._options;let t=this._html;this._events.keydownHandler=this._handleKeydownEvent.bind(this),document.body.addEventListener("keydown",this._events.keydownHandler),this._events.mousedownHandler=this._handleMousedownEvent.bind(this),t.container.addEventListener("mousedown",this._events.mousedownHandler),this._events.clickHandler=this._handleClickEvent.bind(this),t.container.addEventListener("click",this._events.clickHandler),this._events.resizeHandler=this._handleResizeEvent.bind(this),window.addEventListener("resize",this._events.resizeHandler)}_handleMousedownEvent(t){this._pointerInContent=!1,z(t.target).every((t=>!t.classList||!t.classList.contains("modal-content")||(this._pointerInContent=!0,!1)))}_handleClickEvent(t){z(t.target).every((e=>"HTML"!==e.tagName&&((!0===this._options.backdrop||!e.classList.contains("modal"))&&(!e.classList.contains("modal-content")&&("modal"===e.getAttribute("data-dismiss")?(this.emit("dismiss",this,t,F(t.target,"button")),this.hide(),!1):!(!this._pointerInContent&&e.classList.contains("modal"))||(this.emit("dismiss",this,t,null),this.hide(),!1)))))),this._pointerInContent=!1}_handleKeydownEvent(t){27===t.which&&this._options.keyboard&&(this.emit("dismiss",this,t,null),this.hide())}_handleResizeEvent(t){this._resize()}show(){let t=this._options,e=this._html;return this.emit("show",this),this._checkScrollbar(),this._setScrollbar(),document.body.classList.add("modal-open"),t.construct&&e.appendTo.appendChild(e.container),e.container.style.display="block",e.container.scrollTop=0,!1!==t.backdrop?(this.once("showBackdrop",(()=>{this._setEvents(),t.animate&&e.container.offsetWidth,e.container.classList.add(t.animateInClass),setTimeout((()=>{this._visible=!0,this.emit("shown",this)}),t.transition)})),this._backdrop()):(this._setEvents(),t.animate&&e.container.offsetWidth,e.container.classList.add(t.animateInClass),setTimeout((()=>{this._visible=!0,this.emit("shown",this)}),t.transition)),this._resize(),this}toggle(){this._visible?this.hide():this.show()}_resize(){var t=this._html.container.scrollHeight>document.documentElement.clientHeight;this._html.container.style.paddingLeft=!this.bodyIsOverflowing&&t?this._scrollbarWidth+"px":"",this._html.container.style.paddingRight=this.bodyIsOverflowing&&!t?this._scrollbarWidth+"px":""}_backdrop(){let t=this._html,e=this._templates,n=this._options,i=!!n.animate&&n.animateClass;t.backdrop=H(e.backdrop),i&&t.backdrop.classList.add(i),t.appendTo.appendChild(t.backdrop),i&&t.backdrop.offsetWidth,t.backdrop.classList.add(n.animateInClass),setTimeout((()=>{this.emit("showBackdrop",this)}),this._options.backdropTransition)}hide(){let t=this._html,e=this._options,n=t.container.classList;if(this.emit("hide",this),n.remove(e.animateInClass),e.backdrop){t.backdrop.classList.remove(e.animateInClass)}return this._removeEvents(),setTimeout((()=>{document.body.classList.remove("modal-open"),document.body.style.paddingRight=this.originalBodyPad}),e.backdropTransition),setTimeout((()=>{e.backdrop&&t.backdrop.parentNode.removeChild(t.backdrop),t.container.style.display="none",e.construct&&t.container.parentNode.removeChild(t.container),this._visible=!1,this.emit("hidden",this)}),e.transition),this}_removeEvents(){this._events.keydownHandler&&document.body.removeEventListener("keydown",this._events.keydownHandler),this._html.container.removeEventListener("mousedown",this._events.mousedownHandler),this._html.container.removeEventListener("click",this._events.clickHandler),window.removeEventListener("resize",this._events.resizeHandler)}_checkScrollbar(){this.bodyIsOverflowing=document.body.clientWidth<window.innerWidth}_setScrollbar(){if(this.originalBodyPad=document.body.style.paddingRight||"",this.bodyIsOverflowing){let t=parseInt(this.originalBodyPad||0,10);document.body.style.paddingRight=t+this._scrollbarWidth+"px"}}}const B="printMode",V="hideControls";const U="opp-overlay-frame",$=U+"-rectangle",W=U+"-controls",q=U+"-zoom-enabled",G=U+"-cancel-btn",K=U+"-save-btn",Y=U+"-reframe-hint";class J{constructor(t,e,n){this._removeEvents=()=>{document.removeEventListener("keydown",this._escapeKeyListener)},this._map=t,this._view=this._map.getView(),this._saveButton=L("button",{type:"button",className:`btn btn-lg btn-primary ${K}`},e.process),this._cancelButton=L("button",{type:"button",className:`btn-close btn-close-white ${G}`,onclick:()=>this.hideOverlay(),title:e.escapeHint},L("span",{"aria-hidden":"true"},"×")),this._controlButtons=L("div",{className:W}),n.zoomControlOnReframe&&this._controlButtons.append(L("div",{className:"opp-zoom ol-control ol-unselectable"},L("button",{type:"button",className:"opp-zoom-in",onClick:()=>this._zoom("in"),title:e.zoomIn},(new DOMParser).parseFromString('<svg version="1.1" xmlns="http://www.w3.org/2000/svg" width="352" height="448" viewBox="0 0 352 448">\r\n<path d="M352 184v48c0 13.25-10.75 24-24 24h-104v104c0 13.25-10.75 24-24 24h-48c-13.25 0-24-10.75-24-24v-104h-104c-13.25 0-24-10.75-24-24v-48c0-13.25 10.75-24 24-24h104v-104c0-13.25 10.75-24 24-24h48c13.25 0 24 10.75 24 24v104h104c13.25 0 24 10.75 24 24z"></path>\r\n</svg>\r\n',"image/svg+xml").firstChild),L("button",{type:"button",className:"opp-zoom-out",onClick:()=>this._zoom("out"),title:e.zoomOut},(new DOMParser).parseFromString('<svg version="1.1" xmlns="http://www.w3.org/2000/svg" width="352" height="448" viewBox="0 0 352 448">\r\n<path d="M352 184v48c0 13.25-10.75 24-24 24h-304c-13.25 0-24-10.75-24-24v-48c0-13.25 10.75-24 24-24h304c13.25 0 24 10.75 24 24z"></path>\r\n</svg>\r\n',"image/svg+xml").firstChild))),n.rotationControlOnReframe&&this._controlButtons.append(L("div",{className:"opp-rotation ol-control ol-unselectable"},L("button",{type:"button",className:"opp-rotation-left",onClick:()=>this._rotate("left"),title:e.rotateLeft},(new DOMParser).parseFromString('<svg version="1.1" xmlns="http://www.w3.org/2000/svg" width="384" height="448" viewBox="0 0 384 448">\r\n<path d="M384 224c0 105.75-86.25 192-192 192-57.25 0-111.25-25.25-147.75-69.25-2.5-3.25-2.25-8 0.5-10.75l34.25-34.5c1.75-1.5 4-2.25 6.25-2.25 2.25 0.25 4.5 1.25 5.75 3 24.5 31.75 61.25 49.75 101 49.75 70.5 0 128-57.5 128-128s-57.5-128-128-128c-32.75 0-63.75 12.5-87 34.25l34.25 34.5c4.75 4.5 6 11.5 3.5 17.25-2.5 6-8.25 10-14.75 10h-112c-8.75 0-16-7.25-16-16v-112c0-6.5 4-12.25 10-14.75 5.75-2.5 12.75-1.25 17.25 3.5l32.5 32.25c35.25-33.25 83-53 132.25-53 105.75 0 192 86.25 192 192z"></path>\r\n</svg>\r\n',"image/svg+xml").firstChild),L("button",{type:"button",className:"opp-rotation-right",onClick:()=>this._rotate("right"),title:e.rotateRight},(new DOMParser).parseFromString('<svg version="1.1" xmlns="http://www.w3.org/2000/svg" width="384" height="448" viewBox="0 0 384 448">\r\n<path d="M384 64v112c0 8.75-7.25 16-16 16h-112c-6.5 0-12.25-4-14.75-10-2.5-5.75-1.25-12.75 3.5-17.25l34.5-34.5c-23.5-21.75-54.5-34.25-87.25-34.25-70.5 0-128 57.5-128 128s57.5 128 128 128c39.75 0 76.5-18 101-49.75 1.25-1.75 3.5-2.75 5.75-3 2.25 0 4.5 0.75 6.25 2.25l34.25 34.5c3 2.75 3 7.5 0.5 10.75-36.5 44-90.5 69.25-147.75 69.25-105.75 0-192-86.25-192-192s86.25-192 192-192c49.25 0 97 19.75 132.25 53l32.5-32.25c4.5-4.75 11.5-6 17.5-3.5 5.75 2.5 9.75 8.25 9.75 14.75z"></path>\r\n</svg>\r\n',"image/svg+xml").firstChild))),this._rectangle=L("div",{className:`${$} ${n.zoomControlOnReframe?q:""}`},this._cancelButton,L("div",null,L("div",null,this._saveButton),L("div",{className:Y},e.reframeHint)),(n.zoomControlOnReframe||n.rotationControlOnReframe)&&this._controlButtons)}showOverlay(t,e){this._map.getTargetElement().classList.add(V),this._overlay=new m({className:`${U} ${t}-mode`,element:this._rectangle,stopEvent:!1}),this._map.addOverlay(this._overlay),this._addEvents(),this._saveButton.onclick=()=>{e(this._getExtent()),setTimeout((()=>{this.hideOverlay()}),10)}}hideOverlay(){this._overlay&&this._map.removeOverlay(this._overlay),this._removeEvents(),this._map.getTargetElement().classList.remove(V)}_zoom(t,e=.5){const n=.261799*e,i="in"===t?"":"-";this._view.adjustZoom(Number(i+n))}_rotate(t,e=.5){const n=.261799*e,i="right"===t?"":"-";this._view.adjustRotation(Number(i+n))}_getExtent(){const t=this._rectangle.getBoundingClientRect(),e=this._map.getCoordinateFromPixel([t.left,t.top]),n=this._map.getCoordinateFromPixel([t.left+t.width,t.top]),i=this._map.getCoordinateFromPixel([t.left,t.top+t.height]),o=this._map.getCoordinateFromPixel([t.left+t.width,t.top+t.height]);return new u([[e,n,o,i]])}_addEvents(){this._escapeKeyListener=(({key:t})=>{"Escape"===t&&this.hideOverlay()}).bind(this),document.addEventListener("keydown",this._escapeKeyListener)}}class X{constructor(t,e,n,i){this._modal=new N(Object.assign({headerClose:!0,header:!0,animate:!0,title:n.printPdf,content:this.Content(n,e),footer:this.Footer(n,e)},e.modal)),e.allowReframeRegionOfInterest&&(this._reframeROI=new J(t,n,e)),this._modal.el.classList.add("settingsModal"),this._modal.on("dismiss",((t,n)=>{if(!n.target.dataset.print)return;const o=document.getElementById("printMap"),s=new FormData(o),r={format:s.get("printFormat"),orientation:s.get("printOrientation"),resolution:Number(s.get("printResolution")),description:s.get("printDescription"),compass:s.get("printCompass"),attributions:s.get("printAttributions"),scalebar:s.get("printScalebar"),legends:s.get("printLegends"),url:s.get("printUrl"),date:s.get("printDate"),specs:s.get("printSpecs"),safeMargins:s.get("safeMargins"),typeExport:this._modal.el.querySelector('select[name="printTypeExport"]').value};if(this._reframeROI){const t=t=>{i(Object.assign({regionOfInterest:t},r),!0,e.modal.transition)};this._reframeROI.showOverlay(r.orientation,t)}else i(r,!0,e.modal.transition)}))}Content(t,e){const{dpi:n,mapElements:i,extraInfo:o,description:s,paperSizes:r}=e;return L("form",{id:"printMap"},L("section",null,L("div",{className:"printFields-container"},L("div",{className:"printField"},L("label",{htmlFor:"printFormat"},t.paperSize),L("select",{name:"printFormat",id:"printFormat"},r.map((t=>L("option",Object.assign({value:t.value},t.selected?{selected:"selected"}:{}),t.value))))),L("div",{className:"printField"},L("label",{htmlFor:"printOrientation"},t.orientation),L("select",{name:"printOrientation",id:"printOrientation"},L("option",{value:"landscape",selected:!0},t.landscape),L("option",{value:"portrait"},t.portrait))),L("div",{className:"printField"},L("label",{htmlFor:"printResolution"},t.resolution),L("select",{name:"printResolution",id:"printResolution"},n.map((t=>L("option",Object.assign({value:t.value},t.selected?{selected:"selected"}:{}),t.value," dpi")))))),L("div",null,s&&L("div",null,L("label",{htmlFor:"printDescription"},t.addNote),L("textarea",{id:"printDescription",name:"printDescription",rows:"4"})))),i&&L("fieldset",{className:"sectionChecks mapElements"},L("legend",null,t.mapElements),L("div",{className:"sectionChecksList"},i.compass&&L("label",{htmlFor:"printCompass"},L("input",{type:"checkbox",id:"printCompass",name:"printCompass",checked:!0}),L("span",null,t.compass)),i.scalebar&&L("label",{htmlFor:"printScalebar"},L("input",{type:"checkbox",id:"printScalebar",name:"printScalebar",checked:!0}),L("span",null,t.scale)),i.legends&&L("label",{htmlFor:"printLegends"},L("input",{type:"checkbox",id:"printLegends",name:"printLegends",checked:!0}),L("span",null,t.legends)),i.attributions&&L("label",{htmlFor:"printAttributions"},L("input",{type:"checkbox",id:"printAttributions",name:"printAttributions",checked:!0}),L("span",null,t.layersAttributions)))),o&&L("fieldset",{className:"sectionChecks extraInfo"},L("legend",null,t.extraInfo),L("div",{className:"sectionChecksList"},o.url&&L("label",{htmlFor:"printUrl"},L("input",{type:"checkbox",id:"printUrl",name:"printUrl",checked:!0}),L("span",null,t.url)),o.date&&L("label",{htmlFor:"printDate"},L("input",{type:"checkbox",id:"printDate",name:"printDate",checked:!0}),L("span",null,t.date)),o.specs&&L("label",{htmlFor:"printSpecs"},L("input",{type:"checkbox",id:"printSpecs",name:"printSpecs",checked:!0}),L("span",null,t.specs)))),L("div",{className:"safeMarginsSection sectionChecks"},L("label",{htmlFor:"safeMargins"},L("input",{type:"checkbox",id:"safeMargins",name:"safeMargins"}),L("span",null," ",t.printerMargins))))}Footer(t,e){const{mimeTypeExports:n}=e;return L("div",null,L("button",{type:"button",className:"btn-sm btn btn-secondary","data-dismiss":"modal"},t.cancel),L("div",{class:"typeExportContainer"},L("button",{type:"button",className:"btn-sm btn btn-primary","data-print":"true","data-dismiss":"modal"},t.print),L("select",{className:"typeExport",name:"printTypeExport",id:"printTypeExport"},n.map((t=>L("option",Object.assign({value:t.value},t.selected?{selected:"selected"}:{}),t.value)))))).outerHTML}hide(){this._modal.hide()}show(){this._modal._visible||this._modal.show()}}class Z{constructor(t,e,n){this._message=document.createElement("div"),this._loaderContainer=document.createElement("div"),this._i18n=t,this._modal=new N(Object.assign({headerClose:!1,title:this._i18n.printing,backdrop:"static",content:" ",footer:`\n            <button\n                type="button"\n                class="btn-sm btn btn-secondary"\n                data-dismiss="modal"\n            >\n                ${this._i18n.cancel}\n            </button>\n            `},e.modal)),this._modal.el.classList.add("processingModal"),this._modal.once("shown",(()=>{e.loader&&(this._loaderContainer.className="printLoader-container","string"==typeof e.loader?this._loaderContainer.innerHTML=e.loader:this._loaderContainer.appendChild(e.loader)),this._modal._html.body.append(this._message),this._modal._html.body.append(this._loaderContainer)})),this._modal.on("dismiss",(()=>{n()}))}_setContentModal(t){this._message.innerHTML=String(t)}_setFooterModal(t){this._modal._html.footer.innerHTML=t}show(){this._modal.show()}set(t){this._modal._visible&&this._setContentModal(t)}setLoading(t=!0){t?this._modal.el.classList.add("showLoader"):this._modal.el.classList.remove("showLoader")}hide(){this._modal.hide()}}var Q,tt=Object.freeze({__proto__:null,en:{printPdf:"Print PDF",pleaseWait:"Please wait...",downloadFinished:"Download finished, processing...",downloadingImages:"Downloading images",error:"An error occurred while printing",errorImage:"An error ocurred while loading an image",printing:"Exporting",cancel:"Cancel",close:"Close",print:"Export",mapElements:"Map elements",extraInfo:"Extra information",url:"URL",date:"Date",specs:"Specifications",compass:"Compass",scale:"Scale",legends:"Legends",layersAttributions:"Layer attributions",addNote:"Add note",resolution:"Resolution",orientation:"Orientation",paperSize:"Paper size",landscape:"Landscape",portrait:"Portrait",current:"Current",paper:"Paper",printerMargins:"Add printer margins",escapeHint:"Press here or Escape to cancel",reframeHint:"Pan and zoom to adjust the print area",process:"Process",zoomIn:"Zoom in",zoomOut:"Zoom out",rotateLeft:"Rotate left",rotateRight:"Rotate right"},es:{printPdf:"Exportar PDF",pleaseWait:"Por favor espere...",downloadFinished:"Descarga completada, procesando...",downloadingImages:"Descargando imágenes",error:"Error al generar pdf",errorImage:"Ocurrió un error al tratar de cargar una imagen",printing:"Exportando",cancel:"Cancelar",close:"Cerrar",print:"Exportar",mapElements:"Elementos en el mapa",extraInfo:"Información adicional",url:"URL",date:"Fecha",specs:"Especificaciones",compass:"Brújula",scale:"Escala",legends:"Leyendas",layersAttributions:"Atribuciones de capas",addNote:"Agregar nota",resolution:"Resolución",orientation:"Orientación",paperSize:"Tamaño de página",landscape:"Paisaje",portrait:"Retrato",current:"Actual",paper:"Hoja",printerMargins:"Añadir márgenes de impresión",escapeHint:"Presioná aquí o Escape para cancelar",reframeHint:"Paneá y zoomeá para ajustar el área de impresión",process:"Procesar",zoomIn:"Acercar",zoomOut:" Alejar",rotateLeft:"Rotatar a la izquierda",rotateRight:"Rotate a la derecha"}});function et(t,...e){return e.forEach((e=>{Object.keys(e).forEach((n=>{const i=e[n],o=t[n];t[n]=o&&i&&"object"==typeof o&&"object"==typeof i&&!Array.isArray(o)?et(o,i):i}))})),t}class nt extends t{constructor(t){const e=document.createElement("button");super({target:t.target,element:!1===t.showControlBtn?document.createElement("div"):e}),this._i18n=t.language&&t.language in tt?tt[t.language]:tt.en,t.i18n&&(this._i18n=Object.assign(Object.assign({},this._i18n),t.i18n)),this._options=(t=>({language:"en",filename:"Ol Pdf Printer",allowReframeRegionOfInterest:!0,zoomControlOnReframe:!0,rotationControlOnReframe:!0,style:{paperMargin:{left:4,top:4,right:4,bottom:4},watermark:{brcolor:"#000000",bkcolor:"#ffffff",txcolortitle:"#d54b4b",txcolorsubtitle:"#444444"},url:{brcolor:"#000000",bkcolor:"#ffffff",txcolor:"#0077cc"},specs:{brcolor:"#000000",bkcolor:"#ffffff",txcolor:"#000000"},scalebar:{brcolor:"#000000",bkcolor:"#ffffff",txcolor:"#000000"},attributions:{brcolor:"#ffffff",bkcolor:"#ffffff",txcolor:"#666666",txcolorlink:"#0077cc"},legends:{brcolor:"#000000",bkcolor:"#ffffff",txcolor:"#000000"},description:{brcolor:"#333333",bkcolor:"#333333",txcolor:"#ffffff"},compass:{brcolor:"#000000",bkcolor:"#333333"}},extraInfo:{date:!0,url:!0,specs:!0},description:!0,mapElements:{attributions:!0,scalebar:!0,legends:!0,compass:(new DOMParser).parseFromString('<?xml version="1.0" encoding="utf-8"?>\r\n<svg version="1.1" id="compass" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"\r\n\t viewBox="0 0 300 300" xml:space="preserve" width="50" height="50">\r\n<style type="text/css">\r\n\t.st0{fill:#d54b4b;}\r\n</style>\r\n<g>\r\n\t<g>\r\n\t\t<g>\r\n\t\t\t<g>\r\n\t\t\t\t<g>\r\n\t\t\t\t\t<path class="st0" d="M146.3,9.1L75.5,287.2c-0.5,1.8,0.5,3.7,2.1,4.4c1.8,0.8,3.7,0.2,4.7-1.5l68.4-106.7l66.8,106.7\r\n\t\t\t\t\t\tc0.6,1.1,1.9,1.8,3.2,1.8c0.5,0,1-0.2,1.5-0.3c1.8-0.8,2.6-2.6,2.3-4.4L153.7,9.1C152.9,5.7,147.2,5.7,146.3,9.1z M154.2,174.2\r\n\t\t\t\t\t\tc-0.6-1.1-1.9-1.8-3.2-1.8l0,0c-1.3,0-2.6,0.6-3.2,1.8l-59,92L150,25.5l61.1,239.9L154.2,174.2z"/>\r\n\t\t\t\t</g>\r\n\t\t\t</g>\r\n\t\t\t<g>\r\n\t\t\t\t<g>\r\n\t\t\t\t\t<path class="st0" d="M220.8,293.1c-1.8,0-3.4-1-4.2-2.3l-65.8-105.1L83.4,290.8c-1.3,1.9-4,2.9-6.1,1.9c-2.3-1-3.4-3.4-2.9-5.8\r\n\t\t\t\t\t\tL145.1,8.8c0.5-2.1,2.4-3.4,4.9-3.4s4.4,1.3,4.9,3.4l70.8,278.1c0.6,2.4-0.6,4.9-2.9,5.8C222.1,292.9,221.5,293.1,220.8,293.1z\r\n\t\t\t\t\t\t M150.8,181.2l1,1.6l66.8,106.7c0.6,1,1.9,1.5,3.2,1c1.1-0.5,1.8-1.8,1.5-3.1L152.4,9.3c-0.3-1.1-1.6-1.6-2.6-1.6\r\n\t\t\t\t\t\ts-2.3,0.5-2.6,1.6L76.4,287.4c-0.3,1.3,0.3,2.6,1.5,3.1c1.1,0.5,2.6,0,3.2-1L150.8,181.2z M85.6,273.2L150,20.6l64.2,251.9\r\n\t\t\t\t\t\tl-61.1-97.7c-1-1.6-3.4-1.5-4.4,0L85.6,273.2z"/>\r\n\t\t\t\t</g>\r\n\t\t\t</g>\r\n\t\t</g>\r\n\t</g>\r\n</g>\r\n</svg>\r\n',"image/svg+xml").firstChild},watermark:{title:"Ol Pdf Printer",subtitle:"https://github.com/GastonZalba/ol-pdf-printer",logo:!1},paperSizes:[{size:[594,420],value:"A2"},{size:[420,297],value:"A3"},{size:[297,210],value:"A4",selected:!0},{size:[210,148],value:"A5"}],dpi:[{value:96},{value:150,selected:!0},{value:200},{value:300}],mimeTypeExports:[{value:"pdf",selected:!0},{value:"png"},{value:"jpeg"},{value:"webp"}],units:Q.Metric,dateFormat:void 0,showControlBtn:!0,ctrlBtnClass:"",loader:'<span class="printLoader"></span>',modal:{animateClass:"fade",animateInClass:"show",transition:150,backdropTransition:0,templates:{dialog:'<div class="modal-dialog modal-dialog-centered"></div>',headerClose:`<button type="button" class="btn-close" data-dismiss="modal" aria-label="${t.close}"><span aria-hidden="true">×</span></button>`}}}))(this._i18n),this._options=et(this._options,t),this._options.showControlBtn&&(e.className=`ol-print-btn-menu ${this._options.ctrlBtnClass}`,e.title=this._i18n.printPdf,e.onclick=()=>this.showPrintSettingsModal(),e.append((new DOMParser).parseFromString('<?xml version="1.0" encoding="utf-8"?>\r\n<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"\r\n\t viewBox="0 0 256 256" style="enable-background:new 0 0 256 256;" xml:space="preserve">\r\n<g id="Layer_1">\r\n</g>\r\n<g id="Layer_2">\r\n\t<g>\r\n\t\t<path d="M77.4,175.5H64.1v23.7h13.2c3.7,0,6.7-3,6.7-6.7v-10.2C84.1,178.5,81.1,175.5,77.4,175.5z"/>\r\n\t\t<path d="M222.9,177.6v-31.2h-190v31.2v31.6v32.3c0,7,5.7,12.8,12.8,12.8h164.4c7,0,12.8-5.7,12.8-12.8L222.9,177.6\r\n\t\t\tL222.9,177.6z M94.7,192.4c0,9.6-7.8,17.3-17.3,17.3H64.1v18.2c0,2.9-2.4,5.3-5.3,5.3s-5.3-2.4-5.3-5.3v-23.5v-34.3\r\n\t\t\tc0-2.9,2.4-5.3,5.3-5.3h18.5c9.6,0,17.3,7.8,17.3,17.3V192.4z M147.9,214.7c0,10.2-8.3,18.6-18.6,18.6H112c-2.9,0-5.3-2.4-5.3-5.3\r\n\t\t\tv-57.8c0-2.9,2.4-5.3,5.3-5.3h17.3c10.2,0,18.6,8.3,18.6,18.6V214.7z M196.9,175.5h-25.3v18.3h14.7c2.9,0,5.3,2.4,5.3,5.3\r\n\t\t\ts-2.4,5.3-5.3,5.3h-14.7v23.6c0,2.9-2.4,5.3-5.3,5.3s-5.3-2.4-5.3-5.3v-57.8c0-2.9,2.4-5.3,5.3-5.3h30.6c2.9,0,5.3,2.4,5.3,5.3\r\n\t\t\tS199.8,175.5,196.9,175.5z"/>\r\n\t\t<path d="M129.3,175.5h-12v47.2h12c4.4,0,8-3.6,8-8v-31.2C137.3,179,133.7,175.5,129.3,175.5z"/>\r\n\t\t<path d="M222.9,59c0-3.4-1.3-6.6-3.7-9L174.3,5.1c-2.4-2.4-5.6-3.7-9-3.7H45.6c-7,0-12.8,5.7-12.8,12.8v108.5v18.9\r\n\t\t\th190V59z M164.2,86.3l-34.3,34.3c-0.5,0.5-1.3,0.8-2,0.8s-1.4-0.3-2-0.8L91.6,86.3c-0.8-0.8-1-2-0.6-3.1c0.4-1,1.5-1.7,2.6-1.7\r\n\t\t\tH107V48.4c0-1.6,1.3-2.8,2.8-2.8h36c1.6,0,2.8,1.3,2.8,2.8v33.1h13.5c1.1,0,2.2,0.7,2.6,1.7C165.2,84.3,165,85.5,164.2,86.3z"/>\r\n\t</g>\r\n</g>\r\n</svg>\r\n',"image/svg+xml").firstChild))}setMap(t){super.setMap(t),!this._initialized&&t&&this._init()}_init(){this._map=this.getMap(),this._view=this._map.getView(),this._mapTarget=this._map.getTargetElement(),this._settingsModal=new X(this._map,this._options,this._i18n,this._printMap.bind(this)),this._processingModal=new Z(this._i18n,this._options,this._onEndPrint.bind(this)),this._initialized=!0}_onEndPrint(){this._mapTarget.style.width="",this._mapTarget.style.height="",this._map.updateSize(),this._view.setResolution(this._initialViewResolution),this._view.setCenter(this._initialViewCoords),this._view.setConstrainResolution(this._initialConstrain),this._mapTarget.classList.remove(B,V),this._updateDPI(90),this._removeListeners(),clearTimeout(this._timeoutProcessing),this._processingModal.setLoading(!1),this._cancel()}_prepareLoading(){this._processingModal.show(),this._processingModal.setLoading(!0),this._processingModal.set(this._i18n.pleaseWait)}_disableLoading(){this._processingModal.hide(),this._processingModal.setLoading(!1)}_updateDPI(t=90){const e=t/90;this._map.pixelRatio_=e,this._map.getLayers().forEach((t=>{if(t.getVisible()&&"getSource"in t&&"function"==typeof t.getSource){const n=t.getSource();void 0!==n.tilePixelRatio_?(n.tilePixelRatio_=e,n.refresh()):t instanceof o&&(n instanceof i?n.getSource().changed():n.changed())}})),this._map.updateSize()}_printMap(t,n=!0,i=0){n&&this._mapTarget.classList.add(B,V),setTimeout((()=>{n&&this._prepareLoading(),this._isCanceled=!1,this._addDownloadCountListener(),this._initialViewResolution=this._view.getResolution(),this._initialViewCoords=this._view.getCenter(),this._initialConstrain=this._view.getConstrainResolution(),this._view.setConstrainResolution(!1);let i=this._options.paperSizes.find((e=>e.value===t.format)).size;i="landscape"===t.orientation?i:[...i].reverse();const o=i[0],s=i[1];this._updateDPI(t.resolution);const r=t.resolution/25.4,a=Math.round(o*r),c=Math.round(s*r),d=(t.scale&&!t.regionOfInterest?t.scale:((t,e=!0)=>{const n=t.getView(),i=n.getProjection().getUnits();let o=n.getResolution()*l.METERS_PER_UNIT[i]*39.37*(25.4/.28);return e&&(o=Math.round(o)),o})(this._map)/1e3)/e.getPointResolution(this._view.getProjection(),r,this._view.getCenter());this._renderCompleteKey=this._map.once("rendercomplete",(()=>{this._processingModal.set(this._i18n.downloadFinished),y.toJpeg(this._mapTarget.querySelector(".ol-unselectable.ol-layers"),{width:a,height:c}).then((async e=>{this._isCanceled||(this._pdf=new E({form:t,scaleResolution:d,map:this._map,i18n:this._i18n,config:this._options,height:s,width:o}),this._pdf.addMapImage(e),await this._pdf.addMapHelpers(),this._isCanceled||(await this._pdf.savePdf(),this._onEndPrint(),n&&this._disableLoading()))})).catch((t=>{const e="string"==typeof t?t:this._i18n.error;console.error(t),this._onEndPrint(),this._processingModal.set(e)}))})),this._mapTarget.style.width=a+"px",this._mapTarget.style.height=c+"px",this._map.getView().setResolution(d),this._map.updateSize(),t.regionOfInterest&&this._view.fit(t.regionOfInterest,{size:this._map.getSize(),nearest:!1})}),i)}_addDownloadCountListener(){const t=()=>{this._imageCount=this._imageCount+1,this._imageCount%10==0&&this._processingModal.set(this._i18n.downloadingImages+": <b>"+this._imageCount+"</b>")};this._eventsKey=[],this._imageCount=0,this._map.getLayers().getArray().forEach((e=>{"getSource"in e&&"function"==typeof e.getSource&&(this._eventsKey.push(e.getSource().on("tileloadend",(()=>t()))),this._eventsKey.push(e.getSource().on("imageloadend",(()=>t()))))}))}_removeListeners(){n.unByKey(this._eventsKey)}_cancel(){this._renderCompleteKey&&n.unByKey(this._renderCompleteKey),this._isCanceled=!0}showPrintSettingsModal(){this._settingsModal.show()}hidePrintSettingsModal(){this._settingsModal.hide()}createPdf(t,e){t={},this._printMap(Object.assign({format:(this._options.paperSizes.find((t=>t.selected))||this._options.paperSizes[0]).value,resolution:(this._options.dpi.find((t=>t.selected))||this._options.dpi[0]).value,orientation:"landscape",compass:!0,attributions:!0,scalebar:!0,legends:!0,regionOfInterest:null,typeExport:"pdf"},t),e)}}!function(t){t.Metric="metric",t.Imperial="imperial"}(Q||(Q={}));var it=Object.freeze({__proto__:null,get UnitsSystem(){return Q},default:nt});return Object.assign(nt,it),nt}));
//# sourceMappingURL=ol-pdf-printer.min.js.map
